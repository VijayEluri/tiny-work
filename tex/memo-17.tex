\begingroup %{
% 行列にも大文字を使いたいために集合を表す大文字を定義しておく。
\newcommand{\setA}{\mathbb{A}}
\newcommand{\setB}{\mathbb{B}}
\newcommand{\setC}{\mathbb{C}}
\newcommand{\setD}{\mathbb{D}}
\newcommand{\setX}{\mathbb{X}}
%
\newcommand{\bbA}{\mathbb{A}}
\newcommand{\bbB}{\mathbb{B}}
\newcommand{\bbC}{\mathbb{C}}
\newcommand{\bbX}{\mathbb{X}}
\newcommand{\bbY}{\mathbb{Y}}
\newcommand{\bbZ}{\mathbb{Z}}
%
\newcommand{\calA}{\mathcal{A}}
\newcommand{\calB}{\mathcal{B}}
\newcommand{\calC}{\mathcal{C}}
\newcommand{\calD}{\mathcal{D}}
\newcommand{\calJ}{\mathcal{J}}
\newcommand{\calT}{\mathcal{T}}
\newcommand{\calX}{\mathcal{X}}
\newcommand{\calY}{\mathcal{Y}}
\newcommand{\calZ}{\mathcal{Z}}
%
\newcommand{\A}{\mycal{A}}
\newcommand{\B}{\mycal{B}}
\newcommand{\C}{\mycal{C}}
\newcommand{\D}{\mycal{D}}
\newcommand{\E}{\mycal{E}}
\newcommand{\F}{\mycal{F}}
\newcommand{\I}{\mycal{I}}
\newcommand{\J}{\mycal{J}}
\newcommand{\M}{\mycal{M}}
\newcommand{\Q}{\mycal{Q}}
\newcommand{\T}{\mycal{T}}
\newcommand{\W}{\mycal{W}}
\newcommand{\Z}{\mycal{Z}}
\newcommand{\cat}[1]{\mybf{{#1}}}
\newcommand{\Pow}{\mycal{P}}
\newcommand{\End}{\myop{End}}
\newcommand{\Map}{\myop{Map}}
\newcommand{\Lin}{\mathcal{L}}
\newcommand{\Etaol}{\mathcal{H}}
\newcommand{\Aut}{\myop{Aut}}
\newcommand{\Mat}{\myop{Mat}}
\newcommand{\Etaom}{\myop{Hom}}
\newcommand{\Eta}{\mycal{H}}
\newcommand{\Weyl}[1]{\Eta\Braket{#1}}
%
\newcommand{\id}{\myop{id}}
\newcommand{\tran}{\mathbf{t}}
\newcommand{\dfn}{\,\myop{def}\,}
\newcommand{\xiff}[2][]{\xLongleftrightarrow[#1]{#2}}
\newcommand{\tr}{\myop{tr}}
%
\newcommand{\mvec}[2]{\begin{matrix}{#1}\\{#2}\end{matrix}}
\newcommand{\mvect}[2]{\begin{matrix}{#1}&{#2}\end{matrix}}
\newcommand{\pvec}[2]{\begin{pmatrix}{#1}\\{#2}\end{pmatrix}}
\newcommand{\pvect}[2]{\begin{pmatrix}{#1}&{#2}\end{pmatrix}}
\newcommand{\bvec}[2]{\begin{bmatrix}{#1}\\{#2}\end{bmatrix}}
\newcommand{\bvect}[2]{\begin{bmatrix}{#1}&{#2}\end{bmatrix}}
\newcommand{\ad}{\myop{ad}}
\newcommand{\Ad}{\myop{Ad}}
%
\newcommand{\smallxy}[1]{\vcenter{\xymatrix@R=4pt@C=4pt@M=1pt@W=1pt{#1}}}
\newcommand{\hen}{\ar@{-}}
\newcommand{\sbt}{\vcenter{\hbox{\tiny$\bullet$}}}
%
\newcommand{\what}{\widehat}
\newcommand{\wbar}[1]{{\widebar{#1}}}
\newcommand{\rvec}[1]{\overrightarrow{#1}}
\newcommand{\lvec}[1]{\overleftarrow{#1}}
\newcommand{\qhat}{{\widehat{q}}}
\newcommand{\Ihat}{{\widehat{I}}}
\newcommand{\Nhat}{{\widehat{N}}}
\newcommand{\Phat}{{\widehat{P}}}
\newcommand{\qbinom}[2]{\genfrac{[}{]}{0pt}{0}{#1}{#2}}
\newcommand{\ls}{{\lambda}}
\newcommand{\dupls}{\what{\lambda}}
% indicator
\newcommand{\isA}[1]{{\ensuremath{\plr{\mathchar`-\in{#1}}}}}
% lie algebra
\newcommand{\sll}{{\mathfrak{sl}}}
% matrix
\newcommand{\ei}[2]{{{\mathbf#1}_{#2}}}
\newcommand{\eij}[3]{{{\mathbf#1}_{#2}{\mathbf#1}_{#3}^\tran}}
%
\newcommand{\EOF}{{\diamondsuit}}
\newcommand{\dif}{{\partial}}
\newcommand{\uesita}[2]{\genfrac{}{}{0pt}{0}{#1}{#2}}
\newcommand{\op}[1]{\mathinner{{\operatorname{#1}}}}
\newcommand{\Res}{\ensuremath{\mathop\mathrm{Res}}}
%
\newcommand{\EOP}{\hspace{\fill}\P}
%
\newcommand{\opp}{{\op{op}}}
%
{\setlength\arraycolsep{2pt}
%
\section{Haskellのメモ}\label{s1:Haskellのメモ} %{
\subsection{圏論}\label{s2:圏論} %{
	圏論をおさらいする。随伴関手からモナドを導くことを目標にする。
\subsubsection{Hom関手}\label{s3:Hom関手} %{
	$A$を局所的に小さい圏とする。 任意の$a\in A_0$に対して関手
	$A(a,-):A\to\cat{Set}$と$A(-,a):A\to\cat{Set}$を次のように定義する。
	\begin{equation}\label{eq:Hom関手の定義}\xymatrix@C=7ex{
		A(b,a) & b \ar[r]^{A(a,-)} \ar[l]_{A(-,a)} \ar[d]^f 
		& A(a,b) \ar[d]^{A(a,-)f:=f-} \\
		A(c,a) \ar[u]^{A(-,a)f:=-f} & c \ar[r]^{A(a,-)} \ar[l]_{A(-,a)} 
		& A(a,c) \\
	} \quad\text{for all } \xymatrix{
		b \ar[d]^f \\ c
	} \in A
	\end{equation}
	$A(a,-)$を$a$を点とする共変Hom関手といい、
	$A(-,a)$を$a$を点とする反変Hom関手という。

	Hom関手は$\op{hom}$と書かれることが多いが、このノートでは関手$\op{hom}$
	を$\op{hom}(a,-):A\to\cat{Set}$と$\op{hom}(-,a):A^\opp\to\cat{Set}$と
	両者共に共変関手として定義する（節\ref{s3:双対圏}）。

	一般に、反変関手というのは射の合成が逆順になる関手に対して使われる。
	半群の逆順の準同型に対応するものになっている。単に関手といった場合は、
	共変関手を指す。
	\begin{equation*}\begin{array}{rl}
		\text{共変関手} & F(a\xto{f}b\xto{g}c) = Fa\xto{Ff}Fb\xto{Fg} c \\
		\text{反変関手} & F(a\xto{f}b\xto{g}c) = Fa\xfrom{Ff}Fb\xfrom{Fg} c \\
	\end{array}\end{equation*}
%s3:Hom関手}
\subsubsection{双対圏}\label{s3:双対圏} %{
	$A$を圏とする。$A$の射の向きを反転させたものもまた圏となる。
	それを$A$の双対圏といい$A^\opp$と書く。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[対象と射] $a\xto{f}b\in A$ならば$a\xfrom{f^\opp}b\in A^\opp$
		\item[射の合成] $a\xto{f}b\xto{g}c\in A$ならば
		$a\xfrom{f^\opp}b\xfrom{g^\opp}c\in A^\opp$
	\end{description} %}

	圏の双対を次の例を考えてみよう。
	\begin{equation*}\begin{split}
		\vcenter{\xymatrix{
			A \ar[r]^f & B
		}} \xmapsto{-^\opp} \vcenter{\xymatrix{
			A & B \ar[l]_{f^\opp}
		}} \quad\text{where } \begin{split}
			A := \set{a_1,a_2},\quad B := \set{b} \\
			fa = b \quad\text{for all } a\in A
		\end{split}
	\end{split}\end{equation*}
	元の圏では射$f$は写像だた、その双対圏では射$f^\opp$は写像ではなく
	逆写像である。このように、一般には、双対をとると射が意味するものが
	変わる。

	関手の双対を次のように定義する。
	\begin{equation*}\begin{split}
		F:A\to B \implies F^\opp: A^\opp\to B^\opp
		\quad\text{where } A,B\text{ are categories} \\
		Fa\xto{Ff}Fb \implies F^\opp a\xfrom{F^\opp f^\opp} F^\opp b
		\quad\text{for all } a\xto{f}b\in A
	\end{split}\end{equation*}

	関手$F:A^\opp\to B$は次のような操作だが、
	\begin{equation*}\begin{split}
		F\plr{a\xfrom{f^\opp}b} = Fa\xfrom{Ff^\opp}Fb
		\quad\text{for all } a\xfrom{f^\opp}b\in A^\opp
	\end{split}\end{equation*}
	同じことは次の関手$\wbar{F}:A\to B$で実現できる。
	\begin{equation*}\begin{split}
		\wbar{F}\plr{a\xto{f}b} = Fa\xfrom{Ff^\opp}Fb
		\quad\text{for all } a\xto{f}b\in A
	\end{split}\end{equation*}
	$F$は共変関手、$\wbar{F}$は反変関手であるが、内容は同じである。
	一般的に、反変関手は、領域の双対をとることで、共変関手として書くことが
	できる。このノートでは、\cite{maclane.work}にしたがって、共変関手のみを
	使って話を進めることにする。

	双対圏を使うと、Hom関手は共変関手のみで書くことができる。
	$A$を圏として、関手$\op{hom}(a,-)$と$\op{-,a}$を次のように定義する。
	\begin{equation*}\begin{array}{lclcl}
		\op{hom}(a,-): A\to\cat{Set}, &\quad& \op{hom}(-,a): A^\opp\to\cat{Set}
		&\quad& \text{for all } a\in A_0 \\
		\xymatrix@C=10ex{
			b \ar[r]^{\op{hom}(a,-)} \ar[d]^f & A(a,b) \ar[d]^{f-} \\
			c \ar[r]^{\op{hom}(a,-)} & A(a,c) \\
		}, &\quad&\xymatrix@C=10ex{
			b \ar[r]^{\op{hom}(-,a)} & A(b,a) \\
			c \ar[r]^{\op{hom}(-,a)} \ar[u]_{f^\opp} & A(c,a) \ar[u]_{-f} \\
		} &\quad&\text{for all } \xymatrix{
			b \ar[d]^f \\ c
		} \in A
	\end{array}\end{equation*}
	前述のHom関手の定義\eqref{eq:Hom関手の定義}と見比べると、
	共変Hom関手は$\op{hom}(a,-)=A(a,-):A\to\cat{Set}$で記号を書き換えただけ
	だが、反変Hom関手は$A(-,a):A\to\cat{Set}$から
	$\op{hom}(-,a):A^\opp\to\cat{Set}$と領域をその双対に変更している。
%s3:双対圏}
\subsubsection{圏の積}\label{s3:圏の積} %{
	$A,B$を圏とするとき、圏の積$A\times B$は次のように定義される。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[対象と射] $a\xto{f}a'\in A$かつ$b\xto{g}b'\in B$ならば
		$a\times b\xto{f\times g}a'\times b'\in A\times B$とする。
		\item[射の合成] 
		$a\times b\xto{f\times g}a'\times b'\xto{f'\times g'}a''\times b''
		\in A\times B$ならば$a\times b\xto{f'f\times g'g}a''\times b''
		\in A\times B$とする。
		\item[射影] 関手$P_1:A\times B\to A$と$P_2:A\times B\to B$が定義され、
		任意の圏$C$と関手$F_1:C\to A$と$F_2:C\to B$に対して次の図を可換にする
		関手$G:C\to A\times B$が唯一つ存在する。
		\begin{equation}\label{射影関手の定義}\begin{split}
			\xymatrix{
				& C \ar[dl]_{F_1} \ar[dr]^{F_2} \ar@{.>}[d]^{G} \\
				A & A\times B \ar[l]_{P_1} \ar[r]^{P_2} & B \\
			}
		\end{split}\end{equation}
	\end{description} %}
	圏の積は、集合の直積に射の合成を付け加えたものと形式的に同じである。

	圏の積を扱ううえでよく使う関手の族を定義しておく。次の関手の族を、
	\begin{equation*}\begin{split}
		-\times b:A\to A\times B \quad\text{for all } b\in B_0 \\
		a\times-:B\to A\times B \quad\text{for all } a\in A_0
	\end{split}\end{equation*}
	任意の$a\times b \xto{f\times g} a'\times b'\in A\times B$に対して
	次のように定義する。
	\begin{equation}\label{eq:関手の積への入射族}\begin{split}
		\xymatrix{
			a \ar[r]^{-\times b} \ar[d]^f 
			& a\times b \ar[d]^{(-\times b)f := f\times 1_b} \\
			a' \ar[r]^{-\times b} & a'\times b \\
		},\quad\xymatrix{
			b \ar[r]^{a\times-} \ar[d]^g
			& a\times b \ar[d]^{(a\times-)g := 1_a\times g} \\
			b' \ar[r]^{a\times-}
			& a\times b' 
		}
	\end{split}\end{equation}
	そして、任意の$a\times b \xto{f\times g}a'\times b'\in A\times B$に対して
	次の簡略化した記法を使うことにする\cite{maclane.work}。
	\begin{alignat*}{2}
		f\times b &:= (-\times b) f &&= f\times 1_b \\
		a\times g &:= (a\times -) g &&= 1_a\times g
	\end{alignat*}

	圏の積からの関手$S:A\times B\to C$を双関手という。
	双関手は射影関手\eqref{射影関手の定義}の定義にある$G:C\to A\times B$
	の逆になる関手である。関手の族\ref{eq:関手の積への入射族}との合成に
	よって、次の関手が得られる。
	\begin{equation*}\begin{split}
		S(-\times b): A\to C \quad\text{for all } b\in B_0 \\
		S(a\times-): B\to C \quad\text{for all } a\in A_0
	\end{split}\end{equation*}
	可換図で書くとに次のようになっている。
	\begin{equation*}\begin{split}
		\xymatrix{
			& C \\
			A \ar@{.>}[ur]^{S(-\times b)} \ar[r]^{-\times b} 
			& A\times B \ar[u]_{S} 
			& B \ar@{.>}[ul]_{S(a\times-)} \ar[l]_{a\times-}
		} \quad\text{for all } a\in A_0,\; b\in B_0 \\
	\end{split}\end{equation*}
	逆に、次の関手の族$M_b$と$L_a$が与えられた時、次の図を可換にする関手
	$T:A\times B\to C$が存在するための条件を述べているのが、次の命題である。
	\begin{equation*}\begin{split}
		\xymatrix{
			& C \\
			A \ar[ur]^{M_b} \ar[r]^{-\times b} & A\times B \ar@{.>}[u]_{T} 
			& B \ar[ul]_{L_a} \ar[l]_{a\times-}
		} \quad\text{for all } a\in A_0,\; b\in B_0 \\
	\end{split}\end{equation*}

	\begin{proposition}[双関手の構成]\label{prop:双関手の構成} %{
		（\cite{maclane.work} p.37 命題1）
		$A,B,C$を圏とする。$L_b:A\to C$と$M_a:B\to C$を次の関手の族とする。
		\begin{equation*}\begin{split}
			A\xto{L_b} C\xfrom{M_a} B \quad\text{with } L_ba = M_ab
			\quad\text{for all } a\in A_0,\; b\in B_0
		\end{split}\end{equation*}
		このとき、
		\begin{enumerate}\setlength{\itemsep}{-1mm} %{
			\item\label{item:双関手の構成その一} 次の可換図が成り立つことと、
			\begin{equation*}\begin{split}
				\xymatrix{
					L_ba=M_ab \ar[r]^{M_ag} \ar[d]^{L_bf} 
					& L_{b'}a=M_ab' \ar[d]^{L_{b'}f} \\
					L_ba'=M_{a'}b \ar[r]^{M_{a'}g} & L_{b'}a'=M_{a'}b' \\
				} \quad\text{for all } \xymatrix{
					a\times b \ar[d]^{f\times g} \\ a'\times b'
				}\in A\times B
			\end{split}\end{equation*}
			\item\label{item:双関手の構成その二} 次の図を可換にする関手
			$S:A\times B\to C$が存在することは、
			\begin{equation*}\begin{split}
				\xymatrix{
					& C \\
					A \ar[ur]^{L_b} \ar[r]^{-\times b} 
					& A\times B \ar@{.>}[u]_{S} & B \ar[ul]_{M_a} \ar[l]_{a\times-}
				} \quad\text{for all } a\in A_0,\; b\in B_0 \\
			\end{split}\end{equation*}
		\end{enumerate} %}
		同値である。\EOP
	\end{proposition} %prop:双関手の構成}
	\begin{proof} %{
		\ref{item:双関手の構成その一}の可換図が成り立つとすると、
		双関手$T:A\times B\to C$を次のように定義するとことができる。
		\begin{equation*}\begin{split}
			\xymatrix{
				a\times b \ar[r]^(.3){T} \ar[d]^{f\times g}
				& T(a\times b) := L_ba = M_ab \ar[d]^{T(f\times g) 
				:= (L_bf)(M_{a'}g) = (M_ag)(L_{b'}f)} \\
				a'\times b' \ar[r]^(.3){T} & T(a'\times b') := L_{b'}a' = M_{a'}b'
			}
		\end{split}\end{equation*}
		ここで定義した$T$を$S$とすると、\ref{item:双関手の構成その一}$\implies$
		\ref{item:双関手の構成その二}が示される。
		また、圏の積の定義より、次の可換図が成り立つ。
		\begin{equation*}\begin{split}
			\xymatrix{
				a\times b \ar[r]^{a\times g} \ar[d]^{f\times b} 
				& a\times b' \ar[d]^{f\times b'} \\
				a'\times b \ar[r]^{a'\times g} & a'\times b' \\
			} \quad\text{for all } \xymatrix{
				a\times b \ar[d]^{f\times g} \\ a'\times b'
			}\in A\times B
		\end{split}\end{equation*}
		この可換図に$S$を作用させて、\ref{item:双関手の構成その二}の可換図から
		得られる次の式を代入すると、
		\begin{equation*}\begin{split}
			L_b(a\xto{f}a') = S(a\times b\xto{f\times b}a'\times b) \\
			M_a(b\xto{g}b') = S(a\times b\xto{a\times g}a\times b')
		\end{split}\end{equation*}
		\ref{item:双関手の構成その一}の可換図が得られる。
		したがって、\ref{item:双関手の構成その二}$\implies$
		\ref{item:双関手の構成その一}が示される。
	\end{proof} %}

	この命題の条件\ref{item:双関手の構成その一}にある可換図は次の自然変換
	の組を与えている。
	\begin{alignat*}{2}
		L_-f &: M_a\xto{\bullet} M_{a'} 
		&\quad&\text{for all } a\xto{f}a'\in A \\
		M_-g &: L_b\xto{\bullet} L_{b'}
		&\quad&\text{for all } b\xto{g}b'\in B %\\
	\end{alignat*}
	この自然変換は米田の補題で重要な役割を果たすようだ。

	双関手の自然変換について考える。
	$S,T:A\times B\to C$を二つの双関手とし、$\phi$を次の$C$の射の族とする。
	\begin{equation*}\begin{split}
		\phi(a, b): S(a\times b)\to T(a\times b)
		\quad\text{for all } a\in A_0,\; b\in B_0
	\end{split}\end{equation*}
	$\phi$が自然変換$S\xto{\bullet}T$ならば、任意の$b\in B_0$に対して
	次の可換図が成り立ち、
	\begin{equation*}\begin{split}
		\xymatrix{
			S(a\times b) = S(-\times b)a 
			\ar[d]^{S(f\times b) = S(-\times b)f} \ar[r]^{\phi(a,b)}
			& T(a\times b) = T(-\times b)a 
			\ar[d]^{T(f\times b) = T(-\times b)f} \\
			S(a'\times b) = S(-\times b)a' \ar[r]^{\phi(a',b)} 
			& T(a'\times b) = T(-\times b)a' \\
		} \quad\text{for all } \xymatrix{
			a \ar[d]^f \\ a'
		}\in A
	\end{split}\end{equation*}
	$\phi(-,b):S(-\times b)\xto{\bullet}T(-\times b)$は自然変換となる。
	同様に、任意の$a\in A_0$に対して
	$\phi(a,-):S(a\times -)\xto{\bullet}T(a\times -)$は自然変換となるから、
	次の式が成り立つ。
	\begin{equation*}\begin{split}
		\phi:S\xto{\bullet}T \implies \begin{cases}
			\phi(-,b): S(-\times b)\xto{\bullet}T(-\times b)
			&\quad\text{for all } b\in B_0 \\
			\phi(a,-): S(a\times -)\xto{\bullet}T(a\times -)
			&\quad\text{for all } a\in A_0 \\
		\end{cases}
	\end{split}\end{equation*}
	また、逆に、次の式が成り立てば、
	\begin{alignat*}{2}
		\phi(-,b) &: S(-\times b)\xto{\bullet}T(-\times b)
		&\quad&\text{for all } b\in B_0 \\
		\phi(a,-) &: S(a\times -)\xto{\bullet}T(a\times -)
		&\quad&\text{for all } a\in A_0 \\
	\end{alignat*}
	任意の$a\times b \xto{f\times g} a'\times b'$に対して
	次の可換図が成り立つから、
	\begin{equation*}\begin{split}
		\xymatrix{
			S(a\times b) = S(-\times b)a \ar[r]^{\phi(a,b)}
			\ar[d]^{S(f\times b) = S(-\times b)f}
			& T(a\times b) = T(-\times b)a 
			\ar[d]^{T(f\times b) = T(-\times b)f} \\
			S(a'\times b) = S(-\times b)a' \ar[r]^{\phi(a',b)} 
			\ar[d]^{S(a'\times g) = S(a'\times -)g}
			& T(a'\times b) = T(-\times b)a'
			\ar[d]^{T(a'\times g) = T(a'\times -)g} \\
			S(a'\times b') = S(a'\times -)b' \ar[r]^{\phi(a',b')} 
			& T(a'\times b') = T(a'\times -)b'
		}
	\end{split}\end{equation*}
	次の式が成り立つことがわかる。
	\begin{equation}\label{eq:双関手の自然変換}\begin{split}
		\phi:S\xto{\bullet}T \iff \begin{cases}
			\phi(-,b): S(-\times b)\xto{\bullet}T(-\times b)
			&\text{for all } b\in B_0 \\
			\phi(a,-): S(a\times -)\xto{\bullet}T(a\times -)
			&\text{for all } a\in A_0 \\
		\end{cases}
	\end{split}\end{equation}

	$A$を圏とし、圏の積$A\times\mathbf{2}$を考える。ここでは、$\mathbf{2}$
	の対象を$0$と$1$とし、射を$\uparrow:0\to1$とする。
	関手$-\times0:A\to A\times\mathbf{2}$と
	$-\times1:A\to A\times\mathbf{2}$を次のように定義すると、
	\begin{equation*}\begin{split}
		(-\times0)(a\xto{f}a') &:= (a\times0)\xto{f\times0}(a'\times0) \\
		(-\times1)(a\xto{f}a') &:= (a\times1)\xto{f\times1}(a'\times1)
	\end{split}
	\quad\text{for all } a\xto{f}a'\in A
	\end{equation*}
	自然変換$\mu:(-\times0)\xto{\bullet}(-\times1)$が次のように定義できる。
	\begin{equation*}\begin{split}
		\mu a = a\times\uparrow \quad\text{for all } a\in A_0
	\end{split}\end{equation*}
	$B$を圏とし、二つの関手$F,G:A\to B$とのその間の自然変換
	$\phi:F\xto{\bullet}G$が与えられたとする。このとき、
	関手$S:A\times\mathbf{2}\to B$を、任意の$a\xto{f}a'\in A$に対して
	次の可換図が成り立つように定義する。
	\begin{equation*}\begin{split}
		\xymatrix{
			a\times0 \ar[d]^{\mu a} \ar[r]^{a\times\uparrow}
			& a\times1 \ar[d]^{f\times1} \\
			a'\times0 \ar[r]^{a'\times\uparrow} & a'\times1 \\
		} \xto{S} \xymatrix@C=8ex{
			S(a\times0)=Fa \ar[d]^{S(f\times0)=Ff} \ar[r]^{S\mu a=\phi a} 
			& S(a\times1)=Ga \ar[d]^{S(f\times1)=Gf} \\
			S(a'\times0)=Fa' \ar[r]^{S\mu a'=\phi a'} & S(a'\times1)=Ga' \\
		}
	\end{split}\end{equation*}
	すると、自然変換が$\phi=S\mu$と書くことができる。このために、$\mu$の
	ことを普遍自然変換というらしいが、\cite{maclane.work}以外では
	目にしたことがない。
%s3:圏の積}
\subsubsection{関手圏}\label{s3:関手圏} %{
	$A,B$を圏、$F,G,H:A\to B$を関手、$\phi:F\xto{\bullet}G$と
	$\psi:G\xto{\bullet}H$を自然変換とする。$\phi$と$\psi$の積$*$を次の
	ように定義すると、
	\begin{equation*}\begin{split}
		(\phi*\psi)a := (\phi a)(\psi a) \quad\text{for all } a\in A_0
	\end{split}\end{equation*}
	$\phi*\psi:F\xto{\bullet}H$となる。可換図で書くと次のようになる。
	\begin{equation*}\xymatrix{
		Fa \ar[r]^{\phi a} \ar[d]^{Ff} \ar@(ur,ul)[rr]^{(\phi*\psi)a} 
		& Ga \ar[r]^{\psi a} \ar[d]^{Ff} 
		& Ha \ar[d]^{Hf} \\
		Fa' \ar[r]^{\phi a'} \ar@(dr,dl)[rr]_{(\phi*\psi)a} 
		& Ga' \ar[r]^{\psi a'}	& Ha'
	} \quad\text{for all } \xymatrix{
		a \ar[d]^f \\ a'
	}\in A
	\end{equation*}
	さらに、$1_F:F\xto{\bullet}F$を次のように定義すると、
	\begin{equation*}\begin{split}
		1_Fa = 1_{Fa} \quad\text{for all } a\in A_0
	\end{split}\end{equation*}
	$1_F$が積$*$の単位元となる。したがって、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 関手$A\to B$を対象とし、
		\item 関手間の自然変換を射とする
	\end{itemize} %}
	圏を考えることができる。この圏を関手圏といい$B^A$または$\op{Funct}(A,B)$
	と書く。

	$M$をモノイド（対象が一つだけの圏）とし、$\cat{Mod}_R$を可換環$R$上の
	加群の圏とする。$M$は対象が一つだけの圏だから、関手$M\to\cat{Mod}_K$は
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $\cat{Mod}_K$の対象のベクトル空間$V$を一つ選びだして、
		\item モノイドの元を$V$の自己線形射に対応させれば定まる。
	\end{itemize} %}
	したがって、$\cat{Mod}_R^M$の対象はモノイドの表現となる。
	$\cat{Mod}_R^M$の射は何を表すのか考えよう。
	$F,G:M\to\cat{Mod}_K$を関手とし、$\phi:F\xto{\bullet}G$を自然変換とし、
	$\bullet$を$M$とすると、次の可換図が成り立つ。
	\begin{equation*}\begin{split}
		\xymatrix{
			F\bullet \ar[r]^{\phi} \ar[d]^{Ff} & G\bullet \ar[d]^{Gf} \\
			F\bullet \ar[r]^{\phi} & G\bullet \\
		} \quad\text{for all } \xymatrix{
			\bullet \ar[d]^f \\ \bullet
		}\in M
	\end{split}\end{equation*}
	したがって、$\cat{Mod}_R^M$の射は表現のインターツイナーとなっていることが
	わかる。

	\begin{equation*}\begin{split}
		\op{hom}(A\times B, C) \simeq \op{hom}\gplr{A, \op{hom}(B,C)}
	\end{split}\end{equation*}
%s3:関手圏}
\subsubsection{圏の積とHom関手}\label{s3:圏の積とHom関手} %{
	$A$を局所的に小さい圏として関手$\op{hom}:A^\opp\times A\to\cat{Set}$を
	次のように定義する。
	\begin{equation*}\begin{split}
		\xymatrix{
			a\times b \ar[r]^{\op{hom}} \ar[d]^{f^\opp\times g} 
			& A(a,b) \ar[d]^{g-f} \\
			a'\times b' \ar[r]^{\op{hom}} & A(a',b') 
		} \quad\text{for all } \xymatrix{
			a\times b \ar[d]^{f^\opp\times g} \\
			a'\times b' 
		} \in A^\opp\times A
	\end{split}\end{equation*}
	この$\op{hom}$が関手になることは、実際に計算して確かめることもできるが、
	\begin{equation*}\begin{split}
		\op{hom}(f,b) := \op{hom}(-,b) f = -f \\
		\op{hom}(a,g) := \op{hom}(a,-) g = g-
	\end{split}
		\quad\text{for all } a\times b\xto{f^\opp\times g}a'\to b'
		\in A^\opp\times A
	\end{equation*}
	とおくと、次の可換図が成り立つから、
	\begin{equation}\label{eq:Hom関手の可換性}\begin{split}
		\xymatrix@C=8ex{
			\op{hom(a,b)} \ar[r]^{\op{hom}(a,g)} \ar[d]^{\op{hom}(f,b)}
			& \op{hom(a,b')} \ar[d]^{\op{hom}(f,b')} \\
			\op{hom(a',b)} \ar[r]^{\op{hom}(a',g)} & \op{hom(a',b')} \\
		} \quad\text{for all } \xymatrix{
			a\times b\ar[d]^{f^\opp\times g} \\ a'\times b'
		} \in A^\opp\times A
	\end{split}\end{equation}
	命題\ref{prop:双関手の構成}からわかる。また、この可換図から次の自然変換
	の組が得られる。
	\begin{alignat*}{2}
		\op{hom}(f,-) &: \op{hom}(a,-)\xto{\bullet} \op{hom}(a',-)
		&\quad&\text{for all } a\xto{f^\opp} a'\in A^\opp \\
		\op{hom}(-,g) &: \op{hom}(-,b)\xto{\bullet} \op{hom}(-,b')
		&\quad&\text{for all } b\xto{g} b'\in A %\\
	\end{alignat*}
	これを集合の包含関係で書くと次のようになる。
	\begin{alignat*}{2}
		A^\opp(a,a') &\subseteq \Set{\op{hom}(a,-)\xto{\bullet}\op{hom}(a',-)}
		&\quad&\text{for all } a,a'\in A_0 \\
		A(b,b') &\subseteq \Set{\op{hom}(-,b)\xto{\bullet}\op{hom}(-,b')}
		&\quad&\text{for all } b,b'\in A_0 %\\
	\end{alignat*}
%s3:圏の積とHom関手}
\subsubsection{Hom集合による随伴関手}\label{s3:Hom集合による随伴関手} %{
	随伴関手の定義はいくつかあるが、ここでは、Hom集合を用いて随伴関手を
	定義する。
	
	$A,X$を局所的に小さい圏、$X\xtofrom{F}{G}A$を関手とする。このとき、
	関手$X(F-,-):A\times G\to\cat{Set}$と$A(-,G-):A\times G\to\cat{Set}$を
	次のように定義することができる。
	\begin{equation*}\xymatrix@C=8ex{
		A(a,Gx) \ar[d]^{f\times Gg}
		& a\times x \ar[r]^{X(F-,-)} \ar[l]_{A(-,G-)} \ar[d]^{f\times g}
		& X(Fa,x) \ar[d]^{Ff\times g} \\
		A(b,Gy) & b\times y \ar[r]^{X(F-,-)} \ar[l]_{A(-,G-)} & X(Fb,y) \\
	} \quad\text{for all } \xymatrix{
		a\times x \ar[d]^{f\times g} \\ b\times y
	} \in A\times X
	\end{equation*}
	$\cat{Set}$に自然同型$\phi:X(F-,-)\simeq A(-,G-)$が存在するとき、
	組$(F,G,\phi)$をHom集合による随伴といい、$F$を左随伴、$G$を右随伴という。
	\begin{equation*}\xymatrix@C=8ex{
		A(a,Gx) \ar[d]^{f\times Gg}
		& a\times x \ar[r]^{X(F-,-)} \ar[l]_{A(-,G-)} \ar[d]^{f\times g}
		& X(Fa,x) \ar[d]^{Ff\times g} \ar@(u,u)[ll]_{\phi_{a,x}} \\
		A(b,Gy) & b\times y \ar[r]^{X(F-,-)} \ar[l]_{A(-,G-)} & X(Fb,y) 
		\ar@(d,d)[ll]^{\phi_{b,y}} \\
	} \quad\text{for all } \xymatrix{
		a\times x \ar[d]^{f\times g} \\ b\times y
	} \in A\times X
	\end{equation*}
	Hom集合による随伴は自然同型が次の形がベクトルの共役と類似しているために
	覚えやすい。
	\begin{equation*}\begin{split}
		\phi_{a,x}: X(Fa,x)\simeq A(a,Gx)
		\quad\text{for all } a\in A_0,\; x\in X_0
	\end{split}\end{equation*}

	Hom集合による随伴$(F,G,\phi)$が与えられると、
	射の族$u_a:a\to GFa$と$\epsilon_x:FGx\to x$を次のように定義することが
	できる。
	\begin{alignat*}{2}
		u_a &:= \phi_{a,Fa}1_{Fa} &\quad&\text{for all } a\in A_0 \\
		\epsilon_x &:= \phi_{Gx,x}^{-1}1_{Gx} &\quad&\text{for all } x\in X_0
	\end{alignat*}
%s3:Hom集合による随伴関手}
%s2:圏論}
%s1:Haskellのメモ}
\section{Connes-Kreimer代数}\label{s1:Connes-Kreimer代数} %{
\subsection{Brzozowski代数}\label{s2:Brzozowski代数} %{
\subsubsection{Brzozowski代数の準備}\label{s3:Brzozowski代数の準備} %{
	$\jitu\sizen$の基底系をケットを使って書く。
	\begin{equation*}\begin{split}
		\jitu\sizen = \op{span}_\jitu\Set{\ket{n}\bou n\in\sizen}
	\end{split}\end{equation*}
	$\jitu\sizen$の共役空間
	$\jitu\sizen^\flat:=\cat{Mod}_\jitu(\jitu\sizen,\;\jitu)$の基底系を
	を次のように書き、
	\begin{equation*}\begin{split}
		\braket{m|n} = \jump{m=n} \quad\text{for all } m,n\in\sizen
	\end{split}\end{equation*}
	線形射$\myhere^\flat:\jitu\sizen\to\jitu\sizen^\flat$と
	$\myhere^\flat:\jitu\sizen^\flat\to\jitu\sizen$を次のように定義する。
	\begin{equation*}\begin{split}
		\ket{n}^\flat := \bra{n},\quad \bra{n}^\flat := \ket{n}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}

	$m_0:\jitu\sizen\otimes\jitu\sizen\to\jitu\sizen$を次のように定義すると、
	\begin{equation*}\begin{split}
		m_0\ket{m}\otimes\ket{n} := \ket{m+n} \quad\text{for all } m,n\in\sizen
	\end{split}\end{equation*}
	$m_0$は$\ket{0}$を単位元に持つ積となり、$\jitu\sizen^\flat$への作用は
	次のようになる。
	\begin{equation*}\begin{split}
		\bra{n}m_0 = \sum_{k=0}^n \bra{k}\otimes\bra{n-k}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	テンソル積の内積を次のように定義すると、
	\begin{equation*}\begin{split}
		\gplr{\bra{m_1}\otimes\bra{m_2}}\gplr{\ket{n_1}\otimes\ket{n_2}}
		:= \braket{m_1|n_1}\braket{m_2|n_2}
		\quad\text{for all } m_1,m_2,n_1,n_2,\in\sizen
	\end{split}\end{equation*}
	$m_0$の共役として線形射
	$m_0^\flat:\jitu\sizen\to\jitu\sizen\otimes\jitu\sizen$が次のように
	定義される。
	\begin{equation*}\begin{split}
		m_0^\flat\ket{n} = \sum_{k=0}^n \ket{k}\otimes\ket{n-k}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}

	線形射$\eta^\flat:\jitu\sizen\to\jitu\sizen$を$m_0$によって、
	次のように定義すると、
	\begin{equation*}\begin{split}
		\eta^\flat\phi := m_0\ket{1}\otimes\phi
		\quad\text{for all } \phi\in\jitu\sizen
	\end{split}\end{equation*}
	$\eta^\flat$とその共役$\eta$の基底系への作用は次のようになる。
	\begin{equation*}\begin{split}
		\eta\ket{n} = \jump{1\le n}\ket{n-1},\quad
		\eta^\flat\ket{n} = \ket{n+1} \quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	$\eta$の固有状態$\ket{x}_c$は、Kleeneスターを用いて次のように書ける。
	\begin{equation*}\begin{split}
		\ket{x}_c := (x\eta^\flat)^*\ket{0} \quad\text{for all } x\in\jitu
	\end{split}\end{equation*}
	また、$\jitu[x]$の元を用いて$\jitu\sizen$の元を次のように書く事にすると、
	\begin{equation*}\begin{split}
		\ket{f}_x := (f|\eta^\flat)\ket{0}
		\quad\text{for all } f\in\jitu[x]
	\end{split}\end{equation*}
	$\jitu\sizen$と$\jitu[x]$は次の関係になる。
	\begin{equation*}\begin{split}
		{}_c\braket{x|f}_x = (f|x) \quad\text{for all } f\in\jitu[x]
	\end{split}\end{equation*}
	特に、数状態については次のようになる。
	\begin{equation*}\begin{split}
		{}_c\braket{x|n} = x^n \quad\text{for all } n\in\sizen
	\end{split}\end{equation*}

	$\Ihat_0:=\ket{0}\bra{0}:\jitu\sizen\to\jitu\sizen$とすると、
	次の交換関係が成り立つ。
	\begin{equation*}\begin{split}
		\eta^\flat m_0 = m_0\gplr{\eta^\flat\otimes\id},\quad
		\eta m_0 = m_0\gplr{\eta\otimes\id + \Ihat_0\otimes\eta}
	\end{split}\end{equation*}

	$\jitu\sizen$をq-拡張する。$\jitu_q$を$\jitu[q]$の有理数体とし、
	$\jitu_q\sizen$を考える。自然な入射$\jitu\sizen\subset\jitu_q\sizen$に
	よって、$m_0,\eta,\eta^\flat$を$\jitu_q\sizen$でもそのまま用いる。
	$\jitu_q\sizen$に線形射
	$m_q:\jitu_q\sizen\otimes\jitu_q\sizen\to\jitu_q\sizen$を次のように
	定義し、
	\begin{equation*}\begin{split}
		m_q\ket{m}\otimes\ket{n} := \qbinom{m+n}{m}\ket{m+n}
		\quad\text{for all } m,n\in\sizen
	\end{split}\end{equation*}
	線形射$\eta_q^\flat:\jitu_q\sizen\to\jitu_q\sizen$を次のように定義する。
	\begin{equation*}\begin{split}
		\eta_q^\flat\ket{f}_x = m_q\ket{1}\otimes\ket{f}_x
		\quad\text{for all } f\in\jitu[x]
	\end{split}\end{equation*}
	$\eta$と$\eta_q^\flat$は次の交換関係を満たす。
	\begin{equation*}\begin{split}
		\eta\eta_q^\flat = 
	\end{split}\end{equation*}
	$\eta$と$\eta_q$を用いた数状態は次の関係になる。
	\begin{equation*}\begin{split}
		\ket{n} := (\eta^\flat)^n\ket{0} = \frac{1}
		\eta_q^\flat\ket{n} = 
	\end{split}\end{equation*}
%s3:Brzozowski代数の準備}
\subsubsection{形式級数の合成の表現}\label{s3:形式級数の合成の表現} %{
	形式級数の合成$m_\circ$は結合的で、$x\in\jitu[[x]]$を単位元として
	もつので、$\plr{\jitu[[x]],m_\circ,x}$はモノイドとなる。
	ただし、このモノイドは次のように、加法に対して線形ではないので、
	代数とはならない。
	\begin{alignat*}{2}
		f\circ(g + h) &\neq (f\circ g) + (f\circ g) &&\quad\text{in general} \\
		(f + g)\circ h &= (f\circ h) + (f\circ h) &&\quad\text{in general}
	\end{alignat*}
	一つ目の式に着目して、$\plr{\jitu[[x]],m_\circ,x}$の$\jitu\sizen$への
	表現を構成しよう。

	線形射$\rho:\jitu[[x]]\to\jitu\sizen$を次のように定義する。
	\begin{equation*}\begin{split}
		(\rho g)\ket{f}_x := \ket{f\circ g}_x
		\quad\text{for all } f,g\in\jitu[[x]]
	\end{split}\end{equation*}
	すると、次のようになり、$\rho$は逆順のモノイド射となる。
	\begin{equation*}\begin{split}
		\gplr{\rho(g\circ h)}\ket{f}_x = \ket{f\circ g\circ h}_x 
		= (\rho h)(\rho g)\ket{f}_x
		\quad\text{for all } f,g,h\in\jitu[[x]]
	\end{split}\end{equation*}
%s3:形式級数の合成の表現}

%s2:Brzozowski代数}
%s1:Connes-Kreimer代数}
\section{パーサーの実装}\label{s1:パーサーの実装} %{
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item q-計算の方法で再帰下降パーサーまで話を進める。
		\item 例を曖昧さのある文法に変更する。
		\item 文法を線形化した後にBrzozowski代数の部分を無視すると、
		正規言語になる。この正規言語によるパーシングが字句解析に相当するの
		だろうか？
		\item 右再帰の標準型 \\
		$(f|x)\in\calA_q\braket{x}$、$a\neq0\in\calA_q$とし、
		次の微分方程式を考える。
		\begin{equation*}\begin{split}
			\plr{x|t} = a + \plr{\calJ_t}_q\plr{f\circ x|t}\plr{x|t}
		\end{split}\end{equation*}
		この微分方程式の右から$a^{-1}$を掛けると、
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $\plr{x'|t}:=\plr{x|t}a^{-1}$
			\item $\plr{f'|x}:=\plr{f|x}a$
		\end{itemize} %}
		として、次のように初期値を$1$とする形に書き直すことができる。
		\begin{equation*}\begin{split}
			\plr{x'|t} = 1 + \plr{\calJ_t}_q\plr{f'\circ x'|t}\plr{x'|t}
		\end{split}\end{equation*}
		\item q-微分方程式$(x|t)=1+\plr{\calJ_t}_qc(x|t)c(x|t)$の解を
		$(x|t)=\sum_{n\in\sizen}\frac{t^n}{[n]_q!}x_n$と展開する。
		すると、$x_{n+1}=\sum_{k=0}^n\qbinom{n}{k}bx_kcx_{n-k}$という漸化式
		を満たす。そこで、階数$1$のBrzozowski代数を用いて$x_n=\braket{n|x}$
		と書けると仮定すると、$\braket{n+1|x}=\bra{n}m_qb\ket{x}\otimes
		c\ket{x}$という漸化式が成り立ち、
		$\eta\ket{x}=m_qb\ket{x}\otimes c\ket{x}$という漸化式が得られる。
		\item 関数の再帰呼び出しを利用 \\
		関数の再帰呼び出しを利用して簡単にパーサーを書く方法が欲しい。
		スタックの処理の一部を実行プログラムに移譲することになる。
		%
		\item $\bbA:=\set{a}$を文字とする文法$x_*=a+x_*^2$を考える。この文法の
		XML形式での出力は、$\bbB:=\set{x,\wbar{x}}$として、$\bbA+\bbB$を文字
		とする文法$x_*=\alpha_x\plr{a+x_*^2}$で与えられる。ここで、$\alpha_x$は
		線形射$\alpha_x:(\bbA+\bbB)^*\to(\bbA+\bbB)^*$で$\alpha_xw=xw\wbar{x}$
		とする。また、$\beta_x:=\alpha_xm_0$とすると、
		$x_*=\alpha_xa + \beta_x x_*^{\otimes2}$と書ける。
		%
		\item 線形射$f:\setA^*\to(\setA+\setB)^*$
		から線形射$f':\setA^*\to(\setA+\setB)^*\otimes\setA^*$への変更を
		どのように定義すればよいだろうか？
		簡単の為に、$\setA$と$\setB$を有限集合、$R$を可換環とし、$R\setA^*$から
		$R\setB^*$への線形射の集合を$V:=\cat{Mod}(R\setA^*,R\setB^*)$とする。
		次の畳み込みにより、$V$に積$m$と余積$m^\flat$が定義できる。
		\begin{alignat*}{2}
			\gplr{m\plr{f\otimes g}}w &:= m_B\gplr{f\otimes g}m_A^\flat w
			&&\quad\text{for all } f,g\in V,\; w\in\setA^* \\
			\gplr{m^\flat f}\gplr{w_1\otimes w_2} 
			&:= m_B^\flat fm_A\gplr{w_1\otimes w_2}
			&&\quad\text{for all } f\in V,\; w_1,w_2\in\setA^*
		\end{alignat*}
		積$m$は
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $\ket{1}\bra{1}$を単位元とし、
			\item $\ket{w}\bra{1}\;\plr{w\in\setB}$と
			$\ket{w}\bra{a}\;\plr{a\in\setA,\; w\in\setB}$を生成元とする
		\end{itemize} %}
		代数となる。ただし、任意の$a\in\setA$と$w_1,w_2\in\setB^*$に対して
		$\ket{w_1w_2}\bra{a}=m\ket{w_1}\bra{1}\otimes\ket{w_2}\bra{a}$となる
		から、$m$は自由代数とはならない。次のような文法の場合に空変換
		$\ket{w}\bra{1}$が現れる。
		\begin{equation*}\begin{split}
			x_* = 1 + x_*bx_* 
			&\xmapsto{\text{XML出力}} x_* = x\plr{1 + x_*bx_*}\wbar{x} \\
			&\implies x_* = \ket{x\wbar{x}}\bra{1} 
			+ \ket{xx\wbar{x}bx\wbar{x}\wbar{x}}\bra{b} +\cdots
		\end{split}\end{equation*}
		%
		\item XML出力を考えることは特殊なMealyマシンを考えているようだ。
		%
		\item lexer hack \\
		新しい言葉を知ったので書いておく。C言語のパースで$(A)*B$という文は
		次の二通りの解釈が可能になる。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $A$と$B$を引数とする演算$*(A,B)$
			\item $A$を型名、$B$をポインターとみて、$*B$を型$A$にキャスト
		\end{itemize} %}
		こうしたことが問題となる原因はLexerとAnalyzerを分けていることにある。
		この問題を解決するために、LexerにAnalyzerの結果を渡すことをlexter hack
		という。
	\end{itemize} %}

\subsection{構文解析}\label{s2:構文解析} %{
	$\setA:=\set{b,v}$を文字集合とする次の文法を考える。
	\begin{equation}\label{eq:曖昧な中置記法}\begin{split}
		B_* = V + B_*bB_*,\quad V_* = v
	\end{split}\end{equation}
	$x,y,z=v$かつ$\lhd,\rhd=b$として、入力文字列$x\lhd y\rhd z$を
	次のように、$B,\wbar{B},V,\wbar{V}$をタグとするXML形式に変換することを
	考える。
	\begin{equation*}\begin{split}
		x\lhd y\rhd z &\mapsto \smallxy{
			& B \hen[ld] \hen[d] \hen[rd] \\
			B \hen[d] & {\lhd} & B \hen[dl] \hen[d] \hen[dr] \\
			V \hen[d] & B \hen[d] & {\rhd} & B \hen[d] \\
			x & V \hen[d] & & V \hen[d] \\
			& y & & z \\
		} + \smallxy{
			& & B \hen[ld] \hen[d] \hen[rd] \\
			& B \hen[dl] \hen[d] \hen[rd] & {\rhd} & B \hen[d] \\
			B \hen[d] & {\lhd} & B \hen[d] & V \hen[d] \\
			V \hen[d] & & V \hen[d] & z \\
			x & & y \\
		} \\
		&\sim B^2Vx\wbar{V}\wbar{B}{\lhd}B^2Vy\wbar{V}\wbar{B}{\rhd}BVz\wbar{V}
			\wbar{B}^3 \\
		&\;+ B^3Vx\wbar{V}\wbar{B}{\lhd}BVy\wbar{V}\wbar{B}^2{\rhd}BVz\wbar{V}
			\wbar{B}^2
	\end{split}\end{equation*}
	この変換をXML形式への変換ということにする\footnote{
		$B_*$はXMLのミックス要素に相当する。$B$は子供要素$V$とともに文字列$b$
		を含むことができるミックス要素になっている。
		XML形式の文字列から、開始タグを取り除くと逆ポーランド形式の文字列が得
		られる。今の場合、逆ポーランド形式の文字列からパース木を構成すること
		ができるので、XML形式での出力は冗長になっているが、定義が容易なので、
		XML形式での出力を考える。
	}。また、文法を表す再帰多項式の不定元でない変数を句といい、
	句の開始を表す出力文字を開始タグ、終了を表す出力文字を終了タグ
	ということにする。今の例では$B_*,V_*$が句になり、$\set{B,V}$が開始タグ
	の集合、$\set{\wbar{B},\wbar{V}}$が終了タグの集合となる。
	開始タグの集合を$\setB$、終了タグの集合を$\wbar{\setB}$と書く。
	入力文字列をXML形式に変換するプログラムは線形射
	\begin{equation*}\begin{split}
		\myop{parse}:\bun\braket{\setA}\otimes\bun\setB
		\to\bun\braket{\setA\oplus\setB\oplus\wbar{\setB}}
	\end{split}\end{equation*}
	として定義することができる。$\myop{parse}$の一つ目のパラメータは開始タグ
	の指定、二つ目のパラメータは入力文字列である。
	$\myop{parse}$は次のような用途にも使うことができる。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item メンバシップ \\
		入力文字列が文法に従っているかどうかを判定する。
		\item パターンシップ \\
		入力文字列がどのような単語の並びになっているかを調べる。
	\end{itemize} %}
	それらは、$B\in\setB$として次のように図示することができる。
	\begin{equation*}\xymatrix@C=10ex{
		\uesita{\bun\braket{\setA}}{\text{input words}}
		\ar[d]^{\myop{parse}(-\otimes B)} \\
		\uesita{\bun\braket{\setA\oplus\setB\oplus\wbar{\setB}}}{\text{XML}}
		\ar[r]^{\text{drop $\setA$}}
		& \uesita{\bun\braket{\setB\otimes\wbar{\setB}}}{\text{pattern-ship}}
		\ar[r]^{\text{drop $\setB\oplus\wbar{\setB}$}}
		& \uesita{\bun}{\text{member-ship}}
	}\end{equation*}

	入力文字列が正規言語であっても、XML形式の出力文字列は開始タグと終了タグが
	組みとなるDyck言語になる。文法の右辺を開始タグと終了タグで挟み込めば
	出力言語の文法になる\footnote{
		YaccやAntlrなどのパーサー生成器では、$X_*\mapsto X^{-1}X_*$とずらした
		変数のとり方をしている。式\label{eq:二項演算その一の出力}で、
		$X_*':=X^{-1}X_*$とおくと、出力文字列は次の文法で与えられる。
		\begin{equation*}\begin{split}
			B_*' = \plr{V + B_*'bBB_*'}\wbar{B},\quad V_*' = v\wbar{V}
		\end{split}\end{equation*}
		こうすると、開始タグ、終了タグに関わらず、任意の$X,Y\in\setB$に対して
		遷移を$X\xto{\cdots Y\otimes\cdots}Y$という形で統一的に書くことが
		できる。その代償として、パース開始前に予め最初の開始タグ$X$を出力文字列
		に入れておく処置が必要になる。
	}。\eqref{eq:曖昧な中置記法}のXML形式の出力文字列は次の文法で与えられる。
	\begin{equation}\label{eq:曖昧な中置記法の出力}\begin{split}
		B_* = B\plr{V_* + B_*bB_*}\wbar{B},\quad V_* = Vv\wbar{V}
	\end{split}\end{equation}

	以下で$\myop{parse}$を作成することを考える。
%s2:構文解析}
\subsection{文法の解}\label{s2:文法の解} %{
	$A$を有限集合とし、$\calA:=\bun\braket{A}$を有理数上の$A$の元から
	生成される自由代数とする\footnote{
		係数環は標数$0$の整域、例えば整数、であれば良いのだが、q-変形して
		微分方程式と対応付けるために、係数を標数$0$の体にする。
	}。
	
	まず、一変数の場合で考える。$(f|x)\in\calA\braket{x}$を$A$の元と非可換な
	文字$x$を不定元とする$\calA$上の多項式とする。
	$x_t\in\calA[[t]]$を$x_0=1$となる次の式の形式解で、
	\begin{equation}\label{eq:一変数の文法}\begin{split}
		x_t = 1 + t(f|x_t)
	\end{split}\end{equation}
	次のように摂動展開して求めたものとする。
	\begin{equation}\label{eq:一変数の文法のTayler展開}\begin{split}
		x_t &= 1 + t(f|x_t) \\
		&= 1 + t(f|1) + t^2(f_1|t,x_t) \\
		&= 1 + t(f|1) + t^2(f_1|0,1) + t^3(f_2|t,x_t) \\
		&= \cdots \\
		&= 1 + t\sum_{k=0}^n t^k (f_k|0,1) + t^{n+2}(f_{n+1}|t,x_t)
	\end{split}\end{equation}
	ここで、$(f_k|t,x)$は次のように定義している。
	\begin{equation*}\begin{split}
		(f_0|t,x) &:= (f|x) \\
		(f_1|t,x) &:= \frac{\gplr{f|1+t(f|x)}-(f|1)}{t} \\
		(f_2|t,x) &:= \frac{\gplr{f_1|t,1+t(f|x)}-(f_1|0,1)}{t} \\
		\cdots \\
		(f_{n+1}|t,x) &:= \frac{\gplr{f_n|t,1+t(f|x)}-(f_n|0,1)}{t} \\
	\end{split}\end{equation*}
	$f_n$は次のようになっている。
	\begin{equation*}\begin{split}
		(f|x) = bxcx \implies (f_1|t,x) &= b(f|x)c + bc(f|x) + tb(f|x)c(f|x)
	\end{split}\end{equation*}
	$f_n$は微分
	\begin{equation*}\begin{split}
		\lim_{x\to x_t}\plr{\frac{\dif x_t}{\dif t}\frac{\dif}{\dif x}}^n(f|x)
	\end{split}\end{equation*}
	に相当する。この微分をq-微分で書き直せれば、$f_n$をq-微分の形で書くことが
	できるのだが、この微分はチェイン則を使っている。\cite{kac:2002}によると、
	q-微分のチェイン則$(\partial)_t(f\circ g|t)$は、$g$が単項式の場合以外は、
	スッキリした形で得られないそうだ。
	そこで、多項式をテンソル積上の線形作用素として定義して、$x_t$の係数を
	見てみる。
	
	$R$を可換環、$V$を上の加群とする。$\T_0V=R$、任意の$n\in\sizen_+$に
	に対して$\T_n:=V^{\otimes n}$と書く。さらに、
	$\T_*V:=\oplus_{n\in\sizen}\T_nV$及び$\T_+V:=\oplus_{n\in\sizen_+}\T_nV$
	と書く。

	多項式$(f|x)\in\calA\braket{x}$を次のように展開する。
	\begin{equation*}\begin{split}
		(f|x) := \sum_{n\in\sizen} f_nx^{\otimes n}
	\end{split}\end{equation*}
	ここで、線形射$f_n:\T_n\calA\to\calA$を次のように定義する。
	\begin{equation*}\begin{split}
		f_n\plr{x_1\otimes\cdots\otimes x_n} := \sum_{\alpha_n} 
			f_{n,1}^{(\alpha_n)} x_1 \cdots f_{n,n}^{(\alpha_n)} 
			x_n f_{n,n+1}^{(\alpha_n)} \quad\text{where } 
			f_{n,k}^{(\alpha_n)}\in\calA
	\end{split}\end{equation*}
	$\calA_q:=\bun_q\braket{A}$として、次の$\calA_q$上のq-微分方程式を
	考える。
	\begin{equation}\label{eq:一変数のq-文法}\begin{split}
		x_t = 1 + (\J_t)_q(f|x_t)
	\end{split}\end{equation}
	この微分方程式は$q=0$で文法\eqref{eq:一変数の文法}になる。
	$x_t$を次のように級数展開すると、
	\begin{equation*}\begin{split}
		x_t = \sum_{n\in\sizen} \frac{t^n}{[n]_q!} x_n 
		\quad\text{where } x_n\in\calA_q
	\end{split}\end{equation*}
	次の漸化式が得られる。
	\begin{equation}\label{eq:一変数の言語の漸化式}\begin{split}
		x_0 &= 1 \\
		x_{n+1} &= \jump{n=0}f_0 + \sum_{k\in\sizen_+} f_k X_{n,k}
			\quad\text{for all } n\in\sizen \\
	\end{split}\end{equation}
	ここで、$X_{n,k}$は次のように定義している。
	\begin{equation*}\begin{split}
		X_{n,k} &:= \sum_{n_1+\cdots+n_k=n} \qbinom{n}{n_1,\dots,n_k}_q
			x_{n_1}\otimes\cdots\otimes x_{n_k} \\
		\qbinom{n}{n_1,\dots,n_k}_q &:= \frac{[n]_q!}{[n_1]_q!\cdots[n_k]_q!}
	\end{split}\end{equation*}

	直接的な摂動展開\eqref{eq:一変数の文法のTayler展開}では、一旦、
	$(f_n|t,x)$を求めてから$(f_n|0,0)$を計算するために、$t=0$で消えてしまう
	無駄な項も計算する必要があるが、この摂動展開では、その無駄な項の計算
	が必要ない。

	q-数を用いて、漸化式をもう少し簡潔に書き表そう。

	\begin{todo}[もっと単純に]\label{todo:もっと単純に} %{
		$\calA_q$上の階数$1$のBrzozowski代数$\calA_q\Eta_1$を考える。
		$\Eta_1$のq-シャッフル積$m_q$は次のようになるから、
		\begin{equation*}\begin{split}
			m_q\ket{m}\otimes\cket{n} = \qbinom{m+n}{n}_q\ket{m+n}
			\quad\text{for all } m,n\in\sizen
		\end{split}\end{equation*}
		共役の余積$m_q^\flat$は次のようになる。
		\begin{equation*}\begin{split}
			m_q^\flat\ket{n} = \sum_{k=0}^n \qbinom{n}{k}_q
				\ket{k}\otimes\ket{n-k} \quad\text{for all } n\in\sizen
		\end{split}\end{equation*}
		したがって、$\calA_q$-線形射$\chi:\calA_q\Eta_1\to\calA_q$を次のように
		定義すると、
		\begin{equation*}\begin{split}
			\chi\ket{n} := x_n \quad\text{for all } n\in\sizen
		\end{split}\end{equation*}
		$\chi$は次の漸化式を満たす。
		\begin{equation*}\begin{split}
			\chi\ket{n+1} \simeq_{\calA_q} \sum_{k\in\sizen_+}\sum_{\alpha_k} 
				\gplr{f_{k,1}^{(\alpha_k)}\chi\otimes\cdots\otimes 
				f_{k,k}^{(\alpha_k)}\chi} \gplr{m_q^\flat}^{k-1}\ket{n}
		\end{split}\end{equation*}
		\hfill\P
	\end{todo} %todo:もっと単純に}

	$\bun_q$上の$\set{\xi_1,\dots,\xi_n}$を生成元とする代数$\Xi_q^n$
	を次のように定義する。
	\begin{equation*}\begin{split}
		\Xi_q^n := \frac{\bun_q\braket{\xi_1,\dots,\xi_n}}
		{\xi_j\xi_i=q\xi_i\xi_j \quad\text{for all } i<j\in1..n}
	\end{split}\end{equation*}
	$\Xi_q^n$の任意の元は、$k_1,\dots,k_n\in\sizen$として
	$\xi_1^{k_1}\cdots\xi_n^{k_n}$という形で一意に書け、次の式が成り立つ。
	\begin{equation*}\begin{split}
		\plr{\xi_1+\cdots+\xi_n}^k = \sum_{k_1+\cdots+k_n=k}
			\qbinom{k}{k_1,\dots,k_n}_q \xi_1^{k_1}\cdots\xi_n^{k_n}
			\quad\text{for all } k\in\sizen
	\end{split}\end{equation*}
	$\Xi_q^0=\bun_q$として、$\set{\Xi_q^n\bou n\in\sizen}$に次の包含関係が
	あるものとする。
	\begin{equation*}\begin{split}
		\Xi_q^0\subset \Xi_q^1\subset \Xi_q^2\subset\cdots
	\end{split}\end{equation*}

	対数をとる線形射$\tau_n:\Xi_q^n\to\T_n\bun_q\sizen$を次のように定義し、
	\begin{equation*}\begin{split}
		\tau_n\plr{\xi_1^{k_1}\cdots\xi_n^{k_n}} 
		:= \ket{k_1}\otimes\cdots\otimes\ket{k_n}
		\quad\text{for all } k_1,\dots,k_n\in\sizen
	\end{split}\end{equation*}
	微分方程式の解の係数$\set{x_n\bou n\in\sizen}$を表す線形射
	$\chi:\bun_q\sizen\to\calA_q$を次のように定義すると、
	\begin{equation*}\begin{split}
		\chi\ket{n} = x_n
	\end{split}\end{equation*}
	漸化式\eqref{eq:一変数の言語の漸化式}は次のように書くことができる。
	\begin{equation*}\begin{split}
		\chi\ket{0} &= 1 \\
		\chi\ket{n+1} &= \jump{n=0}f_0 + \sum_{k\in\sizen_+} f_k
			\chi^{\otimes k}\tau_k\plr{\xi_1+\cdots+\xi_k}^n
			\quad\text{for all } n\in\sizen \\
	\end{split}\end{equation*}
	$\calX_q^n\subset\calA_q$を次のように定義すると、
	\begin{equation*}\begin{split}
		\calX_q^0 := \bun_q,\quad
		\calX_q^n := \op{span}_{\bun_q}\set{x_1,\dots,x_n}
	\end{split}\end{equation*}
	$\chi_n:\Xi_q^n\to\T_n\calX_q^n$

%	部分空間$\calX\subseteq\calA_q$を次のように定義する。
%	\begin{equation*}\begin{split}
%		\calX := \op{span}_{\bun_q}\set{x_n\bou n\in\sizen}
%	\end{split}\end{equation*}

\subsubsection{線形代数}\label{s3:線形代数} %{
%s3:線形代数}
\subsubsection{メモ}\label{s3:メモ} %{
	根付き平面木全体のつくる集合を$\calT_*$とし、頂点数が$k$の木の集合を
	$\calT_k$とする。すると、$\calT_*=\sum_{k\in\sizen}\calT_k$となる。
	$n$-完全な根付き平面木全体のつくる集合を$\calD^n_*$とし、
	$\calD^n_*$の元で葉でない頂点の数が$k$個の木の集合を$\calD^n_k$とする。
	すると、$\calD^n_*=\oplus_{k\in\sizen}\calD^n_k$となる。
	\begin{equation*}\begin{split}
		\calD^n_0 = \Set{\bullet},\quad \calD^n_1 = \Set{\smallxy{
			& \bullet \hen[dl] \hen[d] \hen[drr] \\
			\bullet & \bullet & \cdots & \bullet \\
		}} \\
		\calD^n_2 = \Set{\smallxy{
			& & \bullet \hen[dl] \hen[d] \hen[drr] \\
			& \bullet \hen[dl] \hen[d] \hen[drr] & \bullet & \cdots & \bullet \\
			\bullet & \bullet & \cdots & \bullet \\
		},\dots, \smallxy{
			& \bullet \hen[dl] \hen[d] \hen[drr] \\
			\bullet & \bullet & \cdots & \bullet \hen[dl] \hen[d] \hen[drr] \\
			& & \bullet & \bullet & \cdots & \bullet \\
		}}
	\end{split}\end{equation*}

	線形射$\beta_n:\plr{\bun_q\calT_+}^{\otimes n}\to \bun_q\calT_+$を
	次のように定義する。
	\begin{equation*}\begin{split}
		\beta_n\plr{t_1\otimes\cdots\otimes t_n} := \smallxy {
			& \bullet \hen[dl] \hen[d] \hen[drr] \\
			t_1 & t_2 & \cdots & t_n \\
		} \quad\text{for all } t_1,\dots,t_n\in\calT_+
	\end{split}\end{equation*}
	すると、任意の木$t\in\calD^n_{k+1}$に対して
	$t=\beta\plr{t_1\otimes\cdots\otimes t_n}$となる
	$t_1,\dots,t_n\in\oplus_{i=0}^k\calD^n_i$が一意に定まり、次の集合同型
	が成り立つ。
	\begin{equation*}\begin{split}
		\beta_n: \oplus_{k_1+\cdots+k_n=k} 
		\calD^n_{k_1}\times\cdots\times\calD^n_{k_n} \simeq \calD^n_{k+1}
		\quad\text{for all } k\in\sizen
	\end{split}\end{equation*}

	葉でない頂点を勘定する線形射$\Nhat:\bun_q\calD^n_*\to \bun_q$を次のように
	定義する。
	\begin{equation*}\begin{split}
		\Nhat\bullet &:= 0 \\
		\Nhat\beta\plr{t_1\otimes\cdots\otimes t_n}
		&:= 1 + \sum_{k=1}^n\Nhat t_k \quad\text{for all } t_1,\dots,t_n
		\in\calD^n_*
	\end{split}\end{equation*}
	すると、次の式が成り立つ。
	\begin{equation*}\begin{split}
		q^\Nhat\bullet = \bullet,\quad
		q^\Nhat\beta = q\beta \ggplr{(q^\Nhat)^{\otimes n}}
	\end{split}\end{equation*}

	木の成長を表す線形射$\gamma_n:\bun_q\calD^n_*\to\bun_q\calD^n_+$を次の
	ように定義する。
	\begin{equation*}\begin{split}
		\gamma_n\bullet := \beta\gplr{\bullet^{\otimes n}},\quad
		\gamma_n\beta_n := \sum_{k=1}^n\beta_n
			\ggplr{(q^\Nhat)^{\otimes(k-1)}
			\otimes\gamma_n\otimes\id^{\otimes(n-k)}}
	\end{split}\end{equation*}
%s3:メモ}
%s2:文法の解}
\subsection{再帰下降パーサー}\label{s2:再帰下降パーサー} %{
%s2:再帰下降パーサー}

\subsubsection{Brzozowski微分}\label{s3:Brzozowski微分} %{
	$\bun_q:=\bun(q)$を不定元$q$の$\bun$上の多項式環のつくる有理式体、
	$A$を有限集合、$\bun_q\braket{A}$を$\bun_q$上の形式級数環とする。
	任意の $a\in A$に対して線形射
	$\plr{a}^\flat_q:\bun_q\braket{A}\to\bun_q\braket{A}$を次のように定義する。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 任意の$b\in A$に対して
		\begin{equation*}\begin{split}
			\plr{a}_q^\flat b = \jump{a=b}
		\end{split}\end{equation*}
		\item 任意の$f,g\in\bun\braket{A}$に対して
		\begin{equation*}\begin{split}
			\plr{a}^\flat_q \ggplr{(f|\mybf{a})(g|\mybf{a})}
			&= \ggplr{\plr{a}^\flat_q (f|\mybf{a})} (g|\mybf{a}) 
				+ (f|q\mybf{a}) \ggplr{\plr{a}^\flat_q(g|\mybf{a})}
		\end{split}\end{equation*}
	\end{itemize} %}
	$\plr{a}^\flat_q 1=\plr{a}^\flat_q 1^2=2\plr{a}^\flat_q 1$より、
	$\plr{a}^\flat_q 1=0$となって、$\plr{a}^\flat_q$の定数への作用は$0$
	になることがわかる。$\plr{a}^\flat_q$を$a\in A$についてのq-微分という。
	特に、$q=0$のときはBrzozowski微分といい、qを省略して
	$a^\flat:=\plr{a}^\flat_0$と書くことにする。

	文字数を勘定する線形射$\Nhat:\bun_q\braket{A}\to\sizen$を次のように定義
	すると、
	\begin{equation*}\begin{split}
		\Nhat 1 = 0,\quad \Nhat(a_1\dots a_n) = n
		\quad\text{for all } a_1,\dots,a_n\in A
	\end{split}\end{equation*}
	次の式が成り立つ。
	\begin{equation*}\begin{split}
		q^\Nhat (f|\mybf{a}) = (f|q\mybf{a})
		\quad\text{for all } f\in \bun_q\braket{A}
	\end{split}\end{equation*}
	したがって、$\bun_q\braket{A}$の通常の乗法を$m_0$と書くと、
	q-微分について次の式が成り立つ。
	\begin{equation*}\begin{split}
		(a)_q^\flat m_0 = m_0\plr{(a)_q^\flat\otimes\id 
		+ q^\Nhat\otimes(a)_q^\flat} \quad\text{for all } a\in A
	\end{split}\end{equation*}

	以下では$q=0$として話を進める。
%s3:Brzozowski微分}



\subsubsection{q-微分の拡張}\label{s3:q-微分の拡張} %{
	二つの文字集合からなる自由代数について考える。
	$A,B$を互いに交わりのない有限集合とする。任意の$w\in\plr{A\oplus B}^*$
	は次のように分類することができる。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $w$は$A$の文字を含まない。
		\item $w$は$A$の文字を一つ以上含む。
	\end{itemize} %}
	そして、$w$が$A$の文字を一つ以上含むときは、最も左端に現れる$A$の文字に
	よって、一意に次のように分解することができる。
	\begin{equation*}\begin{split}
		w \mapsto w_1\otimes a\otimes w_2 
		\quad\text{where } w_1\in B^*,\; a\in A,\; w_2\in \plr{A\oplus B}^*
	\end{split}\end{equation*}
	この分解を定式化しよう。任意の $a\in A$に対して線形射
	$\plr{a}^\nabla_q:\bun_q\braket{A\oplus B}
	\to\bun_q\braket{B}\otimes\bun_q\braket{A\oplus B}$を次のように定義する。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 任意の$w\in B^*$に対して
		\begin{equation*}\begin{split}
			\plr{a}_q^\nabla w = 0
		\end{split}\end{equation*}
		\item 任意の$b\in A$と$w_1,w_2\in B^*$に対して
		\begin{equation*}\begin{split}
			\plr{a}_q^\nabla (w_1bw_2) = \jump{a=b} w_1\otimes w_2
		\end{split}\end{equation*}
		\item 任意の$f,g\in\bun\braket{A\oplus B}$に対して
		\begin{equation*}\begin{split}
			\plr{a}^\nabla_q \ggplr{(f|\mybf{a}\oplus\mybf{b})
			(g|\mybf{a}\oplus\mybf{b})}
			&= \ggplr{\plr{a}^\nabla_q (f|\mybf{a}\oplus\mybf{b})}
				\ggplr{1\otimes(g|\mybf{a}\oplus\mybf{b})} \\
			&\,+ \ggplr{(f|q\mybf{a}\oplus\mybf{b})\otimes1} 
				\ggplr{\plr{a}^\nabla_q(g|\mybf{a}\oplus\mybf{b})}
		\end{split}\end{equation*}
	\end{itemize} %}
	$A$の文字数だけを勘定する線形射$\Nhat_A:\bun_q\braket{A\oplus B}\to\sizen$
	を次のように定義すると、
	\begin{equation*}\begin{split}
		\Nhat_Aw &= 0 \quad\text{for all } w\in B^* \\
		\Nhat_A(w_1a_1\cdots w_na_nw_{n+1}) &= n 
		\quad\text{for all } a_i\in A,\; w_i\in B^* \\
	\end{split}\end{equation*}
	次の式が成り立つ。
	\begin{equation*}\begin{split}
		q^{\Nhat_A} (f|\mybf{a}\oplus\mybf{b}) = (f|q\mybf{a}\oplus\mybf{b})
		\quad\text{for all } f\in \bun_q\braket{A\oplus B}
	\end{split}\end{equation*}
	したがって、$\bun_q\braket{A}$の通常の乗法を$m_0$と書くと、
	$(a)_q^\nabla$について次の式が成り立つ。
	\begin{equation*}\begin{split}
		(a)_q^\nabla m_0 = \ggplr{m_0\otimes\id}\ggplr{(a)_q^\nabla\otimes\id}
		+ \ggplr{\id\otimes m_0}\ggplr{q^{\Nhat_A}\otimes(a)_q^\nabla} 
		\quad\text{for all } a\in A
	\end{split}\end{equation*}

	$(a)_q^\nabla$はq-微分を次の意味で拡張したものになっている。
	\begin{equation*}\begin{split}
		(a)_q^\flat:\bun_q\braket{A}\to \bun_q\otimes\bun_q\braket{A} \\
		\xto{\text{拡張}} (a)_q^\nabla:\bun_q\braket{A\oplus B}
		\to \bun_q\braket{B}\otimes\bun_q\braket{A\oplus B}
	\end{split}\end{equation*}
	したがって、$(a)_q^\nabla$もq-微分ということにする。
	そして、$q=0$のときはBrzozowski微分といい、qを省略して
	$a^\nabla:=\plr{a}^\nabla_0$と書くことにする。
%s3:q-微分の拡張}
\subsubsection{パーサーの構成}\label{s3:パーサーの構成} %{
	$a^\nabla$と$0^{\Nhat_\setA}$を使うと、
	\begin{equation*}\begin{split}
		\text{出力文字列}\otimes\text{出力の文法の解}\otimes\text{入力文字列}
	\end{split}\end{equation*}
	の状態遷移の形で、入力文字列をXMLに変換することができる。
	\begin{equation*}\xymatrix@C=12ex{
		1\otimes w_0\otimes \plr{a_1\cdots a_n} 
			\ar@{|->}[d]^{a_1^\nabla w_0 = x_1\otimes w_1}
			\ar@{|->}[r]^(.7){a_1^\nabla w_0 = 0} & 0 \\
		\plr{x_1a_1}\otimes w_1\otimes\plr{a_2\cdots a_n} 
			\ar@{|->}[d]^{a_2^\nabla w_1 = x_2\otimes w_2}
			\ar@{|->}[r]^(.7){a_2^\nabla w_1 = 0} & 0 \\
		\plr{x_1a_1x_2a_2}\otimes w_2\otimes\ket{a_3\cdots a_n}
			\ar@{|->}[d]
			\ar@{|->}[r]^(.7){a_3^\nabla w_2 = 0} & 0 \\
		\vdots \ar@{|->}[d] \\
		\plr{x_1a_1\cdots x_na_n}\otimes w_n\otimes 1
			\ar@{|->}[d]^{0^{\Nhat_\setA} w_n = x_{n+1}}
			\ar@{|->}[r]^(.7){0^{\Nhat_\setA} w_n = 0} & 0 \\
		\plr{x_1a_1\cdots x_na_nx_{n+1}}\otimes 1\otimes 1
	}\end{equation*}
	実際には、出力文字列の文法の解は単項式ではないので、出力文字列も単項式
	とは限らない多項式として考える必要がある。

	全微分を$\nabla:=\sum_{a\in\setA} (1\otimes a)a^\nabla$とおくと、
	次の式が成り立つ。
	\begin{equation*}\begin{split}
		a^\nabla = \plr{\id\otimes a^\nabla}\nabla
		\quad\text{for all } a\in\setA
	\end{split}\end{equation*}
	\eqref{eq:曖昧な中置記法の出力}の$\nabla$と$0^{\Nhat_\setA}$を計算
	すると次のようになるが、
	\begin{alignat*}{2}
		\nabla B_* &= \gplr{B\otimes 1}\ggplr{\gplr{\nabla V_*} + 
			\gplr{\nabla B_*}\gplr{1\otimes bB_*}}\gplr{1\otimes \wbar{B}}
		,\quad& 0^{\Nhat_\setA} B_* &= 0 \\
		\nabla V_* &= V\otimes v\wbar{V}
		,\quad& 0^{\Nhat_\setA} V_* &= 0
	\end{alignat*}
	$B_*$が非線形のために計算を続けることが難しい。したがって、
	$\nabla B_*$を計算するために文法を線形化する。
%s3:パーサーの構成}
\subsubsection{スタックによる線形化}\label{s3:スタックによる線形化} %{
	ここでは、それぞれの句$X_*$に対になる変数$\wbar{X}_*$を付け足して、
	次の文法を考える。
	\begin{equation}\label{eq:曖昧な中置記法の線形化}\begin{split}
		B_* = B\plr{V_* + B_*bB_*}\wbar{B}\wbar{B}_*
		,\quad V_* = Vv\wbar{V}\wbar{V}_*
		,\quad \wbar{B}_* = \wbar{V}_* = 1
	\end{split}\end{equation}
	Brzozowski代数$X_YA_B^\flat=\jump{X=A}\jump{Y=B}$を用いて、
	この文法の遷移図を次のように変形する。
	\begin{equation*}\begin{split}
		\vcenter{\xymatrix{
			B_* \ar[d]_{B\plr{V_*+B_*bB_*}\wbar{B}} & V_* \ar[d]^{Vv\wbar{V}} \\
			\underline{\wbar{B}_*} & \underline{\wbar{V}_*} \\
		}} \mapsto \vcenter{\xymatrix@C=8ex{
			B_\Eta \ar[r]^{B\otimes B_V} \ar@(ld,lu)^{B\otimes B_B} 
			& V_\Eta \ar[d]^{Vv\wbar{V}} \\
			\underline{\wbar{B}_\Eta} \ar[u]^{b\otimes B_B^\flat\wbar{B}_B} 
			\ar@(ld,lu)^{\wbar{B}\otimes\wbar{B}_B^\flat}
			& \underline{\wbar{V}_\Eta} \ar[l]^{\wbar{B}\otimes B_V^\flat} \\
		}}
	\end{split}\end{equation*}
	ここで、下線を引いて終状態を表している。
	この遷移図の変形によって、変数を$X_*\in\bun\braket{\setA\oplus\setB
	\oplus\wbar{\setB}}$から$X_\Eta\in\bun\braket{\setA\oplus\setB
	\oplus\wbar{\setB}}\otimes\Eta(\bun,\setC)$へと変更している。
	Brzozowski代数の真空期待値をとると$X_*\simeq_\bun\braket{X_\Eta}$となる。
	ここで、$\setC:=\set{B_V,B_B,\wbar{B}_B}$はBrzozowski代数の消滅演算子の
	集合とする。$\setC$はプッシュダウンオートマトンでのスタックに積む文字の
	集合に相当する。この遷移図を式にすると次のようになる。
	\begin{equation*}\begin{split}
		B_\Eta &= \gplr{B\otimes B_V}V_\Eta + \gplr{B\otimes B_B}B_\Eta \\
		%&= \gplr{B\otimes B_B}^*\gplr{B\otimes B_V} V_\Eta \\
		\wbar{B}_\Eta &= 1\otimes 1
			+ \gplr{b\otimes B_B^\flat\wbar{B}_B}B_\Eta
			+ \gplr{\wbar{B}\otimes \wbar{B}_B^\flat}\wbar{B}_\Eta \\
		%&= \gplr{b\otimes B_B^\flat\wbar{B}_B}^*
		%	\ggplr{\gplr{\wbar{B}\otimes \wbar{B}_B^\flat} B_\Eta}^? \\
		V_\Eta &= \gplr{Vv\wbar{V}\otimes 1}\wbar{V}_\Eta \\
		\wbar{V}_\Eta &= 1\otimes1
			+ \gplr{\wbar{B}\otimes B_V^\flat}\wbar{B}_\Eta \\
	\end{split}\end{equation*}
	そして、$0_\Eta^{\Nhat_\setA} :=0^{\Nhat_\setA}\otimes\id$とおくと、
	次の式が得られ、
	\begin{alignat*}{2}
		0_\Eta^{\Nhat_\setA} B_\Eta &= 0
		&,\quad 0_\Eta^{\Nhat_\setA} \wbar{B}_\Eta 
		&= \gplr{\wbar{B}\otimes B_B^\flat}^* \\
		0_\Eta^{\Nhat_\setA} V_\Eta &= 0
		&,\quad 0_\Eta^{\Nhat_\setA} \wbar{V}_\Eta
		&= 1\otimes 1 + \gplr{\wbar{B}\otimes B_V^\flat}
			0_\Eta^{\Nhat_\setA} \wbar{B}_\Eta
	\end{alignat*}
	$\nabla_\Eta :=\nabla\otimes\id$とおくと、次の式が得られる。
	\begin{equation*}\begin{split}
		\nabla_\Eta B_\Eta &= \gplr{B\otimes 1\otimes B_B}^*
			\gplr{B\otimes 1\otimes B_V}\nabla_\Eta V_\Eta \\
		\nabla_\Eta \wbar{B}_\Eta
		&= \gplr{\wbar{B}\otimes 1\otimes \wbar{B}_B^\flat}^*
			\gplr{1\otimes b\otimes B_B^\flat\wbar{B}_B}
			\gplr{1\otimes B_\Eta} \\
		\nabla_\Eta V_\Eta &= \gplr{V\otimes v\wbar{V}\otimes 1}
			\gplr{1\otimes \wbar{V}_\Eta} \\
		\nabla_\Eta \wbar{V}_\Eta 
		&= \gplr{\wbar{B}\otimes 1\otimes B_V^\flat}\nabla_\Eta \wbar{B}_\Eta
	\end{split}\end{equation*}
%s3:スタックによる線形化}
\subsubsection{プッシュダウンオートマトンの解釈}\label{s3:プッシュダウンオートマトンの解釈} %{
	線形化した結果を状態遷移$\myop{next}$
	\begin{equation*}\begin{split}
		\myop{next} : \uesita{\setA}{\text{入力文字}}
		\otimes\uesita{\gplr{\setA\oplus\setB\oplus\wbar{\setB}}^*}
		{\text{出力文字列}}
		\otimes\uesita{\gplr{\setC}^*}{\text{スタック}}
		\otimes\uesita{\setB\oplus\wbar{\setB}}{\text{有限状態}} \\
		\to \uesita{\gplr{\setA\oplus\setB\oplus\wbar{\setB}}^*}
		{\text{出力文字列}}
		\otimes\uesita{\gplr{\setC}^*}{\text{スタック}}
		\otimes\uesita{\setB\oplus\wbar{\setB}}{\text{次の有限状態}}
	\end{split}\end{equation*}
	として解釈すると、$a\in\setA$、
	$w\in\gplr{\setA\oplus\setB\oplus\wbar{\setB}}^*$として、
	次のように書くことができる。
	\begin{equation*}\begin{split}
		\myop{next}\gplr{a\otimes w\otimes B_\Eta}
		&= \myop{next}\gplr{a\otimes w'\otimes V_\Eta} \\
		&\text{where } w' := w\lhd \gplr{B\otimes B_B}^*\gplr{B\otimes B_V} \\
		\myop{next}\gplr{a\otimes w\otimes \wbar{B}_\Eta}
		&= \jump{a = b} w'\otimes B_\Eta \\
		&\text{where } w' := w\lhd \gplr{\wbar{B}\otimes \wbar{B}_B^\flat}^*
			\gplr{a\otimes B_B^\flat\wbar{B}_B} \\
		\myop{next}\plr{a\otimes w\otimes V_\Eta}
		&= \jump{a = v} w'\otimes \wbar{V}_\Eta \\
		&\text{where } w' := w\lhd \gplr{Va\wbar{V}\otimes 1} \\
		\myop{next}\gplr{a\otimes w\otimes \wbar{V}_\Eta}
		&= \myop{next}\plr{a\otimes w'\otimes \wbar{B}_\Eta} \\
		&\text{where } w' := w\lhd \gplr{\wbar{B}\otimes B_V^\flat} \\
	\end{split}\end{equation*}
	ここで、$\lhd$は出力文字列については右からの文字の連結、Brzozowski代数
	についてはBrzozowski代数のケットへの作用を表す。
	Brzozowski代数の生成演算子$\setC^\flat$を作用させたときは$0$になる
	可能性がある。したがって、実際のプログラムでは、生成演算子を作用させた
	後に値が$0$であるかどうかをチェックする必要がある。代数としては、
	$\bun\braket{\setC}$の値が$0$になっても問題ないので、式中ではそれを
	省略していることに注意する。
	そして、入力文字列をすべて読み終えた時に行う処理を$\myop{end}$とすると、
	\begin{equation*}\begin{split}
		\myop{end} : \uesita{\gplr{\setA\oplus\setB\oplus\wbar{\setB}}^*}
		{\text{出力文字列}}
		\otimes\uesita{\gplr{\setC}^*}{\text{スタック}}
		\otimes\uesita{\setB\oplus\wbar{\setB}}{\text{有限状態}}
		\to \uesita{\gplr{\setA\oplus\setB\oplus\wbar{\setB}}^*}
		{\text{出力文字列}}
		\otimes\uesita{\gplr{\setC}^*}{\text{スタック}}
	\end{split}\end{equation*}
	$w\in\gplr{\setA\oplus\setB\oplus\wbar{\setB}}^*$として、
	次のように書くことができる。
	\begin{alignat*}{2}
		\myop{end}\gplr{w\otimes B_\Eta} &= 0 \\
		\myop{end}\gplr{w\otimes \wbar{B}_\Eta} &= w'
		&&\quad\text{where } w' := w\lhd\gplr{\wbar{B}\otimes B_B^\flat}^* \\
		\myop{end}\gplr{w\otimes V_\Eta} &= 0 \\
		\myop{end}\gplr{w\otimes \wbar{V}_\Eta} 
		&= w + \myop{end}\gplr{w'\otimes \wbar{B}_\Eta}
		&&\quad\text{where } w' := w\lhd \gplr{\wbar{B}\otimes B_V^\flat}
	\end{alignat*}
	最後に、$\myop{end}$を呼び出した結果を次のように解釈する。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $0$であれば、入力文字列は文法に従っていない。
		\item スタックが空でなければ、入力文字列は途中で終わって
		尻切れトンボになっている。
		\item スタックが空であれば、入力文字列のXML化が得られる。
	\end{itemize} %}
%s3:プッシュダウンオートマトンの解釈}
\subsubsection{ここまで}\label{s3:ここまで} %{
	XML変換の構成
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 文法が与えられる。$X_i=(f_i|\setA,X_1,\dots,X_n)$
		\item 文法をXML化する。$Y_i=B_i(f_i|\setA,Y_1,\dots,Y_n)\wbar{B}_i$
		\item 便宜$\D\setB:=\setB\oplus\wbar{\setB}$
		\item 文法を線形化する。
		$V:=\sizen\braket{\setA\oplus\D\setB}\otimes\Eta\plr{\sizen,\setC}$
		\begin{equation*}\begin{split}
			\pvec{\mybf{Y}_\Eta}{\wbar{\mybf{Y}}_\Eta}
			= \pvec{0}{1} + T\pvec{\mybf{Y}_\Eta}{\wbar{\mybf{Y}}_\Eta}
			\quad\text{where } \begin{split}
				T\in\Mat\plr{V,2n} \\
				\mybf{Y}_\Eta,\wbar{\mybf{Y}}_\Eta\in V^n
			\end{split}
		\end{split}\end{equation*}
		\item XML化した文法の摂動解が求まる。
		$Y_i=\braket{\mybf{e}_i^\tran\mybf{Y}_\Eta}$
		\item 代数射$\pi:\sizen\braket{\setA\oplus\D\setB}
		\to\sizen\braket{\setA}$と
		入射$:\iota:\sizen\braket{\setA}\to\sizen\braket{\setA\oplus\D\setB}$
		\begin{equation*}\begin{split}
			\pi a = a \quad\text{for all } a\in\setA
			,\quad \pi b = 1 \quad\text{for all } b\in\D\setB
			,\quad \iota a = a \quad\text{for all } a\in\setA
		\end{split}\end{equation*}
		\item $\beta$を自由代数の内積とする。
		\item 線形射の集合が定まる。$\set{\myop{parse}_i\bou i\in1..n}$
		\begin{equation*}\begin{split}
			\myop{parse}_i: \sizen\braket{\setA}
			\to \sizen\braket{\setA\oplus\D\setB}
			;\quad w \mapsto \sum_{x\in\plr{\setA\oplus\D\setB}^*} x
			\beta\gplr{\iota w,x}\beta\gplr{Y_i,x}
		\end{split}\end{equation*}
		\item 
		\item 
		\item 文法の解$B_*\in\sizen\dlr{\setA}$が求まる。
	\end{itemize} %}
	$\myop{parse}: \setA^*\otimes\setB
	\to \gplr{\setA\oplus\setB\oplus\wbar{\setB}}^*$の構成
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item XML変換$\myop{parse}:\sizen\braket{\setA}\otimes\setB
		\to\sizen\braket{\setA\oplus\D\setB}$を求める。
		\item $\myop{parse}$は線形射なので、行列要素が定まればよい。
		\begin{equation*}\begin{split}
			\myop{parse}\gplr{w_I\otimes B} 
			= \sum_{w_O\in\gplr{\setA\oplus\D\setB}^*}
			\ket{w_O}\bra{w_O}\myop{parse}\ket{w_I\otimes B}
		\end{split}\end{equation*}
		\item 一意ではないが、プッシュダウンオートマトンを定義できる。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $V:=\sizen\braket{\setA\otimes\D\setB}
			\otimes\sizen\braket{\setC}$
			\item $\myop{end}:\D\setB\to V\otimes\D\setB$
			\item $\myop{next}:\setA\otimes\D\setB\to V\otimes\D\setB$
			\item $\myop{parse}_\Eta:\setA^*\otimes V\otimes\D\setB
			\to \setA^*\otimes V\otimes\D\setB$
		\end{itemize} %}
	\end{itemize} %}
	\begin{equation*}\begin{split}
		\myop{parse}_\Eta\gplr{1\otimes v\otimes B}
		&= \gplr{\id\otimes \lhd\otimes \id}
		\gplr{\id\otimes\id\otimes \myop{end}}
		\gplr{1\otimes v\otimes B} \\
		\myop{parse}_\Eta\gplr{aw\otimes v\otimes B}
		&= \gplr{\id\otimes \lhd\otimes \id}
	\end{split}\end{equation*}
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item スタックの処理をホストプログラムの関数呼び出しに行わせた場合、
		どこまで簡単にできるだろうか？
		\item バックトレース
	\end{itemize} %}
%s3:ここまで}
\section{Dyck言語の斜体版}\label{s1:Dyck言語の斜体版} %{
	論文\cite{gelfand:1997}についてのメモ。

	$\setA:=\set{b,c}$を文字とするDyck言語の列挙$x\in\sizen\braket{\setA}$
	はKleeneスターを用いて次のように書くこともできる。
	\begin{equation*}\begin{split}
		x = \plr{bxc}^* = 1 + bxc\plr{bxc}^* = 1 + bxcx
	\end{split}\end{equation*}
	$x$を有理数体$\bun\plr{\setA}$に拡張する。写像
	$\pi:\bun\braket{\setA,\setA^{-1}}^2\to\bun\plr{\setA}$を次のように
	定義すると、
	\begin{equation*}\begin{split}
		\pi\pvec{f}{g} := fg^{-1}
		\quad\text{for all } f,g\in\sizen\braket{\setA,\setA^{-1}}
	\end{split}\end{equation*}
	Dyck言語の列挙$x$は次のように書くことができる。
	\begin{equation*}\begin{split}
		x = \plr{bxc}^* = \plr{1 - bxc}^{-1} = c^{-1}\plr{c^{-1} - bx}^{-1}
		= \pi \begin{pmatrix}
			0 & c^{-1} \\ -b & c^{-1}
		\end{pmatrix}\pvec{x}{1}
	\end{split}\end{equation*}

	ここで、M\"{o}bius変換の非可換版を考える。
	$R$を可換とは限らない環として、$R$に$R-\set{0}$の逆元を追加した斜体を
	$\what{R}$と書く。
	漸化式$\set{x_n\in\what{R}\bou n\in\sizen}$を次のように定義すると、
	\begin{equation*}\begin{split}
		x_{n+1} = \pi \begin{pmatrix}
			a_{n+1} & b_{n+1} \\ c_{n+1} & d_{n+1}
		\end{pmatrix}\pvec{x_n}{1}
		\quad\text{where } a_{n+1},b_{n+1},c_{n+1},d_{n+1}\in\what{R}
	\end{split}\end{equation*}
	次の式が成り立ち、
	\begin{equation*}\begin{split}
		x_{n+2} &= \plr{a_{n+2}x_{n+1} + b_{n+2}}
			\plr{c_{n+2}x_{n+1} + d_{n+2}}^{-1} \\
		&= \plr{a_{n+2}{\plr{a_{n+1}x_n + b_{n+1}}
			\plr{c_{n+1}x_n+d_{n+1}}^{-1}} + b_{n+2}} \\
		&\quad \plr{c_{n+2}{\plr{a_{n+1}x_n + b_{n+1}}
			\plr{c_{n+1}x_n+d_{n+1}}^{-1} + d_{n+2}}}^{-1} \\
		&= \plr{a_{n+2}\plr{a_{n+1}x_n + b_{n+1}}
			+ b_{n+1}\plr{c_{n+1}x_n+d_{n+1}}} \\
		&\quad \plr{c_{n+2}\plr{a_{n+1}x_n + b_{n+1}}
			+ d_{n+2}\plr{c_{n+1}x_n+d_{n+1}}}^{-1} \\
		&= \pi \begin{pmatrix}
			a_{n+2} & b_{n+2} \\ c_{n+2} & d_{n+2}
		\end{pmatrix} \begin{pmatrix}
			a_{n+1} & b_{n+1} \\ c_{n+1} & d_{n+1}
		\end{pmatrix}\pvec{x_n}{1}
	\end{split}\end{equation*}
	漸化式は、可換環上のM\"{o}bius変換と同様に、行列の積に帰着する。

\subsection{観察その一}\label{s2:観察その一} %{
	$R$を可換とは限らない環とし、$R$上の次の代数式を考える。
	\begin{equation*}\begin{split}
		x = a + bx^2 \quad\text{where } a,b\in R
	\end{split}\end{equation*}
	この代数式をM\"{o}bius変換を使って書くと、次のようになる。
	\begin{equation*}\begin{split}
		x = \pi \begin{pmatrix}
			0 & a \\ - b & 1
		\end{pmatrix}\pvec{x}{1}
		\quad\text{where } \pi\pvec{y}{z} = z^{-1}y
		\quad\text{for all } y\in R,\; z\in R_\times
	\end{split}\end{equation*}
	$\ei{e}{i}\in R^2$を次のように定義すると、
	\begin{equation*}\begin{split}
		\ei{e}{1} := \pvec{1}{0},\quad \ei{e}{1} := \pvec{0}{1}
	\end{split}\end{equation*}
	M\"{o}bius変換の行列$M$は次のように書ける。
	\begin{equation*}\begin{split}
		M := \begin{pmatrix}
			0 & a \\ - b & 1
		\end{pmatrix} = a\eij{e}{1}{2} - b\eij{e}{2}{1} + \eij{e}{2}{2}
	\end{split}\end{equation*}
%s2:観察その一}
\subsection{擬似行列式の観察}\label{s2:擬似行列式の観察} %{
	連立線形方程式から擬似行列式を導入してみる。
	$R$を可換とは限らない環とし、次の連立線形方程式を考える。
	\begin{equation*}\label{eq:二次元非可換連立線形方程式}\begin{split}
		A \pvec{x_1}{x_2} = \pvec{\xi_1}{\xi_2}
		\quad\text{where } A:=\begin{pmatrix}
			a_{11} & a_{12} \\ a_{21} & a_{22}
		\end{pmatrix}\in\Mat(R,2),\; \xi_i\in R
	\end{split}\end{equation*}
	この連立線形方程式の解は次のように書くことができる。
	\begin{equation*}\begin{split}
		\pvec{x_1}{x_2} = \begin{pmatrix}
			|A|_{11}^{-1} & |A|_{21}^{-1} \\ |A|_{12}^{-1} & |A|_{22}^{-1}
		\end{pmatrix}\pvec{\xi_1}{\xi_2}
	\end{split}\end{equation*}
	ここで、$|A|_{ij}\in R$は次のように定義される。
	\begin{equation}\label{eq:二次元擬似行列式}\begin{split}
		|A|_{11} := a_{11} - a_{12}a_{22}^{-1}a_{21}
		,\quad |A|_{12} := a_{12} - a_{11}a_{21}^{-1}a_{22} \\
		|A|_{21} := a_{21} - a_{22}a_{12}^{-1}a_{11}
		,\quad |A|_{22} := a_{22} - a_{21}a_{11}^{-1}a_{12} \\
	\end{split}\end{equation}
	この式を状態遷移として解釈してみよう。
	連立線形方程式\eqref{eq:二次元非可換連立線形方程式}を修正した
	連立線形方程式$x=\xi+Bx$を考える。
	\begin{equation*}\begin{split}
		A = 1 - B \quad\text{where } B:=\begin{pmatrix}
			b_{11} & b_{12} \\ b_{21} & b_{22}
		\end{pmatrix}\in\Mat(R,2)
	\end{split}\end{equation*}
	この式の状態遷移図は次のようになり、
	\begin{equation*}\xymatrix{
		x_1 \ar[r]^{\xi_1} \ar@<1ex>[d]^{b_{12}} \ar@(ld,lu)^{b_{11}} & 1_1 \\
		x_2 \ar[r]^{\xi_2} \ar@<1ex>[u]^{b_{21}} \ar@(ld,lu)^{b_{11}} & 1_2
	}\end{equation*}
	遷移和は次のように$A$の擬似行列式の逆数で書けることがわかる。
	\begin{equation*}\begin{split}
		|B^*|_{ij} = |A|_{ji}^{-1} \implies
		x_i\xtoto{|A|_{ji}^{-1}}x_j \quad\text{for all } i,j\in1..2
	\end{split}\end{equation*}
	$B$の成分で具体的に書くと次のようになる。
	\begin{equation*}\begin{split}
		|A|_{11}^{-1} = \plr{b_{11} + b_{12}b_{22}^*b_{21}}^*
		,\quad |A|_{12}^{-1} = b_{22}^*b_{21}|A|_{11}^{-1} \\
		|A|_{21}^{-1} = b_{11}^*b_{12}|A|_{22}^{-1}
		,\quad |A|_{22}^{-1} = \plr{b_{22} + b_{21}b_{11}^*b_{12}}^*
	\end{split}\end{equation*}
	そして、経路和の分解を$A$の成分で書くと、擬似行列式のホモロジー的関係式
	が得られる。
	\begin{equation*}\begin{split}
		x_1\xtoto{}x_2 = x_1\xto{}x_2\xtoto{}x_2
		&\implies |A|_{21}^{-1} = b_{11}^*b_{12}|A|_{22}^{-1} \\
		&\iff a_{11}|A|_{21}^{-1} = - a_{12}|A|_{22}^{-1}
	\end{split}\end{equation*}
%s2:擬似行列式の観察}
%s1:Dyck言語の斜体版}
\section{可積分Dyck言語}\label{s1:可積分Dyck言語} %{
	$\setA:=\set{b,c}$を大きさ$2$の集合とし、次の$\sizen_q\setA^*[[t]]$上の
	q-微分方程式を考える。
	\begin{equation*}\begin{split}
		(x|t) = 1 + \J_q^t b(x|qt)c(x|t)
	\end{split}\end{equation*}
	$\set{x_n\in\sizen_q\setA^*\bou n\in\sizen}$を次のように定義すると、
	\begin{equation*}\begin{split}
		(x|t) = \sum_{n\in\sizen}\frac{t^n}{[n]_q!} x_n
	\end{split}\end{equation*}
	次の漸化式が成り立つ。
	\begin{equation*}\begin{split}
		x_0 = 1,\quad x_{n+1} = \sum_{k=0}^n\qbinom{n}{k}_q q^k bx_kcx_{n-k}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	低次の項は次のようになるが、
	\begin{equation*}\begin{split}
		x_1 &= bc \\
		x_2 &= x_1^2 + q\,b^2c^2 \\
		x_3 &= x_1^3 + q\,x_1b^2c^2 + \gplr{q + q^2}b^2c^2x_1 
			+ q^2\,bx_1^2c + q^3\,b^3c^3 \\
		x_4 &= x_1^4 + q\,x_1^2b^2c^2 + \gplr{q + q^2}x_1b^2c^2x_1 
			+ q^2\,x_1bx_1^2c + q^3\,x_1b^3c^3 \\
		&\;+ \gplr{q + q^2 + q^3}b^2c^2x_1^2 
			+ \gplr{q^2 + q^3 + q^4}b^2c^2b^2c^2 \\
		&\;+ \gplr{q^2 + q^3 + q^4}bx_1^2cx_1 
			+ \gplr{q^3 + q^4 + q^5}b^3c^3x_1 \\
		&\;+ q^3\,bx_1^3c + q^4\,b^2cb^2c^3 + \gplr{q^4 + q^5}b^3c^2bc^2 \\
		&\;+ q^5\,b^2x_1^2c^2 + q^6\,b^4c^4
	\end{split}\end{equation*}
	$q$のべきでまとめると次のようになる。
	\begin{equation*}\begin{split}
		x_1 &= bc \\
		x_2 &= x_1^2 + q\plr{b^2c^2} \\
		x_3 &= x_1^3 + q\plr{x_1b^2c^2 + b^2c^2x_1} 
			+ q^2\plr{b^2c^2x_1 + bx_1^2c} + q^3\plr{b^3c^3} \\
		x_4 &= x_1^4 + q\plr{x_1^2b^2c^2 + x_1b^2c^2x_1 + b^2c^2x_1^2} \\
		&\;+ q^2\plr{x_1b^2c^2x_1 + x_1bx_1^2c + b^2c^2x_1^2 + b^2c^2b^2c^2 
			+ bx_1^2cx_1} \\
		&\;+ q^3\plr{x_1b^3c^3 + b^2c^2x_1^2 + b^2c^2b^2c^2 + bx_1^2cx_1 
			+ b^3c^3x_1 + bx_1^3c} \\
		&\;+ q^4\plr{b^2c^2b^2c^2 + bx_1^2cx_1 + b^3c^3x_1 + b^2cb^2c^3 
			+ b^3c^2bc^2} \\
		&\;+ q^5\plr{b^3c^3x_1 + b^3c^2bc^2 + b^2x_1^2c^2} + q^6\plr{b^4c^4}
	\end{split}\end{equation*}
%s1:可積分Dyck言語}
\section{漸化式}\label{s1:漸化式} %{
	複素数上の次の漸化式を考える。
	\begin{equation}\label{eq:一次変換の漸化式}\begin{split}
		x_{n+1} = \frac{a_{n+1}x_n + b_{n+1}}{c_{n+1}x_n + d_{n+1}}
		\quad\text{where } a_i,b_i,c_i,d_i\in\fukuso
	\end{split}\end{equation}
	漸化式は次のように書くこともできる。
	\begin{equation*}\begin{split}
		x_{n+1} = \pi\begin{pmatrix}
			a_{n+1} & b_{n+1} \\ c_{n+1} & d_{n+1} \\
		\end{pmatrix}\pvec{x_n}{1}
		\quad\text{where } \pi\pvec{x}{y} = \frac{x}{y}
	\end{split}\end{equation*}
	すると、次の式から、
	\begin{equation*}\begin{split}
		\pi\begin{pmatrix}
			a_{n+1} & b_{n+1} \\ c_{n+1} & d_{n+1} \\
		\end{pmatrix}\pvec{x_n}{1} 
		&= \frac{a_{n+1}x_n + b_{n+1}}{c_{n+1}x_n + d_{n+1}} \\
		&= \frac{a_{n+1}\plr{a_nx_{n-1} + b_n} + b_{n+1}\plr{c_nx_{n-1} + d_n}}
			{c_{n+1}\plr{a_nx_{n-1} + b_n} + d_{n+1}\plr{c_nx_{n-1} + d_n}} \\
		&= \pi\begin{pmatrix}
			a_{n+1} & b_{n+1} \\ c_{n+1} & d_{n+1} \\
		\end{pmatrix}\begin{pmatrix}
			a_n & b_n \\ c_n & d_n \\
		\end{pmatrix}\pvec{x_{n-1}}{1}
	\end{split}\end{equation*}
	漸化式の解は行列の積に帰着される。
	\begin{equation*}\begin{split}
		x_{n+1} = \pi M_n\cdots M_1\pvec{x_0}{1}
		\quad\text{where } M_k := \begin{pmatrix}
			a_k & b_k \\ c_k & d_k \\
		\end{pmatrix}
	\end{split}\end{equation*}

	これをq-微分方程式に応用してみる。次のq-微分方程式は、
	\begin{equation*}\begin{split}
		(\partial_qx|t) = (c|t)(x|qt)(x|t)
	\end{split}\end{equation*}
	差分を展開すると、次の漸化式となり、
	\begin{equation*}\begin{split}
		(x|t) = \pi\ggplr{1 - (1-q)t(C|t)}\pvec{(x|qt)}{1} \quad\text{where } 
		(C|t) := \begin{pmatrix}
			0 & 0 \\ (c|t) & 0
		\end{pmatrix}
	\end{split}\end{equation*}
	$(C|s)(C|t)=0$より、Jackson積分$\J_q^t$を用いて、解が次のように求まる。
	\begin{equation*}\begin{split}
		(x|t) &= \pi\ggplr{1 - (1-q)t(C|t)}\cdots
			\ggplr{1 - (1-q)q^nt(C|q^nt)}\pvec{(x|q^{n+1}t)}{1} \\
		&= \pi\ggplr{1 - (1-q)\sum_{n\in\sizen}q^nt(C|q^nt)}\pvec{(x|0)}{1} \\
		&= \pi\plr{1 - \J_q^t(C|t)}\pvec{(x|0)}{1} \\
		&= \frac{(x|0)}{1 - (x|0)\J_q^t(c|t)}
	\end{split}\end{equation*}

	一次変換の漸化式\eqref{eq:一次変換の漸化式}で、$d_n=1$とおいて、
	変換がKleeneスターを用いて書くことができる場合を考える。
	\begin{equation*}\begin{split}
		x_{n+1} = \plr{a_{n+1}x_n + b_{n+1}}\plr{1 - c_{n+1}x_n}^*
	\end{split}\end{equation*}
	さらに、変換の合成もKleeneスターを用いて同様に書けることを要請すると、
	次の行列の積から、
	\begin{equation*}\begin{split}
		\begin{pmatrix}
			a_{n+1} & b_{n+1} \\ -c_{n+1} & 1 \\
		\end{pmatrix}\begin{pmatrix}
			a_n & b_n \\ -c_n & 1 \\
		\end{pmatrix} = \begin{pmatrix}
			a_{n+1}a_n - b_{n+1}c_n & a_{n+1}b_n + b_{n+1} \\ 
			-c_{n+1}a_n - c_n & 1 - c_{n+1}b_n \\
		\end{pmatrix}
	\end{split}\end{equation*}
	$b_n=0$となる必要があることがわかる。したがって、次の漸化式を考えると、
	\begin{equation*}\begin{split}
		x_{n+1} = a_{n+1}x_n\plr{c_{n+1}x_n}^*
		= \frac{a_{n+1}x_n}{1 - c_{n+1}x_n}
	\end{split}\end{equation*}
	変換の合成は次のようになって、$*$の高さが$1$に留まる。
	\begin{equation*}\begin{split}
		a_{n+1}x_n\plr{c_{n+1}x_n}^* 
		&= a_{n+1}\plr{a_nx_{n-1}\plr{c_nx_{n-1}}^*}
			\plr{c_{n+1}\plr{a_nx_{n-1}\plr{c_nx_{n-1}}^*}}^* \\
		&= a_{n+1}a_nx_{n-1}\plr{\plr{c_{n+1}a_n + c_n}x_{n-1}}^*
	\end{split}\end{equation*}
	一次変換に対応する次の式が$*$の高さの増加を抑えている。
	\begin{equation*}\begin{split}
		x^*\plr{yx^*} = \plr{x + y}^* \implies yx^* = \plr{1 - x}\plr{x + y}^*
	\end{split}\end{equation*}

\subsection{非可換の場合}\label{s2:非可換の場合メモ} %{
	\begin{equation*}\begin{split}
		x := \plr{ba^*c}a^*
	\end{split}\end{equation*}
	\begin{equation*}\begin{split}
		x = a^* + ba^*cx = 1 + aa^* + ba^*cx ,\quad y = 1 + ay
	\end{split}\end{equation*}
	\begin{equation*}\begin{split}
		\begin{pmatrix}
			x \\ y \\ z
		\end{pmatrix} = \begin{pmatrix}
			0 \\ 0 \\ 1
		\end{pmatrix} + \begin{pmatrix}
			byc & a & 1 \\ 0 & a & 1 \\ 0 & 0 & 0
		\end{pmatrix} \begin{pmatrix}
			x \\ y \\ z
		\end{pmatrix}
	\end{split}\end{equation*}
	\begin{equation*}\begin{split}
		\vcenter{\xymatrix{
			x \ar@<1ex>[r]^1 \ar[d]_{a + b\eta^\flat} 
			& *++[o][F=]{z} \ar@<1ex>[l]^{\eta c} \\
			y \ar[ru]_1 \ar@(ld,lu)^a
		}} \sim \vcenter{\xymatrix@C=4em {
			*++[F=:<8pt>]{x + z} \ar@<1ex>[r]^{a + b\eta^\flat} 
				\ar@(ul,ur)^{\eta c} 
			& y \ar@(ul,ur)^a \ar@<1ex>[l]^1
		}}
	\end{split}\end{equation*}
	\begin{equation*}\begin{split}
		\pvec{x}{y} = \pvec{1}{0} + \begin{pmatrix}
			\eta c & a + b\eta^\flat \\ 1 & a
		\end{pmatrix}\pvec{x}{y}
	\end{split}\end{equation*}
%s2:非可換の場合メモ}
%s1:漸化式}
\section{q-シャッフル積}\label{s1:q-シャッフル積} %{
	$\setA$を有限集合とする。$V:=\fukuso[q_L,q_R]\ket{\setA^*}$とおき、
	文字列の連結による$V$の積を$m_0$と書く。
	線形射$\Ihat_0,\Ihat_+:V\to V$を次のように定義する。
	\begin{equation*}\begin{split}
		\Ihat_0 := \ket{1}\bra{1},\quad \Ihat_+ := \sum_{a\in\setA} aa^\flat
	\end{split}\end{equation*}

	q-シャッフル積を拡張した線形射$\mu:V\otimes V\to V$を次のように定義する。
	\begin{alignat*}{2}
		\mu\ket{w}\otimes\ket{1} &:= \ket{w}
		=: \mu\ket{1}\otimes\ket{w} &&\quad\text{for all } w\in\setA^* \\
		\mu(a\otimes b) &:= a\mu\plr{\id\otimes q_R^{\Nhat}b}
		+ b\mu\plr{q_L^{\Nhat}a\otimes\id} &&\quad\text{for all } a,b\in A
	\end{alignat*}
	線形射$(a)_\mu:V\to V$を次のように定義すると、
	\begin{equation*}\begin{split}
		(a)_\mu\ket{w} := \mu\ket{a}\otimes\ket{w} 
		\quad\text{for all } a\in\setA,\; w\in\setA^*
	\end{split}\end{equation*}
	次のように書ける（ノート\ref{note:作用素(a)_muの計算}）。
	\begin{equation*}\begin{split}
		(a)_\mu = m_0\gplr{\id\otimes a}\gplr{q_L^\Nhat\otimes q_R^\Nhat}
			m_0^\flat \quad\text{for all } a\in\setA
	\end{split}\end{equation*}
	文字を使って書くと次のようになる。
	\begin{equation*}\begin{split}
		(a)_\mu\ket{b_1\cdots a_n} = \sum_{k=0}^n
		q_L^kq_R^{n-k}\ket{b_1\cdots b_kab_{k+1}\cdots b_n}
		\quad\text{for all } a,b_1,\dots,b_n\in\setA
	\end{split}\end{equation*}

	$a^\flat$と$\mu$は次の交換関係を満たし
	（ノート\ref{note:aとmuとの交換関係}）、
	\begin{equation*}\begin{split}
		a^\flat\mu = \mu\gplr{a^\flat\otimes q_R^\Nhat 
			+ q_L^\Nhat\otimes a^\flat} \quad\text{for all } a\in\setA
	\end{split}\end{equation*}
	$\mu$は文字数を保存するから、
	$0^\Nhat = \lim_{x\to0} x^\Nhat = \Ihat_0$と定義すると、
	次の交換関係が成り立つ。
	\begin{equation*}\begin{split}
		\Nhat\mu = \mu\plr{\Nhat\otimes\id + \id\otimes\Nhat}
		\implies x^\Nhat\mu = \mu\plr{x^\Nhat\otimes x^\Nhat} 
		\quad\text{for all } x\in\fukuso
	\end{split}\end{equation*}
	そして、次の交換関係と、
	\begin{equation*}\begin{split}
		\Ihat_0\mu\plr{\mu\otimes\id} 
			= \mu\plr{\mu\otimes\id}\Ihat_0^{\otimes3} ,\quad 
		\Ihat_0\mu\plr{\id\otimes\mu}
			= \mu\plr{\id\otimes\mu}\Ihat_0^{\otimes3} \\
	\end{split}\end{equation*}
	次の交換関係が成り立つことから、
	\begin{equation*}\begin{split}
		\Ihat_+\mu\plr{\mu\otimes\id} = \sum_{a\in\setA} a\mu
			\plr{\mu\otimes\id} \plr{a^\flat}^{(3)} ,\quad 
		\Ihat_+\mu\plr{\id\otimes\mu} = \sum_{a\in\setA} a\mu
			\plr{\id\otimes\mu} \plr{a^\flat}^{(3)} \\
		\quad\text{where } \plr{a^\flat}^{(3)} 
			:= a^\flat\otimes q_R^\Nhat\otimes q_R^\Nhat
			+ q_L^\Nhat\otimes a^\flat\otimes q_R^\Nhat
			+ q_L^\Nhat\otimes q_L^\Nhat\otimes a^\flat
	\end{split}\end{equation*}
	$\ket{\setA^*}^{\otimes3}$の文字数の和についての帰納法によって、
	$\mu$が結合的になることが示される。

	\begin{note}[作用素$(a)_\mu$の計算]\label{note:作用素(a)_muの計算} %{
		\begin{equation*}\begin{split}
			(a)_\mu\ket{b_1\cdots b_n} 
			&= q_R^n\ket{ab_1\cdots b_n} + q_Lb_1(a)_\mu\ket{b_2\cdots b_n} \\
			&= q_R^n\ket{ab_1\cdots b_n} + q_Lq_R^{n-1}\ket{b_1ab_2\cdots b_n}
			+ q_L^2b_1b_2(a)_\mu\ket{b_3\cdots b_n} \\
			&= \cdots \\
			&= q_L^0q_R^n\ket{ab_1b_2\cdots b_n}
			+ q_L^1q_R^{n-1}\ket{b_1ab_2\cdots b_n}
			+\cdots
			+ q_L^nq_R^0\ket{b_1b_2\cdots b_na}
		\end{split}\end{equation*}
	\end{note} %note:作用素(a)_muの計算}

	\begin{note}[$a^\flat$と$\mu$との交換関係]\label{note:aとmuとの交換関係} %{
		任意の$a,b,c\in\setA$に対して次の式が成り立ち、
		\begin{equation*}\begin{split}
			a^\flat\mu\plr{b\otimes c} &= \jump{a=b}
				\mu\plr{\id\otimes q_R^\Nhat c}
				+ \jump{a=c}\mu\plr{q_L^\Nhat b\otimes\id} \\
			&= \mu\plr{a^\flat b\otimes q_R^\Nhat c} 
				+ \mu\plr{q_L^\Nhat b\otimes a^\flat c} \\
			&= \mu\plr{a^\flat\otimes q_R^\Nhat + q_L^\Nhat\otimes a^\flat}
				\plr{b\otimes c}
		\end{split}\end{equation*}
		任意の$a\in\setA,\; w\in\setA^*$に対して次の式が成り立つ。
		\begin{equation*}\begin{split}
			a^\flat\mu\ggplr{\ket{w}\otimes\ket{1}} = a^\flat\ket{w}
			&= \mu\plr{a^\flat\ket{w}\otimes\ket{1}} \\
			&= \mu\plr{a^\flat\otimes q_R^\Nhat + q_L^\Nhat\otimes a^\flat}
				\ggplr{\ket{w}\otimes\ket{1}}
		\end{split}\end{equation*}
	\end{note} %note:aとmuとの交換関係}
%s1:q-シャッフル積}
\section{双代数の効用}\label{s1:双代数の効用} %{
	双代数があると、テンソル積表現が容易に作れる。
	$A=(A,m,\Delta)$を双代数とする。
	\begin{equation*}\begin{split}
		\Delta m = (m\otimes m)\sigma_{23}(\Delta\otimes\Delta)
	\end{split}\end{equation*}
	$i=1,2$に対して$\rho_i:A\to\End V_i$を表現とする。
	線形射$\rho_{12}:A\to\End V_1\otimes\End V_2$を次のように定義する。
	\begin{equation*}\begin{split}
		\rho_{12}:=(\rho_1\otimes\rho_2)\Delta
	\end{split}\end{equation*}
	$\mu_i$を$\End V_i$の通常の積（線形射の合成）とすると、
	$\rho_{12}$がは次の可換図を満たせば代数射となる。
	\begin{equation*}\xymatrix@C=12em{
			A\otimes A \ar[d]^m \ar[r]^{\rho_{12}\otimes\rho_{12}} 
			& \End V_1\otimes\End V_2\otimes\End V_1\otimes\End V_2
				\ar[d]^{\plr{\mu_1\otimes\mu_2}\sigma_{23}} \\
			A \ar[r]^{\rho_{12}} & \End(V_1\otimes V_2) \\
	}\end{equation*}
	実際に計算してみると、次のようになり、$\rho_{12}$が代数射となることが
	わかる。
	\begin{equation*}\begin{split}
		\plr{\mu_1\otimes\mu_2}\sigma_{23}\plr{\rho_{12}\otimes\rho_{12}}
		&= \plr{\mu_1\otimes\mu_2}
		\plr{\rho_1\otimes\rho_1\otimes\rho_2\otimes\rho_2}\sigma_{23}
		\plr{\Delta\otimes\Delta} \\
		&= \plr{\rho_1\otimes\rho_2}\plr{m\times m}\sigma_{23}
		\plr{\Delta\otimes\Delta} \\
		&= \plr{\rho_1\otimes\rho_2}\Delta m \\
		&= \rho_{12} m
	\end{split}\end{equation*}
%s1:双代数の効用}
\section{モノイド射の核}\label{s1:モノイド射の核} %{
	$A$を有限集合、$G=(G,m_G,1)$をモノイド、$\phi:A^*\to G$をモノイド射と
	する。
	$\ker\phi\subset A^*$と$\epsilon_G:G\to\sizen$を次のように定義すると、
	\begin{equation*}\begin{split}
		\ker\phi = \set{a\in A\bou \phi a=1}
		,\quad \epsilon_G x = \jump{x=1} \quad\text{for all }x\in G
	\end{split}\end{equation*}
	$\ker\phi$の列挙$\ls\ker\phi\in\sizen A^*$を次のように書くことができる。
	\begin{equation*}\begin{split}
		\sum_{w\in\ker\phi} w = \sum_{w\in A^*}\plr{\epsilon_G\phi w} w
		\simeq_\sizen \plr{\epsilon_G\otimes\id}
			\plr{\sum_{a\in A}\phi a\otimes a}^*
	\end{split}\end{equation*}
	他の$\ker\phi$の元の積で書くことができない$\ker\phi$の元を素な$\ker\phi$
	の元ということにする。
	\begin{equation*}\begin{split}
		w \text{ is primitive in }\ker\phi
		\xiff{\dfn} \left\{\begin{split}
			w\in\ker\phi &\quad\text{and} \\
			w = w_1w_2 &\implies w_1 = w\text{ or } w_2 = w \\
			&\quad\text{for all } w_1,w_2\in\ker\phi
		\end{split}\right.
	\end{split}\end{equation*}
	素な$\ker\phi$の元の集合を$\ker^\circ\phi$と書くことにする。
	任意の$\ker\phi$の元は$\ker^\circ\phi$の元の積で一意に書くことができる。
	\begin{proof} %{
		ある$w\in\ker\phi$が$x_1,\dots,x_m,y_1,\dots,y_n\in\ker^\circ\phi$で
		$x_1\cdots x_m = w = y_1\cdots y_n$と書かれたとする。
		$|x_1|\le|y_1|$だとすると、$y_1=x_1z$となる$z\in A^*$が一意に定まるが、
		$x_1,y_1\in\ker^\circ\phi$なので、$z=1$となる必要がある。したがって、
		$x_1=y_1$となる。同様に続けると$m=n$かつすべての$i\in1..n$で$x_i=y_i$
		となることが示される。
	\end{proof} %}
%s1:モノイド射の核}
\section{計算の整理}\label{s1:計算の整理} %{
	$\setA$を有限集合とし、$\setA^*:=\oplus_{n\in\sizen}\setA^n$を$\setA$
	から生成される自由モノイド、また$\setA^+:=\oplus_{n\in\sizen_+}\setA^n$
	とする。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[文字数] 単語$w\in\setA^*$の文字数を$|w|$とかき、
		$w$の中の文字$a\in A$の数を$\sharp_aw$と書く。
		$|w| = \sum_{a\in\setA}\sharp_aw$という関係が成り立つ。
		\item[空単語] 文字数$0$の空単語を$1$と書く。
		\item[乗法] $m_0:\setA^*\times\setA^*\to\setA^*$を文字列の連結による
		積とする。$1$が$m_0$の単位元となる。また、$m_0$を中置記法で書く時は
		記号を省略する。
		\begin{equation*}\begin{split}
			w_1w_2 := m_0(w_1,w_2) \quad\text{for all } w_1,w_2\in\setA^*
		\end{split}\end{equation*}
	\end{description} %}

	互いに異なる$b,c\in\setA$を用いて、二項演算
	$\beta:\setA^*\times\setA^*\to\setA^*$を次のように定義する。
	\begin{equation}\label{eq:betaの定義}\begin{split}
		\beta(w_1, w_2) := bw_1cw_2
		\quad\text{for all } w_1,w_2\in\setA^*
	\end{split}\end{equation}
	次の交換関係が成り立つ。
	\begin{equation}\label{eq:betaと連結の交換関係}\begin{split}
		m_0(\beta\times\id) = \beta(\id\times m_0)
	\end{split}\end{equation}

	$\beta$を使って$\setB_n\subset\setA^{2n}$を次のように定義する。
	\begin{equation}\label{eq:Bの定義}\begin{split}
		\setB_0 := \set{1}
		,\quad \setB_{n+1} := \cup_{k=0}^n \beta(\setB_k, \setB_{n-k})
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation}
	$\setB_n$の単語の文字数は$2n$だから、$m\neq n\in\sizen$ならば
	$\setB_m\cap\setB_n=\emptyset$となる。
	$\setB_*:=\oplus_{n\in\sizen}\setB_n$、
	$\setB_+:=\oplus_{n\in\sizen_+}\setB_n$とする。
	$\setB_*$を文字の組$(b,c)$によって生成されるDyck言語という。

	任意の$w\in\setB_+$に対して$\beta(w_1,w_2)$となる$w_1,w_2\in\setB_*$
	が存在して唯一つ定まる。したがって、次の集合同型が成り立ち、
	\begin{equation}\label{eq:beta分解}\begin{split}
		\beta:\setB_*\times\setB_*\simeq\setB_+ \quad\text{as set}
	\end{split}\end{equation}
	定義\eqref{eq:Bの定義}が重複なく$\setB_{n+1}$の元を定義していることが
	わかる。

	任意の集合$X$に対して$\ls X\in\sizen X$を次のように定義し、
	\begin{equation*}\begin{split}
		\ls X := \sum_{x\in X} x
	\end{split}\end{equation*}
	$\ls X$を$X$（の元）の列挙ということにする\footnote{
		$\ls$は圏で考えるべきものなのだろうが、どのように定義すればよいか
		わからない。
	}。集合同型\eqref{eq:beta分解}により、$\setB_n$の定義\eqref{eq:Bの定義}
	をそのまま加法に置き換えれば、$\setB_n$の列挙が得られる。
	\begin{equation}\label{eq:Bの列挙その一}\begin{split}
		\ls\setB_0 = 1,\quad \ls\setB_{n+1} 
		= \sum_{k=0}^n \beta\plr{\ls\setB_k\otimes\ls\setB_{n-k}}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation}
	また、形式級数$\ls^t\setB_*\in\sizen\setB_*[[t]]$を次のように定義すれば、
	\begin{equation*}\begin{split}
		\ls^t\setB_* := \sum_{n\in\sizen} t^{2n}\ls\setB_n
	\end{split}\end{equation*}
	\eqref{eq:Bの列挙その一}より、$\ls^t\setB_*$は次の二次式を満たすことが
	わかる。
	\begin{equation}\label{eq:Bの列挙その二}\begin{split}
		\ls^t\setB_* = 1 + t^2\beta\plr{\ls^t\setB_*\otimes\ls^t\setB_*}
	\end{split}\end{equation}
	$\setB_*$のインジケーター$\isA{\setB_*}:\setA^*\to\sizen$を次のように
	定義する。
	\begin{equation*}\begin{split}
		\isA{\setB_*}w = \jump{w\in\setB_*} \quad\text{for all } w\in\setA^*
	\end{split}\end{equation*}
	$\sizen$の通常の乗法を$m_\sizen$と書くと、次の交換関係が成り立つから、
	\begin{equation*}\begin{split}
		\isA{\setB_*}\beta = m_\sizen\gplr{\isA{\setB_*}\otimes\isA{\setB_*}}
	\end{split}\end{equation*}
	$B_*$の列挙\eqref{eq:Bの列挙その二}より、次の二次式が得られる。
	\begin{equation*}\begin{split}
		\isA{\setB_*}{\ls^t\setB_*} = 1 + t^2m_\sizen\gplr{
			\isA{\setB_*}\ls^t\setB_*\otimes \isA{\setB_*}\ls^t\setB_*}
	\end{split}\end{equation*}
	この二次式は簡単に解けて、
	\begin{equation*}\begin{split}
		x_t = 1 + (tx_t)^2 \implies x_t = \frac{1 \pm \sqrt{1 - 4t^2}}{2t^2}
	\end{split}\end{equation*}
	$t=0$近傍で正則な解が$I_{\setB_*}\ls^t\setB_*$になり、
	\begin{equation*}\begin{split}
		\isA{\setB_*}\ls^t\setB_* = \frac{1 - \sqrt{1 - 4t^2}}{2t^2}
	\end{split}\end{equation*}
	$\setB_n$の大きさはカタラン数$C_n$で与えられることがわかる。
	\begin{equation*}\begin{split}
		|\setB_n| = C_n := \frac{1}{n+1}\binom{2n}{n}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}

	$\setB_*$は文字列の連結で閉じている。
	\begin{equation*}\begin{split}
		w_1,w_2\in\setB_*\implies w_1w_2\in\setB_*
	\end{split}\end{equation*}
	\begin{proof} %{
		$w_1$の文字数についての帰納法で証明する。
		$w_1=1$の時は命題は成り立つ。ある$n\in\in\sizen$があって、
		$w_1$の文字数が$2n$以下では命題が成り立つと仮定する。
		$w_1\in\setB_{n+1}$とすると、ある$x,y\in\oplus_{n=0}^n\setB_n$が
		存在して、$w_1=\beta(x\times y)$と書ける。したがって、
		$w_1w_2=m_0(\beta\times\id)(x\times y\times w_2)$となるが、
		交換関係\eqref{eq:betaと連結の交換関係}から、
		$w_1w_2=\beta(\id\times m_0)(x\times y\times w_2)$となり、
		帰納法の仮定より、$m_0(y\times w_2)\in\setB_*$だから、
		$w_1w_2\in\setB_*$が成り立つことがわかる。
	\end{proof} %}

	\begin{note}[合同関係]\label{note:合同関係} %{
		$G=(G,m)$をモノイド、$\sim$を$G$の集合としての同値関係とする。
		$\sim$が次の式を満たす時、$\sim$を合同関係もしくは単に合同という。
		\begin{equation*}\begin{split}
			x_1\sim y_1 \text{ and } x_2\sim y_2 \implies 
			m(x_1\times x_2) \sim m(y_1\times y_2) \\
			\quad\text{for all } x_1,x_2,y_1,y_2\in G
		\end{split}\end{equation*}
		合同関係には$\cong$や$\equiv$という記号がよく使われる。
	\end{note} %note:合同関係}

	\begin{note}[準同型の観察]\label{note:準同型の観察} %{
		$A$を有限集合、$G$モノイド、$\phi:A^*\to G$をモノイド準同型とする。
		$\epsilon:G\to\sizen$を$\epsilon x:=\jump{x=1}$とすると、
		$\ker\phi\subseteq A^*$の列挙は次のように書くことができる。
		\begin{equation*}\begin{split}
			\sum_{x\in\ker\phi} x = \sum_{x\in A^*} (\epsilon\phi x) x
			\simeq_\sizen \plr{\epsilon\otimes\id}
			\plr{\sum_{a\in A}\phi a\otimes a}^*
		\end{split}\end{equation*}
		$A=\set{b,c}$、$G=\braket{\eta,\eta^\flat\bou\eta\eta^\flat=1}$、
		$\phi b=\eta,\;\phi c=\eta^\flat$とすると、$\ker\phi$がDyck言語になる。
	\end{note} %note:準同型の観察}
	\begin{note}[量子群の観察]\label{note:量子群の観察} %{
		$\sll(2)$の基底系$L_\pm,L_3$を次のようにとると、
		\begin{equation*}\begin{split}
			L_+ := \begin{pmatrix}
				0 & 1 \\ 0 & 0
			\end{pmatrix},\quad L_- := \begin{pmatrix}
				0 & 0 \\ 1 & 0
			\end{pmatrix},\quad L_3 := \begin{pmatrix}
				1 & 0 \\ 0 & -1
			\end{pmatrix}
		\end{split}\end{equation*}
		次の交換関係が成り立つ。
		\begin{equation*}\begin{split}
			[L_+,L_-] = H,\quad [L_3,L_\pm] = \pm2L_\pm
		\end{split}\end{equation*}
		これを量子変形した$L_{q\pm}$を次の交換関係によって定義する。
		\begin{equation*}\begin{split}
			[L_{q+},L_{q-}] = \frac{q^{L_2} - q^{-L_3}}{q - q^{-1}},\quad
			q^{L_3}L_{q\pm}q^{-L_3} = q^2L_{q\pm}
		\end{split}\end{equation*}
		そして、余積を次のように定義すると、
		\begin{equation*}\begin{split}
			\Delta L_{q+} = L_{q+}\otimes1 + q^{L_3}\otimes L_{q+}
			,\quad \Delta L_{q-} = L_{q-}\otimes q^{-L_3} + 1\otimes L_{q-} \\
			\Delta q^{L_3} = q^{L_3}\otimes q^{L_3}
			,\quad \epsilon L_{q\pm} = 0,\quad \epsilon q^{L_3} = 1
		\end{split}\end{equation*}
		アンチポードは次のようになって、
		\begin{equation*}\begin{split}
			S L_{q+} = -q^{-L_3}L_{q+} ,\quad S L_{q-} = -L_{q-}q^{L_3}
			,\quad S q^{L_3} = q^{-L_3}
		\end{split}\end{equation*}
		$\myop{span}_\fukuso\set{L_{q\pm},q^{\pm L_3}}$はHopf代数となる。
		一方、文字列のシャッフル積によって作られたq-Brzozowski代数は次の
		交換関係を満たす。
		\begin{equation*}\begin{split}
			(\eta)_qm_0 = m_0\plr{(\eta)_q\otimes1 + q^\Nhat\otimes(\eta)_q}
			,\quad \eta^\flat m_0 = m_0\plr{\eta^\flat\otimes1}
		\end{split}\end{equation*}
	\end{note} %note:量子群の観察}
%s1:計算の整理}
\section{計算のメモ}\label{s1:計算のメモ} %{
	一方、$D_*$はDyck言語と異なり、文字列の連結では閉じていないことに注意
	する。
	\begin{equation*}\begin{split}
		bcd\in D_1 \quad\text{but}\quad bcdbcd\not\in D_2
	\end{split}\end{equation*}

	$D_n$の列挙$\ls D_n=\sum_{w\in D_n}w\in \sizen D_n$は、
	定義\eqref{eq:D_nの定義}を$\sizen D_n$の漸化式に書き換えた次の漸化式
	によって与えられる。
	\begin{equation}\label{eq:列挙係数の漸化式}\begin{split}
		\ls D_0 = 1,\quad \ls D_{n+1} = \sum_{k=0}^n 
		\beta_D\plr{\ls D_k\otimes\ls D_{n-k}}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation}
	そして、形式級数$\ls D_*$と$\ls D_+$を次のように定義する。
	\begin{equation*}\begin{split}
		\ls D_* := \sum_{n\in\sizen} \ls D_n
		,\quad \ls D_+ := \sum_{n\in\sizen_+} \ls D_n
	\end{split}\end{equation*}
	$\ls D_0=1$だから、$\ls D_*=1+\ls D_L$となる。

	$\fukuso_q[t]$の通常の乗法を$m_0$、Jackson積分を$(\J_t)_q$と書き、
	写像$J_q^t:D_*\to\fukuso_q[t]$を次のように定義する。
	\begin{equation*}\begin{split}
		J_q^t 1 := 1,\quad J_q^t\beta_D &:= (\J_t)_qm_0\plr{J_q^t\otimes J_q^t}
	\end{split}\end{equation*}
	$D_*$では、$D_+$の$\beta_D$による分解の一意性により、$J_q^t$をこのように
	定義できることに注意する。
	次の式から、
	\begin{equation*}\begin{split}
		w\in D_n\implies J_q^tw \in \fukuso_qt^n
		\quad\because\; \text{induction by $n$}
	\end{split}\end{equation*}
	単語についての次の漸化式が成り立つことがわかる。
	\begin{equation*}\begin{split}
		J_q^t1 &= 1 \\
		J_q^t\beta_D\plr{w_1\otimes w_2} 
		&= \frac{t}{\gblr{|w_1|_D + |w_2|_D + 1}_q}
			\plr{J_q^tw_1}\plr{J_q^tw_2} \quad\text{for all } w_1,w_2\in D_*
	\end{split}\end{equation*}
	また、$J_q^t\ls D_n$についての次の漸化式が成り立つことがわかる。
	\begin{equation}\label{eq:微分係数の漸化式}\begin{split}
		J_q^t\ls D_0 &= 1 \\
		J_q^t\ls D_{n+1} &= \frac{t}{[n+1]_q}\sum_{k=0}^n
			\plr{J_q^t\ls D_k}\plr{J_q^t\ls D_{n-k}} 
			\quad\text{for all } n\in\sizen
	\end{split}\end{equation}
	そして、$J_q^t$を形式級数に拡張すると、$J_q^t\ls D_*\in\fukuso_q[[t]]$は
	次の微分方程式を満たす。
	\begin{equation*}\begin{split}
		J_q^t\ls D_* = 1 + \plr{\J_t}_q\plr{J_q^t\ls D_*}^2
	\end{split}\end{equation*}

	\begin{todo}[課題]\label{todo:課題} %{
		$J_q^t$を積を使って書き表すことが課題となる。$D_*$にはこれといった
		積は見つからないし、$\fukuso_q[t]$に二項演算$*$を次のように定義しても、
		\begin{equation*}\begin{split}
			f*g := \plr{\J_t}_q(fg) \quad\text{for all } f,g\in\fukuso_q[t]
		\end{split}\end{equation*}
		次のようになって、$q=0$の時以外は$*$は結合的にはならない。
		\begin{equation*}\begin{split}
			(t^i*t^j)*t^k &= \frac{t^{i+j+k+2}}{[i+j+1]_q[i+j+k+2]_q} \\
			&\neq \frac{t^{i+j+k+2}}{[j+k+1]_q[i+j+k+2]_q} = t^i*(t^j*t^k)
		\end{split}\end{equation*}
	\end{todo} %todo:課題}

	\begin{todo}[修正]\label{todo:修正} %{
		$\beta_D$による$D_*$の元の分解を一意にする。
	\end{todo} %todo:修正}
	Dyck言語の場合と異なり、$\beta_D$は$1:1$でなないが、ここでは$b\neq d$
	と仮定しているので、$m_0$を文字列の連結とすると、次の式が成り立つ。
	\begin{equation}\label{eq:Dの曖昧さ}\begin{split}
		\beta_D(w_1, w_2) = \beta_D(x_1, x_2) 
		\implies m_0(w_1, w_2) = m_0(x_1, x_2) \\
		\quad\text{for all } w_i,x_i\in A^*
	\end{split}\end{equation}

	この定義は重複を含んでいることに注意する\footnote{
		重複を含まない定義は次のようになるだろう。
		\begin{equation*}\begin{split}
			D_{n+1} := \cup_{k=0}^n \jump{k\le n-k} \beta_D(D_k, D_{n-k})
		\end{split}\end{equation*}
		Dyck言語との対応と簡便さを考えて$D_n$を\eqref{eq:D_nの定義}で定義
		している。
	}。例えば、任意の$n\in\sizen$に対して
	$\beta_D(D_0\times D_n)=\beta_D(D_1\times D_n)$となっている。
	低次の$D_n$は次のようになる。
	\begin{equation*}\begin{split}
		D_1 &= \set{bd},\quad D_2 = \set{b^2d^2}
		,\quad D_3 = \set{b^3d^3,\; b^2dbd^2} \\
		D_4 &= \set{b^4d^4,\; b^3dbd^3,\; b^3d^2bd^2,\; b^2db^2d^3} \\
	\end{split}\end{equation*}
	また、$D_*$は文字列の連結で閉じていないことに注意する。
	例えば、$bd\in D_1$だが$bdbd\not\in D_2$である。
	一般には、次のようになっている。
	\begin{equation*}\begin{split}
		w_1w_2\in D_* \implies w_1 = 1 \text{ or } w_2 = 1
		\quad\text{for all } w_1,w_2\in D_*
	\end{split}\end{equation*}
	\begin{proof} %{
		背理法で証明する。
		ある$w_1,w_2\in D_+$が$w_1w_2\in D_+$となっていると仮定する。
		$w_1,w_2\in D_+$だから、ある$x_i,y_i\in D_*$があって、
		$w_1=bx_1y_1d,\;w_2=bx_2y_2d$と書け、$w_1w_2\in D_+$だから、
		ある$z_i\in D_*$があって、$w_1w_2=bz_1z_2d$と書ける。
		したがって、$x_1y_1dbx_2y_2=z_1z_2$となるが、次の式から、この式は
		矛盾となる。
		\begin{equation*}\begin{split}
			w = uv \implies \sharp_bu\ge\sharp_dv
			&\quad\text{for all } w\in D_*,\; u,v\in A^* \\
			\sharp_bw = \sharp_d w &\quad\text{for all } w\in D_*
		\end{split}\end{equation*}
	\end{proof} %}

	\begin{todo}[必要性]\label{todo:必要性} %{
		$\dupls D_n$を定義する必要があるかな？
	\end{todo} %todo:必要性}

	定義\eqref{eq:D_nの定義}を$\fukuso D_n$の漸化式に書き換えた次の漸化式
	$\dupls D_n$を考える。
	\begin{equation}\label{eq:列挙係数の漸化式}\begin{split}
		\dupls D_0 = 1,\quad \dupls D_{n+1} = \sum_{k=0}^n 
		\beta_D\plr{\dupls D_k\otimes\dupls D_{n-k}}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation}
	$\dupls D_n$は$D_n$の列挙$\ls D_n$に係数を掛けたものとなっている。
	係数は$\beta_D$の対称性\eqref{eq:Dの曖昧さ}に起因していて\footnote{
		ここで定義した$\sigma_D$は微分方程式の数値解法でのButhcer理論や、
		Connes-Kreimerの繰り込み理論に現れる根付き平面木の対称性の特別な場合
		である。例えば\cite{Gubinelli:2008}の$\sigma$の逆数が、ここで定義した
		$\kappa_D$に対応する。
		この対称性は、形式言語では文法\eqref{eq:beta_Dの定義}の曖昧さという。
		物理や数学では対称性は計算を容易にする善なるものとして捉えられるが、
		パーシングでは対称性は計算に曖昧さをもたらす悪なるものとして捉えられて
		いる。
	}、次の写像$\kappa_D:D_*\to\sizen$で与えられる。
	\begin{equation*}\begin{split}
		\kappa_D 1 &:= 1 \\
		\kappa_D w &:= \sum_{w_1,w_2\in D_*} \jump{w = \beta_D(w_1, w_2)}
			\plr{\kappa_D w_1}\plr{\kappa_D w_2}
			\quad\text{for all } w\in D_+
	\end{split}\end{equation*}
	$\kappa_D$を用いると$\dupls D_n$は次のように書くことができる。
	\begin{equation*}\begin{split}
		\dupls D_n = \sum_{w\in D_n}\plr{\kappa_D w} w 
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	$\dupls D_n$を低次の項について計算すると次のようになる。
	\begin{equation}\label{低次の列挙係数}\begin{split}
		\dupls D_1 &= bd,\quad \dupls D_2 = 2 b^2d^2
		,\quad \dupls D_3 = 4 b^3d^3 + b^2dbd^2 \\
		\dupls D_4 &= 8 b^4d^4 + 2 b^3dbd^3 + 2 b^3d^2bd^2 + 2 b^2db^2d^3 \\
	\end{split}\end{equation}

	$\fukuso_q[t]$の通常の乗法を$m_0$、Jackson積分を$(\J_t)_q$と書き、
	写像$J_q^t:D_*\to\fukuso_q[t]$を次のように定義する。
	\begin{equation*}\begin{split}
		J_q^t 1 &:= 1 \\
		J_q^t w &:= \sum_{w_1,w_2\in D_*} \jump{w = \beta_D(w_1, w_2)}
			(\J_t)_q\plr{J_q^t w_1}\plr{J_q^t w_2}
			\quad\text{for all } w\in D_+
	\end{split}\end{equation*}

	\begin{todo}[描き直し]\label{todo:描き直し} %{
	\end{todo} %todo:描き直し}

	\begin{todo}[ここまで]\label{todo:ここまで} %{
	\end{todo} %todo:ここまで}

	$\fukuso D_*[[t]]$の元としては次のようになる。
	\begin{equation*}\begin{split}
		(\ls D_*|t) = 1 + t\beta_D\ggplr{(\ls D_*|t)\otimes(\ls D_*|t)}
	\end{split}\end{equation*}

	低次の項を計算すると次のようになる。
	\begin{equation}\label{低次の列挙係数}\begin{split}
		x_1 &= bd,\quad x_2 = 2 b^2d^2,\quad x_3 = 4 b^3d^3 + b^2dbd^2 \\
		x_4 &= 8 b^4d^4 + 2 b^3dbd^3 + 2 b^3d^2bd^2 + 2 b^2db^2d^3 \\
		x_5 &= 16 b^5d^5 + 4 b^4dbd^4 + 4 b^4d^2bd^3 + 4 b^4d^3bd^2 
			+ 4 b^3db^2d^4 + b^3dbd^2bd^2 \\
		&\; + 4 b^3d^2b^2d^3 + 4 b^2db^3d^4 + b^2db^2dbd^3
	\end{split}\end{equation}
	$\fukuso_q[[s]]$の通常の乗法を$m_0$、Jackson積分を$(\J_s)_q$と書き、
	線形射$J_q^s:\fukuso D_*\to\fukuso_q[[s]]$を次のように定義する。
	\begin{equation*}\begin{split}
		J_q^s 1 := 1,\quad 
		J_q^s\beta_D := \plr{\J_s}_qm_0\plr{J_q^s\otimes J_q^s}
	\end{split}\end{equation*}

	したがって、$J_q^s$の定義域を$\fukuso B_*$から$\fukuso B_*[[t]]$へ拡張
	すると、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $s=0$のときは、$J_q^0x$は定数$(J_q^0x|t)=1$になり、
		\item $s\neq0$のときは、$J_q^sx$は次の微分方程式を満たす。
		\begin{equation*}\begin{split}
			(J_q^sx|0) = 1,\quad (\partial_qJ_q^sx|t) = \frac{1}{s}(J_q^sx|t)^2
		\end{split}\end{equation*}
	\end{itemize} %}
	$(C_n)_q\in\fukuso_q$を次のように定義すると、
	\begin{equation*}\begin{split}
		J^s_qx_n = (C_n)_q\frac{s^n}{[n]_q!}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	係数の漸化式\eqref{eq:微分係数の漸化式}より、次の漸化式が成り立つ。
	\begin{equation}\label{eq:微分係数の漸化式その二}\begin{split}
		(C_{n+1})_q = \sum_{k=0}^n \qbinom{n}{k}_q(C_{k})_q(C_{n-k})_q
			\quad\text{for all } n\in\sizen
	\end{split}\end{equation}

	漸化式\eqref{eq:微分係数の漸化式その二}を解くのではなく、
	低次の係数\eqref{低次の列挙係数}に対して実直に$J_q^s$の作用を
	計算すると次のようになる。
	\begin{equation}\label{低次の微分係数その二}\begin{split}
		(C_1)_q &= 1 ,\quad (C_2)_q = 2 ,\quad (C_3)_q = 4 + [2]_q \\
		(C_4)_q &= 8 + 2[2]_q + 2[3]_q + 2[3]_q \\
		(C_5)_q &= 16 + 4[2]_q + 4[3]_q + 4[4]_q + 4 [3]_q + [2]_q[4]_q 
			+ 4\frac{[3]_q[4]_q}{[2]_q} + 4[4]_q + [2]_q[4]_q
	\end{split}\end{equation}
	すると、奇妙なことが成り立っていることに気がつく。
	$b$を生成、$d$を消滅演算子だと思って、$\fukuso D_*$に次の同値関係
	$\sim$を定義する。
	\begin{equation*}\begin{split}
		db \sim 1 + qbd
	\end{split}\end{equation*}
	すると、$D_*$の元は次のように正規積の形で書くことができるが、
	\begin{equation*}\begin{split}
		b^3d^2b^2d^3 \sim (1 + q)b^3d^3 + (q + 2q^2 + q^3)b^4d^4 + q^4 b^5d^5
	\end{split}\end{equation*}
	正規積に書き直したときの係数の和が$J_q^s$の作用と等しくなる。
	\begin{equation*}\begin{split}
		\plr{[5]_q!}J_q^1(b^3d^2b^2d^3) &= \frac{[3]_q[4]_q}{[2]_q}
			= 1 + q + 2q^2 + q^3 + q^4 \\
		&= (1 + q) + 
	\end{split}\end{equation*}

	\begin{note}[プログラムの確認]\label{note:プログラムの確認} %{
		低次の微分係数\eqref{低次の微分係数その二}を
		$q=0$と$q=1$のときを表にすると次のようになる。
		\begin{equation*}\begin{array}{r|rrrrrrl}
			& (C_0)_q & (C_1)_q & (C_2)_q & (C_3)_q & (C_4)_q & (C_5)_q 
				& \quad\cdots \\\hline
			q=0 & 1 & 1 & 2 & 5 & 14 & 42 & \quad\text{カタラン数}C_n \\
			q=1 & 1 & 1 & 2 & 6 & 24 & 120 & \quad\text{階乗}n! \\
		\end{array}\end{equation*}
	\end{note} %note:プログラムの確認}
%s1:計算のメモ}
\section{Kacのメモ}\label{s1:Kacのメモ} %{
	\cite{kac:2002}のメモ

	$F_3^2$を有限体$F_3:=\set{0,1,2}$上の二次元自由ベクトル空間とする。
	$F_3^2$の元は原点を含めて$3^2$個あるが、$F_3^2$の$1$次元部分空間は
	次の元で張られる部分空間の$4$種類になる。
	\begin{equation*}\begin{split}
		\pvect{1}{0}^\tran ,\quad \pvect{0}{1}^\tran
		,\quad \pvect{1}{1}^\tran ,\quad \pvect{1}{2}^\tran
	\end{split}\end{equation*}
	表にすると次のようになっている。
	\begin{equation*}\begin{array}{r|rrrr}
		& 0 & 1 & 2 \\\hline
		0 & \pvect{0}{0}^\tran & \pvect{0}{1}^\tran & 2\pvect{0}{1}^\tran \\
		1 & \pvect{1}{0}^\tran & \pvect{1}{1}^\tran & \pvect{1}{2}^\tran \\
		2 & 2\pvect{1}{0}^\tran & 2\pvect{1}{2}^\tran & 2\pvect{1}{1}^\tran \\
	\end{array}\end{equation*}
%s1:Kacのメモ}
\section{Kempfのメモ}\label{s1:Kempfのメモ} %{
	\cite{kempf:1994}のメモ
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item アンチポード$S_q$
		\begin{equation*}\begin{split}
			S_q\eta_q^n = q^{\binom{n}{2}}(-\eta_q)^n
		\end{split}\end{equation*}
		一般に、アンチポードの定義は次の式を満たす線形射$S$である
		\cite{bk:jinbo.ryousigun}。
		\begin{equation*}\begin{split}
			m(S\otimes\id)\Delta = u\epsilon = m(\id\otimes S)\Delta
		\end{split}\end{equation*}
		\item q-スケーリング$q^\Nhat$ \\
		$\eta_q^\flat\eta_0$はq-数演算子になっているので、
		\begin{equation*}\begin{split}
			\eta_q^\flat\eta_0\ket{\eta_q^n} = [n]_q\ket{\eta_q^n}
			\quad\text{for all } n\in\sizen
		\end{split}\end{equation*}
		次のようにして$q^\Nhat$を$\eta_0$と$\eta_q^\flat$で表すことができる。
		\begin{equation*}\begin{split}
			\eta_q^\flat\eta_0 = \frac{1 - q^\Nhat}{1 - q}
			\implies q^\Nhat = 1 - (1 - q)\eta_q^\flat\eta_0
		\end{split}\end{equation*}
		$q^\Nhat$の交換関係は次のようになる。
		\begin{equation*}\begin{split}
			q^\Nhat\eta_q^\flat = (q\eta_q^\flat)q^\Nhat,\quad
			\eta_0q^\Nhat = q^\Nhat(q\eta_0)
		\end{split}\end{equation*}
		q-スケーリングを使うと積分作用素が次のように書ける。
		\begin{equation*}\begin{split}
			\int_0^t(f|s)d_qs &= (1-q)\sum_{n\in\sizen} (q^nt)(f|q^nt) \\
			&= (1-q)\sum_{n\in\sizen}\bra{t:q}q^{n\Nhat}
				\eta_q^\flat(f|\eta_q^\flat)\ket{1} \\
			&= \bra{t:q}\frac{1-q}{1-q^\Nhat}\eta_q^\flat(f|\eta_q^\flat)\ket{1} \\
			\implies & \frac{1-q}{1-q^\Nhat}\eta_q^\flat\mapsto \int_0^td_qs
		\end{split}\end{equation*}
		\cite{kempf:1994}では$q^\Nhat$を$L$と書いている。
	\end{itemize} %}
%s1:Kempfのメモ}
\section{計算のメモ}\label{s1:計算のメモ} %{
	次の$\fukuso_q\braket{b,c}$上の線形q-微分方程式を考える。
	\begin{equation}\label{eq:線形q-微分方程式}\begin{split}
		(\partial_qx|t) = b(x|t)c
	\end{split}\end{equation}
	$t_q:=(1-q)t$とおき、差分を展開すると次のようになる。
	\begin{equation*}\begin{split}
		(x|t) &= (x|qt) + t_qb(x|t)c \\
		&= \sum_{n\in\sizen} (t_qb)^n(x|qt)c^n \\
		&= \sum_{n\in\sizen} \frac{1-q^{n+1}}{1-q}(t_qb)^n(x|q^2t)c^n \\
		&= \sum_{n\in\sizen} \frac{1-q^{n+1}}{1-q}\frac{1-q^{n+2}}{1-q^2}
			(t_qb)^n(x|q^3t)c^n \\
	\end{split}\end{equation*}
	したがって、次の式が成り立つことが予想される。
	\begin{equation*}\begin{split}
		(x|t) \overset{?}{=} 
		\sum_{n\in\sizen}\qbinom{k+n}{k}_q(t_qb)^n(x|q^{k+1}t)c^n
		\quad\text{for all } k\in\sizen
	\end{split}\end{equation*}
	ある$k\in\sizen$で成り立つとすると、次のようになり、
	\begin{equation*}\begin{split}
		(x|t) &= \sum_{n\in\sizen} \qbinom{n+k}{k}_q(t_qb)^n(x|q^{k+1}t)c^n \\
		&= \sum_{m,n\in\sizen} \qbinom{k+m}{k}_q(t_qb)^m(t_qq^{k+1}b)^n
			(x|q^{k+2}t)c^{m+n} \\
		&= \sum_{n\in\sizen}\sum_{r=0}^n q^{r(k+1)}\qbinom{k+n-r}{k}_q(t_qb)^n
			(x|q^{k+2}t)c^n \\
	\end{split}\end{equation*}
	次の式が成り立つかどうかに帰着する。
	\begin{equation*}\begin{split}
		\qbinom{k+1+n}{k+1}_q \overset{?}{=} \sum_{r=0}^n 
			q^{r(k+1)}\qbinom{k+n-r}{k}_q \quad\text{for all } n,k\in\sizen
	\end{split}\end{equation*}
	\begin{proof} %{
		$n$についての帰納法で証明する。$n=0$のときは、次のようになり、
		命題が成り立つことがわかる。
		\begin{equation*}\begin{split}
			\qbinom{k+1}{k+1}_q = \qbinom{k}{k}_q
			= \sum_{r=0}^0 q^{r(k+1)}\qbinom{k-r}{k}_q 
			\quad\text{for all } k\in\sizen
		\end{split}\end{equation*}
		ある$n\in\sizen$以下で命題が成り立つと仮定すると、Pascalの恒等式と
		帰納法の仮定より、次のようになり、
		\begin{equation*}\begin{split}
			\qbinom{k+2+n}{k+1}_q 
			&= \qbinom{k+1+n}{k}_q + q^{k+1}\qbinom{k+1+n}{k+1}_q \\
			&= \qbinom{k+1+n}{k}_q + q^{k+1}\sum_{r=0}^n q^{r(k+1)}
				\qbinom{k+n-r}{k}_q \\
			&= \sum_{r=0}^{n+1} q^{r(k+1)}\qbinom{k+n+1-r}{k}_q
		\end{split}\end{equation*}
		$n+1$でも命題が成り立つことがわかる。
	\end{proof} %}
	また、\eqref{eq:線形q-微分方程式}の解は次のように書くことができるので、
	\begin{equation*}\begin{split}
		(x|t) = \sum_{n\in\sizen}\frac{t^n}{[n]_q!} b^n(x|0)c^n
	\end{split}\end{equation*}
	次の式が成り立つことが予想される。
	\begin{equation*}\begin{split}
		\lim_{k\to\infty} \qbinom{k+n}{k}_q
		\overset{?}{=} \frac{1}{(1-q)^n[n]_q!}
		= \frac{1}{(1-q)\cdots(1-q^n)}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	確かに、次の式から成り立つことがわかる。
	\begin{equation*}\begin{split}
		\qbinom{k+n}{k}_q &= \frac{(1-q^{k+1})\cdots(1-q^{k+n})}
			{(1-q)\cdots(1-q^n)} \\
		\implies \lim_{k\to\infty}\qbinom{k+n}{k}_q 
		&= \lim_{k\to\infty}\frac{(1-q^{k+1})\cdots(1-q^{k+n})}
			{(1-q)\cdots(1-q^n)} \\
		&= \frac{1}{(1-q)\cdots(1-q^n)} \\
	\end{split}\end{equation*}
	以上を命題の形でまとめておく。

	\begin{proposition}[線形q-微分方程式の摂動解]\label{prop:線形q-微分方程式の摂動解} %{
		$\fukuso_q\braket{b,c}$上の線形q-微分方程式について次の式が成り立つ。
		\begin{equation*}\begin{split}
			(\partial_qx|t) = b(x|t)c \implies (x|t) &= \sum_{n\in\sizen}
				\qbinom{k+n}{k}_q(t_qb)^n(x|q^{k+1}t)c^n
				\quad\text{for all } k\in\sizen \\
			&= \sum_{n\in\sizen} \frac{t^n}{[n]_q!} b^n(x|0)c^n
		\end{split}\end{equation*}
		ここで、$t_q:=(1-q)t$とおいた。
	\end{proposition} %prop:線形q-微分方程式の摂動解}

	$(\eta_0,\eta_q^\flat)$系での交換関係を計算する。
	\begin{equation*}\begin{split}
		\eta_0\eta_q^\flat = 1 + \eta_q^\flat\eta_0
	\end{split}\end{equation*}
\subsubsection{$(t\eta_0)_q^*$と$\eta_0^\flat$との交換関係} %{
	次の式が成り立つから、
	\begin{equation*}\begin{split}
		(t\eta_0)_q^*\eta_0^\flat = \eta_0^\flat + \plr{\int_t(t\eta_0)_q^*}
	\end{split}\end{equation*}
	次の式が成り立つ。
	\begin{equation*}\begin{split}
		(t\eta_0)_q^*\eta_0^\flat(\eta_q^\flat)^n 
		= \eta_0^\flat + \plr{\int_t(t\eta_0)_q^*}
	\end{split}\end{equation*}
%s3:$(t\eta_0)_q^*$と$\eta_0^\flat$との交換関係}
\subsubsection{$(t\eta_0)_q^*$と$\eta_q^\flat$との交換関係} %{
	次の式が成り立つから、
	\begin{equation*}\begin{split}
		\eta_0^{n+1}\eta_q^\flat 
		= [n+1]_q\eta_0^n + \eta_q^\flat(q\eta_0)^{n+1}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	次の式が成り立つ。
	\begin{equation*}\begin{split}
		(t\eta_0)_q^*\eta_q^\flat = t(t\eta_0)_q^* + \eta_q^\flat(qt\eta_0)_q^*
	\end{split}\end{equation*}
	この式からコヒーレント状態$\ket{t:q}$が定義できるが、
	\begin{equation*}\begin{split}
		\ket{t:q} := \ket{1}(t\eta_0)_q^*
		\implies \ket{t:q}\eta_q^\flat = t^n\ket{t:q}
	\end{split}\end{equation*}
	ここでは、$(t\eta_0)_q^*$と$\eta_q^\flat$の交換関係を計算してみる。
	まず、次の式から、
	\begin{equation*}\begin{split}
		(t\eta_0)_q^*(\eta_q^\flat)^2 
		= \sum_{k=0}^2 \qbinom{2}{k}_qt^{2-k}(\eta_q^\flat)^k(q^kt\eta_0)_q^*
	\end{split}\end{equation*}
	ある$n\in\sizen$があって、次の式が成り立つと仮定すると、
	\begin{equation*}\begin{split}
		(t\eta_0)_q^*(\eta_q^\flat)^m
		= \sum_{k=0}^m \qbinom{m}{k}_qt^{m-k}(\eta_q^\flat)^k(q^kt\eta_0)_q^*
		\quad\text{for all } m\le n
	\end{split}\end{equation*}
	$n+1$でも成り立つ。
	\begin{equation*}\begin{split}
		(t\eta_0)_q^*(\eta_q^\flat)^{n+1}
		&= \sum_{k=0}^n \qbinom{n}{k}_qt^{n-k}(\eta_q^\flat)^k(q^kt\eta_0)_q^*
			\eta_q^\flat \\
		&= \sum_{k=0}^n \qbinom{n}{k}_qt^{n-k}(\eta_q^\flat)^k
			\ggplr{q^kt(q^kt\eta_0)_q^* + \eta_q^\flat(q^{k+1}t\eta_0)_q^*} \\
		&= t^{n+1}(t\eta_0)_q^* + (\eta_q^\flat)^{n+1}(q^{n+1}t\eta_0)_q^* \\
		&\; + \sum_{k=1}^n\plr{q^k\qbinom{n}{k}_q + \qbinom{n}{k-1}_q}
			t^{n+1-k}(\eta_q^\flat)^k(q^kt\eta_0)_q^* \\
		&= \sum_{k=0}^{n+1} \qbinom{n+1}{k}_qt^{n+1-k}
			(\eta_q^\flat)^k(q^kt\eta_0)_q^*
	\end{split}\end{equation*}
	したがって、帰納法により、次の式が成り立つことがわかる。
	\begin{equation*}\begin{split}
		(t\eta_0)_q^*(\eta_q^\flat)^n
		= \sum_{k=0}^n \qbinom{n}{k}_qt^{n-k}(\eta_q^\flat)^k(q^kt\eta_0)_q^*
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
%s3:$(t\eta_0)_q^*$と$\eta_q^\flat$との交換関係}
%s1:計算のメモ}
\section{メモ}\label{s1:メモ} %{
	経路代数のHopf代数\cite{Cibils:2000}についてのメモ。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 頂点$v$と$v$から$v$への辺$e_v^\tran e_v$を同一視する。
		\item 辺（の連結）の余積を次のように定義する。
		\begin{equation*}\begin{split}
			\Delta a_n\cdots a_1 &:= t(a_n)\otimes a_n\cdots a_1
			+ a_n\cdots a_1\otimes s(a_1) \\
			&\; + \sum_{i=1}^{n-1} a_n\cdots a_{i+1}\otimes a_i\cdots a_1
		\end{split}\end{equation*}
		通常の余積$\Delta x=1\otimes x+x\otimes 1 +\cdots$での単位元$1$を
		頂点のループに置き換えている。無限箙の場合には単位元が存在することを
		仮定できないので、無限箙も含めて考える場合には有効な定義だと思う。
		\begin{equation*}\begin{split}
			\Delta\xymatrix{
				x \ar[r]^a & y
			} = \xymatrix{
				x\otimes x \ar[r]^{x\otimes a} & x\otimes y
			} + \xymatrix{
				x\otimes y \ar[r]^{a\otimes y} & y\otimes y
			}
		\end{split}\end{equation*}
	\end{itemize} %}
%s1:メモ}
\section{Brzozowski代数}\label{s1:Brzozowski代数} %{
\subsection{この節での便宜}\label{s2:この節での便宜} %{
	この節では多項式を表すのに次の記号を使うことにする。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[多項式環] $R$を可換環とするとき、$R[t]$を$R$上の多項式環とする。
		このとき、係数$R$と不定元$t$は可換である。
		\item[有理式体] $R$を標数$0$の整域とするとき、$R(t)$を$R$上の有理式体
		とする。このとき、係数$R$と不定元$t$は可換である。
		\item[自由代数] $R$を可換環、$A$を有限集合とするとき、$R\braket{A}$
		を$R$上の自由代数とする。このとき、係数$R$と不定元$A$は可換である。
	\end{description} %}
	また、この節では量子変形を多用するために、特別に有理式体の不定元を
	$R_q:=R(q)$というように添え字で表すことにする。
%s2:この節での便宜}
\subsection{一般論}\label{s2:一般論} %{
\subsubsection{環の中心}\label{s3:環の中心} %{
	$V$を環、$C$を$V$の中心とする。$C$は$0$と$1$を含むので、空ではない。
	また、任意の$x,y\in C$と$v\in V$に対して次の式が成り立つので、
	\begin{equation*}\begin{split}
		(x+y)v = v(x+y) \implies x + y\in C,\quad xyv = vxy \implies xy\in C
	\end{split}\end{equation*}
	$C$は$V$の部分環となる。
%s3:環の中心}
\subsubsection{既約と分解可能}\label{s3:既約と分解可能} %{
	$S$を環、$V$を$S$上の加群とする。部分空間$W\subset V$が$SW\subseteq W$と
	なるとき、$W$を不変な部分空間という。
	不変な部分空間が$\set{0}$と$V$自身に限られるとき、$V$を既約な加群という。
	また、任意の不変な部分空間$W\subseteq V$に対して$V=W\oplus W'$と直和分解
	できるとき、$V$を分解可能または完全可約な加群という。
%s3:既約と分解可能}
\subsubsection{整域の標数}\label{s3:整域の標数} %{
	$R$を整域、$n\in\sizen$を$n1=0$となる最小の自然数とする。
	ある$p,q\in\sizen$で$n=pq$と書けたとすると、$n1=\plr{p1}\plr{q1}=0$
	となる。$R$は整域だから、$p1=0$または$q1=0$となるが、それは$n$の定義に
	反する。したがって、$n$は$0$または素数でなくてはならない。
	つまり、整域の標数は$0$または素数に限られる。
%s3:整域}
%s2:一般論}
\subsection{Dyck経路メモ}\label{s2:Dyck経路メモ} %{
	次のDyck言語型の解をq-微分方程式をq-Weyl代数で表すことを考える。
	\begin{equation}\label{eq:q-Dyck微分方程式}\begin{split}
		(\partial_t)_q (x|t) = (x|t)^2
	\end{split}\end{equation}
	この式を差分で書くと次のようになる。
	\begin{equation}\label{eq:q-Dyck差分方程式}\begin{split}
		(x|t) = (x|qt) + (1 - q)t(x|t)^2 
	\end{split}\end{equation}
	\eqref{eq:q-Dyck微分方程式}または\eqref{eq:q-Dyck差分方程式}を
	q-Weyl代数で表す方法はいくつか考えられる。
\subsubsection{再帰下降}\label{s3:再帰下降section name} %{
	\eqref{eq:q-Dyck差分方程式}に終状態$y$を次のように付け加えて
	次の遷移図を考える。
	\begin{equation*}\begin{split}
		\left\{\begin{split}
			(x|t) &= (x|qt)y + (1 - q)t(x|t)^2 \\
			y &= 1
		\end{split}\right. \xymatrix{
			x_0 \ar@/^1ex/[d]^{(x|qt)} \ar@(ul,ur)^{(1-q)\eta_0} \\
			*++[o][F=]{y} \ar[u]^{\eta_0^\flat t}
		}
	\end{split}\end{equation*}
	さらに、$(x|qt)$を定数から状態に変更して次の遷移図を考える。
	\begin{equation*}\begin{split}
		\left\{\begin{split}
			(x|t) &= (x|qt)y + (1 - q)t(x|t)^2 \\
			(x|qt) &= (x|q^2t)y + (1 - q)qt(x|qt)^2 \\
			y &= 1
		\end{split}\right. \xymatrix{
			x_0 \ar[r]^{\xi_1} \ar@(ul,ur)^{(1-q)\eta_0} 
			& x_1 \ar@/^1ex/[d]^{(x|q^2t)} \ar@(ul,ur)^{(1-q)q\eta_1} \\
			& *++[o][F=]{y} \ar[ul]^{\eta_0^\flat t} \ar[u]^{\eta_1^\flat t}
				\ar@(dr,dl)^{\xi_1^\flat}
		}
	\end{split}\end{equation*}
	\begin{todo}[振動し]\label{todo:振動し} %{
		$\eta$と$\xi$に$\eta\xi^\flat=q\xi^\flat\eta$のような交換関係
		を設定すれば何とかなるかもしれない。
	\end{todo} %todo:振動し}
%s3:再帰下降section name}
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 代数式として再起下降を適用する。\\
		\eqref{eq:q-Dyck方程式}を次の代数式に書き直して、
		次のように変数$(y|t)$を付け加えて、
		次の遷移図を考える。
		\begin{equation*}\begin{split}
			\xymatrix{
				x_t \ar[r]^{(x|qt)} \ar@(dl,ul)^{(1-q)tx_t} & *++[o][F=]{y_t}
			} \mapsto \xymatrix{
				x_t \ar@<1ex>[r]^{(x|qt)} \ar@(dl,ul)^{(1-q)\eta} 
				& *++[o][F=]{y_t} \ar@<1ex>[l]^{\eta^\flat t}
			}
		\end{split}\end{equation*}
		$x_{qt}$にも同様の遷移図を考えて、
		次のように遷移図を連結する。
		\begin{equation*}\begin{split}
			\xymatrix{
				x_t \ar[d]^{\xi} \ar@(dl,ul)^{(1-q)\eta} 
				& *++[o][F=]{y_t} \ar[l]_{\eta\flat t} \\
				x_{qt} \ar@<1ex>[r]^{(x|q^2t)} \ar@(dl,ul)^{(1-q)\eta} 
				& *++[o][F=]{y_{qt}} \ar@<1ex>[l]^{\eta^\flat t} 
					\ar[u]_{\xi_\flat}
			}
		\end{split}\end{equation*}
		さて、ここから。
		\item 係数から考える。\\
		\eqref{eq:q-Dyck方程式}を次の代数式に書き直して、
		\begin{equation*}\begin{split}
			(x|t) = (x|qt) + (1 - q)t(x|t)^2 
		\end{split}\end{equation*}
		平方完成して$(x|t)$について解くと次のようになる。
		\begin{equation*}\begin{split}
			(x|t) &= \frac{1 - \sqrt{1 - 4(1 - q)t(x|qt)}}{2(1 - q)t} \\
				&= (x|qt) \sum_{n\in\sizen} C_n\ggplr{(1 - q)t(x|qt)}^n
		\end{split}\end{equation*}
		\item Jackson積分を使う。\\
		$\fukuso(q)[[t]]$に線形二項演算$*_q$を次のように定義すると、
		\begin{equation*}\begin{split}
			(f|t)*_q(g|t) := \int_0^td_qs \ggplr{(\partial_s)_q(f|s)}
				\ggplr{(\partial_s)_q(g|s)}
		\end{split}\end{equation*}
		$*_q$は積になる。
		\eqref{eq:q-Dyck方程式}の解は次のように書ける。
		\begin{equation*}\begin{split}
			(x|t) = (x|0) + (y|t)*_q(y|t) 
			,\quad (y|t) = t*_q(x|t)
		\end{split}\end{equation*}
	\end{itemize} %}
%s2:Dyck経路メモ}
\subsection{q-微分とq-Weyl代数の対応メモ}\label{s2:q-微分とq-Weyl代数の対応メモ} %{
	q-微分の定義
	\begin{equation}\label{eq:q-微分の定義}\begin{split}
		\gplr{\partial_t}_q\gplr{x|t} := \frac{\gplr{x|t} - \gplr{x|qt}}{t - qt}
	\end{split}\end{equation}
	は、次のq-Kleeneスターについて成り立つ次の式に対応する。
	\begin{equation}\label{eq:q-Kleeneスターによるq-微分}\begin{split}
		\gplr{\phi}_q^* = \gplr{q\phi}_q^* + (1 - q)\phi\gplr{\phi}_q^*
		\quad\text{for all } \phi\in V_q
	\end{split}\end{equation}
	この式は$\gplr{\phi}_q^*-\gplr{q\phi}_q^*$を直接計算すると得られる。
	$q=0$の時はお馴染みの$\gplr{\phi}_0^*=1+\phi\gplr{\phi}_0^*$という
	式になる。式\eqref{eq:q-Kleeneスターによるq-微分}はコヒーレント状態を
	通してq-微分\eqref{eq:q-微分の定義}に繋がる。
	$\eta_q^\flat$の固有状態$\bra{t:q}$は
	$\bra{t:q}=\bra{1}\gplr{t\eta_0}_q^*$と書けて\footnote{
		$\eta_0^\flat$の場合は特別に、固有状態$\bra{t:0}$を次のように
		書くこともできる。
		\begin{equation*}\begin{split}
			\bra{t:0}=\bra{1}\gplr{t\eta_0}_0^*=\bra{1}\gplr{t\eta_q}_q^*
		\end{split}\end{equation*}
	}、次の式が成り立つ。
	\begin{equation}\label{eq:q-コヒーレント状態の展開}\begin{split}
		\bra{t:q} = \bra{qt:q} + (1 - q)t\bra{t:q}\eta_0
	\end{split}\end{equation}
	$|q|<1$の場合、式\eqref{eq:q-Kleeneスターによるq-微分}を次のように
	展開すると、
	\begin{equation}\label{eq:q-Kleeneスターによるq-微分その二}\begin{split}
		\gplr{\phi}_q^* &= \gplr{q\phi}_q^* + (1 - q)\gplr{\phi}_q^+ \\
		&= \gplr{q^2\phi}_q^* + (1 - q)\ggplr{\gplr{\phi}_q^+ + \gplr{q\phi}_q^+} \\
		&= \cdots \\
		&= 1 + (1 - q)\phi \sum_{n\in\sizen} q^n\gplr{q^n\phi}_q^*
	\end{split}\end{equation}
	右辺の第二項はJackson積分の形になっている。
	\begin{equation}\label{eq:Jackson積分の定義}\begin{split}
		\int d_qx\plr{f|x} := (1 - q)x\sum_{n\in\sizen} q^n\plr{f|q^nx}
	\end{split}\end{equation}
	したがって、次のように書くことができ、
	\begin{equation}\label{eq:q-Kleeneスターの展開その二}\begin{split}
		\gplr{\phi}_q^* = 1 + \int \gplr{\phi}_q^*d_q\phi
	\end{split}\end{equation}
	コヒーレント状態に適用すると次のようになる。
	\begin{equation}\label{eq:q-コヒーレント状態の展開その二}\begin{split}
		\bra{t:q} = \bra{1} + \int d_qt \bra{t:q}\eta_0 \\
	\end{split}\end{equation}
	この式の両辺に$\eta_0^\flat$を作用させると、$\eta_0^\flat$が積分に
	対応する作用素になっていることがわかる。
	\begin{equation*}\begin{split}
		\bra{t:q}\eta_0^\flat = \int d_qt\bra{t:q}
	\end{split}\end{equation*}
	ここで、式\eqref{eq:q-Kleeneスターの展開その二}でのJackson積分は
	$\fukuso(q)\Eta$での積分になるので、無限次元空間での積分になるが、
	式\eqref{eq:q-コヒーレント状態の展開その二}でのJackson積分は変数$t$に
	ついての積分なので、$\fukuso(q)$での積分になることに注意する。

	以上をまとめると、$\fukuso(q)[[\eta_q]]\simeq\fukuso(q)[[\eta]]$だから、
	コヒーレント状態が線形射$\bra{t:q}:\fukuso(q)[[\eta]]\to\fukuso(q)[[t]]$
	を与え、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $\ket{1}$が単位元$1$、
		\item $\eta_q^\flat$が変数$t$、
		\item $\eta_0$がq-微分$(\partial_t)_q$、
		\item $\eta_0^\flat$がJackson積分$\int d_qt$
	\end{itemize} %}
	に対応することがわかる。また、次の式から、
	\begin{alignat*}{2}
		\ket{\eta_q^n} &= \ket{\eta_0^n}[n]_q!
		&\quad&\text{for all } n\in\sizen \\
		m_q\ket{\eta_q^m}\otimes\ket{\eta_q^n} &= \ket{\eta_q^{m+n}} 
		&\quad&\text{for all } m,n\in\sizen
	\end{alignat*}
	コヒーレント状態は代数射
	$\bra{t:q}:\ggplr{\fukuso(q)[[\eta]],m_q,\ket{1}}
	\to\ggplr{\fukuso(q)[[t]],m_\myspace,1}$
	となっていることがわかる。
%s2:q-微分とq-Weyl代数の対応メモ}
\subsection{q-Riccatiとq-Weyl代数の対応メモ}\label{s2:q-Riccatiとq-Weyl代数の対応メモ} %{
	\cite{hirota:2003}にならって次のq-Ricatti方程式を考える。
	\begin{equation}\label{eq:可積分q-Riccatiの定義}\begin{split}
		\plr{\partial_t}_q\plr{x|t}
		= \plr{a|t} + \plr{b_1|t}\plr{x|t} + \plr{b_2|t}\plr{x|qt}
			+ \plr{c|t}\plr{x|t}\plr{x|qt}
	\end{split}\end{equation}
	この式を次のように書き直す。
	\begin{equation}\label{eq:可積分q-Riccatiその一}\begin{split}
		\plr{x|t} = \pi\plr{M|t}\pvec{\plr{x|qt}}{1} \quad\text{where }
		\plr{M|t} := 1 - \plr{1 - q}t\plr{T|t} \\
		\plr{T|t} := \begin{pmatrix}
			-\plr{b_2|t} & -\plr{a|t} \\ \plr{b_1|t} & \plr{c|t}
		\end{pmatrix}
	\end{split}\end{equation}
	ここで、写像$\pi:\fukuso\times\fukuso_\times\to\fukuso$を次のように
	定義する。
	\begin{equation*}\begin{split}
		\pi\pvec{a}{b} = \frac{a}{b}
		\quad\text{for all } a\in\fukuso,\; b\in\fukuso_\times
	\end{split}\end{equation*}
	式\eqref{eq:可積分q-Riccatiその一}は次のように展開できるが、
	\begin{equation*}\begin{split}
		\plr{x|t} = \pi\plr{M|t}\plr{\pvec{0}{1} 
			+ \pvec{1}{0}\pi\plr{M|qt}\pvec{\plr{x|q^2t}}{1}}
	\end{split}\end{equation*}
	$\pi$について成り立つ次の式を使うと、
	\begin{equation*}\begin{split}
		\pi\plr{\pvec{a_1}{a_2}+\pvec{b_1}{b_2}\pi\pvec{c_1}{c_2}}
		&= \pi\frac{1}{c_2}\plr{\pvec{a_1}{a_2}c_2+\pvec{b_1}{b_2}c_1} \\
		&= \pi\plr{\pvec{a_1}{a_2}c_2+\pvec{b_1}{b_2}c_1} \\
	\end{split}\end{equation*}
	次のようになる。
	\begin{equation*}\begin{split}
		\plr{x|t} &= \pi\plr{M|t} \plr{\pvec{0}{1}\pvec{0}{1}^\tran
			+ \pvec{1}{0}\pvec{1}{0}^\tran} \plr{M|qt}\pvec{\plr{x|q^2t}}{1} \\
		&= \pi\plr{M|t}\plr{M|qt}\pvec{\plr{x|q^2t}}{1}
	\end{split}\end{equation*}
	したがって、$|q|<1$のとき、
	\eqref{eq:可積分q-Riccatiの定義}の解は次のように書ける。
	\begin{equation*}\begin{split}
		\plr{x|t} = \pi\plr{\prod_{n\in\sizen}\plr{M|q^nt}}\pvec{\plr{x|0}}{1}
	\end{split}\end{equation*}
	さらに、$a,b_i,c$が定数の時は、行列の部分がq-Kleeneスターの逆数
	\eqref{eq:q-Kleeneスターの逆数を乗積表示}
	\eqref{eq:q-Kleeneスターの逆数のTayler展開}で書け、
	\begin{equation*}\begin{split}
		\prod_{n\in\sizen}\plr{M|q^nt}
		= \prod_{n\in\sizen}\plr{1 - (1 - q)q^ntT}
		= \plr{tT}_q^{-*}
		= \sum_{n\in\sizen} q^{\binom{q}{2}}\frac{\plr{-tT}^n}{[n]_q!}
	\end{split}\end{equation*}
	\eqref{eq:可積分q-Riccatiの定義}の解は次のように書ける。
	\begin{equation*}\begin{split}
		\plr{x|t} = \pi\plr{tT}_q^{-*}\pvec{\plr{x|0}}{1}
	\end{split}\end{equation*}

	以上のq-Riccati方程式を解く手順をq-Weyl代数に翻訳することが仕事になる。
%s2:q-Riccatiとq-Weyl代数の対応メモ}
\subsection{シャッフル積の結合性}\label{s2:シャッフル積の結合性} %{
	$R$を標数$0$の整域、$A$を有限集合とし、$V_q:=R(q)\braket{A}$を
	$A$から生成される$R(q)$上の自由代数とする。
	$V_q$の線形二項演算$m_q:V_q\otimes V_q\to V_q$を次のように再帰的に
	定義する。
	\begin{equation}\label{q-シャッフル積の定義}\begin{split}
		m_q\ket{1}\otimes\ket{w} = \ket{w} = m_q\ket{w}\otimes\ket{1}
			&\quad\text{for all } w\in A^* \\
		m_q\gplr{a^\flat\otimes b} = a^\flat m_q\gplr{\id\otimes b^\flat} 
			+ b^\flat m_q\gplr{q^{\Nhat}a\otimes\id}
			&\quad\text{for all } a,b\in A
	\end{split}\end{equation}
	$m_q$は文字数を保存するから、次の式が成り立つ。
	\begin{equation}\label{eq:q-シャッフル積の文字数保存}\begin{split}
		\Nhat m_q = m_q\gplr{\Nhat\otimes\id + \id\otimes\Nhat}
	\end{split}\end{equation}
	\begin{todo}[証明]\label{todo:証明} %{
		式\eqref{eq:q-シャッフル積の文字数保存}を証明せよ。また、
		$\nu_n:=\sum_{w\in A^n}w^\flat w$と定義したとき、
		$\nu_n$と$m_q$の交換関係を求めよ。
		さらに、$\Phat_n:=\sum_{w\in A^n}\ket{w}\bra{w}$、
		$\Phat_+:=\sum_{n\in\sizen_+}\Phat_n$と定義したとき、
		$\Phat_+=\nu_1$となることを証明せよ。
	\end{todo} %todo:証明}
	また、次の式が成り立つから、
	\begin{alignat*}{2}
		am_q\ket{1}\otimes\ket{w} &= m_q\gplr{a\otimes\id + q^{\Nhat}\otimes a}
			\ket{1}\otimes\ket{w} &\quad&\text{for all } w\in A^* \\
		am_q\ket{w}\otimes\ket{1} &= m_q\gplr{a\otimes\id + q^{\Nhat}\otimes a}
			\ket{w}\otimes\ket{1} &\quad&\text{for all } w\in A^* \\
		am_q\gplr{b\otimes c} &= m_q\gplr{a\otimes\id + q^{\Nhat}\otimes a}
			\gplr{b\otimes c} &\quad&\text{for all } a,b,c\in A
	\end{alignat*}
	次の交換関係が得られる。
	\begin{equation}\label{q-シャッフル積と消滅演算子の交換関係}\begin{split}
		am_q = m_q\gplr{a\otimes\id + q^{\Nhat}\otimes a}
		\quad\text{for all } a\in A
	\end{split}\end{equation}
	式\eqref{eq:q-シャッフル積の文字数保存}から次の式が成り立つから、
	\begin{equation*}\begin{split}
		q^{\Nhat}m_q = m_q\gplr{q^{\Nhat}\otimes q^{\Nhat}}
	\end{split}\end{equation*}
	この式と交換関係\eqref{q-シャッフル積と消滅演算子の交換関係}を使うと、
	次の式が成り立つことがわかる。
	\begin{equation*}\begin{split}
		am_q\gplr{m_q\otimes\id} &= m_q\gplr{m_q\otimes\id}\gplr{L_q^3a} \\
		am_q\gplr{\id\otimes m_q} &= m_q\gplr{\id\otimes m_q}\gplr{L_q^3a} \\
	\end{split}
		\quad\text{for all } a\in A
	\end{equation*}
	ここで、線形射
	$L_q^{n+1}:\cat{Mod}\gplr{V_q}\to\cat{Mod}\gplr{V_q^{\otimes(n+1)}}$
	を次のように定義する。
	\begin{equation*}\begin{split}
		L_q^{n+1}\phi &:= \sum_{k=0}^n \gplr{q^{\Nhat}}^{\otimes k}
			\otimes\phi\otimes\gplr{\id}^{\otimes(n-k)}
		\quad\text{for all } n\in\sizen,\; \phi\in\cat{Mod}\plr{V_q}
	\end{split}\end{equation*}
	この式を使って、$m_q$が結合的であることを、帰納法によって証明することが
	できる。
	
	射影$\Phat_0:V_q\to R_q$と$\Phat_+:V_q\to R_q\ket{A^+}$を次のように
	定義する。
	\begin{equation*}\begin{split}
		\Phat_0 := \ket{1}\bra{1},\quad \Phat_+ := \sum_{a\in A}a^\flat a
	\end{split}\end{equation*}
	$m_q$は文字数を保存するから、任意の
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $1\le n_1 + n_2 + n_3$となる$n_1,n_2,n_3\in\sizen$、
		\item $u\in R\ket{A^{n_1}}\otimes R\ket{A^{n_2}}\otimes R\ket{A^{n_3}}$
	\end{itemize} %}
	に対して次の式が成り立つ。
	\begin{equation*}\begin{array}{rclcl}
		m_q\gplr{m_q\otimes\id} u &=& P_+m_q\gplr{m_q\otimes\id} u
		&=& \sum_{a\in A}a^\flat m_q\gplr{m_q\otimes\id}\gplr{L_q^3a} u \\
		m_q\gplr{\id\otimes m_q} u &=& P_+m_q\gplr{\id\otimes m_q} u
		&=& \sum_{a\in A}a^\flat m_q\gplr{\id\otimes m_q}\gplr{L_q^3a} u
	\end{array}\end{equation*}
	$\gplr{L_q^3a} u$の文字数は$n_1+n_2+n_3-1$だから、$n_1+n_2+n_3-1$で$m_q$
	が結合的ならば、
	\begin{equation*}\begin{split}
		m_q\gplr{m_q\otimes\id} u 
		&= \sum_{a\in A}a^\flat m_q\gplr{m_q\otimes\id}\gplr{L_q^3a} u \\
		&= \sum_{a\in A}a^\flat m_q\gplr{\id\otimes m_q}\gplr{L_q^3a} u
		= m_q\gplr{\id\otimes m_q} u \\
	\end{split}\end{equation*}
	となり、$n_1+n_2+n_3$でも$m_q$が結合的になる。そして、直接の計算により、
	次の式が成り立つことがわかるので、
	\begin{equation*}\begin{split}
		m_q\gplr{m_q\otimes\id}\ket{1}\otimes\ket{1}\otimes\ket{1}
		= m_q\gplr{\id\otimes m_q}\ket{1}\otimes\ket{1}\otimes\ket{1}
	\end{split}\end{equation*}
	帰納法により、$m_q$が$V_q\otimes V_q\otimes V_q$で結合的になることが
	示される。
%s2:シャッフル積の結合性}
\subsection{TODO}\label{s2:TODO} %{
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item テンソル積の内積を変更したので、以下は書き直すこと。
		\item 妄想
		\begin{equation*}\begin{split}
			m_q \overset{?}{=} m_0\gplr{m_q\otimes m_q}\sigma_{23}
			\gplr{m_0^\flat\otimes m_0^\flat}
		\end{split}\end{equation*}
		この式の右辺は次のようになる。
		\begin{equation*}\begin{split}
			a m_0\gplr{m_q\otimes m_q}\sigma_{23}
				\gplr{m_0^\flat\otimes m_0^\flat}
			= m_0\gplr{m_q\otimes m_q}a_{(4)}\sigma_{23}
				\gplr{m_0^\flat\otimes m_0^\flat} \\
			a_{(4)} := a\otimes\id\otimes\id\otimes
				+ q^{\Nhat}\otimes a\otimes\id\otimes\id \\
				+ \Phat_0\otimes\Phat_0\otimes a\otimes\id
				+ \Phat_0\otimes\Phat_0\otimes q^{\Nhat}\otimes a
		\end{split}\end{equation*}
	\end{itemize} %}
%s2:TODO}

\subsection{Brzozowwki代数の定義}\label{s2:Brzozowwki代数の定義} %{
	$R$を可換環、$A$を空でない有限集合とする。
	$A$から生成される$R$上のBrzozowski代数\footnote{
		q-Heisenberg代数の$q=0$としたものをBrzozowski代数と書いている。
	}を$R\Eta(A)$と書く。
	\begin{equation*}\begin{split}
		R\Eta(A) := \frac{R\braket{A,A^\flat}}
			{ab^\flat = \jump{a=b} \text{ for all }a,b\in A} 
	\end{split}\end{equation*}
	$R\Eta(A)$の基底を次のように書くことにする。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $A$の元を消滅演算子
		\item $A^\flat$の元を生成演算子
	\end{itemize} %}
	また、文字集合を明記する必要がない場合は、文字集合の大きさだけを明記
	して$R\Eta_n$と書き、文字集合について次の便宜を用いることにする。
	\begin{equation*}\begin{split}
		R\Eta_n := R\Eta(H_n) \quad\text{where } H_n := \set{\eta_1,\dots,e_n}
	\end{split}\end{equation*}
	\underline{逆順の}代数射$-^\flat:R\Eta(A)\to R\Eta(A)$を次のように定義する。
	\begin{equation*}\begin{split}
		(a)^\flat = a^\flat,\quad (a^\flat)^\flat = a
		\quad\text{for all } a\in A
	\end{split}\end{equation*}
	そして、$R\Eta_n$の場合は特別に次の約束を使う。
	\begin{equation*}\begin{split}
		\eta_i^\flat = \eta_{-i} \quad\text{for all } i\in1..n
	\end{split}\end{equation*}

\subsubsection{数演算子}\label{s3:数演算子} %{
	$\mu_n\in R\Eta(A)$を次のように定義する。
	\begin{equation*}\begin{split}
		\mu_n := \sum_{a\in A} (a^\flat)^na^n \quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	集合$M\subset R\Eta(A)$を$M:=\set{\mu_n\bou n\in\sizen}$と定義すると、
	次の式から、
	\begin{equation*}\begin{split}
		\mu_m\mu_n = \mu_{\max(m,n)} \quad\text{for all } m,n\in\sizen
	\end{split}\end{equation*}
	$M$はモノイドとなり、モノイド同型$M\simeq(\sizen,\max,0)$が成り立つ。
	また、$M$の元はすべてべき等$\mu_n^2=\mu_n$になる。
	特に、$\what{N}_0:=\mu_1$と定義し、$\what{N}_0$を数演算子ということに
	する。
%s3:数演算子}
\subsubsection{Fock空間}\label{s3:Fock空間} %{
	係数環$R$が複素数の場合は、$\what{N}_0$はべき等なので、固有値は$0$と$1$
	だけになることが言える。$\what{N}_0$の固有値を拠り所にして表現を考える
	ために、係数環を複素数に限定する。

	$\fukuso\Eta(A)$の表現空間は、$\what{N}_0$の固有値によって次の三種類
	に分類される。
	\begin{enumerate}\setlength{\itemsep}{-1mm} %{
		\item $\what{N}_0$の固有値を$0$だけ持つ。
		\item $\what{N}_0$の固有値を$1$だけ持つ。
		\item $\what{N}_0$の固有値を$0$と$1$の両方持つ。
	\end{enumerate} %}
	ここでは、三番目の$\what{N}_0$の固有値を$0$と$1$の両方持つ表現空間を
	考える。

	$V$を$\fukuso\Eta(A)$の表現空間とし、$V_\lambda$を$\what{N}_0$の固有値
	$\lambda$を持つ$V$の部分空間とすると、$V=V_0\oplus V_1$と直和分解される。
	そして、$V_0$と$V_1$は空でないとする。任意の$a\in A$に対して次の性質が
	成り立つ。
	\begin{enumerate}\setlength{\itemsep}{-1mm} %{
		\item $\ker a^\flat=\set{0}$となる。\\
		ある$v\in V$に対して$a^\flat v=0$ならば、左から$a$を作用させると、
		$v=0$となる。
		%
		\item $\ker a=V_0$となる。\\
		任意の$v\in V_0$に対して$\what{N}_0v=0$となるが、左から$a$を作用させる
		と、$av=0$となる。したがって、$V_0\subseteq \ker a$となる。
		一方、$\what{N}_0$の定義より、$\ker a\subseteq V_0$となるから、
		$\ker a=V_0$となることがわかる。
		%
		\item $a^\flat V\subseteq V_1$となる。\\
		任意の$v\in V$に対して$\what{N}_0a^\flat v=a^\flat v$となる。
		%
		\item 任意の$v\neq0\in V_0$と$n\in\sizen$に対して
		$\Set{(a^\flat)^nv\bou n\in\sizen}$は線形独立となる
		（ノート\ref{note:自然数による基底系}）。
	\end{enumerate} %}
	そして、次の性質が成り立つ。
	\begin{enumerate}\setlength{\itemsep}{-1mm} %{
		\item 任意の$v\neq0\in V_0$に対して集合$(A^\flat)^*v\subset V$を
		$(A^\flat)^*v:=\Set{w^\flat v\bou w\in A^*}$と定義すると、
		$(A^\flat)^*v$の元は互いに線形独立となる
		（ノート\ref{note:単語による基底系}）。
		したがって、任意の$v\neq0\in V_0$に対してモノイド環$\fukuso\braket{A}$
		との線形同型$\fukuso(A^\flat)^*v\simeq\fukuso\braket{A}$が成り立つ。
		%
		\item $u,v\in V_0$が互いに線形独立であれば、直和分解
		$\fukuso(A^\flat)^*u\cup\fukuso(A^\flat)^*v
		=\fukuso(A^\flat)^*u\oplus\fukuso(A^\flat)^*v$が成り立つ
		（ノート\ref{note:真空の独立性}）。
	\end{enumerate} %}
	したがって、次の部分空間の関係が成り立つ。
	\begin{equation*}\begin{split}
		\plr{\fukuso\braket{A}}^{\oplus\plr{\dim\ker\what{N}_0}} \subseteq V
		\quad\text{as vector space}
	\end{split}\end{equation*}
	また、$\what{N}_0$の固有値が$0$と$1$の両方を持つような$\fukuso\Eta(A)$
	の$\fukuso\braket{A}$への表現は既約表現となる
	（ノート\ref{note:Fock表現の既約性}）。
	以上を定義と命題の形でまとめておく。

	\begin{definition}[Fock空間]\label{def:Fock空間} %{
		$R$を可換環、$A$を空でない有限集合、$R\Eta(A)$を$R$上のBrzozowski代数、
		$R\braket{A}$を$A$から生成される$R$上の自由代数とする。
		$R\Eta(A)$の$R\braket{A}$への次の表現をFock表現といい、
		$R\braket{A}$を$R\Eta(A)$のFock空間ということにする。
		\begin{alignat*}{2}
			a\ket{1} &= 0 &\quad&\text{for all } a\in A \\
			a\ket{bw} &= \jump{a=b}\ket{w} 
				&\quad&\text{for all } a,b\in A,\; w\in A^* \\
			a^\flat\ket{w} &= \ket{aw} 
				&\quad&\text{for all } a\in A,\; w\in A^*
		\end{alignat*}
		ここで、$\fukuso\Eta(A)$の基底系と$\fukuso\braket{A}$の基底系を区別
		するために、$\fukuso\braket{A}$の基底系をブラケット記法を使って書いた。
	\end{definition} %def:Fock空間}

	\begin{proposition}[Fock表現の既約性]\label{prop:Fock表現の既約性} %{
		複素数上のBrzozowski代数のFock表現は既約表現である。
	\end{proposition} %prop:Fock表現の既約性}

	\begin{proposition}[数演算子による表現の分類]\label{prop:数演算子による表現の分類} %{
		$A$を空でない有限集合、$\fukuso\Eta(A)$を複素数上のBrzozowski代数
		とする。$\fukuso\Eta(A)$の表現$(\rho,V)$が、$\what{N}_0$の固有値
		$0$と$1$の両方を持てば、次の部分空間の関係が成り立つ。
		\begin{equation*}\begin{split}
			\plr{\fukuso\braket{A}}^{\oplus\plr{\dim\ker\what{N}_0}} \subseteq V
			\quad\text{as vector space}
		\end{split}\end{equation*}
	\end{proposition} %prop:数演算子による表現の分類}

	\begin{note}[自然数による基底系]\label{note:自然数による基底系} %{
		任意の$v\neq0\in V_0$と$n\in\sizen$に対して
		$\Set{(a^\flat)^iv\bou i\in0..n}$は線形独立となる。
		\begin{proof} %{
			$n$に関する帰納法を使う。$n=0$の時は明らかで、ある$n\in\sizen$で
			命題が成り立つとすると、任意の$c_1,\dots,c_{n+1}\in\fukuso$に対して
			次の式が成り立つ。
			\begin{alignat*}{2}
				& c_1(a^\flat)v +\cdots+ c_{n+1}(a^\flat)^{n+1}v = 0 \\
				\iff & a^\flat\plr{c_1v +\cdots+ c_{n+1}(a^\flat)^nv} = 0 \\
				\implies & c_1v +\cdots+ c_{n+1}(a^\flat)^nv = 0 
					&\quad& \because\quad \ker a^\flat = \set{0} \\
				\implies & c_1v = 0 \text{ and } 
					c_2v +\cdots+ c_{n+1}(a^\flat)^nv = 0
					&\quad& \because\quad V_0\cup V_1 = \set{0} \\
				\implies & c_1 = c_2 =\cdots= c_{n+1} = 0
					&\quad& \text{by assumptions}
			\end{alignat*}
		\end{proof} %}
	\end{note} %note:自然数による基底系}

	\begin{note}[単語による基底系]\label{note:単語による基底系} %{
		任意の$v\neq0\in V_0$、$n\in\sizen$に対して集合
		$(A^\flat)^n v\subseteq V$を次のように定義し、
		\begin{equation*}\begin{split}
			(A^\flat)^n v := \Set{w^\flat v\bou w\in A^n}
		\end{split}\end{equation*}
		$(A^\flat)^{\le n} v:=\cup_{r=0}^n(A^\flat)^r v$とする。
		任意の$n\in\sizen$に対して$(A^\flat)^{\le n} v$の元は互いに線形独立
		になる。
		\begin{proof} %{
			$(A^\flat)^{\le n} v$の$n$についての帰納法で証明する。
			$n=0$のときは$(A^\flat)^{\le 0} v=\fukuso v$だから、命題が成り立つ
			ことがわかる。ある$n\in\sizen$で命題が成り立つと仮定する。
			写像$c:A^{n+1}\to\fukuso$が次の式を満たすとすると、
			\begin{equation*}\begin{split}
				\sum_{w\in A^{n+1}} \plr{c|w}w^\flat v = 0
			\end{split}\end{equation*}
			任意の$a\in A$で次の式が成り立つ。
			\begin{alignat*}{2}
				a\sum_{w\in A^n} \plr{c|w} w^\flat v = 0
				\implies & \sum_{w\in A^n} \plr{c|wa} w^\flat v = 0 \\
				\implies & \plr{c|wa} = 0 \quad\text{for all } w\in A^n
					&\quad& \text{by assumption}
			\end{alignat*}
			任意の$k\in\sizen$で$A^{k+1}=\cup_{a\in A}A^ka$が成り立つから、
			$c=0$となることがわかる。したがって、$n+1$でも命題が成り立つことが
			わかる。
		\end{proof} %}
	\end{note} %note:単語による基底系}

	\begin{note}[真空の独立性]\label{note:真空の独立性} %{
		ある$u,v\in V_0$、$w\in A^*$と写像$c:A^*\to\fukuso$が次の式を
		満たすとすると、
		\begin{equation*}\begin{split}
			w^\flat v = \sum_{x\in A^*} (c|x)x^\flat u
		\end{split}\end{equation*}
		次の式から、
		\begin{equation*}\begin{split}
			w^\flat v = \sum_{x\in A^*} (c|x)x^\flat u
			\implies v = \sum_{x\in A^*} (c|xw)x^\flat u \\
			\implies (c|w) u = v \quad\text{and}\quad
			(c|xw) = 0 \quad\text{for all } w\in A^+
		\end{split}\end{equation*}
		$u$と$v$は互いに線形従属となる。したがって、$u,v\in V_0$が互いに
		線形独立であれば、$(A^\flat)^*u$と$(A^\flat)^*v$は互いに線形独立
		となり、$(A^\flat)^*u\cup(A^\flat)^*v=(A^\flat)^*u\oplus(A^\flat)^*v$
		となる。
	\end{note} %note:真空の独立性}

	\begin{note}[Fock表現の既約性]\label{note:Fock表現の既約性} %{
		部分空間$V\subseteq\fukuso\braket{A}$を$\fukuso\Eta(A)$-不変な部分空間
		とする。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $V$が$\what{N}_0$の固有値$0$を持てば、$V=\set{0}$または
			$\fukuso\ket{1}\subseteq V$となる。$\fukuso\ket{1}$を含む
			$\fukuso\Eta(A)$-不変な部分空間は$\fukuso\braket{A}$だけだから、$V$は
			$\set{0}$または$\fukuso\braket{A}$自身となる。
			%
			\item $V$が$\what{N}_0$の固有値$1$のみを持てば、$V\subseteq\fukuso A^+$
			となる。ここで、
			$\fukuso A^+:=\myop{span}_\fukuso\Set{\ket{w}\bou w\in A^+}$とする。
			しかし、任意の$w\in A^+$に対して$w\ket{w}=\ket{1}$となるから、
			$\fukuso A^+$は$\fukuso\Eta(A)$-不変な部分空間ではなく、
			その部分空間もまた$\fukuso\Eta(A)$-不変な部分空間でない。したがって、
			$\what{N}_0$の固有値$1$だけを持つ$\fukuso\Eta(A)$-不変な
			$\fukuso\braket{A}$の部分空間は存在しない。
		\end{itemize} %}
		したがって、Fock表現は既約表現となる。
	\end{note} %note:Fock表現の既約性}

	\begin{note}[係数に対する制限]\label{note:係数に対する制限} %{
		係数に対する制限を弱めるためには、可換環$R$と$R$上の加群$V$が
		次の条件をクリアする必要がある。
		\begin{enumerate}\setlength{\itemsep}{-1mm} %{
			\item $V$でべき等作用素$T^2=T$の固有値が$0$と$1$だけになること。
			\item $V$が固有ベクトル空間で直和分解できること。
			\item 任意の$r\neq0\in R$と$v\neq0\in V$に対して$rv\neq0$
			となること。
		\end{enumerate} %}
		これらの条件は、$R$が整域で$V$が自由加群$R^D$であればクリアできると
		思う。
	\end{note} %note:係数に対する制限}

	\begin{todo}[この後の展開]\label{todo:この後の展開} %{
		この後の予定
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item Fock空間の内積を定義して、自由モノイドの積とその共役の作用版が
			Brzozowski代数となることを示す。
			\item 係数環を整域上の多項式環の有理式体とし、自由モノイドの積を
			変形してq-シャッフル積を定義し、その作用素版を導く。
			\item 一変数の場合にコヒーレント状態を使ってq-Brzozowski代数の
			解析的な表現を導く。Kleeneスターに対して成り立つ式$x^*=1+xx^*$を
			q-Kleeneスターに対して拡張する。多分、q-積分を使うことになる。
			\item 多変数の場合に拡張する。
			\item Dyck単語の分割を解析の言葉で理解する。
		\end{itemize} %}
	\end{todo} %todo:この後の展開}
%s3:Fock空間}
%s2:Brzozowwki代数の定義}
\subsection{自由代数}\label{s2:自由代数} %{
	$R$を可換環、$A$を空でない有限集合とする。

	$A^*$を$A$から生成される自由モノイドとして、次の記法を用いる。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[積] 文字列の連結による積を記号を省略して書く。
		\begin{equation*}\begin{split}
			w_1w_2 := \text{単語$w_1$と$w_2$を連結した単語}
			\quad\text{for all } w_1,w_2\in A^*
		\end{split}\end{equation*}
		\item[単位元] 空の単語を$1$と書く。
	\end{description} %}
	$R\ket{A^*}:=R\braket{A}$を$R$から生成される$R$上の自由代数として、
	次の記法を用いる。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[標準基底] $A^*$から$R\ket{A^*}$への標準入射をケットで表す。
		\begin{equation*}\begin{split}
			\ket{w}\in R\ket{A^*} \quad\text{for all } w\in A^*
		\end{split}\end{equation*}
		\item[積] 文字列の連結による積を
		$m_0:R\ket{A^*}\otimes R\ket{A^*}\to R\ket{A^*}$と書く。
		\begin{equation*}\begin{split}
			m_0\ket{w_1}\otimes\ket{w_2} := \ket{w_1w_2}
			\quad\text{for all } w_1,w_2\in A^*
		\end{split}\end{equation*}
	\end{description} %}

	$R\bra{A^*}:=\cat{Mod}_R\plr{R\ket{A^*},R}$を$R\ket{A^*}$の双対空間
	として、次の記法を用いる。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[標準基底] $A^*$から$R\bra{A^*}$への標準入射をブラで表す。
		\begin{equation*}\begin{split}
			\bra{w}\in R\bra{A^*} \text{ such that }
			\braket{w|x} = \jump{w=x} \quad\text{for all } w,x\in A^*
		\end{split}\end{equation*}
		\item[転置と内積] 線形射$-^\flat:R\ket{A^*}\xtofrom{}{}R\bra{A^*}$を
		次のように定義する。
		\begin{equation*}\begin{split}
			\ket{w}^\flat := \bra{w},\quad \bra{w}^\flat := \ket{w}
			\quad\text{for all } w\in A^*
		\end{split}\end{equation*}
		有限次元実ベクトル空間の言葉をそのまま借用して、
		$-^\flat$を転置、$R\bra{A^*}$の$R\ket{A^*}$への作用を内積ということに
		する。
		\item[作用素] 線形射
		$\cat{Mod}_R\plr{R\ket{A^*}}\to\cat{Mod}_R\plr{R\bra{A^*}}$
		を次のように定義する。
		\begin{equation*}\begin{split}
			(f^\flat\phi)g = f^\flat(\phi g)
			\quad\text{for all } \phi\in\cat{Mod}_R\plr{R\ket{A^*}}
			,\; f,g\in R\ket{A^*}
		\end{split}\end{equation*}
		\item[作用素の転置] 線形射
		$-^\flat:\cat{Mod}_R\plr{R\ket{A^*}}\to\cat{Mod}_R\plr{R\ket{A^*}}$
		を次のように定義する。
		\begin{equation*}\begin{split}
			(\phi f)^\flat g = f^\flat\phi^\flat g
			\quad\text{for all } \phi\in\cat{Mod}_R\plr{R\ket{A^*}}
			,\; f,g\in R\ket{A^*}
		\end{split}\end{equation*}
	\end{description} %}

	任意の$R$上の加群$V$に対して$T^n V$を次のように定義し、
	\begin{equation*}\begin{split}
		\T^0 V := R ,\quad \T^n V := V^{\otimes n} 
		\quad\text{for all } n\in\sizen_++
	\end{split}\end{equation*}
	$\T^*V:=\oplus_{n\in\sizen}\T^nV$を$V$から生成されるテンソル代数とする。
	$\T R\ket{A^*}$の内積について次の記号を用いることにする。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[内積] 線形射
		$\T^*R\bra{A^*}\otimes\T^*R\ket{A^*}\to R$を次のように定義する。
		\begin{equation*}\begin{split}
			\gplr{f_1^\flat\otimes\cdots\otimes f_m^\flat}
			\gplr{g_1\otimes\cdots\otimes g_n}
			:= \jump{m=n}\gplr{f_n^\flat g_1}\cdots\gplr{f_1^\flat g_n} \\
			\quad\text{for all } f_i,g_i\in R\ket{A^*}
		\end{split}\end{equation*}
		環同型$R\otimes R\simeq_R R$を用いると、次のように書くこともできる。
		\begin{equation*}\begin{split}
			\gplr{f_1^\flat\otimes\cdots\otimes f_m^\flat}
			\gplr{g_1\otimes\cdots\otimes g_n} = \jump{m=n}
			\gplr{f_n^\flat g_1}\otimes\cdots\otimes\gplr{f_1^\flat g_n} \\
			\quad\text{for all } f_i,g_i\in R\ket{A^*}
		\end{split}\end{equation*}
		\item[転置] 逆順の代数射
		$-^\flat:\T^*R\ket{A^*}\xtofrom{}{}\T^*R\bra{A^*}$
		を次のように定義する。
		\begin{equation*}\begin{split}
			\gplr{f_1\otimes\cdots\otimes f_n}^\flat 
				:= f_n^\flat\otimes f_1^\flat
			,\quad \gplr{f_1^\flat\otimes\cdots\otimes f_n^\flat}^\flat 
				:= f_n\otimes f_1 \\
			\quad\text{for all } f_1,\dots,f_n\in A^*
		\end{split}\end{equation*}
	\end{description} %}

	$\T^nR\ket{A^*}$から$\T^mR\ket{A^*}$への線形射全体のつくる空間を
	$\T^m_nR\ket{A^*}$とする。
	\begin{equation*}\begin{split}
		\T^m_nR\ket{A^*}:=\cat{Mod}_R\plr{\T^nR\ket{A^*},\T^mR\ket{A^*}}
		\quad\text{for all } m,n\in\sizen
	\end{split}\end{equation*}
	形式的には$\T_n^nR\ket{A^*}$の単位元$I_n$は次のように書ける。
	\begin{equation*}\begin{split}
		I_n := \sum_{w_1,\dots,w_n} \ket{w_1}\otimes\cdots\otimes\ket{w_n}
			\bra{w_n}\otimes\cdots\otimes\bra{w_1}
	\end{split}\end{equation*}
	$I_2$を用いて積$m_0$の$R\bra{A^*}$への作用を計算すると次のようになる。
	\begin{equation*}\begin{split}
		\bra{w}m_0 = \sum_{w_1,w_2\in A^*} \jump{w = w_1w_2}
			\bra{w_2}\otimes\bra{w_1} \quad\text{for all } w\in A^*
	\end{split}\end{equation*}
%s2:自由代数}
\subsection{非可換な係数}\label{s2:非可換な係数} %{
	可換上のBrzozowski代数を非可換上のBrzozowskiに拡張する。
	$V$を可換とは限らない環、$\Z V$を$V$の中心とする。
	$V\Eta(A):=V\otimes_{\Z V}(\Z V)\Eta(A)$と書き、$\otimes_{\Z V}$を省略して
	次のように書く。
	\begin{equation*}\begin{split}
		vx := v\otimes_{\Z V}x =: xv \\
		vx^\flat := v\otimes_{\Z V}x^\flat =: x^\flat v 
	\end{split}
		\quad\text{for all } v\in V,\; x\in(\Z V)\Eta(A)
	\end{equation*}
	また、テンソル積$V\Eta(A)\otimes_{\Z V}(\Z V)\Eta(A)$を多用するが、
	$V\Eta(A)\otimes\Eta(A):=V\Eta(A)\otimes_{\Z V}(\Z V)\Eta(A)$と略記する。
%23:非可換な係数}
%s1:Brzozowski代数}

\section{微分方程式とBrzozowski代数}\label{s1:微分方程式とBrzozowski代数} %{
	この節では複素係数で考える。
	根付き平面二分木の成長は次の微分方程式で書き表される。
	\begin{equation}\label{eq:平面二分木の成長}\begin{split}
		\plr{\partial_t}_q\plr{\phi|t} = \plr{\phi|t}^2
	\end{split}\end{equation}
	これをBrzozowski代数に翻訳しよう。次のように定義したコヒーレント状態
	を使うと、
		\begin{equation*}\begin{split}
		\ket{t:q} := \gplr{t\eta_q^\flat}_q^*\ket{1},\quad
		\bra{t:q} := \bra{1}\gplr{t\eta_q}_q^*
	\end{split}\end{equation*}
	微分方程式\eqref{eq:平面二分木の成長}は次のように書ける。
	\begin{equation}\label{eq:平面二分木の成長その二}\begin{split}
		\braket{t:q|\eta_q|\phi} = \braket{t:q|\phi}^2
	\end{split}\end{equation}
	この式を満たす$\ket{\phi}$を求めることになる。
	コヒーレント状態の微分は次のようになり
	（ノート\ref{note:q-Kleeneスターの余積}）、
	\begin{equation*}\begin{split}
		\bra{t:q}\eta_q &= \bra{1}\eta_q\plr{t\eta_q}_q^*
		= \bra{1}\eta_0\plr{t\eta_q}_q^* = \bra{\eta}\plr{t\eta_q}_q^*
		= \bra{1}\otimes\bra{\eta}m_0^\flat\plr{t\eta_q}_q^* \\
		&= \plr{\bra{t:q}\otimes\bra{\eta}\plr{t\delta_q}_q^*}m_0^\flat
	\end{split}\end{equation*}
	求める$\ket{\phi}$は次の式を満たすことがわかる。
	\begin{equation*}\begin{split}
		\bra{t:q}\eta_q\ket{\phi} = \plr{\bra{t:q}\otimes\bra{\eta}
			\plr{t\delta_q}_q^*}m_0^\flat\ket{\phi}
		= \braket{t:q|\phi}^2
	\end{split}\end{equation*}

	$q=1$の時は、次の解ける微分方程式から解を求めることができる。
	\begin{equation}\label{eq:解ける差分方程式}\begin{split}
		\bra{t:q}\eta_q\ket{\phi} = \braket{qt:q|\phi}\braket{t:q|\phi}
	\end{split}\end{equation}
	この場合、$\ket{\phi}=\ket{1:0}$となる。このことをBrzozowski代数を
	用いて確かめてみる。$u\in\fukuso$として、
	$m_0^\flat\ket{u:0} = \ket{u:0}\otimes\ket{u:0}$から、次の式が得られて
	（ノート\ref{note:delta_qの交換関係}）、確かにコヒーレント状態$\ket{1:0}$
	が差分方程式\eqref{eq:解ける差分方程式}の解になっていることがわかる。
	\begin{equation*}\begin{split}
		\bra{t:q}\eta_q\ket{1:0} 
		&= \braket{t:q|1:0}\braket{\eta|\plr{t\delta_q}_q^*|1:0} \\
		&= \braket{t:q|1:0}\braket{qt:q|1:0} \\
	\end{split}\end{equation*}
	一方、$q=0$の時は、次の状態が差分方程式\eqref{eq:平面二分木の成長その二}
	の解になる。
	\begin{equation*}\begin{split}
		\plr{\eta_0^\flat\gplr{t\eta_0}_0^*}_0^*\ket{1}
	\end{split}\end{equation*}

	\begin{note}[模索その一]\label{note:模索その一} %{
		$t_q=(1-q)t$とすると、次のようにして$q=0$と$q=1$の解を補間する状態を
		定義することができる。
		\begin{equation*}\begin{split}
			\plr{\eta_0^\flat\gplr{t\eta_0}_0^*}_0^*\ket{1} \xmapsfrom{q=0} 
			\plr{\eta_0^\flat\gplr{t_q\eta_q}_q^*}_0^*\ket{1}
			\xmapsto{q=1} \gplr{\eta_0^\flat}_0^*\ket{1}
		\end{split}\end{equation*}
	\end{note} %note:模索その一}
	
	\begin{note}[模索その二]\label{note:模索その二} %{
		$s\in\fukuso$として、$\psi_{q,s}$を次のように定義して、
		\begin{equation}\label{eq:psiの定義}\begin{split}
			\psi_{q,s} := \eta_0^\flat\plr{s\eta_q}_q^*
		\end{split}\end{equation}
		次の式を使って、
		\begin{equation*}\begin{split}
			\psi_{q,s} \ket{\eta^n} 
			= \eta_0^\flat\sum_{k=0}^n\frac{s^k}{[k]_q!}\eta_q^k\ket{\eta^n}
			= \sum_{k=0}^n s^k\qbinom{n}{k}\ket{\eta^{n-k+1}}
			\quad\text{for all } n\in\sizen
		\end{split}\end{equation*}
		真空への作用を低次の項について計算すると次のようになる。
		\begin{equation*}\begin{split}
			\psi_{q,s} \ket{1} &= \ket{\eta} \\
			\psi_{q,s}^2\ket{1} &= \ket{\eta^2} + s \ket{\eta} \\
			\psi_{q,s}^3\ket{1} &= \ket{\eta^3} + \ggplr{[2]_q + 1}s \ket{\eta^2} 
				+ 2s^2 \ket{\eta} \\
			\psi_{q,s}^4\ket{1} 
				&= \ket{\eta^4} + \ggplr{[3]_q + [2]_q + 1}s \ket{\eta^2} \\
				&\; + \ggplr{[3]_q + [2]_q^2 + [2]_q + 2}s^2 \ket{\eta^2} 
				+ \ggplr{[2]_q + 4} s^3\ket{\eta^2} \\
		\end{split}\end{equation*}
		不思議なことに、$s=t$とすると、$t$の四次までの範囲で、
		$\plr{\psi_{q,t}}_q^*\ket{1}$は$q=0,1$で木の成長
		\eqref{eq:平面二分木の成長その二}の解に一致する。
		しかし、$0<q<1$では四次で不一致が現れる。
		\begin{equation*}\begin{split}
			\bra{t:q}\psi_{q,t}^{n+1}\ket{1} = t \sum_{k=0}^n \qbinom{n}{k}_q
			\bra{t:q}\psi_{q,t}^k\ket{1} \bra{t:q}\psi_{q,t}^{n-k}\ket{1}
		\end{split}\end{equation*}
	\end{note} %note:模索その二}

	\begin{note}[q-Kleeneスターの余積]\label{note:q-Kleeneスターの余積} %{
		$\eta_q,\;\eta_q^\flat$と$m_0$の交換関係は次のようになることから、
		\begin{equation*}\begin{split}
			\eta_qm_0 &= m_0\plr{\eta_q\otimes1 + q^{\Nhat}\otimes\eta_q} \\
			\eta_q^\flat m_0 &= m_0\plr{\eta_q^\flat\otimes1 
				+ q^{\Nhat}\otimes\delta_q^\flat} \quad\text{where}\quad 
				\delta_q := \eta_q - \eta_0
		\end{split}\end{equation*}
		$\gplr{t\eta_q}_q^*,\;\gplr{t\eta_q^\flat}_q^*$と$m_0$の交換関係は
		次のようになる。
		\begin{equation*}\begin{split}
			\gplr{t\eta_q}_q^*m_0 &= m_0 \gplr{q^{\Nhat}\otimes t\eta_q}_q^* 
				\gplr{t\eta_q\otimes1}_q^* \\
			\gplr{t\eta_q^\flat}_q^*m_0 &= m_0 \gplr{t\eta_q^\flat\otimes1}_q^*
				\gplr{q^{\Nhat}\otimes t\delta_q^\flat}_q^*
		\end{split}
			\quad\text{for all } t\in\fukuso
		\end{equation*}
		そして、直接の計算により次の式が得られ、
		\begin{equation*}\begin{split}
			\plr{\eta_q\otimes1 + q^{\Nhat}\otimes\eta_q}^2
			= \sum_{k=0}^2 \qbinom{2}{k} q^{k\Nhat}\eta_q^{n-k}\otimes\eta_q^k
		\end{split}\end{equation*}
		帰納法によって次の式が成り立つことが示される。
		\begin{equation*}\begin{split}
			\plr{\eta_q\otimes1 + q^{\Nhat}\otimes\eta_q}^n
			= \sum_{k=0}^n \qbinom{n}{k} q^{k\Nhat}\eta_q^{n-k}\otimes\eta_q^k
			\quad\text{for all } n\in\sizen
		\end{split}\end{equation*}
		したがって、次の式が成り立つことがわかる。
		\begin{equation*}\begin{split}
			\gplr{t\eta_q}_q^*m_0 = m_0\gplr{q^{\Nhat}\otimes\eta_q}_q^*
				\gplr{\eta_q\otimes1}_q^* \quad\text{for all } t\in\fukuso
		\end{split}\end{equation*}
		同様に、直接の計算により次の式が得られ、
		\begin{equation*}\begin{split}
			\plr{\eta_q^\flat\otimes1 + q^{\Nhat}\otimes\delta_q^\flat}^2
			= \sum_{k=0}^2 \qbinom{2}{k} \gplr{\eta_q^\flat}^{n-k}q^{k\Nhat}
				\otimes\gplr{\delta_q^\flat}^k
		\end{split}\end{equation*}
		帰納法によって次の式が成り立つことが示され、
		\begin{equation*}\begin{split}
			\plr{\eta_q^\flat\otimes1 + q^{\Nhat}\otimes\delta_q^\flat}^n
			= \sum_{k=0}^n \qbinom{n}{k} \gplr{\eta_q^\flat}^{n-k}q^{k\Nhat}
				\otimes\gplr{\delta_q^\flat}^k \quad\text{for all } n\in\sizen
		\end{split}\end{equation*}
		次の式が成り立つことがわかる。
		\begin{equation*}\begin{split}
			\gplr{t\eta_q^\flat}_q^*m_0 = m_0 \gplr{\eta_q^\flat\otimes1}_q^*
				\gplr{q^{\Nhat}\otimes\delta_q^\flat}_q^*
				\quad\text{for all } t\in\fukuso
		\end{split}\end{equation*}
		$\gplr{t\eta_q}_q^*$と$\gplr{t\eta_q^\flat}_q^*$の場合では、
		右辺の因子の積の順序が逆になっていることに注意する。
	\end{note} %note:q-Kleeneスターの余積}

	\begin{note}[$\delta_q$の交換関係]\label{note:delta_qの交換関係} %{
		$\delta_q$と$\eta_0^\flat$の交換関係は次のようになる。
		\begin{equation*}\begin{split}
			\delta_q\eta_0^\flat = q\eta_0^\flat\eta_q 
			&\implies \gplr{t\delta_q}_q^*\eta_0^\flat 
				= \eta_0^\flat\gplr{qt\eta_q}_q^* \\
			&\implies \gplr{t\delta_q}_q^*\gplr{u\eta_0^\flat}_0^*
				= \gplr{t\delta_q}_q^* 
				+ u\eta_0^\flat\gplr{qt\eta_q}_q^*\plr{qt\eta_q}_q^*
		\end{split}\end{equation*}
		したがって、$\gplr{t\delta_q}_q^*$のコヒーレント状態への作用を
		次のようになる。
		\begin{equation*}\begin{split}
			\gplr{t\delta_q}_q^*\ket{u:0} = \ket{1} 
			+ u\eta_0^\flat\gplr{qt\eta_q}_q^*\ket{u:0}
		\end{split}\end{equation*}
	\end{note} %note:delta_qの交換関係}

	\begin{todo}[ここまで]\label{todo:ここまで} %{
	\end{todo} %todo:ここまで}
	ここに現れた作用素$\delta_q$と$\eta_0^\flat$の交換関係は次のようになる。
	\begin{equation*}\begin{split}
		\delta_q\eta_0^\flat = q\eta_0^\flat\eta_q
		\implies \plr{t\delta_q}_q^*\eta_0^\flat = \eta_0^\flat\plr{qt\eta_q}_q^*
	\end{split}\end{equation*}
	したがって、$m_0^\flat\ket{u:0} = \ket{u:0}\otimes\ket{u:0}$より、
	\begin{equation*}\begin{split}
		\bra{t:q}\eta_q\ket{u:0}
		&= \plr{\bra{t:q}\otimes\bra{\eta}\plr{t\delta_q}_q^*}m_0^\flat
			\ket{u:0} \\
		&\simeq_\fukuso \braket{t:q|u:0}\otimes\braket{\eta|\plr{t\delta_q}_q^*|u:0}
	\end{split}\end{equation*}
	となるが、次の式から、
	\begin{equation*}\begin{split}
		\plr{t\delta_q}_q^*\ket{u:0} = \ket{1} 
			+ \plr{t\delta_q}_q^*\plr{u\eta_0^\flat}\ket{u:0}
		= \ket{1} + \plr{u\eta_0^\flat}\plr{qt\eta_q}_q^*\ket{u:0}
	\end{split}\end{equation*}
	次の式が得られる。
	\begin{equation*}\begin{split}
		\bra{t:q}\eta_q\ket{u:0} = u\braket{t:q|u:0}\braket{qt:q|u:0}
		\quad\text{for all } t,u\in\fukuso
	\end{split}\end{equation*}

	\begin{todo}[式の変形]\label{todo:式の変形} %{
		定数$u$を関数に変更することが考えられる。少なくとも、$q=0$の時は、
		\begin{equation*}\begin{split}
			\ket{x:0}:=\plr{u\eta_0^\flat\plr{t\eta_0}_0^*}_0^*\ket{1}
		\end{split}\end{equation*}
		という状態は意味がある。
		この状態を変形することを考えた場合、余積の一項目が
		$m_0^\flat\ket{x:q}=\ket{x:q}\otimes\ket{y:q}$という形になることが
		一つめのカギになる。そして、二項目が次の式を満たせば、
		\begin{equation*}\begin{split}
			\plr{t\delta_q}_q^*\ket{y:q}
			\propto \eta_q^\flat\plr{t\eta_q}_q^*\ket{x:q}
		\end{split}\end{equation*}
		欲しい微分方程式$\plr{\partial_t}_q\plr{\phi|t}=\plr{\phi|t}^2$の
		解が得られる。
	\end{todo} %todo:式の変形}
%s1:微分方程式とBrzozowski代数}
\section{指数写像}\label{s1:指数写像} %{
	与えられた$\plr{a|t}\in\fukuso_q[[t]]$に対して
	\begin{equation*}\begin{split}
		\plr{\partial_t}_q\plr{\phi|t} = \plr{a|t}\plr{\phi|t}
	\end{split}\end{equation*}
	となる$\plr{\phi|t}\in\fukuso_q[[t]]$を求めることを考える。
	$\plr{a|t}=k\in\fukuso$の場合は、$\plr{\phi|t}\propto\plr{kt}_q^*$
	となるが、$\plr{a|t}$が一般の関数の場合は、
	$\plr{\phi|t}\propto\plr{\I_qa|t}$となる。
	ここで、写像$\I_q:\fukuso_q[[t]]\to\fukuso_q[[t]]$は次のように定義する。
	\begin{equation*}\begin{split}
		\plr{\I_qf|t} := 1 + \int_0^t\plr{f|u}\plr{\I_qf|u}d_qu
		\quad\text{for all } f\in\fukuso_q[[t]]
	\end{split}\end{equation*}

	\begin{todo}[ここまで]\label{todo:ここまで} %{
	\end{todo} %todo:ここまで}

	\begin{equation*}\begin{split}
		\plr{\I_{q,0}f|t} &:= 1 \\
		\plr{\I_{q,n}f|t} &:= \int_0^t\plr{f|u_1}\int_0^{u_1}\plr{f|u_2}\cdots
			\int_0^{u_{n-1}}\plr{f|u_{n}}du_{n}\cdots du_2du_1
			\quad\text{for all } n\in\sizen_+
	\end{split}\end{equation*}
	$\I_q=\sum_{n\in\sizen}\I_{q,n}$と書くことができる。

	ここで定義した$\I_qx$は、$q=1$のときのみ、次の式が成り立つことから
	（ノート\ref{note:積分計算その一}）、
	\begin{equation}\label{eq:繰り返し積分その一}\begin{split}
		\frac{1}{n!}\plr{\int_0^t\plr{x|s}ds}^n
		= \int_0^t\plr{x|t_1}\int_0^{t_1}\plr{x|t_2}\cdots
			\int_0^{t_{n-1}}\plr{x|t_{n}}dt_{n}\cdots dt_2 dt_1
	\end{split}\end{equation}
	次のように$\exp$で書くことができる。
	\begin{equation*}\begin{split}
		\plr{\I_1x|t} = \plr{\exp\bou\int_0^t\plr{x|s}ds}
	\end{split}\end{equation*}

	\begin{note}[積分計算その一]\label{note:積分計算その一} %{
		$\plr{x|t}\in\fukuso[[t]]$とする。
		\begin{equation*}\begin{split}
			\plr{x|t} := \sum_{n\in\sizen} x_nt^n \quad\text{where } 
			x_n\in\fukuso
		\end{split}\end{equation*}
		次の二つの積分は一見異なるように見えるが、
		\begin{equation*}\begin{split}
			\plr{\int_0^t\plr{x|u}du}^2 &= \sum_{m,n\in\sizen} 
				\frac{x_mx_nt^{m+n+1}}{(m+1)(n+1)} \\
			\int_0^t\plr{x|u}\int_0^u\plr{x|v}dudv &= \sum_{m,n\in\sizen} 
				\frac{x_mx_nt^{m+n+1}}{(m+n+1)(n+1)} \\
		\end{split}\end{equation*}
		二つ目の級数の和を対称化すると、次の式が得られる。
		\begin{equation*}\begin{split}
			&\int_0^t\plr{x|u}\int_0^u\plr{x|v}dudv \\
			&= \sum_{m,n\in\sizen} \frac{x_mx_nt^{m+n+1}}{(m+n+1)(n+1)} \\
			&= \frac{1}{2}\sum_{m,n\in\sizen} x_mx_nt^{m+n+1}
				\plr{\frac{1}{(m+n+1)(n+1)} + \frac{1}{(m+n+1)(m+1)}} \\
			&= \frac{1}{2}\sum_{m,n\in\sizen} 
				\frac{x_mx_nt^{m+n+1}}{(m+1)(n+1)} \\
			&= \frac{1}{2}\plr{\int_0^t\plr{x|u}du}^2
		\end{split}\end{equation*}
		同様にして\eqref{eq:繰り返し積分その一}を導き出す。
	\end{note} %note:積分計算その一}
%s1:指数写像}
\section{有理式体}\label{s1:有理式体} %{
	$R$を標数$0$の整域、$R[t]$を$R$上の多項式環、$R[t]_\times:=R[t]-\set{0}$
	とする。$R[t]\times R[t]_\times$に積を次のように定義すると、
	\begin{equation*}\begin{split}
		\plr{x_1\times x_2}\plr{y_1\times y_2} := x_1y_1\times x_2y_2
		\quad\text{for all } x_i\in R[t],\; y_i\in R[t]_\times
	\end{split}\end{equation*}
	$1\times1$を単位元とするモノイドとなる。
	$R[t]\times R[t]_\times$に関係$\sim$を次のように定義すると、
	\begin{equation*}\begin{split}
		x_1\times x_2\sim y_1\times y_2 \xiff{\dfn} 
		\text{there exists } z\in R[t] \text{ such that } x_1y_2z = x_2y_1z \\
		\quad\text{for all } x_i\in R[t],\; y_i\in R[t]_\times
	\end{split}\end{equation*}
	$\sim$は同値関係になり、同値類
	$\Q R[t]:=\plr{R[t]\times R[t]_\times}/\sim$が定義できる。
	$\Q R[t]$の元を割り算の記号を用いて$x/y$と書く。$\Q R[t]$は零元$0/1$
	を持ち、$0/1$以外は逆元を持つモノイドとなる。
	入射$\iota:R[t]\to\Q R[t]$を次のように定義すると、
	\begin{equation*}\begin{split}
		\iota x := x / 1 \quad\text{for all } x\in R[t]
	\end{split}\end{equation*}
	$\iota$は$1:1$のモノイド射となる。$\iota$が代数射になるように、
	$\Q R[t]$に加法を定義すると、次のようになる。
	\begin{equation*}\begin{split}
		\frac{x_1}{x_2} + \frac{y_1}{y_2}
		= \frac{x_1y_2 + x_2y_1}{x_2y_2}
		\quad\text{for all } x_i\in R[t],\; y_i\in R[t]_\times
	\end{split}\end{equation*}
	$\Q R[t]$を$R[t]$の有理式体という。$\Q R[t]$は$R$の局所化$\Q R$を
	含むので、通常は体上の多項式環の有理式体を考える。
%s1:有理式体}
\section{射影変換}\label{s1:射影変換} %{
	$\fukuso_\times:=\fukuso-\set{0}$、$\fukuso P_n$を$n$次元射影空間とする。

	$\fukuso P_1$の一次変換$T_i$を次のように定義すると、
	\begin{equation*}\begin{split}
		T_i\frac{x}{y} := \frac{a_ix + b_iy}{c_ix + d_iy}
		\quad\text{for all } i\in\sizen_+,\; x\in\fukuso,\; y\in\fukuso_\times
	\end{split}\end{equation*}
	一次変換の合成$T_2T_1$は次のようになる。
	\begin{equation*}\begin{split}
		T_2T_1\frac{x}{y} &= T_2\frac{a_1x + b_1y}{c_1x + d_1y}
		= \frac{a_2\plr{a_1x + b_1y} + b_2\plr{c_1x + d_1y}}
			{c_2\plr{a_1x + b_1y} + d_2\plr{c_1x + d_1y}} \\
		&= \frac{\pvect{a_2}{b_2}\pvec{a_1}{c_1}x
			+ \pvect{a_2}{b_2}\pvec{b_1}{d_1}y}{\pvect{c_2}{d_2}\pvec{a_1}{c_1}x
			+ \pvect{c_2}{d_2}\pvec{b_1}{d_1}y}
	\end{split}\end{equation*}
	したがって、次のようにカギ括弧の行列で一次変換を表すと、
	\begin{equation*}\begin{split}
		\begin{bmatrix}
			a & b \\ c & d
		\end{bmatrix}\frac{x}{y} := \frac{ax + by}{cx + dy}
	\end{split}\end{equation*}
	一次変換の合成は通常の行列の積で書くことができる。
	\begin{equation*}\begin{split}
		\begin{bmatrix}
			a_2 & b_2 \\ c_2 & d_2
		\end{bmatrix}\begin{bmatrix}
			a_1 & b_1 \\ c_1 & d_1
		\end{bmatrix} = \begin{bmatrix}
			a_2a_1 + b_2c_1 & a_2b_1 + b_2d_1 \\ c_2a_1 + d_2c_1 
			& c_2b_1 + d_2d_1
		\end{bmatrix}
	\end{split}\end{equation*}

	写像$\iota:\fukuso\times\fukuso_\times\to\fukuso^2$と
	写像$\pi:\iota\plr{\fukuso\times\fukuso_\times}\to\fukuso P_1$を
	次のように定義すると、
	\begin{equation*}\begin{split}
		\iota(x, y) := \pvec{x}{y} ,\quad\pi\pvec{x}{y} := \frac{x}{y} 
		\quad\text{for all } x\in\fukuso,\; y\in\fukuso_\times
	\end{split}\end{equation*}
	次の可換図が成り立つ。
	\begin{equation*}\xymatrix@C=4em{
		x\times y \ar@{|->}[d]^\iota \ar@{|->}[r]^T
			& \plr{ax + by}\times\plr{cx + dy} \ar@{|->}[d]^\iota \\
		\,\pvec{x}{y} \ar@{|->}[d]^\pi \ar@{|->}[r]^{\begin{pmatrix}
			a & b \\ c & d
		\end{pmatrix}} & \,\pvec{ax + by}{cx + dy} \ar@{|->}[d]^\pi \\
		\cfrac{x}{y} \ar@{|->}[r]^{\begin{bmatrix}
			a & b \\ c & d
		\end{bmatrix}}& \cfrac{ax + by}{cx + dy} \\
	}\end{equation*}
%s1:射影変換}
\section{代数式と差分式の関係}\label{s1:代数式と差分式の関係} %{
	$R$を標数$0$の整域（ノート\ref{note:整域の標数}）、$R_q$を多項式$R[q]$に
	よる有理式体とする。

	線形射$\I_q^t:R[x]\to R[[t]]$を次のように再帰的に定義する。
	\begin{equation}\label{eq:多項式から形式級数への線形射}\begin{split}
		\I_q^t f = 1 + \int_0^t\plr{f\bou\I_q^sf}d_qs
		\quad\text{for all } f\in R[x]
	\end{split}\end{equation}
	ここでは、$\I_q^t$が定義できるかどうかは置いておき、この代数式で
	定義できるものとする\footnote{
		$R$が標数$0$の整域でない場合は、再帰式
		\eqref{eq:多項式から形式級数への線形射}の解が複数あり得る。
		また、$R$が標数$0$の整域という条件だけで、解が唯一つ定まるかどうかも
		わからない。
	}。すると、$\I_q^tf$は次の微分方程式を満たす。
	\begin{equation*}\begin{split}
		\plr{\partial_t}_q\plr{I_q^tf} = \plr{f\bou\I_q^tf},\quad \I_q^0f = 1
	\end{split}\end{equation*}

	線形射$\I_q^t$にワンクッション挟んで、
	$R[x]\to R\D(\xi)\to R[[t]]$という線形射に分解する。線形射
	$\omega:R[x]\to R\D\braket{\xi,\bar{\xi}}$を次のように再帰的に定義する。
	\begin{equation*}\begin{split}
		\omega f = 1 + \xi\plr{f\bou\omega f}\bar{\xi}
		\quad\text{for all } f\in R[x]
	\end{split}\end{equation*}
	$\omega f$の各項は$\xi$と$\bar{\xi}$のバランスがとれているので、
	$\xi$と$\bar{\xi}$で生成されるDyck言語$\D(\xi)$の和になっている。
	したがって、$\omega:R[x]\to R\D(\xi)$となる。
	線形射$\iota_q^t:R\D(\xi)\to R_q[[t]]$を次のように再帰的に定義する。
	\begin{equation*}\begin{split}
		\iota_q^t1 &:= 1 \\
		\iota_q^t\plr{\xi w_1\bar{\xi}w_2} & := \int_0^t
		\plr{\iota_q^sw_1}\plr{\iota_q^sw_2}d_qs 
		\quad\text{for all } w_1,w_2\in \D(\xi)
	\end{split}\end{equation*}
	すると、次の式が成り立ち、
	\begin{equation*}\begin{split}
		\iota_q^t\omega f = 1 + \int_0^t \plr{f\bou\iota_q^s\omega f} d_qs
		\quad\text{for all } f\in R[x]
	\end{split}\end{equation*}
	$\iota_q^t\omega=\I_q^t$となる。

	多項式$\plr{f\bou x}\in R[x]$に対して明示的に書くと次のようになっている。
	\begin{equation*}\begin{array}{rclclclclcl}
		\plr{f\bou x} &:=& && a_0 &+& a_1x &+& a_2x^2 &+& \cdots \\
		\omega f &=& 1 &+& a_0\xi\bar{\xi} &+& a_1\xi\plr{\omega f}\bar{\xi} 
			&+& a_2\xi\plr{\omega f}^2\bar{\xi} &+& \cdots \\
		\iota_q^t\omega f &= &1 &+& a_0t 
			&+& a_1\int_0^t\plr{\iota_q^s\omega f}d_qs
			&+& a_2\int_0^t\plr{\iota_q^s\omega f}^2d_qs &+& \cdots \\
	\end{array}\end{equation*}
	$\omega f$をBrzozowski代数を使って書くと次のようになる。
	\begin{equation*}\begin{split}
		\omega f = \pvec{1}{0}^\tran\braket{T^*}\pvec{0}{1}
		,\quad T = \begin{pmatrix}
			\xi h_{11} & 1 + a_0\xi\bar{\xi} \\ h_{21} & h_{22}\bar{\xi}
		\end{pmatrix} \\
	\end{split}\end{equation*}
	ここで、$h_{ij}\in R\Eta_*$は次のように定義する。
	\begin{equation*}\begin{split}
		h_{11} := \sum_{n=1}^{\deg f} a_n\eta_{n1},\quad
		h_{21} := \sum_{n=2}^{\deg f} \sum_{k=1}^{n-1} 
			\eta_{nk}^\flat\eta_{n(k+1)},\quad
		h_{22} := \sum_{n=1}^{\deg f} \eta_{nn}^\flat
	\end{split}\end{equation*}
	行列$T$のBrzozowski代数の階数は$\plr{\deg f}\plr{\deg f+1}/2$となる。

%s1:代数式と差分式の関係}
\section{Riccati方程式}\label{s1:Riccati方程式} %{
	定数を係数とするRiccati方程式を考える。

	$a,b,c\in\fukuso$として次のq-微分方程式を考える。
	\begin{equation}\label{eq:定係数Riccati}\begin{split}
		\plr{\partial_t}_q\plr{x|t} = a + b_1\plr{x|t} 
			+ b_2\plr{x|qt} + c\plr{x|t}\plr{x|qt}
	\end{split}\end{equation}
	\Midline{q-微分をバラすと次の式が得られる。}次の式は間違っている。
	\begin{equation*}\begin{split}
		\plr{x|t} = \ggplr{1 - \plr{1 - q}tT}\begin{pmatrix}
			\plr{x|qt} \\\hline 1
		\end{pmatrix} \quad\text{where } T := \begin{pmatrix}
			- b_2 & - a \\ c & b_1
		\end{pmatrix}
	\end{split}\end{equation*}
	ここで、右辺は射影変換を表す。$|q|<1$ならば、\eqref{eq:定係数Riccati}
	の解は次の積表示を持つ。
	\begin{equation*}\begin{split}
		\plr{x|t} = \prod_{n\in\sizen}\ggplr{1 - (1-q)q^ntT} \begin{pmatrix}
			\plr{x|0} \\\hline 1
		\end{pmatrix} \quad\text{when } |q| < 1
	\end{split}\end{equation*}
	この式の右辺はq-Kleeneスターの逆数（節\eqref{s2:q-Kleeneスター}）に
	なっているので、次のように書くことができる。
	\begin{equation*}\begin{split}
		\plr{x|t} = \plr{tT}_q^{-*} \begin{pmatrix}
			\plr{x|0} \\\hline 1
		\end{pmatrix}
		= \sum_{n\in\sizen} q^{\binom{n}{2}}\frac{\plr{-tT}^n}{[n]_q!}
		\begin{pmatrix}
			\plr{x|0} \\\hline 1
		\end{pmatrix} \\\quad\text{when } |q| < 1 \text{ or } q = 1
	\end{split}\end{equation*}
	この式は$q=1$でも定義できることに注意する\footnote{
		$|q|=1$では$[n]_q!$が$0$になり得るので、$|q|=1$では定義できない。
		$q=1$の時のみ$[n]_q!$が$0$にならない。
	}。

\subsubsection{双線形化による解法}\label{s3:双線形化による解法} %{
	教科書\cite{hirota:2003}にならって定係数Riccati\eqref{eq:定係数Riccati}
	を解いてみる。次の変数変換をして、
	\begin{equation*}\begin{split}
		\plr{x|t} := \frac{\plr{f|t}}{\plr{g|t}}
	\end{split}\end{equation*}
	次の微分を使うと\footnote{
		次のように微分をとることもできるが、
		\begin{equation*}\begin{split}
			\plr{\partial_t}_q\frac{\plr{f|t}}{\plr{g|t}}
			= \plr{\partial_t}_q\plr{\plr{f|t}\frac{1}{\plr{g|t}}}
			= \frac{\plr{f|D_q|t}\plr{g|qt} 
				- \plr{f|t}\plr{g|D_q|t}}{\plr{g|qt}\plr{g|t}}
		\end{split}\end{equation*}
		この場合、ゲージ対称性が明白でなくなる、もしくは、ゲージ対称性がない。
	}、
	\begin{equation*}\begin{split}
		\plr{\partial_t}_q\frac{\plr{f|t}}{\plr{g|t}}
		= \plr{\partial_t}_q\plr{\frac{1}{\plr{g|t}}\plr{f|t}}
		= \frac{\plr{f|D_q|t}\plr{g|t} 
			- \plr{t|f}\plr{g|D_q|t}}{\plr{g|qt}\plr{g|t}}
	\end{split}\end{equation*}
	次の双線形な微分方程式が得られる。
	\begin{equation}\label{eq:定係数Riccatiの双線形}\begin{split}
		&\plr{f|D_q|t}\plr{g|t} - \plr{f|t}\plr{g|D_q|t} \\
		&= a\plr{g|t}\plr{g|qt} + b_1\plr{f|t}\plr{g|qt}
			+ b_2\plr{g|t}\plr{f|qt} + c\plr{f|t}\plr{f|qt}
	\end{split}\end{equation}
	任意の正則関数$\plr{h|t}$による次のゲージ変換で、
	\begin{equation*}\begin{split}
		\plr{f|t} \mapsto \plr{h|t}\plr{f|t}
		,\quad \plr{g|t} \mapsto \plr{h|t}\plr{g|t}
		\quad\text{for all } \plr{h|t}
	\end{split}\end{equation*}
	\eqref{eq:定係数Riccatiの双線形}は不変になっている。
	\begin{equation*}\begin{split}
		\text{l.h.s.} \mapsto \plr{h|t}\plr{h|qt}\plr{\text{l.h.s.}}
		,\quad \text{r.h.s.} \mapsto \plr{h|t}\plr{h|qt} \plr{\text{r.h.s.}}
	\end{split}\end{equation*}
	\eqref{eq:定係数Riccatiの双線形}を次のように書き直して、
	\begin{equation*}\begin{split}
		\frac{\plr{f|D_q|t} - a\plr{g|qt} - b_2\plr{f|qt}}{\plr{f|t}}
		= \frac{\plr{g|D_q|t}+ b_1\plr{g|qt} + c\plr{f|qt}} {\plr{g|t}}
	\end{split}\end{equation*}
	両辺を$\plr{\alpha|t}$とおくと、次の連立微分方程式が得られる。
	\begin{equation*}\begin{split}
		\plr{f|D_q|t} - a\plr{g|qt} - b_2\plr{f|qt} 
		&= \plr{\alpha|t}\plr{f|t} \\
		\plr{g|D_q|t} + b_1\plr{g|qt} + c\plr{f|qt} &= \plr{\alpha|t}\plr{g|t}
	\end{split}\end{equation*}
	この式に対して次のゲージ変換を使うと、
	\begin{equation*}\begin{split}
		\plr{f|t}\mapsto \plr{f|t}\int_0^t\plr{\alpha|s}d_qs
		,\quad \plr{t|t}\mapsto \plr{g|t}\int_0^t\plr{\alpha|s}d_qs
	\end{split}\end{equation*}
	ゲージ場$\alpha$を消去した次の式が得られる。
	\begin{equation*}\begin{split}
		\plr{f|D_q|t} - a\plr{g|qt} - b_2\plr{f|qt} &= 0 \\
		\plr{g|D_q|t} + b_1\plr{g|qt} + c\plr{f|qt} &= 0
	\end{split}\end{equation*}
%s3:双線形化による解法}
%s1:Riccati方程式}
\section{代数的Chomsky-Schutzenbergerの定理}\label{s1:代数的Chomsky-Schutzenbergerの定理} %{
	Wikipeidaに代数的Chomsky-Schutzenbergerの定理の項目\footnote{
		英語のWikipediaで次の文字列で検索すればよい。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item Chomsky-Schutzenberger
		\end{itemize} %}
	}があったので記録しておく。

	$\sizen[[x]]$を自然数を係数とする形式級数全体のつくる集合、
	$\bun(x):=\bun[x,x^{-1}]$を有理数を係数とする$x$と$x^{-1}$を変数とする
	多項式全体のつくる集合とする。

	$f\in\sizen[[x]]$が次の性質を満たす時、$f$を$\bun(x)$上で代数的という。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item ある有限個の$p_0,\dots,p_n\in\bun(x)$が存在して、
		\begin{equation*}\begin{split}
			p_0 + p_1\cdot f +\cdots+ p_n\cdot f^n = 0
		\end{split}\end{equation*}
		となる。ここで、積$\cdot$は次のように定義する。
		\begin{equation*}\begin{split}
			\plr{\phi\cdot\psi|x} := \plr{\phi|x}\plr{\psi|x}
		\end{split}\end{equation*}
	\end{itemize} %}

	\begin{proposition}[代数的Chomsky-Schutzenberの定理]\label{prop:代数的Chomsky-Schutzenberの定理} %{
		$A$を有限集合、$L\subseteq A^*$を曖昧さのない文脈自由文法、
		$L_n:=\set{w\in L\bou |w|=n}$とする。
		このとき、$\sum_{n\in\sizen}|L_n|t^n$は$\bun(t)$上で代数的となる。
	\end{proposition} %prop:代数的Chomsky-Schutzenberの定理}

	$A$を文字集合、$f\in\sizen\braket{A,x}$として、
	文法$x=\plr{f|x}$に曖昧さがなければ、ある言語$L\subseteq A^*$があって、
	$x=\sum_{w\in L}w$と摂動展開が書ける。
	したがって、モノイド射$\chi_t:A^*\to\set{t}^*$を$\chi_tw=t^{|w|}$と定義i
	して、それを線形に拡張すると、$\chi_tx=\sum_{n\in\sizen}|L_n|t^n$となる。
	$A$が有限集合だから、任意の$n\in\sizen$で$L_n\le|A^n|=|A|^n$となり、
	少なくとも$|t|<|A|^{-1}$では$\chi_tx$は収束する。
	そして、$\chi_t$を文法に作用させると、$\chi_tx=\chi_t\plr{f|x}$という
	形式級数に対する代数式が得られる。
	
	例を使って考えてみよう。
	文字集合$A:=\set{p,m,l,r,v}$から生成される次の文法を考える。
	\begin{equation*}\begin{split}
		X &= Y + YpX + YmX,\quad Y = v^* + lXr 
	\end{split}\end{equation*}
	任意の$\alpha\in A$に対して$\chi_t\alpha=t$だから、文法に$\chi_t$を作用
	させると、次のようになる。
	\begin{equation*}\begin{split}
		\left\{\begin{split}
			X_t &= Y_t + 2tY_tX_t \\
			Y_t &= t^* + t^2X_t
		\end{split}\right. \iff \left\{\begin{split}
			X_t &= \plr{t^* + t^2X_t}\plr{1 + 2tX_t} \\
			Y_t\plr{1 - 2tY_t} &= t^*\plr{1 - 2tY_t} + t^2Y_t
		\end{split}\right.
	\end{split}\end{equation*}
	Kleeneスターを展開しても次のようになり、
	\begin{equation*}\begin{split}
		\plr{1 - t}X_t &= \plr{1 + \plr{1 - t}t^2X_t}\plr{1 + 2tX_t} \\
		\plr{1 - 1}Y_t\plr{1 - 2tY_t} &= \plr{1 - 2tY_t} + t^2Y_t
	\end{split}\end{equation*}
	この文法は$\sizen[t]$上で代数的になる。
	普通に考えると、曖昧さがない文脈自由文法は$\sizen[t]$上で代数的になりそう
	なものだが、何か見落としているのだろう。

	曖昧さがある文脈自由文法の場合、文法の摂動解$x$の各項に組合せの数が係数が
	掛かり、$\chi_tx$の収束半径が有限になるかどうかが簡単に判断できなくなる。
	しかし、曖昧さは新たな不定元を追加することで回避できることがある。
	例えば、次のような変形である。
	\begin{equation*}\begin{split}
		x = a + xbx \mapsto x = a + xbxc
	\end{split}\end{equation*}
	したがって、すべての曖昧な文法に対して、新たな不定元を追加することで
	曖昧さが回避できるならば、代数的Chomsky-Schutzenberの定理から
	曖昧さの制限を取り除くことができる。

	代数的Chomsky-Schutzenberの定理は自由モノイドに対する命題だが、Kontsevich
	\cite{2011arXiv1109.2469K}によって自由群に対して同様の命題が証明されて
	いる。\cite{2011arXiv1109.2469K}ではより大きな目標の一貫として自由群に
	対する代数的Chomsky-Schutzenberの定理が証明されているようだが、
	Reutenauer達\cite{Reutenauer:2012}が、代数的Chomsky-Schutzenber
	の定理の部分だけを抜き出して解説している。
%s1:代数的Chomsky-Schutzenbergerの定理}
\section{Dyck単語の分割}\label{s1:Dyck単語の分割} %{
	この節では次の便宜を用いることにする。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item Brzozowski代数 \\
		\item 係数の環 \\
		この節では、$V$を環、$\Z V$を$V$の中心として、
		テンソル積$x\otimes_{\Z C}y$を単に$x\otimes y$と省略する。
		\item Brzozowski代数の標準基底系 \\
		$V\Eta_*$の標準基底系を
		$\E_\pm\Eta_*:=\set{\eta_{\pm},\eta_{\pm2},\dots}$と書き、
		$\E\Eta_*:=\E_+\Eta_*$と略記する。
		\item 余積 \\
		$m_0:V\Eta_*\otimes(\Z C)\Eta_*\to V\Eta_*$を$V$-線形な文字列の連結
		とする。線形射$\Delta_0:V\Eta_*\to V\Eta_*\otimes(\Z V)\Eta_*$を
		$m_0$との交換関係によって定義する。
		\begin{equation*}\begin{split}
			xm_0 = m_0(\Delta_0x) \quad\text{for all } x\in V\Eta_*
		\end{split}\end{equation*}
		$\Eta_*$の標準基底系に対しては次のようになる。
		\begin{equation*}\begin{split}
			\Delta_0\eta_i = \eta_i\otimes1 + I_0\otimes\eta_i
			,\quad \Delta_0\eta_{-i} = \eta_{-i}\otimes1
			\quad\text{for all } i\in\sizen_+
		\end{split}\end{equation*}
		ここで、$I_0:=\ket{1}\bra{1}$と定義する。
		$\Delta_0$には左単位射がないので、余積にはならないが、
		代数射$V\Eta_*\to V\Eta_*\otimes(\Z V)\Eta_*$になっているので、
		Hopf代数の多くの性質を持つ。
	\end{itemize} %}

	\begin{todo}[リファクタリング]\label{todo:リファクタリング} %{
		以下には間違っているところがある。間違いを修正するついでにストーリーを
		整理する。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item 間違い \\
			$\bra{w}\eta_K=\bra{\eta_K}\otimes\bra{w}
			\neq\bra{w}\otimes\bra{\eta_K}=\bra{\eta_K}w$
			%
			\item 部分真空期待値 \\
			任意の$n\in\sizen_+$に対して線形射$\J_n:V\Eta_*\to V\Eta_*$を
			次のように定義する。
			\begin{equation*}\begin{split}
				\eta_{\pm i}\J_n = \J_n\eta_{\pm i}
				\quad\text{for all } i\neq n\in\sizen_+,\quad
				\eta_n\J_n = 0 = \J_n\eta_{-n}
			\end{split}\end{equation*}
			文字集合$\E\Eta_*$から文字$\eta_n$を除いた集合を$\E\Eta_{-n}$と書くと、
			$\J_n$は形式的には$\sum_{w\in(\E\Eta_{-n})^*}\ket{w}\bra{w}$
			と書くことができる。本質的にはDiracのデルタ関数なので、存在するか
			どうかは微妙だと思う。
			%
			\item 余積の計算 \\
			$\xi_1,\dots,\xi_n\in\plr{\Z V}\E\Eta_*$として、$m_0$との交換関係
			を計算すると次のようになる。
			\begin{equation*}\begin{split}
				\xi_1\cdots\xi_n m_0 &= m_0\plr{\xi_1\cdots\xi_n \otimes1}
					+ \sum_{r=1}^n \xi_1\cdots\xi_{r-1} m_0
					\plr{I_0\xi_{r+1}\cdots\xi_n\otimes\xi_r} \\
				&= m_0\plr{\xi_1\cdots\xi_n \otimes1} + m_0 \sum_{r=1}^n 
					\plr{I_0\xi_{r+1}\cdots\xi_n\otimes\xi_1\cdots\xi_r} \\
			\end{split}\end{equation*}
		\end{itemize} %}
	\end{todo} %todo:リファクタリング}

	$V\Eta_n$への射影$I_n\in\End_V\plr{V\Eta_*}$を次のように定義すると、
	\begin{equation*}\begin{split}
		I_n := \sum_{w\in\Eta_{n+}^*}\ket{w^\flat}\bra{w}
	\end{split}\end{equation*}
	$I_n$は$\eta_{\pm1},\dots,\eta_{\pm n}$に対しては可換、
	$\eta_{\pm\plr{n+1}},\eta_{\pm\plr{n+2}},\dots$に対しては真空のように
	振る舞う。
	\begin{alignat*}{2}
		I_n\eta_{\pm i} &= \eta_{\pm i}I_n &\quad&\text{for all } i\in1..n \\
		I_n\eta_{-i} &= 0 = \eta_iI_n &\quad&\text{for all } n < i
	\end{alignat*}
	$I_n$を用いて射影$\braket{-}_n:V\Eta_*\to V\Eta_n$を次のように定義する。
	\begin{equation*}\begin{split}
		\braket{x}_n := I_nxI_n \quad\text{for all } x\in V\Eta_*
	\end{split}\end{equation*}

	$K\in\sizen$、$a,b,c\in V\Eta_K$とし、$\phi\in V\Eta_{K+1}$を次のように
	定義する。
	\begin{equation*}\begin{split}
		\phi := a + b\eta_{K+1} + \eta_{-\plr{K+1}}c
	\end{split}\end{equation*}
	Kleeneスターの射影$\braket{\phi^*}_K$を計算してみる。
	まず、次のようになるが、
	\begin{equation}\label{ea:Dyck単語の分割その一}\begin{split}
		I_K\phi^{n+2} &= a^{n+2}I_K 
			+ \sum_{r=0}^{n+1}a^rbI_K\eta_{K+1}\phi^{n+1-r} \\
	\end{split}\end{equation}
	$I_K^{1,2}$を次のように定義すると、
	\begin{equation*}\begin{split}
		I_K^{1,2} := \sum_{w\in\Eta_n^*}\ket{w^\flat}\bra{w}\otimes\bra{1}
	\end{split}\end{equation*}
	二項目の和の中は次のように書くことができる。
	\begin{equation*}\begin{split}
		I_K\eta_{K+1}\phi^{n+1-r}
		= I_K^{1,2} \plr{\id\otimes\eta_{K+1}}m_0^\flat\phi^{n+1-r}
	\end{split}\end{equation*}
	$\phi$と$m_0^\flat$の交換関係は次の形になるが、
	\begin{equation}\label{ea:Dyck単語の分割その二}\begin{split}
		m_0^\flat\phi &= \plr{\Delta_0\phi}m_0^\flat \\
		\Delta_0\phi &= \phi\otimes\id + I_0c\otimes\eta_{-\plr{K+1}}
			+ \plr{\cdots}\otimes\plr{\text{operators in $\Eta_{-K}$}}
	\end{split}\end{equation}
	生成演算子$\Eta_{K-}$がテンソル積の二項目に現れる項は
	$I_K\plr{\id\otimes\eta_{K+1}}$に作用すると$0$になるから、			
	次の式が成り立つ。
	\begin{equation}\label{ea:Dyck単語の分割その三}\begin{split}
		I_K\eta_{K+1}\phi^{n+1-r}
		&= I_K^{1,2} \plr{\id\otimes\eta_{K+1}}m_0^\flat\phi^{n+1-r} \\
		&= I_K^{1,2} \plr{\phi^{n+1-r}\otimes\eta_{K+1}} m_0^\flat \\
		&\;+ \sum_{s=0}^n I_K^{1,2} 
			\plr{\phi^sI_0c\otimes\eta_{K+1}\eta_{-\plr{K+1}}}
			m_0^\flat\phi^{n-(r+s)} \\
		&= I_K\phi^{n+1-r}\eta_{K+1} + \sum_{s=0}^n\phi^sI_0c\phi^{n-(r+s)}
	\end{split}\end{equation}
	したがって、次の式が得られる。
	\begin{equation*}\begin{split}
		I_K\phi^{n+2} &= a^{n+2}I_K 
			+ \sum_{r=0}^{n+1} a^rbI_K\phi^{n+1-r}\eta_{K+1}
			+ \sum_{r+s+t=n} a^rbI_K\phi^sI_0c\phi^t
	\end{split}\end{equation*}
	また、次の式が成り立つが、
	\begin{equation*}\begin{split}
		\braket{\phi^{n+2}}_K = a^{n+2} 
			+ \sum_{r+s+t=n} \braket{a^rb\phi^s}_KI_0\braket{c\phi^t}_K
	\end{split}\end{equation*}
	次の式を使うと、
	\begin{equation*}\begin{split}
		\braket{\phi^{n+3}}_K &= a^{n+3} + a\sum_{r+s+t=n}
			\braket{a^rb\phi^s}_KI_0\braket{c\phi^t}_K
			+ \sum_{r+s=n+1} \braket{b\phi^s}_KI_0\braket{c\phi^t}_K \\
		&= a\braket{\phi^{n+2}}_K + \sum_{s+t=n+1}
			\braket{b\phi^s}_KI_0\braket{c\phi^t}_K
	\end{split}\end{equation*}
	次の式より、
	\begin{equation*}\begin{split}
		\braket{\phi^0}_K &= 1 \\ 
		\braket{\phi^1}_K &= a\braket{\phi^0}_K \\ 
		\braket{\phi^2}_K &= a\braket{\phi^1}_K
			+ \sum_{s+t=0} \braket{b\phi^s}_KI_0\braket{c\phi^t}_K \\
		\braket{\phi^3}_K &= a\braket{\phi^2}_K 
			+ \sum_{s+t=1} \braket{b\phi^s}_KI_0\braket{c\phi^t}_K \\
		\cdots \\
	\end{split}\end{equation*}
	任意の$n\in\sizen$に対して次の式が成り立つ。
	\begin{equation*}\begin{split}
		\sum_{i=0}^{n+2} \braket{\phi^i}_K &= 1 
			+ \sum_{i=0}^{n+1} a\braket{\phi^i}_K 
			+ \sum_{s+t=n} \braket{b\phi^s}_KI_0\braket{c\phi^t}_K
	\end{split}\end{equation*}
	したがって、$t$を$V\Eta_*$の元と可換な不定元として、次の式が成り立つ。
	\begin{equation*}\begin{split}
		\Braket{\plr{t\phi}^*}_K = 1 + t\Braket{a\plr{t\phi}^*}_K 
			+ t^2\Braket{b\plr{t\phi}^*}_KI_0\Braket{c\plr{t\phi}^*}_K 
			\quad\text{up to } t^\infty
	\end{split}\end{equation*}
	この式は$t$の有限べきについて成り立つだけで、収束性
	$\braket{\phi^*}_K\in V\Eta_K$は保証していない。
	以上のことを命題の形でまとめておく。

	\begin{proposition}[Dyck単語の分割]\label{prop:Dyck単語の分割} %{
		$V$を環とする。$K\in\sizen$、$a,b,c\in V\Eta_K$として、
		$\phi\in V\Eta_{K+1}$を次のように定義すると、
		\begin{equation*}\begin{split}
			\phi := a + b\eta_{K+1} + \eta_{-\plr{K+1}}c
		\end{split}\end{equation*}
		形式級数$\braket{\plr{t\phi}^*}_K\in V\Eta_K[[t]]$について、次の式が
		成り立つ。
		\begin{alignat*}{2}
			\Braket{\plr{t\phi}^*}_K &= 1 + t\Braket{a\plr{t\phi}^*}_K 
				+ t^2\Braket{b\plr{t\phi}^*}_KI_0\Braket{c\plr{t\phi}^*}_K
				&\quad\text{up to } t^\infty \\
			&= \ggplr{ta + t^2b\Braket{\plr{t\phi}^*}_KI_0c}^* 
				&\quad\text{up to } t^\infty
		\end{alignat*}
		この式は$t$の有限べきについて成り立つだけで、
		収束性$\braket{\phi^*}_K\in V\Eta_K$は保証していない\footnote{
			無限和や無限積を含む場合は、有限和や有限積の場合に成り立つ事柄が
			そのまま成り立たないことが多い。代数的Chomsky-Schutzenberの定理
			\ref{s1:代数的Chomsky-Schutzenbergerの定理}を参照すること。
		}。
	\end{proposition} %prop:Dyck単語の分割}

	この命題から、$V[[t]]$に対する次の式が導かれる。
	\begin{equation*}\begin{split}
		\phi := a + b\eta_1 + \eta_{-1}c 
		\xRightarrow{x := \Braket{\plr{t\phi}^*}} x = 1 + tax + t^2bxcx
		\quad\text{for all } a,b,c\in V
	\end{split}\end{equation*}
	この式を$x=1+\plr{f|x}x$という形の文法に拡張することを考える。

	まず、二次式の範囲で考えてみる。$a,b_1,\dots,b_N,c_1,\dots,c_N\in V\Eta_K$
	として、$\phi\in V\Eta_{K+N}$を次のように定義する。
	\begin{equation*}\begin{split}
		\phi := a + \phi_+ + \phi_-
		,\quad \phi_+ := \sum_{i=1}^N b_i\eta_{K+i}
		,\quad \phi_- := \sum_{i=1}^N \eta_{-(K+i)}c_i
	\end{split}\end{equation*}
	式\eqref{ea:Dyck単語の分割その二}と同様に、次の式が成り立つから、
	\begin{equation*}\begin{split}
		m_0^\flat\phi &= \plr{\Delta_0\phi}m_0^\flat \\
		\Delta_0\phi &= \phi\otimes\id 
			+ \sum_{i=1}^N I_0c\otimes\eta_{-\plr{K+i}}
			+ \plr{\cdots}\otimes\plr{\text{operators in $\Eta_{-K}$}}
	\end{split}\end{equation*}
	任意の$n\in\sizen$で次の式が成り立ち、
	\begin{equation*}\begin{split}
		I_K\phi^{n+2} &= a^{n+2} + \sum_{r=0}^{n+1} a^rI_K\phi_+\phi^{n+1-r} \\
		&= a^{n+2} + \sum_{r=0}^{n+1} a^rI_K\phi^{n+1-r}\phi_+
			+ \sum_{r+s=n}\sum_{i=1}^N a^r\Braket{b_i\phi^s}I_0c_i\phi^{n-(r+s)}
	\end{split}\end{equation*}
	次の式が成り立つ。
	\begin{alignat*}{2}
		\Braket{\plr{t\phi}^*}_K &= 1 + ta\Braket{\plr{t\phi}^*}_K 
			+ t^2\sum_{i=1}^N\Braket{b_i\plr{t\phi}^*}_K
			I_0\Braket{c_i\plr{t\phi}^*}_K &\quad\text{up to }t^\infty \\
		&= \ggplr{ta + t^2\sum_{i=1}^N b_i\Braket{\plr{t\phi}^*}_KI_0c_i}^* 
			&\quad\text{up to } t^\infty
	\end{alignat*}
	以上のことを命題の形でまとめておく。

	\begin{proposition}[Dyck単語の分割その二]\label{prop:Dyck単語の分割その二} %{
		$V$を環とする。$K,N\in\sizen$、
		$a,b_1,\dots,b_N,c_1,\dots,c_N\in V\Eta_K$として、
		$\phi\in V\Eta_{K+N}$を次のように定義すると、
		\begin{equation*}\begin{split}
			\phi := a + \sum_{i=1}^N \plr{b_i\eta_{K+i} + \eta_{-(K+i)}c_i}
		\end{split}\end{equation*}
		次の式が成り立つ。
		\begin{alignat*}{2}
			\Braket{\plr{t\phi}^*}_K &= 1 + ta\Braket{\plr{t\phi}^*}_K 
				+ t^2\sum_{i=1}^N\Braket{b_i\plr{t\phi}^*}_K
				I_0\Braket{c_i\plr{t\phi}^*}_K &\quad\text{up to }t^\infty \\
			&= \ggplr{ta + t^2\sum_{i=1}^N b_i\Braket{\plr{t\phi}^*}_KI_0c_i}^* 
				&\quad\text{up to } t^\infty
		\end{alignat*}
	\end{proposition} %prop:Dyck単語の分割その二}

	単項式のべきについては次の命題が成り立つ。

	\begin{proposition}[Dyck単語の分割その三]\label{prop:Dyck単語の分割その三} %{
		$V$を環とする。$K,N\in\sizen$、$a,b_1,\dots,b_{N+2}\in V\Eta_K$として、
		$\phi\in V\Eta_{K+N+1}$を次のように定義すると、
		\begin{equation*}\begin{split}
			\phi := a + b_1\eta_{K+1} + \eta_{-(K+N+1)}b_{N+2} 
				+ \sum_{r=2}^{N+1} \eta_{-(K+r-1)}b_r\eta_{K+r}
		\end{split}\end{equation*}
		形式級数$\braket{\plr{t\phi}^*}_K\in V\Eta_K[[t]]$について、次の式が
		成り立つ。
		\begin{alignat*}{2}
			\Braket{\plr{t\phi}^*}_K &= 1 + t\Braket{A}_K
				+ t^{N+2}\Braket{B_1}_KI_0\Braket{B_2}\cdots\Braket{B_{N+1}}
				I_0\Braket{B_{N+2}}_K &\quad\text{up to } t^\infty \\
			&= \ggplr{ta 
				+ t^{N+2}\Braket{B_1}_KI_0\Braket{B_2}\cdots\Braket{B_{N+1}}
				I_0b_{N+2}}^* &\quad\text{up to } t^\infty
		\end{alignat*}
		ここで、$A$と$B_i$は次のように定義した。
		\begin{equation*}\begin{split}
			A := a\plr{t\phi}^*,\quad B_1 := b_1\plr{t\phi}^*,\dots,\quad 
			B_{N+2} := b_{N+2}\plr{t\phi}^*
		\end{split}\end{equation*}
		$B_1,\dots,B_{N+1}$に対しては部分真空期待値ではなく、
		完全な真空期待値をとっていることに注意する。
	\end{proposition} %prop:Dyck単語の分割その三}
	\begin{proof} %{
		命題の$N$の帰納法によって証明する。$N=0$のとき命題が成り立つことは
		Dyck単語の分割\ref{prop:Dyck単語の分割}からわかる。
		ある$N\in\sizen$で命題が成り立つと仮定し、$\phi_{N+3}\in V\Eta_{K+N+3}$
		を次のように定義する。
		\begin{equation*}\begin{split}
			\phi_{N+3} := a + b_1\eta_{K+1} + \eta_{-(K+N+2)}b_{N+3}
				+ \sum_{r=2}^{N+2} \eta_{-(K+r-1)}b_r\eta_{K+r}
		\end{split}\end{equation*}
		Dyck単語の分割\ref{prop:Dyck単語の分割}によって、$\eta_{\pm(K+N+3)}$を
		積分してしまうと、次の式が成り立つ。
		\begin{equation*}\begin{split}
			\Braket{\plr{t\phi_{N+3}}^*}_{K+N+2} = \plr{t\phi_{N+2}}^*
		\end{split}\end{equation*}
		ここで、$\phi_{N+2}\in V\Eta_{K+N+2}$は次のように定義した。
		\begin{equation*}\begin{split}
			\phi_{N+2} &:= a + b_1\eta_{K+1} + t\eta_{-(K+N+1)}c 
				+ \sum_{r=2}^{N+1} \eta_{-(K+r-1)}b_r\eta_{K+r} \\
			c &:= b_{N+2}\plr{t\phi_{N+2}}^*I_0 b_{N+3}\plr{t\phi_{N+2}}^*
		\end{split}\end{equation*}
		$\phi_{N+2}$は次の性質を持つことに注意して、
		\begin{equation*}\begin{split}
			\Braket{f\plr{t\phi_{N+2}}^*g}_K = \Braket{f\plr{t\phi_{N+3}}^*g}_K
			\quad\text{for all } f,g\in V\Eta_K
		\end{split}\end{equation*}
		$\phi_{N+2}$に対して帰納法の仮定を適用すると、次の式が得られるが、
		\begin{equation*}\begin{split}
			\Braket{\plr{t\phi_{N+2}}^*}_K
			= 1 + t\Braket{A}_K + t^{N+3}\Braket{B_1}_KI_0
				\Braket{B_2}\cdots\Braket{B_{N+1}}I_0
				\Braket{c\plr{t\phi_{N+2}}^*}_K \\
		\end{split}\end{equation*}
		次の式から、
		\begin{equation*}\begin{split}
			I_0\Braket{c\plr{t\phi_{N+2}}^*}_K = I_0\Braket{b_{N+2}
				\plr{t\phi_{N+2}}^*} I_0\Braket{b_{N+3}\plr{t\phi_{N+2}^*}}_K
			= I_0\Braket{B_{N+2}}I_0\Braket{B_{N+3}}_K
		\end{split}\end{equation*}
		次の式が成り立つことがわかる。
		\begin{equation*}\begin{split}
			\Braket{\plr{t\psi}^*}_K = 1 + t\Braket{A}_K 
				+ t^{N+3}\Braket{B_1}_KI_0\Braket{B_2}\cdots\Braket{B_{N+2}}
				I_0\Braket{B_{N+3}}_K
		\end{split}\end{equation*}
		したがって、
		$\Braket{\plr{t\phi_{N+3}}^*}_K=\Braket{\plr{t\phi_{N+2}}^*}_K$だから、
		$N+1$でも命題が成り立つことがわかる。
	\end{proof} %}

	この命題の$\phi$は次のベクトル$H_0,\; H_\pm$と巡回的な行列$B$を用いて、
	\begin{equation*}\begin{split}
		H_0 := \begin{pmatrix}
			1 \\ 0 \\ 0 \\ \vdots \\ 0 \\ 0
		\end{pmatrix},\quad H_\pm := \begin{pmatrix}
			0 \\ \eta_{\pm(K+1)} \\ \eta_{\pm(K+2)} 
			\\ \vdots \\ \eta_{\pm(K+N)} \\ \eta_{\pm(K+N+1)}
		\end{pmatrix},\quad B := \begin{pmatrix}
			0 & b_1 & 0 & 0 & \cdots & 0 \\
			0 & 0 & b_2 & 0 & \cdots & 0 \\
			0 & 0 & 0 & b_3 & \cdots & 0 \\
			\vdots & \vdots & \vdots & \vdots & \ddots & 0 \\
			0 & 0 & 0 & 0 & \cdots & b_{N+1} \\
			b_{N+2} & 0 & 0 & 0 & \cdots & 0 \\
		\end{pmatrix}
	\end{split}\end{equation*}
	次のように書くことができる。
	\begin{equation*}\begin{split}
		\phi = a + \plr{H_0 + H_-}^\tran B \plr{H_0 + H_+}
	\end{split}\end{equation*}
	メモ\ref{note:Dyck単語の分割その三}を使いつつ、
	行列の形で$\Braket{\phi^*}_K$を計算してみる。まず、Kleeneスターの摂動から
	次の式が成り立つが、
	\begin{equation*}\begin{split}
		\Braket{\phi^*}_K = 1 + \plr{a + H_0^\tran BH_0}\Braket{\phi^*}_K
			+ H_0^\tran B\Braket{H_+\phi^*}_K
	\end{split}\end{equation*}
	計算\eqref{eq:真空期待値の一次微分の計算}から、次の式が成り立つことが
	わかる。
	\begin{equation*}\begin{split}
		\Braket{H_+\phi^*}_K
		= 1 + \plr{a + H_0^\tran BB_\phi^*H_0}\Braket{\phi^*}_K
	\end{split}\end{equation*}
	ここで、$B_\phi\in(V\Eta_K)^{N+2}$は次のように定義する。
	\begin{equation*}\begin{split}
		B_\phi := \Braket{\phi^*}_KI_0\plr{1 - H_0H_0^\tran}B
	\end{split}\end{equation*}
	ここまでの計算結果は$B$の形に依らない。
	行列$B$の具体的な形を用いると、計算\eqref{eq:Bの具体形を用いた計算}から、
	命題の式が得られる。
	\begin{equation*}\begin{split}
		\Braket{\phi^*}_K
		= 1 + \plr{a + H_0^\tran BB_\phi^{N+1}H_0}\Braket{\phi^*}_K
	\end{split}\end{equation*}
	\begin{note}[計算メモ]\label{note:Dyck単語の分割その三} %{
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $m_0^\flat\phi=\plr{\Delta_0\phi}m_0$とすると、次の式が
			成り立つ。
			\begin{equation*}\begin{split}
				\Delta_0\phi = \phi\otimes\id 
					+ I_0{\contraction{}{B(H_0 + H_+)}{\otimes}{H_-^\tran}
						B(H_0 + H_+)\otimes H_-^\tran}
					+ \plr{\cdots}\otimes\plr{\text{operators in $\Eta_{-K}$}}
			\end{split}\end{equation*}
			ここで、$\contraction{}{X}{\otimes}{Y^\tran}X\otimes Y^\tran$は
			次のようにテンソル積を跨いだベクトルの内積を表す。
			\begin{equation*}\begin{split}
				\contraction{}{X}{\otimes}{Y^\tran}X\otimes Y^\tran 
				:= \sum_{i=1}^{N+1}X_i\otimes Y_i
				,\quad \contraction{}{X^\tran}{\otimes}{Y}X^\tran\otimes Y
				:= \sum_{i=1}^{N+1}X_i\otimes Y_i
			\end{split}\end{equation*}
			%
			\item $\Braket{H_+\phi^*}_K$の計算
			\begin{equation*}\begin{split}
				I_KH_+\phi^* & = I_K^{1,2}(\id\otimes H_+)m_0^\flat\phi^* \\
				& = I_K^{1,2}(\phi^*\otimes H_+)m_0^\flat
					+ I_K^{1,2}(\phi^*\otimes H_+)
					\plr{I_0{\contraction{}{B(H_0 + H_+)}{\otimes}{H_-^\tran}
							B(H_0 + H_+)\otimes H_-^\tran}}
					m_0^\flat\phi^* \\
				&= I_K\phi^*H_+ + I_K\phi^*I_0\plr{H_+H_-^\tran}B(H_0 + H_+)\phi^*
			\end{split}\end{equation*}
			より、縮約に対する次の式と、
			\begin{equation*}\begin{split}
				\plr{\contraction{}{X_1^\tran}{\otimes}{Y_1} X_1^\tran\otimes Y_1}
				\plr{\contraction{}{X_2}{\otimes}{Y_2^\tran} X_2\otimes Y_2^\tran}
				&= \sum_{i,j} \plr{X_{1i}X_{2j}}\otimes\plr{Y_{1i}Y_{2j}} \\
				&= \contraction{(}{X_1}{\otimes1)(1\otimes}{Y_1}
				\contraction{(X_1\otimes1)(1\otimes Y_1}{Y_2^\tran}{)(}{X_2}
				(X_1\otimes1)(1\otimes Y_1Y_2^\tran)(X_2\otimes1)
			\end{split}\end{equation*}
			$H_\pm$に対する次の式を使って、
			\begin{equation*}\begin{split}
				H_+H_-^\tran = 1 - H_0H_0^\tran\in\text{ matrix of center of }V
			\end{split}\end{equation*}
			次の式が得られる。
			\begin{equation}\label{eq:真空期待値の一次微分の計算}\begin{split}
				\Braket{H_+\phi^*}_K 
				&= \Braket{\phi^*}_KI_0\plr{H_+H_-^\tran}BH_0\Braket{\phi^*}_K
				+ \Braket{\phi^*}_KI_0\plr{H_+H_-^\tran}B\Braket{H_+\phi^*}_K \\
				&= \ggplr{\Braket{\phi^*}_KI_0\plr{H_+H_-^\tran}B}^+H_0\Braket{\phi^*}_K
			\end{split}\end{equation}
			%
			\item $H_0^\tran BB_\phi^*H_0$の計算
			\begin{equation}\label{eq:Bの具体形を用いた計算}\begin{split}
				H_0^\tran BB_\phi^*H_0 &= \begin{pmatrix}
					0 \\ b_1 \\ 0 \\ \vdots \\ 0 \\ 0
				\end{pmatrix}^\tran\plr{\Braket{\phi^*}_KI_0\begin{pmatrix}
					0 & 0 & 0 & 0 & \cdots & 0 \\
					0 & 0 & b_2 & 0 & \cdots & 0 \\
					0 & 0 & 0 & b_3 & \cdots & 0 \\
					\vdots & \vdots & \vdots & \vdots & \ddots & 0 \\
					0 & 0 & 0 & 0 & \cdots & b_{N+1} \\
					b_{N+2} & 0 & 0 & 0 & \cdots & 0 \\
				\end{pmatrix}}^*\begin{pmatrix}
					1 \\ 0 \\ 0 \\ \vdots \\ 0 \\ 0
				\end{pmatrix} \\
				&= H_0^\tran BB_\phi^{N+1}H_0
			\end{split}\end{equation}
			$\beta_i$を次のようにおくと、
			\begin{equation*}\begin{split}
				\beta_1:=b_1,\quad
				\beta_i:=b_1\Braket{\phi^*}_KI_0b_2\cdots\Braket{\phi^*}_KI_0b_i
			\end{split}\end{equation*}
			次のようになっていることから、前記の式が成り立つことがわかる。
			\begin{equation*}\begin{split}
				H_0^\tran BB_\phi^0 &= (0\; \beta_1\; 0\; 0\; \cdots\; 0) \\
				H_0^\tran BB_\phi^1 &= (0\; 0\; \beta_2\; 0\; \cdots\; 0) \\
				\vdots \\
				H_0^\tran BB_\phi^N &= (0\; 0\; 0\; 0\; 0\; \cdots\; \beta_{N+1}) \\
				H_0^\tran BB_\phi^{N+1} H_0 &= (b_{N+2}\; 0\; 0\; 0\; \cdots\; 0) \\
				H_0^\tran BB_\phi^{N+2} H_0 &= (0\; 0\; 0\; 0\; \cdots\; 0)
			\end{split}\end{equation*}
		\end{itemize} %}
	\end{note} %note:Dyck単語の分割その三}
\subsection{観察その一}\label{s2:観察その一} %{
	この節では多項式とその根について考える。

	環$V$を係数とする多項式を$V$-多項式と書く事にする。通常は、多項式の
	係数は変数変換で変わり得るので、係数を明示することはないが、この節では
	多項式を変形していくので、係数を明示することにする。
	また、環$V$、$t$を$V$と可換な不定元として、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $V[t]$を$V$を係数とする$t$の多項式全体のつくる集合、
		\item $V[[t]]$を$V$を係数とする$t$の形式級数全体のつくる集合、
		\item $V(t):=V[t,t^{-1}]$、
		\item $V((t)):=V[[t,t^{-1}]]$、
	\end{itemize} %}
	とする。また、通常は用いられることがない記号だが、見やすさを考えて
	次の記法を使うことにする。
	\begin{equation*}\begin{split}
		[V]_t:=V[t],\quad [[V]]_t:=V[[t]],\quad (V)_t:=V[t,t^{-1}]
		,\quad ((V))_t:=V[[t,t^{-1}]]
	\end{split}\end{equation*}

	$t$を変数として次の$[\sei]_t$-多項式とその根$x_\pm\in((\fukuso))_t$
	を考える。
	\begin{equation}\label{eq:元の多項式}\begin{split}
		x = 1 + tx^2,\quad x_\pm := \frac{1 \pm \sqrt{1 - 4t}}{2t}
	\end{split}\end{equation}
	この多項式を次のプッシュダウンオートマトンを構成する過程に添って変形
	してみる。
	\begin{equation*}\begin{array}{rcll}
		\xymatrix{
			*++[o][F=]{x} \ar@(dl,ul)^{tx^2}
		} &\xmapsto{\text{insert final state}}& \xymatrix{
			*++[o][F-]{x} \ar[r]^{1+tx^2} & *++[o][F=]{y}
		} \\
		&\xmapsto{\text{eliminate 1st $x$}}& \xymatrix{
			*++[o][F-]{x} \ar[r]^{1} \ar@(dl,ul)^{t\eta_1} 
			& *++[o][F=]{y} \ar@(ru,rd)^{\eta_{-1}x}
		} \\
		&\xmapsto{\text{eliminate 2nd $x$}}& \xymatrix{
			*++[o][F-]{x} \ar@<1ex>[r]^{1} \ar@(dl,ul)^{t\eta_1} 
			& *++[o][F=]{y} \ar@(ru,rd)^{\eta_{-2}} \ar@<1ex>[l]^{\eta_{-1}\eta_2}
		}
	\end{array}\end{equation*}

	元の多項式\eqref{eq:元の多項式}の左辺で、$x=X/Y$という有理変換をして、
	次のように書き換える。
	\begin{equation*}\begin{split}
		X = xY ,\quad X = Y + tx^2Y
	\end{split}\end{equation*}
	この式は、任意の$g\neq0\in((\fukuso))_t$に対して
	$(X,Y)\mapsto\plr{gX,gY}$という変換で不変になっている。
	したがって、ある$y\neq0\in((\fukuso))_t$を用いて、$Y=y$としてゲージ固定
	すると、次の$((\fukuso))_t$-連立多項式が得られる。
	\begin{equation*}\begin{split}
		X = xY ,\quad X = Y + tx^2Y ,\quad Y = y
	\end{split}\end{equation*}
	\begin{equation*}\begin{split}
		\pvec{X}{Y} = \pvec{0}{y} + \begin{pmatrix}
			0 & 1 + tx^2 \\ 0 & 0
		\end{pmatrix}\pvec{X}{Y},\quad X = xY
	\end{split}\end{equation*}

	次の二つの$((\fukuso))_t$-連立多項式を考えると、
	それぞれの解$X^{(0\pm)}\in((\fukuso))_t^2$は唯一つ定まる
	\footnote{
		この代数式の書き換えはCole-Hopf変換に似ている。
		ポテンシャルが$x_\pm$、波動関数が$X^{(0\pm)}$に対応する。
	}。
	\begin{equation}\label{eq:多項式の線形化その零}\begin{split}
		X^{(0\pm)} = \pvec{0}{1} + \begin{pmatrix}
			0 & 1 + tx_\pm^2 \\ 0 & 0
		\end{pmatrix} X^{(0\pm)}
		\implies X^{(0\pm)} = \pvec{x_\pm}{1}
	\end{split}\end{equation}
	そして、この連立多項式を書き換えた次の二つの$[\fukuso]_t$-連立多項式も、
	それぞれの解$\what{X}^{(0\pm)}\in((\fukuso))_t^2$は唯一つ定まる。
	\begin{equation}\label{eq:多項式の線形化その零改}\begin{split}
		\what{X}^{(0\pm)} = \pvec{0}{1} + \begin{pmatrix}
			0 & 1 + t\what{X}^{(0\pm)}_1x_\pm \\ 0 & 0
		\end{pmatrix} \what{X}^{(0\pm)}
		\implies \what{X}^{(0\pm)} = \pvec{x_\pm}{1}
	\end{split}\end{equation}

	\begin{todo}[妄想あるいは]\label{todo:妄想あるいは} %{
		多項式の書き換え、\eqref{eq:多項式の線形化その零}
		から\eqref{eq:多項式の線形化その零改}、が本質的な気がしてきた。
		$x_\pm=1+tx_\pm^2$というのがゲージ変換に見えてきた。
	\end{todo} %todo:妄想あるいは}

	次の二つの$((\fukuso\Eta_1))_t$-連立多項式を考える。
	\begin{equation}\label{eq:多項式の線形化その一}\begin{split}
		X^{(1\pm)} = \pvec{0}{1} + T_{1\pm}X^{(1\pm)} 
		\quad\text{where } T_{1\pm} := \begin{pmatrix}
			t\eta_1 & 1 \\ 0 & \eta_{-1}x_\pm
		\end{pmatrix}
	\end{split}\end{equation}
	命題\ref{prop:Dyck経路の分割}から次の式が成り立ち、
	\begin{equation*}\begin{split}
		\braket{T_{1\pm}^*} = 1 + \begin{pmatrix}
			0 & 1 \\ 0 & 0
		\end{pmatrix}\braket{T_{1\pm}^*} + \begin{pmatrix}
			t & 0 \\ 0 & 0
		\end{pmatrix}\braket{T_{1\pm}^*}\begin{pmatrix}
			0 & 0 \\ 0 & x_\pm
		\end{pmatrix}\braket{T_{1\pm}^*}
	\end{split}\end{equation*}
	真空期待値は$((\fukuso))_t$-連立多項式\eqref{eq:多項式の線形化その零改}
	を再現する。
	\begin{equation*}\begin{split}
		\braket{X^{(1\pm)}} = \pvec{0}{1} + \begin{pmatrix}
			0 & 1 + t\braket{X^{(1\pm)}_1}x_\pm \\ 0 & 0
		\end{pmatrix} \braket{X^{(1\pm)}}
	\end{split}\end{equation*}
	ただし、$((\fukuso))_t$-連立多項式\eqref{eq:多項式の線形化その零改}の場合
	と異なり、遷移行列$T_{1\pm}$に$0$でない対角成分があるために、
	$\braket{T_{1\pm}^*}$が収束しない可能性がある。実際に$\braket{T_{1\pm}^*}$
	を計算すると次のようになり、
	\begin{equation*}\begin{split}
		\braket{T_{1\pm}^*} = 1 + \begin{pmatrix}
			0 & \plr{tx_\pm}^* \\ 0 & 0
		\end{pmatrix} \implies \braket{X^{(1\pm)}} = \pvec{\plr{tx_\pm}^*}{1}
	\end{split}\end{equation*}
	$\braket{T_{1\pm}^*}$が収束するためには、次の条件が必要なことがわかる。
	\begin{equation*}\begin{split}
		\plr{tx_\pm}^*\in\fukuso((t))
		\iff |tx_\pm| < 1
		\iff |1\pm\sqrt{1-4t}| < 2
	\end{split}\end{equation*}
	この条件は次の式を反映したものだから、
	\begin{equation*}\begin{split}
		x = 1 + tx^2 \iff x = \frac{1}{1 - tx}
		\implies x = \plr{tx}^* \quad\text{iff}\quad |tx| < 1
	\end{split}\end{equation*}
	この条件が満たされるときに限り、$x_\pm=\plr{tx_\pm}^*$となる。
	つまり、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 真空期待値$\braket{X^{(1\pm)}}$が収束するならば、
		$\braket{X^{(1\pm)}}=(x_\pm,\; 1)^\tran$となる
	\end{itemize} %}
	ということが言える。式で書くと次のようになる。
	\begin{equation}\label{eq:多項式の収束条件その一}\begin{split}
		\braket{X^{(1\pm)}}\in((\fukuso))_t
		\implies \braket{X^{(1\pm)}} = \pvec{x_\pm}{1}
	\end{split}\end{equation}
%	そして、$\braket{X^{(1\pm)}}\in((\fukuso))_t$となるときは、
%	$((\fukuso\Eta_1))_t$-連立多項式\eqref{eq:多項式の線形化その一}を
%	次のように、$[\fukuso\Eta_1]_t$-連立多項式に書き換えることができる。
%	\begin{equation}\label{eq:多項式の線形化その一改}\begin{split}
%		\what{X}^{(1)} = \pvec{0}{1} + \what{T}_{1}\what{X}^{(1)}
%		\quad\text{where } \what{T}_{1} := \begin{pmatrix}
%			t\eta_1 & 1 \\ 0 & \eta_{-1}\braket{\what{X}^{(1)}_1}
%		\end{pmatrix}
%	\end{split}\end{equation}
%	この連立多項式には$x_\pm$が現れないので、$t$の多項式を係数とすることに
%	注意する。

	次の$[\fukuso\Eta_2]_t$-連立多項式を考える。
	\begin{equation}\label{eq:多項式の線形化その二}\begin{split}
		X^{(2)} = \pvec{0}{1} + T_{2}X^{(2)} 
		\quad\text{where } T_{2} := \begin{pmatrix}
			t\eta_1 & 1 \\ \eta_{-1}\eta_2 & \eta_{-2}
		\end{pmatrix}
	\end{split}\end{equation}
	命題\ref{prop:Dyck経路の分割}から、部分真空期待について次の式が成り立ち、
	\begin{equation*}\begin{split}
		\braket{T_{2}^*}_1 = 1 + \begin{pmatrix}
			t\eta_1 & 1 \\ 0 & 0
		\end{pmatrix}\braket{T_{2}^*}_1 + I_1\begin{pmatrix}
			0 & 0 \\ \eta_{-1} & 0
		\end{pmatrix}T_{2}^*I_0\begin{pmatrix}
			0 & 0 \\ 0 & 1
		\end{pmatrix}T_{2}^*I_1 
	\end{split}\end{equation*}
	$((\fukuso\Eta_1))_t$-連立多項式\eqref{eq:多項式の線形化その一}に似ている
	が異なる次の$[\fukuso\Eta_1]_t$-連立多項式が得られる。
	\begin{equation*}\begin{split}
		Y^{(1)} = \pvec{0}{1} + \begin{pmatrix}
			t\eta_1 & 1 \\ 0 & \eta_{-1}Y^{(1)}_1I_0
		\end{pmatrix} Y^{(1)}
		\quad\text{where } Y^{(1)} := \braket{X^{(2)}}_1
	\end{split}\end{equation*}

	\begin{todo}[多項式の係数を明示]\label{todo:多項式の係数を明示} %{
	\end{todo} %todo:多項式の係数を明示}

	\begin{todo}[以下は怪しい]\label{todo:以下は怪しい} %{
		結果は正しいが、議論はおかしい。
	\end{todo} %todo:以下は怪しい}

	この連立多項式と連立多項式\eqref{eq:多項式の線形化その一改}は異なるが、
	真空期待値をとると同じ連立多項式となる。
	\begin{equation*}\begin{split}
		\Braket{X^{(1)}} &= \pvec{0}{1} + \Braket{\begin{pmatrix}
			t\eta_1 & 1 \\ 0 & 0
		\end{pmatrix} X^{(1)}} \\
		\Braket{\braket{X^{(2)}}_1} &= \pvec{0}{1} + \Braket{\begin{pmatrix}
			t\eta_1 & 1 \\ 0 & 0
		\end{pmatrix} \braket{X^{(2)}}_1}
	\end{split}\end{equation*}

	\begin{equation*}\begin{split}
		\braket{T_{2}^*} = 1 + \Braket{\begin{pmatrix}
			t\eta_1 & 1 \\ 0 & 0
		\end{pmatrix}T_{2}^*} + \Braket{\begin{pmatrix}
			0 & 0 \\ \eta_{-1} & 0
		\end{pmatrix}T_{2}^*}\Braket{\begin{pmatrix}
			0 & 0 \\ 0 & 1
		\end{pmatrix}T_{2}^*}
	\end{split}\end{equation*}

	部分真空期待値として$\fukuso\Eta_1((t))$上の連立代数式
	\eqref{eq:多項式の線形化その一改}が再現される。
	\begin{equation*}\begin{split}
		\braket{X^{(2)}}_1 = \pvec{0}{1} + \begin{pmatrix}
			t\eta_1 & 1 \\ 0 & \eta_{-1}\braket{X^{(2)}_1}_1
		\end{pmatrix} \braket{X^{(2)}}_1
	\end{split}\end{equation*}
	$\braket{X^{(2)}}$を具体的に計算してみたいところだが、$T_2^*$は次の
	ようになり、
	\begin{equation*}\begin{split}
		T_2^* = U_1\plr{1 + U_2}U_3^* \quad\text{where }
		U_1 = \begin{pmatrix}
			\plr{t\eta_1}^* & 0 \\ 0 & \eta_{-2}^*
		\end{pmatrix},\quad U_2 = \begin{pmatrix}
			0 & \eta_{-2}^* \\ \eta_{-1}\eta_2\plr{t\eta_1}^* & 0
		\end{pmatrix} \\
		U_3 = \begin{pmatrix}
			\eta_{-2}^*\eta_{-1}\eta_2\plr{t\eta_1}^* & 0 \\
			0 & \eta_{-1}\plr{\eta_2\plr{t\eta_1}^* + \eta_{-2}^*} \\
		\end{pmatrix}
	\end{split}\end{equation*}
	収束性を議論できるところまで持っていくことが困難である。
	したがって、$\braket{T_2^*}$の具体的な計算をせずにその収束性を考える。
	$T_2$は$t$の一次式だから、$\braket{T_2^*}$は$t$の形式級数となる。
	\begin{equation*}\begin{split}
		\braket{T_2^*}\in\fukuso[[t]]\subset\fukuso((t))
		\implies \braket{X^{(2)}}\in\fukuso[[t]]
	\end{split}\end{equation*}
	したがって、真空期待値が収束するための条件は、$\fukuso\Eta_1((t))$上の
	連立多項式の場合\eqref{eq:多項式の収束条件その一}より更に厳しく、
	次のようになる。
	\begin{equation*}\begin{split}
		\braket{X^{(2)}}\in\fukuso[[t]]
		\implies \braket{X^{(2)}} = \pvec{x_-}{1}
	\end{split}\end{equation*}
	$x_+$は$t=0$近傍で正則でないので、この連立多項式
	\eqref{eq:多項式の線形化その二}の根に含まれない。

	\begin{todo}[摂動展開の基点]\label{todo:摂動展開の基点} %{
		ここでの議論は$t=0$近傍で摂動展開しているが、任意の複素数$t_0\in\fukuso$
		を基点に摂動展開できるはずである。
	\end{todo} %todo:摂動展開の基点}
%s2:観察その一}
\subsection{観察その二}\label{s2:観察その二} %{
	前節の$\fukuso\Eta_2((t))$上の連立代数式\eqref{eq:多項式の線形化その二}
	は次のもので、
	\begin{equation*}\begin{split}
		X^{(2)} = \pvec{0}{1} + T_{2}X^{(2)} 
		\quad\text{where } T_{2} := \begin{pmatrix}
			t\eta_1 & 1 \\ \eta_{-1}\eta_2 & \eta_{-2}
		\end{pmatrix}
	\end{split}\end{equation*}
	部分真空期待は次の式を満たす。
	\begin{equation*}\begin{split}
		\braket{T_{2}^*}_1 = 1 + \begin{pmatrix}
			t\eta_1 & 1 \\ 0 & 0
		\end{pmatrix}\braket{T_{2}^*}_1 + I_1\begin{pmatrix}
			0 & 0 \\ \eta_{-1} & 0
		\end{pmatrix}T_{2}^*\ket{1}\bra{1}\begin{pmatrix}
			0 & 0 \\ 0 & 1
		\end{pmatrix}T_{2}^*I_1
	\end{split}\end{equation*}
	ここで、次の式が成り立つから、
	\begin{equation*}\begin{split}
		\begin{pmatrix}0 & 1\end{pmatrix}\bra{1}T_{2} = 0
	\end{split}\end{equation*}
	部分真空期待は次のようになる。
	\begin{equation*}\begin{split}
		\braket{T_{2}^*}_1 = 1 + \begin{pmatrix}
			t\eta_1 & 1 \\ 0 & 0
		\end{pmatrix}\braket{T_{2}^*}_1 + I_1\begin{pmatrix}
			0 & 0 \\ \eta_{-1} & 0
		\end{pmatrix}T_{2}^*\ket{1}\bra{1}\begin{pmatrix}
			0 & 0 \\ 0 & 1
		\end{pmatrix}I_1
	\end{split}\end{equation*}
%s2:観察その二}
\subsection{バックアップ}\label{s2:バックアップ} %{
	Dyck経路の分割\ref{eq:Dyck経路の分割}を行列に
	応用してみる。$V$を環、$K\in\sizen$をBrzozowski代数の階数、
	$D\in\sizen_+$を$V$上の自由加群の次元、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $X_0\in V^D$を初期値、
		\item $Y\in\plr{V\Eta_K}^D$をあるベクトル、
		\item $A,B\in\Mat\plr{V\Eta_K,D}$を行列
	\end{itemize} %}
	として、$X\in\plr{V\Eta_{K+1}}^{K+1}$を次の代数式の解とすると、
	\begin{equation*}\begin{split}
		X = X_0 + \plr{A + B\eta_{K+1} + \eta_{-\plr{K+1}}X_0Y^\tran}X
	\end{split}\end{equation*}
	Dyck経路の分割\ref{eq:Dyck経路の分割}により、
	次の$\plr{V\Eta_{K+1}}^{K}$の代数式が得られる。
	\begin{equation*}\begin{split}
		[X]_K = X_0 + A[X]_K + B[X]_K\ket{1}\bra{1}Y^\tran[X]_K
	\end{split}\end{equation*}
%s2:バックアップ}
%s1:Dyck経路の分割}
\section{木の成長とDyck経路の成長}\label{s1:木の成長とDyck経路の成長} %{
	Brzozowski代数によるDyck経路の成長$g:=b\eta\plr{\eta^\flat c}^*$を、
	$q=0$の平面二分木の成長に対応させてみる。

	一次、$\bra{1}\mapsto\bra{1}g$、は次のように、
	\begin{equation*}\begin{split}
		\sbt &\mapsto \smallxy{
			& \sbt \hen[dl] \\
			\sbt \\
		} +  \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \\
		}
	\end{split}\end{equation*}
	二次、$\bra{1}g\mapsto\bra{1}g^2$、は次のように、
	\begin{equation*}\begin{split}
		\smallxy{
			& \sbt \hen[dl] \\
			\sbt \\
		} &\mapsto \smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \\
			\sbt \\
		} + \smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \\
		} + \smallxy{
			& & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[dr] & & \sbt \\
			\sbt & & \sbt \\
		} \\
		\smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \\
		} &\mapsto \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \\
			& \sbt \\
		} + \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt \\
		}
	\end{split}\end{equation*}
	三次、$\bra{1}g^2\mapsto\bra{1}g^3$、は次のようになる。
	\begin{equation*}\begin{array}{rcccccccc}
		\smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \\
			\sbt \\
		} &\mapsto& \smallxy{
			& & & \sbt \hen[dl] \\
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \\
			\sbt \\
		} &+& \smallxy{
			& & & \sbt \hen[dl] \\
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \\
		} &+& \smallxy{
			& & & \sbt \hen[dl] \\
			& & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[dr] & & \sbt \\
			\sbt & & \sbt \\
		} &+& \smallxy{
			& & & \sbt \hen[dl] \hen[dr] \\
			& & \sbt \hen[dl] \hen[dr] & & \sbt \\
			& \sbt \hen[dl] \hen[dr] & & \sbt \\
			\sbt & & \sbt \\
		} \\
		\smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \\
		} &\mapsto& \smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \\
			& \sbt
		} &+& \smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt
		} &+& \smallxy{
			& & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[dr] & & \sbt \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt
		} \\
		\smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \\
			& \sbt \\
		} &\mapsto& \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \\
			& \sbt \hen[dl] \\
			\sbt \\
		} &+& \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \\
		} &+& \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[dr]  & & \sbt \\
			\sbt & & \sbt \\
		} \\
		\smallxy{
			& & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[dr] & & \sbt \\
			\sbt & & \sbt \\
		} &\mapsto& \smallxy{
			& & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[d] & & \sbt \hen[d] \\
			\sbt & \sbt & & \sbt \\
		} &+& \smallxy{
			& & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[d] & & \sbt \hen[d] \hen[dr] \\
			\sbt & \sbt & & \sbt & \sbt \\
		} \\
		\smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt \\
		} &\mapsto& \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt \hen[dl] \\
			& & \sbt \\
		} &+& \smallxy{
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt \hen[dl] \hen[dr] \\
			& & \sbt & & \sbt \\
		} \\
	\end{array}\end{equation*}
	成長$\bra{1}g^n\mapsto\bra{1}g^{n+1}$を平面二分木の言葉で書くと次のように
	なるだろう。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 行きがけ順で最後の葉$p$を見つける。
		\item $p$に左の子供を付け足す。
		\item 行きがけ順で$p$の後ろの頂点に右の子供を付け足す。
	\end{itemize} %}
	次のように対応する。
	\begin{equation*}\begin{array}{rcccccccc}
		\bra{1}(b\eta)(bc)b\eta(\eta^\flat c)^*
		&=& \bra{1}(b\eta)(bc)(b\eta) &+& \bra{1}(b\eta)(bc)(bc)
		&+& \bra{1}(b)(bc)(bc^2) \\
		\smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \\
		} &\mapsto& \smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \\
			& \sbt
		} &+& \smallxy{
			& & \sbt \hen[dl] \\
			& \sbt \hen[dl] \hen[dr] \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt
		} &+& \smallxy{
			& & \sbt \hen[dl] \hen[dr] \\
			& \sbt \hen[dl] \hen[dr] & & \sbt \\
			\sbt & & \sbt \hen[dl] \hen[dr] \\
			& \sbt & & \sbt
		} \\
	\end{array}\end{equation*}
	この
%s1:木の成長とDyck経路の成長}
%
}\endgroup %}
