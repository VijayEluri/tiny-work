\section{文字列の基本事項}\label{s1:文字列の基本事項} %{
	$R=(R,+,0,\myspace,1)$を自明でない可換半環、$A$を有限集合、
	$WA=(WA,m_*,1_W)$を$A$から生成された自由モノイド、
	$RWA$を$WA$を基底とする$R$係数自由半モジュールとする。
	ここで、積$m_*$は文字列の連結で定義された積とし、中置記法で$*$とも書く。
	また、$1_W$は文字数$0$の単語とする。
	$WA$の元を$A$の元を並べたものを括弧でくくって表すことにする。
	例えば、$a_1,a_2,\dots, a_n\in A$を並べた$WA$の元を$[a_1a_2\cdots a_n]$
	と書く。
	
	任意の$n\in\mybf{N}$に対して$W_nA\subseteq WA$を文字数$n$の単語の集合と
	する。つまり、$WA=\oplus_{n\in N}W_nA$となる。$RW_nA$を$W_nA$を基底とする
	$R$係数自由半モジュールとする。やはり、$RWA=\oplus_{n\in N}RW_nA$となる。
	積$m_*$は$R$双線形写像$m_*:RW_mA\otimes RW_nA\to RW_{m+n}A$として
	みることもできる。

	次の$R$線形写像$i_W$を文字列への標準埋め込み(canonical injection)
	という。
	\begin{equation*}\begin{split} %{
		i_W: RA & \to RWA \\
		a & \mapsto [a] \quad\text{for all }a\in A
	\end{split}\end{equation*} %}
	文字列への標準埋め込みを使って、文字列の二項演算と文字の作用の同一視する。
	$RWA$の$R$双線形二項演算$\beta_\square$に対して、次の可換図によって
	$RWA$の二項演算と$RA$の$RWA$への作用を同一視して、誤解の恐れがないとき
	は同一の記号$\beta_\square$を用いる。
	\begin{equation*}\xymatrix@C+1pc{
		RA\otimes RWA \ar[r]^{i_W\otimes \myid} \ar@{.>}[dr]_{\beta_\square}
			& RWA\otimes RWA \ar[d]^{\beta_\square} 
			& RWA\otimes RA \ar[l]_{\myid\otimes i_W} \ar@{.>}[dl]^{\beta_\square} \\
		& RWA
	}\end{equation*}
	任意の$a\in A,\;w\in WA$に対して、中置記法で
	$a\square w:=[a]\square w$、$w\square a:=w\square [a]$と書く。
	この同一視は、$RWA$の二項演算$\beta_\square$によって、
	$RA$から$\myop{end}(RWA)$への$R$線形写像$\myhere\square$
	\begin{equation*}\begin{split} %{
		\myhere\square: RA &\to \myop{end}(RWA) \\
		a &\mapsto (iWa)\square\myhere \quad\text{for all }a\in RA \\
	\end{split}\end{equation*} %}
	と$R$線形写像$\square\myhere$
	\begin{equation*}\begin{split} %{
		\square\myhere: RA &\to \myop{end}(RWA) \\
		a &\mapsto \myhere\square(iWa)　\quad\text{for all }a\in RA \\
	\end{split}\end{equation*} %}
	を定義していることになる。例えば、文字列の連結の場合は次のようになる。
	\begin{equation*}\begin{split} %{
		a*[a_1a_2\cdots a_m] = [aa_1a_2\cdots a_m]
		,\quad [a_1a_2\cdots a_m]*a= [a_1a_2\cdots a_ma]
	\end{split}\end{equation*} %}

	$RWA$の$R$線形二項演算$\beta_\square$の中置記法$\mybiop{\square}$を
	テンソル積に対して次のように定義する。
	\begin{equation}\begin{split} %{
		&(w_{11}\otimes w_{12}\otimes\cdots\otimes w_{1m})
		\square(w_{21}\otimes w_{22}\otimes\cdots\otimes w_{2m}) \\
		&\quad= (w_{11}\square w_{21})\otimes (w_{12}\square w_{22})\otimes\cdots\otimes (w_{1m}\square w_{2m}) \\
		&\quad\text{for all }w_{11},w_{12},\dots,w_{1m},w_{21},w_{22},\dots,w_{2m}\in WA
	\end{split}\end{equation} %}
	テンソル積をベクトルのように縦に並べて書くと、$\mybiop{\square}$は次のよう
	になる。
	\begin{equation*}\begin{split} %{
		\begin{pmatrix}
			w_{11}\\ w_{12}\\ \vdots\\ w_{1m}
		\end{pmatrix}\square \begin{pmatrix}
			w_{21}\\ w_{22}\\ \vdots\\ w_{2m}
		\end{pmatrix} = \begin{pmatrix}
			w_{11}\square w_{21}\\ w_{12}\square w_{22}\\ \vdots\\ w_{1m}\square w_{2m}
		\end{pmatrix}
	\end{split}\end{equation*} %}

	'ケース文'を簡潔に書くために、デルタ関数'$\jump{\mathchar`-}$を定義して
	おく。論理値$\mybf{B}=\set{0_{\mybf{B}},1_{\mybf{B}}}$から半環
	$R=(R,+,0_R,\myspace,1_R)$への写像$\jump{\mathchar`-}:\mybf{B}\mapsto R$
	を次のように定義する。
	\begin{equation*}\begin{split} %{
		0_{\mybf{B}}\mapsto 0_R,\quad 1_{\mybf{B}}\mapsto 1_R
	\end{split}\end{equation*} %}
%s1:文字列の基本事項}

\section{文字列の連結に双対な余積}\label{s:文字列の連結に双対な余積} %{
	積$m_*$に双対で、任意の$a\in A$に対して
	$\Delta_*[a]=[a]\otimes 1_W+1_W\otimes [a]$となる余積$\Delta_*$は、
	任意の$a_1,a_2,\dots,a_m\in A$に対して次の式で具体的な形が求まる。
	\begin{equation}\begin{split} %{
		\Delta_*[a_1a_2\cdots a_m] &= (\Delta_*[a_1])*(\Delta_*[a_2])*\cdots*(\Delta_*[a_m]) \\
		&= 1_W\otimes [a_1a_2\cdots a_m] \\
		&\;+ \sum_{1\le i\le n}[a_i]\otimes [a_1a_2\cdots a_m]_{\neg\set{i}} \\
		&\;+ \sum_{1\le i<j\le n}[a_ia_j]\otimes [a_1a_2\cdots a_m]_{\neg\set{i,j}} \\
		&\;+ \cdots \\
		&\;+ \sum_{1\le i\le n}[a_1a_2\cdots a_m]_{\neg\set{i}}\otimes [a_i] \\
		&\;+ [a_1a_2\cdots a_m]\otimes 1_W \\
	\end{split}\end{equation} %}
	ここで、任意の$1\le i_1<i_2<i_n\le m$に対して
	$[a_1a_2\cdots a_m]_{\neg\set{i_1,i_2,\dots,i_n}}$を$[a_1a_2\cdots a_m]$
	から$i_1$番目と$i_2$番目と...と$i_n$番目の文字を取り除いた文字列とした。
	例えば、$[abc]_{\neg\set{1}}=[bc]$、$[abc]_{\neg\set{2}}=[ac]$、
	$[abc]_{\neg\set{1,3}}=[b]$となる。更に、余単位射を
	$\epsilon_*:w\mapsto \jump{w=1_W}$で定めると、単位元$1_W$に対する余積が
	$\Delta_*1_W=1_W\otimes 1_W+\cdots$という形になる必要がある。
	一方、双対性$\Delta_*[a]=(\Delta_*1_W)*(\Delta_*[a])$を満たすためには、
	$\Delta_*1_W=1_W\otimes 1_W$となる必要があることがわかる。まとめると、
	次のようになる。

	\begin{definition}[文字列の連結に双対な余積]\label{def:文字列の連結に双対な余積} %{
		$R$線形写像$\Delta_*$を次のように定義する。
		\begin{equation}\begin{split} %{
			\Delta_*: RWA &\to RWA\otimes RWA \\
			1_W &\mapsto 1_W\otimes 1_W \\
			[a] &\mapsto [a]\otimes 1_W + 1_W\otimes [a] \quad\text{for all }a\in A \\
			w_1*w_2 &\mapsto (\Delta_*w_1)*(\Delta_*w_2) \quad\text{for all }w_1,w_2\in WA \\
		\end{split}\end{equation} %}
		$R$線形写像$\epsilon_*$を次のように定義する。
		\begin{equation}\begin{split} %{
			\epsilon_*: RWA &\to R \\
				w &\mapsto \jump{w=1_W}\quad\text{for all }w\in WA
		\end{split}\end{equation} %}
		$\Delta_*$は積$m_*$に双対な余積になり、
		$\epsilon_*$が余積$\Delta_*$の余単位射となる。
	\end{definition} %def:文字列の連結に双対な余積}

	\begin{proposition}[$\Delta_*$は余可換]\label{prop:Delta_*は余可換} %{
		$\Delta_*$は余可換である。
	\end{proposition} %prop:Delta_*は余可換}
	\begin{proof} %{
		文字数についての帰納法で証明する。
		$\Delta_*1_W=1_W\otimes 1_W$だから、文字数が$0$の場合は余可換となる
		ことがわかる。
		任意の$a\in A$に対して$\Delta_*1[a]=[a]\otimes 1_W+[a]\otimes 1_W$
		だから、文字数が$1$の場合も余可換となることがわかる。
		文字数が$n\in\mybf{N}\bou 1\le n$以下の任意の単語に対して$\Delta\*$が
		余可換だとする。
		\begin{equation*}\begin{split} %{
			\Delta_{*(1)}w\otimes\Delta_{*(2)}w
			=\Delta_{*(2)}w\otimes\Delta_{*(1)}w
			\quad\text{for all }w\in WA\bou \zettai{w}\le n
		\end{split}\end{equation*} %}
		$w_1,w_2$を文字数が$n$以下の単語とする。次の式から単語$w_1*w_2$は
		余可換になることがわかる。
		\begin{equation*}\begin{split} %{
			\Delta_*(w_1*w_2) &= (\Delta_*w_1)*(\Delta_*w_2) \\
			&= \left((\Delta_{*(1)}w_1)*(\Delta_{*(1)}w_2)\right)
			\otimes \left((\Delta_{*(2)}w_1)*(\Delta_{*(2)}w_2)\right) \\
			&= \left((\Delta_{*(2)}w_1)*(\Delta_{*(2)}w_2)\right)
			\otimes \left((\Delta_{*(1)}w_1)*(\Delta_{*(1)}w_2)\right) \\
			& = \left(\Delta_{*(2)}(w_1*w_2)\right)
			\otimes \left(\Delta_{*(1)}(w_1*w_2)\right) \\
		\end{split}\end{equation*} %}
		任意の$n+1$文字の単語$w$は、ある$1$文字の単語$x$とある$n$文字の単語$y$
		の積$w=x*y$で書くことができるので、任意の$n+1$文字の単語に対する
		余積$\Delta_*$は余可換となることがわかる。
	\end{proof} %}

	ここで、余可換な余積を余表現の面から見てみる。$\Delta$を$RWA$の余積とし、
	$WA$の基底を$\set{e_0,e_1,\cdots}$とおき、$R$値行列$\Delta_i^{jk}$を
	用いて$\Delta e_i=\Delta_i^{jk}e_j\otimes e_k$とする。
	余積$\Delta$の余結合性は、余表現に対する
	$\Delta_i^{ja}\Delta_a^{kl}=\Delta_a^{jk}\Delta_i^{al}$という条件になる。
	余積$\Delta$が余可換であった場合、$\Delta_i^{jk}=\Delta_i^{kj}$となる。
	$\Delta^2$についてみてみる。
	$(\Delta^2)_i^{jkl}=\Delta_i^{ja}\Delta_a^{kl}$となるが、
	$(\Delta^2)_i^{jkl}$の添え字$(kl)$について対称なことは、
	余積$\Delta$が余可換であることからわかる。また、余結合性
	$\Delta_i^{ja}\Delta_a^{kl}=\Delta_a^{jk}\Delta_i^{al}$を使うと、
	$(\Delta^2)_i^{jkl}$の添え字$(jk)$について対称なこともわかる。
	したがって、$(\Delta^2)_i^{jkl}$は添え字$(jkl)$の任意の置換で不変なこと
	がわかる。同様にして、$(\Delta^n)_i^{i_1i_2\cdots i_{n+1}}$は添え字
	$(i_1i_2\cdots i_{n+1})$の任意の置換で不変なこともわかる。
	したがって、Sweedler記法を用いて
	$\Delta^nw=w_{(1)}\otimes w_{(2)}\otimes\cdots\otimes w_{(n+1)}$
	と書くと、$\Delta$が余可換であれば、$n+1$次の任意の置換$\sigma$に対して
	$\Delta^nw=w_{(\sigma1)}\otimes w_{(\sigma2)}\otimes\cdots\otimes w_{\left(\sigma(n+1)\right)}$
	となる。
%s1:文字列の連結に双対な余積}

\section{文字列とその双対空間}\label{s1:文字列とその双対空間} %{
	$RA$から$R$への$R$線形写像全体の作る空間を$RA^t$、
	$RWA$から$R$への$R$線形写像全体の作る空間を$RWA^t$とする。
	文字$w\in A$に双対な元を$a^t\in A^t$、
	単語$w\in WA$に双対な元を$w^t\in WA^t$と書く。
	\begin{equation*}\begin{split} %{
		w_1^t w_2 = \jump{w_1=w_2} \quad\text{for all }w_1,w_2\in WA
	\end{split}\end{equation*} %}
	$WA$の元を$A$の元を用いて書いた場合にも同様に書く。
	例えば、$a_1,a_2,\dots, a_n\in A$として、$[a_1a_2\cdots a_n]\in WA$
	に双対な元を$[a_1a_2\cdots a_n]^t\in WA^t$と書く。
	$R$線形写像$\mypowop{t}$を次のように定義する。
	\begin{equation*}\begin{split} %{
		\mypowop{t}:RWA\to RWA^t,\quad w\mapsto w^t \quad\text{for all }w\in WA \\
		\mypowop{t}:RWA^t\to RWA,\quad w^t\mapsto w \quad\text{for all }w\in WA \\
	\end{split}\end{equation*} %}
	$\mypowop{t}$は集合同型射で$\mypowop{t}\mypowop{t}=\myid$となる。
	写像$\mypowop{t}$を転置と書くことにする。
	テンソル積に対する転置と内積を次のように定義する。
	\begin{equation*}\begin{split} %{
		\mypowop{t}:RWA\otimes RWA &\to (RWA\otimes RWA)^t \\
		w_1\otimes w_2 &\mapsto (w_1\otimes w_2)^t
	\end{split}\end{equation*} %}
	ここで、$(w_1\otimes w_2)^t$は次のように定義される。
	\begin{equation*}\begin{split} %{
		(w_1\otimes w_2)^t(w_3\otimes w_4)
			& =(w_1^t w_3)\otimes (w_2^t w_4) \simeq (w_1^t w_3)(w_2^t w_4) \\
		&\quad\text{for all }w_1,w_2,w_3,w_4\in WA \\
	\end{split}\end{equation*} %}
	ここで、任意の$R$係数半モジュール$RX$に対して
	$R\otimes RX\simeq R\simeq RX\otimes R$
	、特に、$R\otimes R\simeq R\simeq R\otimes R$となることに注意する。
	二次以上のテンソル積についても同様に定義する。この同一視は頻繁に用いる。

	\begin{note}[双対空間の正順同型と逆順同型]\label{note:双対空間の正順同型と逆順同型} %{
		$RWA^t$の積$*$を任意の$w_1,w_2\in WA$に対して、
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $(w_1*w_2)^t=w_1^t*w_2^t$と定義すれば、転置$\myhere^t$は
			積$*$ついて正順モノイド同型となり、
			\item $(w_1*w_2)^t=w_2^t*w_1^t$と定義すれば、転置$\myhere^t$は
			積$*$ついて逆順モノイド同型となる。
		\end{itemize} %}
		また、任意の$w_1,w_2\in WA$に対して
		$(w_1\otimes w_2)^t(w_1\otimes w_2)=1\otimes 1$という要請から、
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item テンソル積の内積を
			\begin{equation*}\begin{split} %{
				(w_1^t\otimes w_2^t)(w_3\otimes w_4)=(w_1^tw_3)\otimes(w_2^tw_4)
				\quad\text{for all }w_1,w_2,w_3,w_4\in WA
			\end{split}\end{equation*} %}
			と定義すれば、$(w_1\otimes w_2)^t=w_1^t\otimes w_2^t$となり、
			\item テンソル積の内積を
			\begin{equation*}\begin{split} %{
				(w_1^t\otimes w_2^t)(w_3\otimes w_4)=(w_2^tw_3)\otimes(w_1^tw_4)
				\quad\text{for all }w_1,w_2,w_3,w_4\in WA
			\end{split}\end{equation*} %}
			と定義すれば、$(w_1\otimes w_2)^t=w_2^t\otimes w_1^t$となる。
		\end{itemize} %}
		わかりやすいバターンは次の二通りだろう。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item 正順パターン: 転置$\myhere^t:RWA\to RWA^t$が正順同型になるように
			積$m_*:RWA^t\otimes RWA^t\to RWA$を定義し、テンソル積の内積を
			$\myhere^t:RWA\otimes RWA\to RWA^t\otimes RWA^t$が正順になるように
			定義する。
			\item 逆順パターン: 転置$\myhere^t:RWA\to RWA^t$が逆順同型になるように
			積$m_*:RWA^t\otimes RWA^t\to RWA$を定義し、テンソル積の内積を
			$\myhere^t:RWA\otimes RWA\to RWA^t\otimes RWA^t$が逆順になるように
			定義する。
		\end{itemize} %}
		ディラックのブラケット記法は逆順パターンである。
		この節では、ブラ空間$RWA^t$の文字とテンソル積の順序に混泥しないように、
		$v_1^tMv_2=(Mv_1)^tv_2$という作用素$M$の転置を用いてケット空間$RWA$のみ
		で議論していく。
	\end{note} %note:双対空間の正順同型と逆順同型}

	\subsection{内積とシャッフル積}\label{s2:内積とシャッフル積} %{
		次の畳み込みによって$RWA$に余積$\Delta_\sqcup:RWA\to RWA\otimes RWA$
		を定義する。
		\begin{equation}\label{eq:シャッフル余積の可換図その一}\begin{split} %{
			\xymatrix{
				RWA\otimes RWA \ar[r]^{m_*} \ar@{.>}[d]^{(\Delta_\sqcup f)^t} 
				& RWA \ar[d]^{f^t} \\
				R\otimes R \ar@{<->}[r]^{\simeq} & R \\
			} \quad\text{for all }f\in RWA
		\end{split}\end{equation} %}
		$R$値行列$D$を用いて、任意の$w\in WA$に対して
		$\Delta_\sqcup w=\sum_{w_1,w_2\in WA}D_{w_1w_2}^ww_1\otimes w_2$
		とすると、可換図式により$D_{w_1w_2}^w=w^t(w_1*w_2)$となる。したがって、
		余積$\Delta_\sqcup$は具体的に求まって次のようになる。
		\begin{equation*}\begin{split} %{
			\Delta_\sqcup w = \sum_{w_1,w_2\in WA}\jump{w=w_1*w_2}w_1\otimes w_2
			\quad\text{for all }w\in WA
		\end{split}\end{equation*} %}
		$A$の元$a_1,a_2,\dots,a_m$を用いて書くと、次のようになる。
		\begin{equation*}\begin{split} %{
			\Delta_\sqcup[a_1a_2\cdots a_m]^t &= 1_W\otimes [a_1a_2\cdots a_m] \\
			&\;+ [a_1]\otimes [a_2\cdots a_m] \\
			&\;+ [a_1a_2]\otimes [\cdots a_m] \\
			&\;+ \cdots \\
			&\;+ [a_1a_2\cdots a_m]\otimes 1_W^t \\
		\end{split}\end{equation*} %}
		余積$\Delta_\sqcup$に対する余単位射は、余積$\Delta_*$に対する
		単位射$\epsilon_*$になる。

		次の畳み込みによって$RWA$に積$m_\sqcup:RWA\otimes RWA\to RWA$を定義する。
		\begin{equation}\label{eq:シャッフル積の可換図その一}\begin{split} %{
			\xymatrix{
				RWA\otimes RWA \ar[d]^{(f\otimes g)^t} 
				& RWA \ar[l]_{\Delta_*} \ar@{.>}[d]^{(f\sqcup g)^t}\\
				R\otimes R \ar@{<->}[r]^{\simeq} & R  \\
			} 
		\end{split}\end{equation} %}
		任意の$w,w_1,w_2\in WA$に対して、$R\otimes R\simeq R$の同一視で、
		$(w_1\otimes w_2)^t\Delta_*w\simeq(w_1\sqcup w_2)^tw$
		となるから、積$m_\sqcup$は積$\Delta_*$の転置$m_\sqcup=\Delta_*^t$
		となっている。
		積$m_*$と余積$\Delta_*$が双対な関係になっているから、
		それらから畳み込みで定義された積$m_\sqcup$と余積$\Delta_\sqcup$も
		双対の関係になる。

		$R$値行列$D$を用いて、任意の$w_1,w_2\in WA$に対して
		$w_1\sqcup w_2=\sum_{w\in WA}M_{w_1w_2}^ww$とすると、
		可換図式により$M_{w_1w_2}^w=(w_1^t\Delta_{*(1)}w)(w_2^t\Delta_{*(2)}w)$
		となる。余積$\Delta_\sqcup$の場合と異なり、$m_\sqcup$の具体的な形を
		求めることは難しい。しかし、次の事柄はすぐわかる。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $\Delta_*$が余可換だから、$m_\sqcup$は可換になる。つまり、
			任意の$w_1,w_2\in WA$に対して$w_1\sqcup w_2=w_2\sqcup w_1$となる。
			\item $\Delta_*$の余単位射$\epsilon_*$が$\epsilon_*=1_W$となるから、
			任意の$w,w_2\in WA$に対して
			\begin{equation*}\begin{split} %{
				M_{1_Ww_2}^w &= (1_W^t\Delta_{*(1)}w)(w_2^t\Delta_{*(2)}w) \\
				&= (\epsilon_*\Delta_{*(1)}w)(w_2^t\Delta_{*(2)}w) \\
				&= w_2^t w \\
			\end{split}\end{equation*} %}
			となり、$1_W$が単位元になる。つまり、
			任意の$w\in WA$に対して$w\sqcup 1_W=w=1_W\sqcup w$となる。
		\end{itemize} %}

		任意の$a\in A$と$w,w_2\in WA$に対して
		$M_{[a]x}^w=([a]^t\Delta_{*(1)}w)*(w_2^t\Delta_{*(2)}w)$となり、
		任意の$a,b_1,b_2,\dots,b_m\in A$に対して次の式が成り立つ。
		\begin{equation*}\begin{split} %{
			[a]\sqcup [b_1b_2\cdots b_m]
			&= \sum_{w\in WA}M_{[a][b_1b_2\cdots b_m]}^ww \\
			&= \sum_{w\in WA}\jump{\Delta_*w=[a]\otimes [b_1b_2\cdots b_m]+\cdots}w \\
			&= [ab_1b_2\cdots b_m] + [b_1ab_2\cdots b_m]
				+ \cdots + [b_1b_2\cdots b_ma] \\
		\end{split}\end{equation*} %}
		となることがわかる。つまり、次のようになる。
		\begin{equation*}\begin{split} %{
			[a]\sqcup w &= (\Delta_{\sqcup(1)}w)*[a]*(\Delta_{\sqcup(1)}w)
			\quad\text{for all }a\in A,\;w\in WA
		\end{split}\end{equation*} %}
		次に、任意の$a_1,a_2\in A$と$w,w_2\in WA$に対して
		$M_{[a_1a_2]x}^w=([a_1a_2]^t\Delta_{*(1)}w)*(w_2^t\Delta_{*(2)}w)$
		となり、任意の$a_1,a_2,b_1,b_2,\dots,b_m\in A$に対して
		\begin{equation*}\begin{split} %{
			[a_1a_2]\sqcup [b_1b_2\cdots b_m]
			&= \sum_{w\in WA}M_{[a_1a_2][b_1b_2\cdots b_m]}^ww \\
			&= \sum_{w\in WA}\jump{\Delta_*w=[a_1a_2]\otimes [b_1b_2\cdots b_m]+\cdots}w \\
			&= [a_1a_2b_1b_2\cdots b_m] + [a_1b_1a_2b_2\cdots b_m]
				+ \cdots + [a_1b_1b_2\cdots b_ma_2] \\
			&\;+ [b_1a_1a_2b_2\cdots b_m] + \cdots + [b_1a_1b_2\cdots b_ma_2] \\
			&\;+ \cdots \\
			&\;+ [b_1b_2\cdots a_1a_2b_m] + [b_1b_2\cdots a_1b_ma_2] \\
			&\;+ [b_1b_2\cdots b_ma_1a_2] \\
		\end{split}\end{equation*} %}
		となることがわかる。つまり、次のようになる。
		\begin{equation*}\begin{split} %{
			[a_1a_2]\sqcup w
			&= (\Delta_{\sqcup(1)}w)*[a_1]
			*(\Delta_{\sqcup(1)}\Delta_{\sqcup(2)}w)*[a_2]
			*(\Delta_{\sqcup(2)}^2w) \\
			&\quad\text{for all }a_1,a_2\in A,\;w\in WA
		\end{split}\end{equation*} %}
		これを一般化すると次のようになる。
		\begin{equation*}\begin{split} %{
			[a_1a_2\cdots a_m]\sqcup w
			& = (\Delta_{\sqcup(1)}w)*[a_1] \\
			&\; + (\Delta_{\sqcup(1)}\Delta_{\sqcup(2)}w)*[a_2] \\
			&\; + \cdots \\
			&\; + (\Delta_{\sqcup(1)}\Delta_{\sqcup(2)}^{m-1}w)*[a_{m}] \\
			&\; + (\Delta_{\sqcup(2)}^{m}w) \\
			&\quad\text{for all }a_1,a_2,\dots,a_m\in A,\;w\in WA
		\end{split}\end{equation*} %}


		積$m_\sqcup$と余積$\Delta_\sqcup$を定義の形でまとめておく。
		積$m_*$と余積$\Delta_*$の場合とは逆に、先に余積$\Delta_\sqcup$を定義して
		積$m_\sqcup$を余積$\Delta_\sqcup$を使って定義する。
		\begin{definition}[シャッフル積に双対な余積]\label{def:シャッフル積に双対な余積} %{
			$R$線形写像$\Delta_\sqcup$を次のように定義する。
			\begin{equation*}\begin{split} %{
				\Delta_\sqcup: RWA &\to RWA\otimes RWA \\
				1_W &\mapsto 1_W\otimes 1_W \\
				[a_1a_2\cdots a_m] 
				& \mapsto 1_W\otimes [a_1a_2\cdots a_m] \\
				&\; + [a_1]\otimes [a_2\cdots a_m] \\
				&\; + [a_1a_2]\otimes [a_3\cdots a_m] \\
				&\; + \cdots \\
				&\; + [a_1a_2\cdots a_{m-1}]\otimes [a_m] \\
				&\; + [a_1a_2\cdots a_m]\otimes 1_W \\
				&\quad\text{for all }a_1,a_2,\dots,a_m\in A
			\end{split}\end{equation*} %}
			$\Delta_\sqcup$は余積になり、$\epsilon_*$が余積$\Delta_\sqcup$の
			余単位射となる。
			余積$\Delta_\sqcup$のことをシャッフル余積ということにする。
		\end{definition} %def:シャッフル積に双対な余積}
		通常のシャッフル積の定義とは異なるが、イメージのしやすさを優先して、
		次のようにシャッフル積を定義する。
		\begin{definition}[シャッフル積]\label{def:シャッフル積} %{
			$R$双線形写像$m_\sqcup$を次のように定義する。
			\begin{equation*}\begin{split} %{
				m_\sqcup: RWA\otimes RWA &\to RWA \\
				1_W\otimes w &\mapsto w \quad\text{for all }w\in WA \\
				[a_1a_2\cdots a_m]\otimes w
				& \mapsto (\Delta_{\sqcup(1)}w)*[a_1] \\
				&\; + (\Delta_{\sqcup(1)}\Delta_{\sqcup(2)}w)*[a_2] \\
				&\; + \cdots \\
				&\; + (\Delta_{\sqcup(1)}\Delta_{\sqcup(2)}^{m-1}w)*[a_{m}] \\
				&\; + (\Delta_{\sqcup(2)}^{m}w) \\
				&\quad\text{for all }a_1,a_2,\dots,a_m\in A,\;w\in WA
			\end{split}\end{equation*} %}
			$m_\sqcup$は余積$\Delta_\sqcup$に双対な積になり、$1_W$が積$m_\sqcup$の
			単位元となる。積$m_\sqcup$をシャッフル積という。
		\end{definition} %def:シャッフル積}

		ここで、積$m_*$と$m_\sqcup$に対応する作用素を見てみる。

		任意の$w,w_0,w_2\in WA$に対して、$R\otimes R\simeq R$の同一視で、
		$w^tm_*(w_1\otimes w_2)\simeq(\Delta_\sqcup w)^t(w_1\otimes w_2)$
		となるから、余積$\Delta_\sqcup$は積$m_*$の転置$\Delta_\sqcup=m_*^t$
		となっている。作用素$\set{a*}_{a\in A}$の転置
		$\set{a^t*}_{a\in A}:=\set{(a*)^t}_{a\in A}$は次の式で定義され、
		\begin{equation*}\begin{split} %{
			w_1^t(a*w_2)=(a^t*w_1)^tw_2 \quad\text{for all }a\in A,\;w_1,w_2\in WA
		\end{split}\end{equation*} %}
		任意の$a\in A$に対して次のようになる。
		\begin{equation*}\begin{split} %{
			a^t*1_W &= 0 \\
			a^t*[a_1a_2\cdots a_m]^t &= \jump{a=a_1}[a_2\cdots a_m] 
			\quad\text{for all }a_1,a_2,\dots,a_m\in A
		\end{split}\end{equation*} %}

		積$m_\sqcup$に対応する作用素$a\sqcup$を任意の$a\in A$に対して
		次のように定義する。
		\begin{equation*}\begin{split} %{
			a\sqcup: RWA\to RWA \\
			w \mapsto [a]\sqcup w \quad\text{for all }w\in WA 
		\end{split}\end{equation*} %}
		積$m_\sqcup$は可換なので、任意の$a\in A$に対して$a\sqcup=\sqcup a$となり、
		$a*$の場合と異なり、右からの作用$a\sqcup$と左からの作用$\sqcup a$を
		区別する必要はない。任意の$a\in A$に対して次のようになる。
		\begin{equation*}\begin{split} %{
			a\sqcup 1_W &= [a] \\
			a\sqcup[a_1a_2\cdots a_m] &= [aa_1a_2\cdots a_m] \\
			&\;+ [a_1aa_2\cdots a_m] \\
			&\;+ [a_1a_2a\cdots a_m] \\
			&\; + \cdots \\
			&\;+ [a_1a_2\cdots aa_m] \\
			&\;+ [a_1a_2\cdots a_ma] \\
			&\quad\text{for all }a_1,a_2,\dots,a_m\in A
		\end{split}\end{equation*} %}
		任意の$w,w_0,w_2\in WA$に対して、$R\otimes R\simeq R$の同一視で、
		$(w_1\sqcup w_2)^t w\simeq(w_1\otimes w_2)^t(\Delta_* w)$
		となるから、余積$\Delta_*$は積$m_\sqcup$の転置$\Delta_*=m_\sqcup^t$
		となっている。$\set{a\sqcup}_{a\in A}$の転置
		$\set{a^t\sqcup}_{a\in A}:=\set{(a\sqcup)^t}_{a\in A}$は次の式で
		定義され、
		\begin{equation*}\begin{split} %{
			(a\sqcup w_1)^tw_2=w_1^t(a^t\sqcup w_2)
			\quad\text{for all }a\in A,\;w_1,w_2\in WA
		\end{split}\end{equation*} %}
		任意の$a\in A$に対して次のようになる。
		\begin{equation*}\begin{split} %{
			a^t\sqcup 1_W &= 0 \\
			a^t\sqcup [a_1a_2\cdots a_m]^t &= \jump{a=a_1}[a_2\cdots a_m] \\
			&\;+ \jump{a=a_2}[a_1a_3\cdots a_m] \\
			&\;+ \cdots \\
			&\;+ \jump{a=a_m}[a_1a_3\cdots a_{m-1}] \\
			&\quad\text{for all }a_1,a_2,\dots,a_m\in A
		\end{split}\end{equation*} %}

		積と作用素の関係と作用素における双対性をまとめると次のようになる。
		\begin{minipage}{0.5\hsize}
			\begin{center}\begin{tabular}{ccc}
				積 & 作用素 & 可換性 \\ \hline
				$m_*$ & $a*$ & 非可換 \\
				$\Delta_\sqcup=m_*^t$ & $a^t*$ & 非可換 \\
				$m_\sqcup$ & $a\sqcup$ & 可換 \\
				$\Delta_*=m_\sqcup^t$ & $a^t\sqcup$ & 可換 \\
			\end{tabular}\end{center}
		\end{minipage}
		\begin{minipage}{0.5\hsize}
			\begin{center}\begin{tabular}{c|cccc}
				双対性 & $a*$ & $a^t*$ & $a\sqcup$ & $a^t\sqcup$ \\ \hline
				$a*$ & & 転置 & & 代数 \\
				$a^t*$ & 転置 & & 代数　\\
				$a\sqcup$ & & 代数 & & 転置 \\
				$a^t\sqcup$ & 代数 & & 転置 \\
			\end{tabular}\end{center}
		\end{minipage}
		作用素の交換関係は次のようになる。
		\begin{equation}\label{eq:作用素の交換関係}\begin{split} %{
			a_1^t* a_2* &= \jump{a_1=a_2} \\
			a_1^t\sqcup a_2\sqcup &= \jump{a_1=a_2}(\nu + 1) 
				+ \delta(a_1\otimes a_2^t)+ a_2\sqcup a_1^t\sqcup \\
			a_1^t* a_2\sqcup &= \jump{a_1=a_2} + a_2\sqcup a_1^t* \\
			a_1^t\sqcup a_2* &= \jump{a_1=a_2} + a_2* a_1^t\sqcup \\
		\end{split}\end{equation} %}
		ここで、$\nu$は文字数を数える$R$線形写像で次のように定義される。
		\begin{equation*}\begin{split} %{
			\nu: RWA &\to RWA \\
			1_W &\mapsto 0 \\
			[a_1a_2\cdots a_m] &\mapsto m \quad\text{for all }a_1,a_2,\dots,a_m\in A
		\end{split}\end{equation*} %}
		また、$\delta$はリー微分に相当する$R$双線形写像で次のように定義される。
		\begin{equation*}\begin{split} %{
			\delta: RA\otimes RA^t &\mapsto \myop{end}(RWA) \\
			\delta(a_1\otimes a_2^t)[b_1b_2\cdots b_n]
			&= \jump{a_2=b_1}[a_1b_2\cdots b_n] \\
			&\;+ \jump{a_2=b_2}[b_1a_1b_3\cdots b_n] \\
			&\;+ \cdots \\
			&\;+ \jump{a_2=b_m}[b_1b_2\cdots b_{n-1}a_1] \\
			&\quad\text{for all }a_1,a_2,b_1,b_2,\dots,a_m\in A
		\end{split}\end{equation*} %}
		'リー微分'$\delta$を使うと文字数の勘定は
		$\nu=\sum_{a\in A}\delta(a\otimes a^t)$と書くことができる。
		実直に計算すると作用素の交換関係\eqref{eq:作用素の交換関係}が得られる。
		\begin{proof} %{
			\begin{enumerate}\setlength{\itemsep}{-1mm} %{
				\item 任意の$a_1,a_2\in A,\;w_1,w_2\in WA$に対して次の式が成り立つ。
				\begin{equation*}\begin{split} %{
					w_1^t a_1^t* a_2* w_2 &= (a_1* w_1)^t a_2* w_2 \\
					&= \jump{a_1* w_1=a_2* w_2} \\
					&= \jump{a_1=a_2}\jump{w_1 = w_2} \\
				\end{split}\end{equation*} %}
				\item 任意の$a_1,a_2,b_1,b_2,\dots,b_m\in A$に対して次の式が成り立つ。
				\begin{equation*}\begin{split} %{
					& a_1^t\sqcup a_2\sqcup [b_1b_2\cdots b_m] \\
					&= a_1^t\sqcup \bigl([a_2b_1b_2\cdots b_m] 
						+ [b_1a_2b_2\cdots b_m] + \cdots + [b_1b_2\cdots b_ma_2]\bigr)\\
					&= (m+1)\jump{a_1=a_2}[b_1b_2\cdots b_m] \\
					&\;+ \jump{a_1=b_1}\bigl([a_2b_2b_3\cdots b_m] 
						+ [a_2b_2b_3\cdots b_m] + \cdots + [b_2\cdots b_ma_2]\bigr)\\
					&\;+ \jump{a_1=b_2}\bigl([a_2b_1b_3\cdots b_m] 
						+ [b_1a_2b_3\cdots b_m] + \cdots + [b_1b_3\cdots b_ma_2]\bigr)\\
					&\;+ \cdots \\
					&\;+ \jump{a_1=b_m}\bigl([a_2b_1b_2\cdots b_{m-1}] 
						+ [b_1a_2b_2\cdots b_{m-1}] + \cdots + [b_1b_2\cdots b_{m-1}a_2]\bigr)\\
					&= (m+1)\jump{a_1=a_2}[b_1b_2\cdots b_m] \\
					&\;+ \jump{a_1=b_1}[a_2b_2b_3\cdots b_m]
						+ \jump{a_1=b_2}[b_1a_2b_3\cdots b_m] + \cdots + \jump{a_1=b_m}[b_1b_2\cdots b_{m-1}a_2] \\
					&\;+ a_2\sqcup a_1^t\sqcup [b_1b_2\cdots b_m] \\
					&= \Bigl((m+1)\jump{a_1=a_2} +\delta(a_2\otimes a_1^t)	
						+ a_2\sqcup a_1^t\sqcup\Bigr) [b_1b_2\cdots b_m] \\
				\end{split}\end{equation*} %}
				\item 任意の$a_1,a_2,b_1,b_2,\dots,b_m\in A$に対して次の式が成り立つ。
				\begin{equation*}\begin{split} %{
					& a_1^t* a_2\sqcup [b_1b_2\cdots b_m] \\
					&= a_1^t* \bigl([a_2b_1b_2\cdots b_m] 
						+ [b_1a_2b_2\cdots b_m] + \cdots + [b_1b_2\cdots b_ma_2]\bigr)\\
					&= \jump{a_1=a_2}[b_1b_2\cdots b_m]
						+ \jump{a_1=b_1}\bigl([a_2b_2\cdots b_m]+[b_2a_2b_3\cdots b_m]
						+ \cdots + [b_2b_3\cdots b_ma_2]\bigr) \\
					&= \bigl(\jump{a_1=a_2} + a_2\sqcup a_1^t*\bigr)[b_1b_2\cdots b_m] \\
				\end{split}\end{equation*} %}
				\item 式$a_1^t*a_2\sqcup=\jump{a_1=a_2}+a_2\sqcup a_1^t*$の転置を
				とれば、$a_2^t\sqcup a_1*=\jump{a_1=a_2}+a_1*a_2^t\sqcup$となる。
				具体的に計算すると以下のようになる。
				任意の$a_1,a_2,b_1,b_2,\dots,b_m\in A$に対して次の式が成り立つ。
				\begin{equation*}\begin{split} %{
					& a_1^t\sqcup a_2* [b_1b_2\cdots b_m] \\
					&= a_1^t\sqcup [a_2b_1b_2\cdots b_m] \\
					&= (\jump{a_1=a_2} + a_2* a_1^t\sqcup) [b_1b_2\cdots b_m] \\
				\end{split}\end{equation*} %}
			\end{enumerate} %}
		\end{proof} %}
		
		until

		定義\ref{def:シャッフル積}から通常のシャッフル積の定義を導く。
		\begin{proposition}[シャッフル余積の性質]\label{prop:シャッフル余積の性質} %{
			シャッフル余積$\Delta_\sqcup$は次の式を満たす。
			\begin{itemize}\setlength{\itemsep}{-1mm} %{
				\item 任意の$a\in A,\;w\in WA$に対して次の式が成り立つ。
				\begin{equation}\label{eq:シャッフル余積の性質その一}\begin{split} %{
					\Delta_\sqcup(a*w) &= 1_W\otimes (a*w) 
						+ (a\otimes 1_W)*(\Delta_{\sqcup}w) \\
				\end{split}\end{equation} %}
			\end{itemize} %}
		\end{proposition} %prop:シャッフル余積の性質}
		\begin{proof} %{
			\begin{itemize}\setlength{\itemsep}{-1mm} %{
				\item 式\eqref{eq:シャッフル余積の性質その一}の証明。
				任意の$a_1,a_2,\dots,a_m\in A$に対して次の式が成り立つ。
				\begin{equation*}\begin{split} %{
						& \Delta_\sqcup[a_1a_2\cdots a_m] \\
						& = 1_W\otimes [a_1a_2\cdots a_m]
						+ [a_1]\otimes [a_2\cdots a_m] + \cdots 
						+ [a_1a_2\cdots a_m]\otimes 1_W 
						\\
						& = 1_W\otimes [a_1a_2\cdots a_m] 
						+ (a_1\otimes 1_W)*(\Delta_\sqcup [a_2\cdots a_m])
						\\
						& \quad\text{for all }a_1,a_2,\dots,a_m\in A
				\end{split}\end{equation*} %}
				したがって、$a=a_1$と$w=[a_2\cdots a_m]$おくと命題の式が成り立つこと
				がわかる。
			\end{itemize} %}
		\end{proof} %}
		\begin{proposition}[通常のシャッフル積の定義]\label{prop:通常のシャッフル積の定義} %{
			シャッフル積$m_\sqcup$は次の式を満たす。
			\begin{equation*}\begin{split} %{
				(a_1*w_1)\sqcup(a_2*w_2) &= a_1*\bigl(w_1\sqcup (a_2*w_2)\bigr)
					+ a_2*\bigl((a_1*w_1)\sqcup w_2\bigr)
			\end{split}\end{equation*} %}
			シャッフル積は通常この形で定義される。
		\end{proposition} %prop:通常のシャッフル積の定義}
		\begin{proof} %{
			シャッフル積の定義\ref{def:シャッフル積}から次の式が成り立つ。
			\begin{equation}\label{eq:シャッフル積の性質その一}\begin{split} %{
				(a_1*w_1)\sqcup w 
				& = (\Delta_{\sqcup(1)}w)*a_1*\bigl(w_1\sqcup(\Delta_{\sqcup(2)}w)\bigr) \\
				& \quad\text{for all }a_1\in A,\; w,w_1\in WA
			\end{split}\end{equation} %}
			この式に式\eqref{eq:シャッフル余積の性質その一}を用いると、次のよう
			になり、命題が証明される。
			\begin{equation*}\begin{split} %{
				& (a_1*w_1)\sqcup (a_2*w_2) \\
				& = \bigl(\Delta_{\sqcup(1)}(a_2*w_2)\bigr)*a_1
					*\Bigl(w_1\sqcup\bigl(\Delta_{\sqcup(2)}(a_2*w_2)\bigr)\Bigr) \\
				& \quad\lcomment{式\eqref{eq:シャッフル積の性質その一}} \\
				& = 1_W*a_1*\bigl(w_1\sqcup(a_2*w_2)\bigr)
					+ a_2*(\Delta_{\sqcup(1)}w_2)*a_1
					*\bigl(w_1\sqcup(\Delta_{\sqcup(2)}w_2)\bigr) \\
				& \quad\lcomment{式\eqref{eq:シャッフル余積の性質その一}} \\
				& = a_1*\bigl(w_1\sqcup(a_2*w_2)\bigr)
					+ a_2*\bigl((a_1*w_1)\sqcup w_2\bigr) \\
				& \quad\lcomment{和の二項目に式\eqref{eq:シャッフル積の性質その一}} \\
			\end{split}\end{equation*} %}
		\end{proof} %}

		任意の$w_1,w_2,w\in WA$に対して次の式が成り立つから、
		\begin{equation*}\begin{split} %{
			\xymatrix@R-1pc@C-1pc{
				w^t(w_1*w_2) \ar@{=}[r] \ar@{=}[d]
					& m_\myspace(\Delta_\sqcup w^t)(w_1\otimes w_2)\ar@{=}[d] \\
				(w_1^t*w_2^t)w & m_\myspace(w_1^t\otimes w_2^t)(\Delta_\sqcup w) \\
			},\quad \xymatrix@R-1pc@C-1pc{
				m_\myspace(w_1^t\otimes w_2^t)(\Delta_*w) \ar@{=}[r] \ar@{=}[d]
					& (w_1^t\sqcup w_2^t)w \ar@{=}[d] \\
				m_\myspace(\Delta_*w^t)(w_1\otimes w_2) & w^t(w_1\sqcup w_2) \\
			}
		\end{split}\end{equation*} %}
		可換図\eqref{eq:シャッフル余積の可換図その二}と
		\eqref{eq:シャッフル積の可換図その一}の$*$と$\sqcup$の役割を入れ替えた
		次の可換図が成り立つ。
		\begin{equation}\label{eq:シャッフル積とシャッフル余積の可換図}\begin{split} %{
			\xymatrix{
				RWA\otimes RWA \ar[r]^{m_\sqcup} \ar[d]^{\Delta_* f} 
				& RWA \ar[d]^{f} \\
				R\otimes R \ar[r]^{m_\myspace} & R \\
			},\quad \xymatrix{
				RWA\otimes RWA \ar[d]^{f\otimes g} 
				& RWA \ar[l]_{\Delta_\sqcup} \ar[d]^{f* g}\\
				R\otimes R \ar[r]^{m_\myspace} & R \\
			}
		\end{split}\end{equation} %}
	%s2:内積とシャッフル積}

	\subsection{半代数準同型とKleeneスター}\label{s2:半代数準同型とKleeneスター} %{
		$RWA^t$の部分空間で半代数準同型となる部分空間を考える。
		$m_\square$を$RWA$の積とし、$RWA^t$の元で次の図が可換になる元で張られる
		部分空間を$\homset_\square(RWA,R)$とする。
		\begin{equation}\label{eq:半モジュール準同型の可換図}
			\xymatrix{
				RWA\otimes RWA \ar[d]^{x\otimes x} \ar[r]^{m_\square} 
					& RWA \ar[d]^{x} \\
				R\otimes R \ar[r]^{m_\myspace} & R \\
			}\quad\text{for all }x\in \homset_\square(RWA,R)
		\end{equation}
		自由モノイドの普遍性により、任意の$x\in RA^t\simeq \mapset(A,R)$に対して
		次の図を可換にする$k_*x\in \homset_*(RWA,R)$が一意に定まり、
		\begin{equation*}\begin{split} %{
			\xymatrix{
				A \ar[dr]_{x} \ar[r]^{i_W} & WA \ar@{.>}[d]^{k_*x} \\
				& R \\
			} \\
		\end{split}\end{equation*} %}
		写像$k_*$は集合同型$k_*:RA^t\simeq \homset_*(RWA,R)$となる。
		写像$k_*$は任意の$x\in RA^t$に対して次のようになる。
		\begin{equation*}\begin{split} %{
			(k_*x)1_W &= 1 \\
			(k_*x)[a_1a_2\cdots a_m] &= (xa_1)(xa_2)\cdots(xa_m)
				\quad\text{for all }a_1,a_2,\dots,a_m\in A \\
		\end{split}\end{equation*} %}
		したがって、任意の$x\in RA^t$に対して次のように書ける。
		\begin{equation*}\begin{split} %{
			k_*f &= \sum_{n\in\mybf{N}}(i_Wf)^{*n} \\
			&= 1_W^t + i_Wf + (i_Wf)*(i_Wf) + \cdots \\
		\end{split}\end{equation*} %}
		写像$k_*$はKleeneスターと呼ばれる演算である。つまり、$x\in RA^t$に対して
		Kleeneスター$k_*x$をとれば、それは$RWA$から$R$への半モジュール準同型
		となる。写像$k_*$は線形でないことに注意する。
		\begin{equation*}\begin{split} %{
			k_*(x_1+x_2) \neq k_*x_1+ k_*x_2 \quad\text{in generally }x_1,x_2\in RA^t \\
			k_*(rx) \neq rk_*x \quad\text{in generally }r\in R,\;x\in RA^t \\
		\end{split}\end{equation*} %}
		Kleeneスターを少し一般化して定義しておく。
		\begin{definition}[Kleeneスター]\label{def:Kleeneスター} %{
			$m_\square$を$RWA$の積、$1_\square$を積$m_\square$の単位元とする。
			次の写像$\kappa_\square$を$m_\square$のKleeneスターという。
			\begin{equation*}\begin{split} %{
				\kappa_\square: RWA &\to RWA \\
				f &\mapsto \sum_{n\in\mybf{N}}x^{\square n}
					= 1_\square + f + x\square f + \cdots
					\quad\text{for all }f\in RWA
			\end{split}\end{equation*} %}
		\end{definition} %def:Kleeneスター}
		Kleeneスターを使って、$RA^t$と$\homset_*(RWA,R)$の集合同型を
		命題の形で書いておく。
		\begin{proposition}[群と環の関係]\label{prop:群と環の関係} %{
			次の写像$k_*$は集合同型となる。
			\begin{equation*}\begin{split} %{
				k_*: RA^t &\to \homset_*(RWA,R) \\
				x &\mapsto \kappa_*i_W x \quad\text{for all }x\in RA^t \\
			\end{split}\end{equation*} %}
		\end{proposition} %prop:群と環の関係}
		標準埋め込み$i_W$による同一視によって、任意の$x\in RA^t$に対して
		$\kappa_*x:=k_*x$と書く。

		Kleeneスターを使った計算でよく使う式を命題の形で書いておく。
		\begin{proposition}[Kleeneスターの性質]\label{prop:Kleeneスターの性質} %{
			\begin{enumerate}\setlength{\itemsep}{-1mm} %{
				\item 任意の$f\in RWA$に対して次の式が成り立つ。
				\begin{equation}\label{eq:Kleeneスターの性質その一}\begin{split} %{
					\kappa_\square f = 1_\square + f\square(\kappa_\square f)
				\end{split}\end{equation} %}
			\end{enumerate} %}
		\end{proposition} %prop:Kleeneスターの性質}
		\begin{proof} %{
			\begin{enumerate}\setlength{\itemsep}{-1mm} %{
				\item 任意の$f\in RWA$に対して次のようになり、命題の式が成り立つ
				ことがわかる。
				\begin{equation*}\begin{split} %{
					\kappa_\square f &= 1_\square + f + f\square f + \cdots \\
					&= 1_\square + f\square(1_\square + f + \cdots) \\
					&= 1_\square + f\square(\kappa_\square f) \\
				\end{split}\end{equation*} %}
			\end{enumerate} %}
		\end{proof} %}
		$\homset_*(RWA,R)$を定義する可換図\eqref{eq:半モジュール準同型の可換図}は
		シャッフル余積$\Delta_\sqcup$を定義する可換図
		\eqref{eq:シャッフル余積の可換図その二}によく似ている。
		そこで、$\homset_*(RWA,R)$の元に対するシャッフル余積は群的な余積になること
		が予想される。式で書くと次のような予想である。
		\begin{equation}\label{eq:Kleeneスターのシャッフル余積が群的になること}\begin{split} %{
			\Delta_\sqcup x = x\otimes x \quad\text{for all }x\in \homset(RWA,R)
		\end{split}\end{equation} %}
		この予想を$\kappa_*RA$に対して確かめてみる。
		任意の$f\in RA$に対して次の式が成り立つ。
		\begin{equation*}\begin{array}{ll} %{
			\Delta_\sqcup\kappa_*f \\
			= \Delta_\sqcup\bigl(1_W+f*(\kappa_*f)\bigr)
				&\quad\lcomment{式\eqref{eq:Kleeneスターの性質その一}} \\
			= 1_W\otimes 1_W + \Delta_\sqcup\bigl(f*(\kappa_*f)\bigr)
				&\quad\lcomment{$\Delta_\sqcup$の定義} \\
			= 1_W\otimes 1_W + 1_W\otimes \bigl(f*(\kappa_*f)\bigr) 
				+ (f\otimes 1_W)*(\Delta_\sqcup\kappa_*f)
				&\quad\lcomment{式\eqref{eq:シャッフル余積の性質その一}} \\
			= 1_W\otimes(\kappa_*f) 
				+ (f\otimes 1_W)*(\Delta_\sqcup\kappa_*f)
				&\quad\lcomment{式\eqref{eq:Kleeneスターの性質その一}} \\
			= (1_W+f)\otimes(\kappa_*f) 
				+ (f^{*2}\otimes 1_W)*(\Delta_\sqcup\kappa_*f)
				&\quad\lcomment{摂動} \\
			= (\sum_{k=0}^nf^{*k})\otimes(\kappa_*f)
				+ (f^{*(n+1)}\otimes 1_W)*(\Delta_\sqcup\kappa_*f)
				&\quad\lcomment{摂動} \\
		\end{array}\end{equation*} %}
		したがって、摂動が収束するための条件
		\begin{equation}\label{eq:Kleeneスターの余積の摂動が収束するための条件}\begin{split} %{
			(f^{*(n+1)}\otimes 1_W)*(\Delta_\sqcup\kappa_*f)
				\xrightarrow{n\to\infty}0
				\quad\text{for }f\in RA
		\end{split}\end{equation} %}
		を仮定すると、$\Delta_\sqcup\kappa_*f=(\kappa_*f)\otimes(\kappa_*f)$
		が成り立つ。摂動の収束条件
		\eqref{eq:Kleeneスターの余積の摂動が収束するための条件}が成り立たない場合
		でも、文字数が有限の範囲で、任意の$f\in RA$に対して
		式$\Delta_\sqcup\kappa_*f=(\kappa_*f)\otimes(\kappa_*f)$が成り立つ。
		つまり、収束条件\eqref{eq:Kleeneスターの余積の摂動が収束するための条件}が
		成立するしないに関わらず、任意の\underline{有限文字数}の$w_1,w_2\in WA$
		と任意の$x\in RA^t$に対して次の式が成り立つ。
		\begin{equation*}\begin{split} %{
			(\kappa_*x)(w_1*w_2) 
			&= (\Delta_\sqcup\kappa_*x)(w_1\otimes w_2) \\
			&= \bigl((\kappa_*x)\otimes(\kappa_*x)\bigr)(w_1\otimes w_2) \\
			&= \bigl((\kappa_*x)w_1\bigr)\otimes\bigl((\kappa_*x)w_2\bigr) \\
		\end{split}\end{equation*} %}
		文字数が無限の単語に対する作用が含まれる場合にのみ、
		収束条件\eqref{eq:Kleeneスターの余積の摂動が収束するための条件}
		を考慮する必要がある。この結果を命題の形でまとめておく。

		\begin{proposition}[文字のKleeneスターに対するシャッフル余積]\label{prop:文字のKleeneスターに対するシャッフル余積} %{
			任意の$f\in RA$に対して次の式が文字数が有限の範囲で成り立つ。
			\begin{equation*}\begin{split} %{
				\Delta_\sqcup\kappa_*f = (\kappa_*f)\otimes (\kappa_*f)
			\end{split}\end{equation*} %}
		\end{proposition} %prop:文字のKleeneスターに対するシャッフル余積}

		一般に、$RWA^t$の文字数が無限の単語の項を含む元でも、$RWA$の文字数が
		有限の単語に作用する場合は収束性の問題は生じないが、文字数が無限の単語に
		作用する場合は収束性を考慮する必要がある。
		文字数が無限の単語に対する作用が含まれる場合の例として、
		$r\in R,\;a\in A$として次のようなものがある。
		\begin{equation*}\begin{split} %{
			\bigl(\kappa_*(ra^t)\bigr)(\kappa_*a)
			&= \sum_{n\in\mybf{N}}r^n \\
		\end{split}\end{equation*} %}
		この場合、半環$R$が自然数の場合は$r\neq0$で発散、
		有理数/実数/複素数の場合は$1\le\zettai{r}$で発散する。
		\begin{note}[文字数が無限大のイメージ]\label{note:文字数が無限大のイメージ} %{
			文字として、円$S^1$から複素数$\mybf{C}$への写像
			$\set{u:\sigma\mapsto e^{i\sigma}}$を考えると、文字数が無限大の単語は
			は$\lim_{n\to\infty}u^n$に対応し、振動数が無限大の領域に対応する。
			量子力学でエネルギーの固有状態を摂動によって計算するとき現れる紫外発散
			は振動数が無限大の領域での積分に起因するものである。紫外発散からの
			類推で、完全系$\sum_{w\in WA}w\otimes w^t$を使うような場合、
			文字数が有限の範囲で成り立つ命題
			\ref{prop:文字のKleeneスターに対するシャッフル余積}（=古典論）
			が成り立たなくなるかもしれない。
		\end{note} %note:文字数が無限大のイメージ}

		$f\in RWA,\;x\in RA^t$を次のようにおくと、
		\begin{equation*}\begin{array}{rll} %{
			f &= \sum_{w\in WA}f_ww, &f_w\in R \quad\text{for all }w\in WA \\
			x &= \sum_{a\in A}x_aa^t, &x_a\in R \quad\text{for all }a\in A \\
		\end{array}\end{equation*} %}
		$(\kappa_*x)f$は次のようになる。
		\begin{equation}\label{eq:内積が関数になる式}\begin{split} %{
			(\kappa_*x)f &= f_{1_W} + \sum_{a\in A}f_{a}x_a
				+ \sum_{a_1,a_2\in A}f_{a_1a_2}x_{a_1}x_{a_2} + \cdots \\
		\end{split}\end{equation} %}
		したがって、$(\kappa_*x)f$は$x_A=\set{x_a\in R}_{a\in A}$を不定変数とする
		$R$係数多項式としてみることができる。$x_A=\set{x_a\in R}_{a\in A}$を
		不定変数とする$R$係数多項式全体の作る集合を$R[x_A]$と書く。
		式\eqref{eq:内積が関数になる式}の形から、任意の$g\in R[x_A]$に対して
		$g=(\kappa_*x)f$となる$f\in RWA,\;x\in RA^t$が存在することがわかる。
		つまり、$R$線形写像$(\kappa_*x):RWA\to R[x_A]$は$\myop{onto}$になる。
		$(R,m_\myspace)$は可換で、$(RWA,m_*)$は非可換だから、$\zettai{A}\le 1$の
		時のみ$(\kappa_*x)$は$1:1$となる可能性がある。
		そして、$x=\sum_{a\in A}x_aa^t\in RA^t$とすると、
		任意の$a\in A$と任意の文字数が有限な$f\in RWA$に対して次の式が成り立つ。
		\begin{equation}\label{eq:コヒーレント状態}\begin{array}{lll} %{
			(\kappa_*x)(a*f) &= x_a\bigl((\kappa_*x)f\bigr) &= (\kappa_*x)(f*a) \\
			\bigr(a^t\sqcup(\kappa_*x)\bigr)f
				&= \frac{\partial}{\partial x_a}\bigl((\kappa_*x)f\bigr)
				&= \bigl((\kappa_*x)\sqcup a^t\bigr)f \\
		\end{array}\end{equation} %}
		\begin{proof} %{
			任意の$a\in A$と任意の文字数が有限な$f\in RWA$に対して次の式が成り立ち、
			\begin{equation*}\begin{array}{lll} %{
				(\kappa_*x)(a*f)
				&= m_\myspace(\Delta_\sqcup\kappa_*x)(a\otimes f) 
					&\quad\lcomment{可換図\eqref{eq:シャッフル余積の可換図その二}} \\
				&= m_\myspace(\kappa_*x\otimes \kappa_*x)(a\otimes f) 
					&\quad\lcomment{命題\ref{prop:文字のKleeneスターに対するシャッフル余積}} \\
				&= x_a(\kappa_*x)f
					&\quad\lcomment{$(\kappa_*x)a=x_a$} \\
			\end{array}\end{equation*} %}
			$R$が可換だから命題の一つ目の式が成り立つことがわかる。

			任意の$a\in A$と任意の$f\in RWA$に対して次の式が成り立つが、
			\begin{equation*}\begin{array}{lll} %{
				\bigr(a^t\sqcup(\kappa_*x)\bigr)f
				&= m_\myspace\bigl(a^t\otimes (\kappa_*x)\bigr)\Delta_*f 
					&\quad\lcomment{可換図\eqref{eq:シャッフル積とシャッフル余積の可換図}} \\
			\end{array}\end{equation*} %}
			任意の$a_1,a_2,\dots,a_m\in A$に対して次の式が成り立つから、
			\begin{equation*}\begin{split} %{
				(a^t\otimes \myid)(\Delta_\sqcup[a_1a_2\cdots a_m])
				&= \jump{a=a_1}1_W\otimes [a_2\cdots a_m] \\
				&\;+ \jump{a=a_2}1_W\otimes [a_1a_3\cdots a_m] \\
				&\;+ \cdots \\
				&\;+ \jump{a=a_m}1_W\otimes [a_1a_2\cdots a_{m-1}] \\
			\end{split}\end{equation*} %}
			任意の$g^t\in RWA^t$に対して次の式が成り立ち、
			\begin{equation*}\begin{split} %{
				(a^t\sqcup g^t)[a_1a_2\cdots a_m]
				&= \jump{a=a_1}g^t[a_2\cdots a_m] \\
				&\;+ \jump{a=a_2}g^t[a_1a_3\cdots a_m] \\
				&\;+ \cdots \\
				&\;+ \jump{a=a_m}g^t[a_1a_2\cdots a_{m-1}] \\
			\end{split}\end{equation*} %}
			$x=\sum_{a\in A}x_aa^t\in RA^t$とすると、次の式が成り立ち、
			\begin{equation*}\begin{split} %{
				(a^t\sqcup \kappa_*x)[a_1a_2\cdots a_m]
				&= \jump{a=a_1}x_{a_2}\cdots x_{a_m} \\
				&\;+ \jump{a=a_2}x_{a_1}x_{a_3}\cdots x_{a_m} \\
				&\;+ \cdots \\
				&\;+ \jump{a=a_m}x_{a_1}x_{a_2}\cdots x_{a_{m-1}} \\
				&= \frac{\partial}{\partial x_a}x_{a_1}x_{a_2}\cdots x_{a_m} \\
				&= \frac{\partial}{\partial x_a}\bigl((\kappa_*x)[a_1a_2\cdots a_m]\bigr) \\
			\end{split}\end{equation*} %}
			$m_\sqcup$が可換だから、命題の二つ目の式が成り立つ。
		\end{proof} %}
		式\eqref{eq:コヒーレント状態}は、文字$x\in RA^t$のKleeneスター
		$\kappa_*x$が量子力学でのFock空間におけるコヒーレント状態に相当する
		ことを示している。
		以上の事柄を定義と命題の形でまとめておく。
		\begin{definition}[多項式への写像]\label{def:多項式への写像} %{
			集合$A$で添え字付けられた$R$の不定変数$x_A=\set{x_a\in R}_{a\in A}$
			に対して、$R$線形写像$\lambda_*$を次のように定義する。
			\begin{equation*}\begin{split} %{
				\lambda_*: RWA &\to R[x_A] \\
				f &\mapsto (\kappa_*x)f \quad\text{for all finite }f\in RWA \\
				&\quad\text{where } x=\sum_{a\in A}x_aa^t\in RA^t \\
			\end{split}\end{equation*} %}
		\end{definition} %def:多項式への写像}
		\begin{proposition}[多項式の上への写像]\label{prop:多項式の上への写像} %{
			$\lambda_*$は$\myop{onto}$となる。
		\end{proposition} %prop:多項式の上への写像}
		\begin{proposition}[コヒーレント状態]\label{prop:コヒーレント状態} %{
			任意の$a\in A$と任意の文字数が有限な$f\in RWA$に対して次の式が
			成り立つ。
			\begin{equation*}\begin{array}{lll} %{
				(\kappa_*x)(a*f) &= x_a\bigl((\kappa_*x)f\bigr) &= (\kappa_*x)(f*a) \\
				\bigr(a^t\sqcup(\kappa_*x)\bigr)f
					&= \frac{\partial}{\partial x_a}\bigl((\kappa_*x)f\bigr)
					&= \bigl((\kappa_*x)\sqcup a^t\bigr)f \\
			\end{array}\end{equation*} %}
		\end{proposition} %prop:コヒーレント状態}
	%s2:半代数準同型とKleeneスター}

	\subsection{内積と交換関係}\label{s2:内積と交換関係} %{
		ベクトル空間の転置$(Mv_1)^tv_2=v_1^tM^tv_2$に倣い、
		$R$線形写像$\myhere\rhd_\square:RA^t\to \myop{end}(RWA)$を、
		任意の$w,w_1,w_2\in WA$に対して次の式が成り立つように定義する。
		\begin{equation}\label{eq:転置の定義式}\begin{array}{cc} %{
			(w_1^t* w_2^t)w = w_2^t(w_1^t\rhd_* w)
				, & (w_1^t\sqcup w_2^t)w = w_2^t(w_1^t\rhd_\sqcup w)
		\end{array}\end{equation} %}
		関係式$(w_1^t* w_2^t)w=m_\myspace(w_1^t\otimes w_2^t)\Delta_\sqcup w$
		と$(w_1^t\sqcup w_2^t)w_2=m_\myspace(w_1^t\otimes w_2^t)\Delta_*w$
		を使うと、任意の$w,w_1,w_2\in WA$に対して次のように定義すれば、
		式\eqref{eq:転置の定義式}が成り立つことがわかる。
		\begin{equation*}\begin{array}{cc} %{
			w_1^t\rhd_* w_2 = m_\myspace(w_1^t\otimes \myid)(\Delta_\sqcup w_2)
			, & w_1^t\rhd_\sqcup w_2 = m_\myspace(w_1^t\otimes \myid)(\Delta_* w_2)
		\end{array}\end{equation*} %}
		特に、任意の$w\in WA$に対して$1_W^t\rhd_\square w=w$となり、
		$1_W^t\rhd_\square=\myid$となる。
		また、式\eqref{eq:転置の定義式}から、任意の$w_1,w_2,w_3\in WA$に対して
		次のようになり、
		\begin{equation*}\begin{split} %{
			w_3^t\bigl((w_1^t\square w_2^t)\rhd_\square w\bigr)
			= (w_1^t\square w_2^t\square w_3^t)w 
			= w_3^t(w_2^t\rhd_\square w_1^t\rhd_\square w)
		\end{split}\end{equation*} %}
		任意の$w_1,w_2\in WA$に対して次のようになる。
		\begin{equation*}\begin{split} %{
			(w_1^t\square w_2^t)\rhd_\square = w_2^t\rhd_\square w_1^t\rhd_\square
		\end{split}\end{equation*} %}
		したがって、写像$\myhere\rhd_\square$は逆順準同型
		$(RA^t,m_\square,1_W^t)\to(\myop{end}(RWA),\circ,\myid)$になることが
		わかる。ただし、$m_\sqcup$は可換なので、写像は$\myhere\rhd_\sqcup$
		は正順と逆順の違いはない。$\rhd_\square$の作用を文字を使って書いておく。
		任意の$a,a_1,a_2,\dots,a_m\in A$に対して、$a^t\rhd_*$の作用は
		\begin{equation*}\begin{split} %{
			a^t\rhd_* 1_W &= 0 \\
			a^t\rhd_* [a_1a_2\cdots a_m] &= \jump{a=a_1}[a_2\cdots a_m] \\
		\end{split}\end{equation*} %}
		となり、$a^t\rhd_\sqcup$の作用は
		\begin{equation*}\begin{split} %{
			a^t\rhd_\sqcup 1_W &= 0 \\
			a^t\rhd_\sqcup [a_1a_2\cdots a_m]
				&= \jump{a=a_1}[a_2\cdots a_m] \\
				&\;+ \jump{a=a_2}[a_1a_3\cdots a_m] \\
				&\;+ \cdots \\
				&\;+ \jump{a=a_m}[a_1a_2\cdots a_{m-1}] \\
		\end{split}\end{equation*} %}
		となる。記法が対称的になるように、任意の$a\in A,\;w\in WA$に対して
		\begin{equation*}\begin{split} %{
			a\rhd_*w &= [a]*w \\
			a\rhd_\sqcup w &= [a]\sqcup w
		\end{split}\end{equation*} %}
		と書くと、任意の$a_1,a_2,b_1,b_2,\cdots,b_m\in A$に対して
		次のようになる。
		\begin{equation*}\begin{split} %{
			a_1^t\rhd_*a_2\rhd_*[b_1b_2\cdots b_m] 
			&= a_1^t\rhd_*[a_2b_1b_2\cdots b_m] \\
			&= \jump{a_1=a_2}[b_1b_2\cdots b_m] \\
			%
			a_1^t\rhd_*a_2\rhd_\sqcup[b_1b_2\cdots b_m] 
			&= a_1^t\rhd_*\bigl([a_2b_1b_2\cdots b_m]+\cdots+[b_1b_2\cdots b_ma_2]\bigr) \\
			&= \bigl(\jump{a_1=a_2}+a_2\rhd_\sqcup a_1^t\rhd_*\bigr)[b_1b_2\cdots b_m] \\
			%
			a_1^t\rhd_\sqcup a_2\rhd_*[b_1b_2\cdots b_m] 
			&= a_1^t\rhd_\sqcup[a_2b_1b_2\cdots b_m] \\
			&= \bigl(\jump{a_1=a_2}+a_2\rhd_* a_1^t\rhd_*\bigr)[b_1b_2\cdots b_m] \\
			%
			a_1^t\rhd_\sqcup a_2\rhd_\sqcup[b_1b_2\cdots b_m]
			&= a_1^t\rhd_\sqcup\bigl([a_2b_1b_2\cdots b_m]+\cdots+[b_1b_2\cdots b_ma_2]\bigr) \\
			&= \bigl((m+1)\jump{a_1=a_2}+a_2\rhd_\sqcup a_1^t\rhd_\sqcup\bigr)[b_1b_2\cdots b_m] \\
		\end{split}\end{equation*} %}
		つまり、任意の$a_1,a_2\in A$に対して次のようになる。
		\begin{equation}\label{eq:シングルトンの交換関係}\begin{split} %{
			a_1^t\rhd_*a_2\rhd_* &= \jump{a_1=a_2} \\
			a_1^t\rhd_*a_2\rhd_\sqcup &= \jump{a_1=a_2}+a_2\rhd_\sqcup a_1^t\rhd_* \\
			a_1^t\rhd_\sqcup a_2\rhd_* &= \jump{a_1=a_2}+a_2\rhd_* a_1^t\rhd_* \\
			a_1^t\rhd_\sqcup a_2\rhd_\sqcup	&= (\nu+1)\jump{a_1=a_2}+a_2\rhd_\sqcup a_1^t\rhd_\sqcup \\
		\end{split}\end{equation} %}
		ここで、$\nu$は文字数を数える$R$線形写像で次のように定義される。
		\begin{equation*}\begin{split} %{
			\nu: RWA &\to RWA \\
				1_W &\mapsto 0 \\
				[a_1a_2\cdots a_m] &\mapsto m[a_1a_2\cdots a_m]
				\quad\text{for all }a_1,a_2,\dots,a_m\in A
		\end{split}\end{equation*} %}
		交換関係\eqref{eq:シングルトンの交換関係}にはWely代数によく似た構造が
		表われている。正準交換関係
		$[\alpha_1,\alpha_2^\dag]=\jump{\alpha_1=\alpha_2}$になるパターンは
		次の二通りになる。\\
		\begin{minipage}{0.5\hsize}
			\begin{center}\begin{tabular}{c|cc}
				& 作用素 & 可換性 \\ \hline
				消滅演算子 & $a^t\rhd_*$ & 非可換 \\
				生成演算子 & $a\rhd_\sqcup$ & 可換 \\
			\end{tabular}\end{center}
		\end{minipage}
		\begin{minipage}{0.5\hsize}
			\begin{center}\begin{tabular}{c|cc}
				& 作用素 & 可換性 \\ \hline
				消滅演算子 & $a^t\rhd_\sqcup$ & 可換 \\
				生成演算子 & $a\rhd_*$ & 非可換 \\
			\end{tabular}\end{center}
		\end{minipage}
		正準交換関係に似た交換関係
		$[\alpha_1,\alpha_2^\dag]=(\nu+1)\jump{\alpha_1=\alpha_2}$になる
		パターンに次のものがある。\\
		\begin{minipage}{0.5\hsize}
			\begin{center}\begin{tabular}{c|cc}
				& 作用素 & 可換性 \\ \hline
				消滅演算子 & $a^t\rhd_\sqcup$ & 可換 \\
				生成演算子 & $a\rhd_\sqcup$ & 可換 \\
			\end{tabular}\end{center}
		\end{minipage}

		ディラックのブラケット記法を用いて書き直してみる。
		$u_*$を積$m_*$と$m_\sqcup$の単位射$w\mapsto \jump{w=1_W}$とすると、
		任意の$a_1,a_2,\dots,a_m\in A,\;f\in RWA$に対して、
		$[a_1a_2\cdots a_m]^t$と$f$の内積は次のように書ける。
		\begin{equation*}\begin{split} %{
			[a_1a_2\cdots a_m]^t f &= u_*[a_1a_2\cdots a_m]^t\rhd_* f \\
			&= u_*a_m^t\rhd_*\cdots a_2^t\rhd_*a_1^t\rhd_* f \\
		\end{split}\end{equation*} %}
		したがって、次のようにブラケット記法に対応付ける。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $a\rhd_*$と$a^t\rhd_*$をそれぞれ$a$と$a^t$と省略して書き、
			\begin{equation*}\begin{split} %{
				a_1\rhd_*a_2\rhd_*\cdots a_m\rhd_* &\mapsto a_1a_2\cdots a_m \\
				a_1^t\rhd_*a_2^t\rhd_*\cdots a_m^t\rhd_* &\mapsto a_1^t a_2^t \cdots a_m^t \\
			\end{split}\end{equation*} %}
			\item 次のようにケットを対応させ、
			\begin{equation*}\begin{split} %{
				1_W &\mapsto \ket{} \\
				[a_1a_2\cdots a_m] &\mapsto a_1a_2\cdots a_m\ket{} \\
				&= a_1a_2\cdots a_{m-1}\ket{a_m} \\
				&\vdots \\
				&= a_1\ket{a_2\cdots a_m} \\
				&= \ket{a_1a_2\cdots a_m} \\
			\end{split}\end{equation*} %}
			\item 次のようにブラを対応させる。
			\begin{equation*}\begin{split} %{
				u_* &\mapsto \bra{} \\
				[a_1a_2\cdots a_m]^t 
				&\mapsto \bra{}a_m^t\cdots a_2^t a_1^t \\
				&= \bra{a_m}a_{m-1}^t\cdots a_2^t a_1^t \\
				&\vdots \\
				&= \bra{a_2\cdots a_m}a_1^t \\
				&= \bra{a_1a_2\cdots a_m} \\
			\end{split}\end{equation*} %}
		\end{itemize} %}
		すると、ブラとケットの直行関係は、任意の$w_1,w_2\in WA$に対して
		$\bra{w_1}\ket{w_2}=\jump{w_1=w_2}$となり、$A^t$のケットへの作用と
		$A$のブラへの作用は、任意の$a,a_1,a_2,\dots,a_m\in A$に対して
		次のようになり、
		\begin{equation*}\begin{split} %{
			a^t\ket{} &= 0 \\
			a^t\ket{a_1a_2\cdots a_m} &= \jump{a=a_1}\ket{a_2\cdots a_m} \\
			\bra{}a &= 0 \\
			\bra{a_1a_2\cdots a_m}a &= \jump{a=a_1}\bra{a_2\cdots a_m} \\
		\end{split}\end{equation*} %}
		$R$線形写像$\myhere^t$が、
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item ブラとケットに換えて、
			\item 演算子$a,a^t$の並び方と反転させて、
			\item 各演算子に$\myhere^t$をかけたものになる。
		\end{itemize} %}
		\begin{equation*}\begin{split} %{
			\bigl(a_1a_2\cdots a_mb_1^t b_2^t \cdots b_n^t \ket{f}\bigr)^t 
			 = \bra{f}b_1b_2\cdots b_na_m^t\cdots a_2^t a_1^t \\
			\quad\text{for all }a_1,a_2,\dots,a_m,b_1,b_2,\dots,b_n\in A
			,\; f\in RWA
		\end{split}\end{equation*} %}
		テンソル積の記号$\otimes$は省略して、テンソル積の内積を次のように
		定義する。
		\begin{equation*}\begin{split} %{
			\bra{f}\ket{f_1}\ket{f_2}\cdots\ket{f_m}
			&= \ket{f_2}\cdots\ket{f_m}\braket{f|f_1} \\
			\bra{f_m}\cdots\bra{f_2}\bra{f_1}\ket{f}
			&= \braket{f_1|f}\bra{f_m}\cdots\bra{f_2} \\
			&\quad\text{for all }f,f_1,f_2,\dots,f_m\in RWA
		\end{split}\end{equation*} %}
		ケットの積$m_*$を$R$線形写像として次のように定義する。
		\begin{equation*}\begin{split} %{
			m_*\ket{a_1a_2\cdots a_m}\ket{b_1b_2\cdots b_n}
			= \ket{a_1a_2\cdots a_mb_1b_2\cdots b_n} \\
			\quad\text{for all }a_1,a_2,\dots,a_m,b_1,b_2,\dots,b_n\in A
		\end{split}\end{equation*} %}
		すると、$m_*$のブラへの作用は次のようになる。
		\begin{equation*}\begin{split} %{
			\bra{a_1a_2\cdots a_m}m_*
			&= \bra{a_1a_2\cdots a_m}\bra{} \\
			&\;+ \bra{a_2\cdots a_m}\bra{a_1} \\
			&\;+ \cdots \\
			&\;+ \bra{}\bra{a_1a_2\cdots a_m} \\
			&\quad\text{for all }a_1,a_2,\dots,a_m\in A
		\end{split}\end{equation*} %}
		ケットの余積$\Delta_*$を$R$線形写像として次のように定義する。
		\begin{equation*}\begin{split} %{
			\Delta_*\ket{a_1a_2\cdots a_m}
			&= \bigl(\Delta_*\ket{a_1}\bigr) * \bigl(\Delta_*\ket{a_2}\bigr)
				* \cdots * \bigl(\Delta_*\ket{a_m}\bigr) \\
			\Delta_*\ket{a} &= \ket{}\ket{a} + \ket{a}\ket{} \\
			\Delta_*\ket{} &= \ket{}\ket{} \\
			&\quad\text{for all }a,a_1,a_2,\cdots a_m\in A
		\end{split}\end{equation*} %}
		すると、$\Delta_*$のブラへの作用は次のようになる。
		\begin{equation*}\begin{split} %{
			\bra{a_1a_2\cdots a_m}\bra{w}\Delta_*
				&= \bra{w_1a_1w_2a_2\cdots w_ma_mw_{m+1}} \\
			\bra{w_k} &= \bra{w}m_{*(1)}m_{*(2)}^{k-1} \quad\text{for all }k=1,\dots,m\\
			\bra{w_{m+1}} &= \bra{w}m_{*(2)}^m \\
			&\quad\text{for all }a_1,a_2,\dots,a_m\in A,\;w\in WA
		\end{split}\end{equation*} %}
		シャッフル積とシャッフル余積は、文字列の連結とその余積の転置として
		得られる。
	%s2:内積と交換関係}
%s1:文字列とその双対空間}

\section{課題}\label{s1:課題} %{
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 式\ref{eq:シャッフル余積の性質その一}とBrzozowski微分は
		よく似ている。
		$R$双線形写像$\myop{pop}_L$（左ポップ）を次のように定義し、
		\begin{equation*}\begin{split} %{
			\myop{pop}_L: RWA &\to RA\otimes RWA \\
			1_W &\mapsto 0 \\
			[a_1a_2\cdots a_m] &\mapsto a_1\otimes [a_2\cdots a_m]
			\quad\text{for all }a_1,a_2,\dots,a_m\in A
		\end{split}\end{equation*} %}
		$R$線形写像$u_L$（左単位テンソル積）を次のように定義する。
		\begin{equation*}\begin{split} %{
			u_L: RWA &\to RWA \\
			w &\mapsto 1_W\otimes w \quad\text{for all }w\in WA
		\end{split}\end{equation*} %}
		すると、式\ref{eq:シャッフル余積の性質その一}の式は前置記法のみで
		次のように書ける。
		\begin{equation*}\begin{split} %{
			\Delta_\sqcup = u_L 
			+ (\beta_*\otimes \myid)(\myid\otimes \Delta_\sqcup)\myop{pop}_L
		\end{split}\end{equation*} %}
		単語$w=[a_1a_2\cdots a_m]$に対して適用すると次のような漸化式になる。
		\begin{equation*}\begin{array}{lll} %{
			\Delta_\sqcup w_0 
			& = u_Lw_0 + (a_1\otimes 1_W) * (\Delta_\sqcup w_1),
			& a_1\otimes w_1 = \myop{pop}_Lw_0 \\
			%
			\Delta_\sqcup w_1
			& = u_Lw_1 + (a_2\otimes 1_W) * (\Delta_\sqcup w_2),
			& a_2\otimes w_2 = \myop{pop}_Lw_1 \\
			%
			& \vdots \\
			%
			\Delta_\sqcup w_{m-1} 
			& = u_Lw_{m-1} + (a_m\otimes 1_W) * (\Delta_\sqcup w_m),
			& a_m\otimes w_m = \myop{pop}_Lw_{m-1} \\
			%
			\Delta_\sqcup w_m & = u_Lw_m & 0 = \myop{pop}_Lw_m \\
		\end{array}\end{equation*} %}
		$R$線形作用$RA\otimes RWA\to RWA$
		\begin{equation*}\begin{split} %{
			a\rhd_L w = ([a]^t\otimes \myid)\Delta_\sqcup w
		\end{split}\end{equation*} %}
		で考えた方が簡潔になりそうだ。
		%
		\item バックアップ\\
		作用素の交換関係\eqref{eq:作用素の交換関係}の中で、代数的な双対の関係
		にある作用素の交換関係が正準交換関係
		$\alpha\alpha^\dag-\alpha^\dag\alpha=1$になっている。
		正準交換関係が現れたそもそもの原因は、積$m_*$に双対な余積$\Delta_*$を
		$a\in A$に対して$\Delta_*[a]=[a]\otimes 1_W+1_W\otimes [a]$と定義したこと
		にある。$\Delta_*[a]$の定義と作用素の交換関係の関係を調べてみる。
		三つ目の式と四つ目の式は互いに転置をとったものだから、四つ目の式
		\begin{equation}\label{eq:調べる交換関係}\begin{split} %{
			a_1^t\sqcup a_2* &= \jump{a_1=a_2} + a_2* a_1^t\sqcup \\
		\end{split}\end{equation} %}
		について調べれば十分である。代数的な双対の関係
		\begin{equation*}\begin{split} %{
			\Delta_*(w_1* w_2) = (\Delta_*w_1)*(\Delta_*w_2)
			\quad\text{for all }w_1,w_2\in WA
		\end{split}\end{equation*} %}
		の内積をとると次の式が得られる。
		\begin{equation*}\begin{split} %{
			(w_1\sqcup w_2)^t(w_3* w_4) 
			&= \bigl((\Delta_\sqcup w_1)\otimes(\Delta_\sqcup w_2)\bigr)^t
				\sigma_{23}\bigl((\Delta_*w_3)\otimes(\Delta_*w_4)\bigr) \\
			& \quad\text{for all }w_1,w_2,w_3,w_4\in WA
		\end{split}\end{equation*} %}
		したがって、任意の$a_1,a_2\in A,\;w_1,w_2\in WA$に対して次の式が成り立つ。
		\begin{equation}\label{eq:交換関係を導くための双対性}\begin{split} %{
			(a_1\sqcup w_1)^t(a_2* w_2) 
			&= \bigl((\Delta_\sqcup[a_1])\otimes(\Delta_\sqcup w_1)\bigr)^t
				\sigma_{23}\bigl((\Delta_*[a_2])\otimes(\Delta_*w_2)\bigr) \\
		\end{split}\end{equation} %}
		この式の左辺は$w_1^ta_1^t\sqcup a_2* w_2$となり、
		交換関係\eqref{eq:調べる交換関係}の左辺になる。同一視$R\otimes R\simeq R$
		によって、次の式が成り立つから、
		\begin{equation*}\begin{split} %{
			(\Delta_\sqcup[b])^t(x_1\otimes x_2) &\simeq [b]^t(x_1\sqcup x_2) \\
			&= \jump{x_1=[b]}\jump{x_2=1_W} + \jump{x_1=1_W}\jump{x_2=[b]} \\
			&= (\epsilon_*{b^t*x_1})(\epsilon_*{x_2}) 
				+ (\epsilon_*{x_1})(\epsilon_*{b^t*x_2}) \\
			& \quad\text{for all }b\in A,\;x_1,x_2\in WA
		\end{split}\end{equation*} %}
		式\eqref{eq:交換関係を導くための双対性}の右辺は次のようになる。
		\begin{equation*}\begin{split} %{
			& \bigl((\Delta_\sqcup[a_1])\otimes(\Delta_\sqcup w_1)\bigr)^t
				\sigma_{23}\bigl((\Delta_*[a_2])\otimes(\Delta_*w_2)\bigr) \\
			&= \bigl((\Delta_\sqcup[a_1])\otimes(\Delta_\sqcup w_1)\bigr)^t
				\bigl((\Delta_{*(1)}[a_2])\otimes(\Delta_{*(1)}w_2)\otimes(\Delta_{*(2)}[a_2])\otimes(\Delta_{*(2)}w_2)\bigr) \\
			&\simeq (\epsilon_*a_1^t*\Delta_{*(1)}[a_2])(\epsilon_*\Delta_{*(1)}w_2)
				(\Delta_\sqcup w_1)^t\bigl((\Delta_{*(2)}[a_2])\otimes(\Delta_{*(2)}w_2)\bigr) \\
			&\;+ (\epsilon_*\Delta_{*(1)}[a_2])(\epsilon_*a_1^t*\Delta_{*(1)}w_2)
				(\Delta_\sqcup w_1)^t\bigl((\Delta_{*(2)}[a_2])\otimes(\Delta_{*(2)}w_2)\bigr) \\
			&= (\epsilon_*a_1^t*\Delta_{*(1)}[a_2])(\Delta_\sqcup w_1)^t
				\bigl((\Delta_{*(2)}[a_2])\otimes w_2\bigr) \\
			&\;+ (\epsilon_*a_1^t*\Delta_{*(1)}w_2)(\Delta_\sqcup w_1)^t
				\bigl([a_2]\otimes(\Delta_{*(2)}w_2)\bigr) \\
			&= (\epsilon_*a_1^t*\Delta_{*(1)}[a_2])w_1^t
				\bigl((\Delta_{*(2)}[a_2])* w_2\bigr) \\
			&\;+ (\epsilon_*a_1^t*\Delta_{*(1)}w_2)w_1^t
				\bigl(a_2*(\Delta_{*(2)}w_2)\bigr) \\
		\end{split}\end{equation*} %}
	\end{itemize} %}
%s1:課題}
