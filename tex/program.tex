\section{Programming}

\subsection{Range representation of powerset}
We use the folloing symbols through this section:
\begin{equation}\begin{split}
	N_n &= \set{0, 1, \dots, n - 1} \\
	P_n &= \text{power set of }N_n \\
	W_n &= \text{free-monoid on }N_n \\ 
\end{split}\end{equation}
, and use the following maps as usual:
\begin{equation}\begin{split}
	\min: P_n\backslash\set{\emptyset} &\to N_n \\ 
		p &\mapsto x \text{ satisfies }x\le y \text{ for all }y\in p \\ 
	\max: P_n\backslash\set{\emptyset} &\to N_n \\ 
		p &\mapsto x \text{ satisfies }y\le x \text{ for all }y\in p \\ 
\end{split}\end{equation}

We want to represent $P_n$ with $W_n$ for data compression.
Bitarray is easest and direct way to represnt power-set in program.
But bitarray requires a lot of memory, the length of array is $\zettai{S}/64$
to represent any subset of $S$.
For example, bitarray requires the length $2^{21}/64=2^{6}=2^{15}=32768$ 
of long-array to represent any subset of unicode-2.0.
Thus we shall consider the way to represent power-set with range.

Let $R_n$ be the followings:
\begin{equation}\begin{split}
	R_n &= \set{w\in W_n\bou \zettai{w}\text{ is even and sorted}}
\end{split}\end{equation}
. For example, $R_2$ is given by the followings:
\begin{equation}\begin{split}
	R_2 &= \set{\bakko{}, \bakko{0}, \bakko{1}, \bakko{01}}
\end{split}\end{equation}
. We define the following maps:
\begin{equation}\begin{split}
	\myop{begin}: R_n &\to N_n \\
		w &\mapsto \begin{cases}
			n & \text{iff } \zettai{w} = 0 \\
			\text{the first character of }w & \text{otherwise} \\
			\end{cases} \\
	\myop{end}: R_n &\to N_n \\
		w &\mapsto \begin{cases}
			n & \text{iff } \zettai{w} = 0 \\
			\text{the last character of }w & \text{otherwise} \\
			\end{cases} \\
	\myop{splitFirst}: R_n &\to R_n \otimes R_n \\
		w &\mapsto \begin{cases}
			\bakko{}\times \bakko{} & \text{iff } \zettai{w} = 0 \\
			w_1 \times w_2 & \text{otherwise} \\
			\end{cases} \\
			&\text{where } \zettai{w_1} = 2 \text{ and } w = w_1 * w_2 \\
	\myop{splitLast}: R_n &\to R_n \otimes R_n \\
		w &\mapsto \begin{cases}
			\bakko{}\times \bakko{} & \text{iff } \zettai{w} = 0 \\
			w_1 \times w_2 & \text{otherwise} \\
			\end{cases} \\
			&\text{where } \zettai{w_2} = 2 \text{ and } w = w_1 * w_2 \\
\end{split}\end{equation}
. And we define the map $\myop{asSet}$
\begin{equation}\begin{split}
	\myop{asSet}: R_{n+1} &\to P_n \\
		w &\mapsto \begin{cases}
			\emptyset & \text{if }\zettai{w} = 0 \\
			\set{x\in N_n\bou w.\myop{begin}() \le x < w.\myop{end}()} & \text{if }\zettai{w} = 2 \\
			w.\myop{splitFirst}().(\myop{asSet}()\times\myop{asSet}()).(-\cup-) &\text{otherwise} \\
		\end{cases}
\end{split}\end{equation}
. We assume without proof that $\myop{asSet}$ is isomorphism.
We define the map $\cup_R$ by the following commutative diagram:
\begin{equation}\begin{split}
	\xymatrix @C+12pt {
		R_{n+1}\times R_{n+1} \ar@{.>}[d]^{\cup_R}
			\ar[r]^{\myop{asSet}\times\myop{asSet}} 
			& P_n\times P_n \ar[d]^{\cup} \\
		R_{n+1} & P_n \ar[l]^{\myop{asSet}^{-1}} \\
	}
\end{split}\end{equation}
. We know immediately the followings:
\begin{equation}\begin{split}
	r_1.\cup_R r_2 &= \begin{cases}	
		r_1*r_2 &\text{if }r_1.\myop{end}() < r_2.\myop{begin}() \\
		r_2*r_1 &\text{else if }r_2.\myop{end}() < r_1.\myop{begin}() \\
		\bakko{(r_1*r_2).\min()(r_1*r_2).\max()} &\text{else} \\
	\end{cases} \\
\end{split}\end{equation}
. Thus 
\begin{equation}\begin{split}
%	w.\cup_R \bakko{ab] &= \begin{cases}
%		\bakko{ab} & \text{if }\zettai{w} = 0 \\
%		w_1 * u * w_2 \text{otherwise} \\
%	\end{cases}
%	\text{where}& \\
\end{split}\end{equation}
. Thus 
\begin{cprog}
w.cup = { [ab] |->
	(w0, w1) = w.splitFirst();
	if (w0.begin() == w0.end()) {
		return [ab];
	} else if (w0.end() < a) {
		return w0.* w1.cup [ab];
	} else if (b < w0.begin()) {
		return [ab] * w;
	} else {
	}
}
\end{cprog}

\subsection{backup}
\begin{equation}\begin{split}
	\bakko{ab}\vee\bakko{cd} &= \begin{cases}
		\bakko{abcd} & b < c \\
		\bakko{cdab} & d < a \\
		\bakko{(a,c).\min(),(b,d).\max()} & \text{else} \equiv a\le d \myop{and} d\le b  \\
		\end{cases}
\end{split}\end{equation}
\begin{equation}\begin{split}
	\bakko{ab}\vee w &= w_1 * u * w_2 \\
\end{split}\end{equation}
. Where
\begin{equation}\begin{split}
	w_1 &= w.\myop{subset}\set{x\bou x.\myop{end}() < a} \\
	w_2 &= w.\myop{subset}\set{x\bou b < x.\myop{begin}()} \\
	u &= \bakko{(a,ww).\min()(b,ww).\max()} \\
	ww &= w.\myop{subset}\set{x\bou a\le x.\myop{end}()\myop{and} x.\myop{begin}()\le b} \\
\end{split}\end{equation}
. Then we define the map $\myop{split}$ as the followings:
\begin{equation}\begin{split}
	\myop{split}: P_n^\circ\times P_n &\to P_n\times P_n\times P_n \\
		r\times p &\mapsto p_1\times q\times p_2 \\
		p_1 &= p.\myop{subset}\set{x\bou x.\myop{end}() < r.\myop{begin}()} \\
		p_2 &= p.\myop{subset}\set{x\bou r.\myop{end}() < x.\myop{begin}()} \\
		q &= p.\myop{subset}\set{x\bou r.\myop{begin}() \le x.\myop{end}() \myop{and} x.\myop{begin}() \le r.\myop{end}()} \\
\end{split}\end{equation}
\begin{equation}\begin{split}
	w_1\vee w_2 &= (r * w_{11})\vee w_2 \\
		&r \text{ is the first range of }w_1 \\
		&= (r * w_{11})\vee (w_{21} * u * w_2) \\
		&w_{21}\times u\times w_2 \text{ is the first range of }w_1 \\
\end{split}\end{equation}

\subsection{backup}

We view power-set as semi-ring, 'or' as additive, 'and' as multiplicative
operations. A power-set become a idempotent semi-ring in this view.

We shall first define the term 'connected' to represent range.



\begin{definition}[connected subset and disconnectable point]
Let $p$ is an element of $P_n$.
$p$ is called connected iff $p=\emptyset$ or $p=\set{x\in N_n\bou p.\min()\le x\le p.\max()}$.
$x\in N_n$ is called disconnectable point of $p$ 
iff $x$ is $p.\min()<x<p.\max()$ and $x\not\in p$. 
\end{definition}
. 

We shall define the following maps as convention:
\begin{equation}\begin{split}
	\myop{begin}: P_n &\to N_{n+1} \\ 
		p &\mapsto \begin{cases}
			n + 1 & \text{iff }p = \emptyset \\
			p.\min() & \text{else} \\
			\end{cases} \\
	\myop{end}: P_n &\to N_{n+1} \\ 
		p &\mapsto \begin{cases}
			n + 1 & \text{iff }p = \emptyset \\
			p.\max() + 1 & \text{else} \\
			\end{cases}
\end{split}\end{equation}
.

We denote $P_n^\circ\subseteq P_n$ as all connected subset of $N_n$.
$P_n^\circ$ is closed under the binary operation 'and'.

\subsection{backup}


\begin{definition}[pointwise split]
Let $p$ is an element of $P_n$ for some $n>0$.
The map $\myop{split}$ is defined as the followings:
\begin{equation}\begin{split}
	\myop{split}: N_n\times P_n &\to P_n\times P_n \\
		x\times p &\mapsto p_1\times p_2 \text{ such that} \\
			&\quad y < x \text{ for all }y\in p_1 \text{ and } \\
			&\quad x < y \text{ for all }y\in p_2 \\
\end{split}\end{equation}
\end{definition}

We define the map $\varphi$ as follows:
\begin{equation}\begin{split}
	\varphi: P_n &\to W_{n+1} \\
		p &\mapsto \begin{cases}
			1 & \text{if } p = \emptyset \\
			\bakko{\kakko{\myop{beg}p}\kakko{\myop{end}p}} & \text{else if } p \text{ is connected} \\
			m(\varphi\times\varphi)\myop{split}(x\times p) & \text{else} \\
			\end{cases} \\
\end{split}\end{equation}
, where $m$ is string concatenation, $x$ is a some disconnectable point 
of $p$. The map $\varphi$ converges for all element of $P_n$.

\begin{example}[$\varphi$]
\begin{equation}\begin{split}
	\varphi\set{2,3,4} = \bakko{24} \\
	\varphi\set{2,3,0} = \bakko{03} \\
\end{split}\end{equation}
\end{example}

The set $\varphi P_n\subset W_{n+1}$ is consisted with the following 
words.
\begin{itemize}
	\item all characters are ordered from smaller to bigger and
	\item there is not duplicated character and
	\item the number of characters is event.
\end{itemize}
We denote $R_n\subseteq W_n$ as a set of all words that satisfies the
followings:
\begin{itemize}
	\item all characters are ordered from smaller to bigger and
	\item there is not duplicated character.
\end{itemize}
, and define the map $\pi$ as the followings:
\begin{equation}\begin{split}
	\pi: W_n &\to R_n \\
		w &\mapsto \text{sorts and eliminates duplicated characters of }w \\
\end{split}\end{equation}
. 

\begin{example}[$\pi$]
\begin{equation}\begin{split}
	\pi\bakko{312} &= \bakko{123} \\
	\pi\bakko{2312} &= \bakko{123} \\
\end{split}\end{equation}
\end{example}

We denote $EW_n\subseteq W_n$ as the set of all even-length words over
$N_n$, and denote $ER_n\subseteq W_n$ same way.
The set $EW_n$ is closed under string concatenation.

We define the map $\mu$ as the followings:
\begin{equation}\begin{split}
	\mu: ER_{n+1} &\to P_n \\
		w &\mapsto \begin{cases}
			\emptyset & \text{if } \zettai{w} = 0 \\
			\set{x\in N_n\bou a\le x< b} & \text{else if } w \text{ is in the form } \bakko{ab} \\
			(\mu w_1) + (\mu w_2) & \text{else} \\
			\end{cases}
\end{split}\end{equation}
. Where $w_1$ and $w_2$ are defined as the followings:
\begin{equation}\begin{split}
	0 < \bakko{w_1} \text{ and } 0 < \bakko{w_1} \text{ and } w = w_1 * w_2
\end{split}\end{equation}
. We assume without proof that the following diagam is commute:
\begin{equation}\begin{split}
	\xymatrix {
		P_n \ar[r]^{\varphi} & W_{n+1} \ar[r]^{\pi} & R_{n+1} \ar@(d,d)[ll]^{\mu} 
	}
\end{split}\end{equation}
.
