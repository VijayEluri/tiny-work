\begingroup %{
	\newcommand{\Mod}[1]{{#1}\myhere\mybf{Mod}}
	\newcommand{\Alg}{\mybf{Alg}}
	\newcommand{\Vect}[1]{\mybf{Vec}_{#1}}
	\newcommand{\Hom}{\myop{Hom}}
	\newcommand{\End}{\myop{End}}
	\newcommand{\Mat}{\myop{M}}
	\newcommand{\Map}{\mybf{Set}}
	\newcommand{\Pow}{\mycal{P}}
	\newcommand{\Perm}{\mycal{S}}
	\newcommand{\W}{\mycal{W}}
	\newcommand{\T}{\mycal{T}}
	\newcommand{\N}{\mycal{N}}
	\newcommand{\D}{\mycal{D}}
	\newcommand{\Wedge}{{\bigwedge}}
	%
	\newcommand{\id}{\myop{id}}
	\newcommand{\dup}{\myop{du}}
	\newcommand{\onto}{\myop{onto}}
	\newcommand{\dfn}{\,\myop{def}\,}
	\newcommand{\oless}{\olessthan}
	%
	\newcommand{\tran}{\mathbf{t}}
	%
	\newcommand{\from}{\xfrom{}}
	\newcommand{\toto}{\rightrightarrows}
	\newcommand{\fromfrom}{\leftleftarrows}
	\newcommand{\tofrom}{\rightleftarrows}
	\newcommand{\fromto}{\leftrightarrows}
	\newcommand{\xIff}[2][]{\xLongleftrightarrow[#1]{#2}}
	%
	\newcommand{\bld}[1][e]{{\mathbf{#1}}}
	\newcommand{\swap}{\leftrightarrow}
	\newcommand{\range}[2]{\genfrac{[}{]}{0pt}{}{#1}{#2}}
	%
	\newcommand{\mf}[1]{{\mathfrak{#1}}}
	\newcommand{\Dyck}{{\mathfrak D}}
	\newcommand{\Cyck}{{\mathfrak C}}
	\newcommand{\cbinom}[2]{\genfrac{[}{]}{0pt}{}{#1}{#2}}
	%
	{\setlength\arraycolsep{2pt}
	%
\section{Dyck言語}\label{s1:Dyck言語} %{
	一般的にはDyck言語は次のように定義される。

	\begin{definition}[Dyck言語]\label{def:Dyck言語} %{
		大きさ$2$の集合$\mybf{2}=\set{a,b}$から生成される自由モノイドを
		$\W_*\mybf{2}$とする。任意の$n\in\sizen$に対して、
		$\W_{2n}\mybf{2}$の部分集合$\Dyck_n$が次の条件を満たすとき、
		$\Dyck_*:=\sum_{n\in\sizen}\Dyck_n$をDyck言語という。
		\begin{enumerate}\setlength{\itemsep}{-1mm} %{
			\item $w\in\Dyck_n$ならば、$\sharp_{a}w=\sharp_{b}w$となる。
			\item $w\in\Dyck_n,\;w_1,w_2\in\W_*\mybf{2}$かつ$w=w_1w_2$
			ならば、$\sharp_{a}w_1\ge\sharp_{b}w_1$となる。
		\end{enumerate} %}
	\end{definition} %def:Dyck言語}

	Dyck言語の場合、$\Dyck_n$は長さ$2n$の単語の集合としていることに注意する。
	式で書くと、$\Dyck_n\subset\W_{2n}\mybf{2}$という約束を使う。

	この定義は、直感的でないが簡潔にDyck言語を定義する。
	長さ$2,4,6$のDyck言語を文字$\set{0,1}$で書くと次のようになる。
	\begin{equation*}\begin{array}{rrrrr}
		01 \\
		0011 & 0101 \\
		000111 & 001011 & 001101 & 010011 & 010101 \\
	\end{array}\end{equation*}
	これを文字$\set{\langle,\rangle}$で書き直すと形式言語との関係が
	明確になる。
	\begin{equation*}\begin{array}{rrrrr}
		\braket{} \\
		\langle\braket{}\rangle & \braket{}\braket{} \\
		\langle\langle\braket{}\rangle\rangle
		& \langle\braket{}\braket{}\rangle
		& \langle\braket{}\rangle\braket{}
		& \braket{}\langle\braket{}\rangle
		& \braket{}\braket{}\braket{} \\
	\end{array}\end{equation*}

	\begin{note}[Dyck言語と自己線形写像]\label{note:Dyck言語と自己線形写像} %{
		多項式$R[x]$を通常の加法と乗法によって$R$-代数とみなす。
		$R[x]$の自己線形写像全体のつくる集合を$V=\Mod{R}(R[x],R[x])$とする。
		$V$は畳み込みによる加法と係数の作用によって$R$-加群となり、
		写像の合成により$R$-代数となる。
		$x^{n\tran}:=(x^n)^\tran\in\Mod{R}(R[x],R)$を次のようにおくと、
		\begin{equation*}\begin{split}
			x^{m\tran}x^n = \jump{m=n}
		\end{split}\end{equation*}
		集合$E=\set{x^mx^{n\tran}\in V\bou m,n\in\sizen}$は$V$の基底系となり、
		次の代数を満たす。
		\begin{equation*}\begin{split}
			x^{m_1}x^{n_1\tran}x^{m_2}x^{n_2\tran}
			= \jump{n_1=m_2}x^{m_1}x^{n_2\tran}
			\quad\text{for all } m_1,m_2,n_1,n_2\in\sizen
		\end{split}\end{equation*}
		集合$X=\set{x,y}$とすると、自由モノイドの普遍性により、
		次の性質を満たす$f\in\Alg_R(R\W_*X,V)$が一意に定まる。
		\begin{equation*}\begin{split}
			fx = x := xx^{0\tran},\quad fy = x^\tran := x^0x^\tran
		\end{split}\end{equation*}
		$\ker f$は$X$から生成されるDyck言語となる。
	\end{note} %note:Dyck言語と自己線形写像}

	Dyck言語は、次のような平面格子上の経路から生成することができる。
	\begin{equation}\label{eq:Dyck経路}\xymatrix@R=1em@C=1em{
		& & & (3,3) \\
		& & (2,2) \ar[r]^0 & (3,2) \ar[u]_1\\
		& (1,1) \ar[r]^0 & (2,1) \ar[r] \ar[u]_1& (3,1) \ar[u]_1\\
		(0,0) \ar[r]^0 & (1,0) \ar[r]^0 \ar[u]_1 & (2,0) \ar[r]^0 \ar[u]_1
			& (3,0) \ar[u]_1\\
	}\end{equation}
	経路内を
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 右へ移動した時に$0$、
		\item 上へ移動した時に$1$
	\end{itemize} %}
	を書いていくと、$(0,0)$から$(n,n)$への経路によって、長さ$2n$のDyck言語の
	単語が生成される。例えば、経路$(0,0)(1,0)(2,0)(2,1)(2,2)(3,2)(3,3)$
	からは$001101$という単語が生成される。この図のようにDyck言語を生成する
	経路をDyck経路という。

	Dyck経路を２次元平面上の経路の特別な場合として定義する。

	\begin{definition}[単調経路（monotonic path）]\label{def:単調経路} %{
		平面上の自然数を頂点とする格子で、$(0,0)$から$(m,n)$への経路で、
		水平方向にも垂直方向にもプラス方向にのみ頂点の移動が可能となる経路を
		$(0,0)$から$(m,n)$への単調経路という。
	\end{definition} %def:単調経路}

	次の図は$(0,0)$から$(3,2)$への単調経路（の集合）を表している。
	\begin{equation*}\xymatrix@R=1em@C=1em{
		& & (2,2) \ar[r] & (3,2) \\
		& (1,1) \ar[r] & (2,1) \ar[r] \ar[u] & (3,1) \ar[u] \\
		(0,0) \ar[r] & (1,0) \ar[r] \ar[u] & (2,0) \ar[r] \ar[u]
			& (3,0) \ar[u] \\
	}\end{equation*}

	\begin{definition}[Dyck経路]\label{def:Dyck経路} %{
		$(0,0)$から$(n,n)$への単調経路で、$p\ge q$となる頂点$(p,q)$のみを通過
		する経路をDyck経路という。
	\end{definition} %def:Dyck経路}

	Dyck言語もDyck経路も同じものとして、用途に応じて両者を用いる。
	Dyck言語を次の命題によって再帰的に定義する流儀もある。

	\begin{proposition}[Dyck言語その二]\label{prop:Dyck言語その二} %{
		$\Dyck_*$を集合$\mybf{2}=\set{a,b}$から生成されたDyck言語とする。
		任意の$w\in\Dyck_+$に対して次の式を満たす$w_1,w_2\in\Dyck_*$
		が唯一つ定まる。
		\begin{equation*}\begin{split}
			w = (aw_1)(bw_2)
		\end{split}\end{equation*}
	\end{proposition} %prop:Dyck言語その二}
	\begin{proof} Dyck経路を用いて証明する。
	$n\ge 1$として、$(n,n)$へのDyck経路全体のつくる集合を$\Gamma_n$とする。
	経路$\gamma\in\Gamma_n$が通る対角線上の頂点の集合を$\myop{diag}\gamma$
	と書く。$(0,0)$と$(n,n)$は常に$\myop{diag}\gamma$に含まれ、
	$1\le n$なので、$2\le|\myop{diag}\gamma|$となる。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[存在] $\myop{diag}\gamma$の中で、$(0,0)$の次に小さな頂点を
		$(p,p)$とする。$\gamma$は次のようなDyck経路となる。
		\begin{equation*}\xymatrix@R=1em@C=1em{
			 & & & (n,n) \\
			 & & (p,p) \ar@{>>}[ru]^{\gamma_2} \\
			 & & (p,p-1) \ar[u] \\
			(0,0) \ar@{.}[rruu] \ar[r] & (1,0) \ar@{>>}[ru]^{\gamma_1} \\
		}\end{equation*}
		$\gamma$を命題の$w\in\Dyck$に対応させると、$\gamma_1$と$\gamma_2$は
		それぞれ、命題の$w_1$と$w_2$に対応する。
		%
		\item[一意性] $\myop{diag}\gamma$の中で、$(p,p)$の次に小さな頂点
		$(q,q)$が存在したとする。すると、$\gamma$は次のようなDyck経路となる。
		\begin{equation*}\xymatrix@R=1em@C=1em{
			 & & & & & (n, n) \\
			 & & & & (q, q) \ar@{>>}[ru]^{\eta_2} \\
			 & & & & (q, q - 1) \ar[u] \\
			 & & (p,p) \ar[r] \ar@{.}[rruu] & (p + 1,p) \ar@{>>}[ru]^{\eta_1} \\
			 & & (p,p-1) \ar[u] \\
			(0,0) \ar@{.}[rruu] \ar[r] & (1,0) \ar@{>>}[ru]^{\gamma_1} \\
		}\end{equation*}
		この図で、経路$(1,0)(q,q-1)$は始点と終点が対角的な関係になっているが、
		部分経路$(p,p-1)(p,p)(p+1,p)$で対角線の上にはみ出てしまっているので、
		$(1,0)(q,q-1)$はDyck経路とはならない。
	\end{description} %}
	\end{proof}

	この命題によって、Dyck言語の大きさに関する次の命題が導かれる。

	\begin{proposition}[Dyck言語の大きさ]\label{prop:Dyck言語の大きさ} %{
		$\Dyck_*$をDyck言語とする。任意の$n\in\sizen$に対して次の式が成り立つ。
		\begin{equation*}\begin{split}
			|\Dyck_{n+1}| = \sum_{p\in0..n}|\Dyck_p||\Dyck_{n-p}|
		\end{split}\end{equation*}
	\end{proposition} %prop:Dyck言語の大きさ}
	\begin{proof} $\mybf{2}=\set{a,b}$として、
	命題\ref{prop:Dyck言語その二}から、任意の$n\in\sizen$に対して、次の写像
	$\phi:\sum_{p\in0..n}\Dyck_p\times\Dyck_{n-p}\to\Dyck_{n+1}$が
	集合同型となる。
	\begin{equation*}\begin{split}
		\phi(w_1,w_2) = (aw_1)(bw_2) \quad\text{for all } (w_1,w_2)\in
		\sum_{p\in0..n}\Dyck_p\times\Dyck_{n-p}
	\end{split}\end{equation*}
	\end{proof}

	Dyck経路の数は既知で次のようにCataran数で表される。
	\begin{equation*}\begin{split}
		|\Dyck_n| = \frac{1}{n+1}\binom{2n}{n}
		\quad\text{for all } n\in\sizen
	\end{split}\end{equation*}
	この式はDyck経路の数についての漸化式\ref{prop:Dyck言語の大きさ}を
	用いて次のようにして導くことができる。

	変数$z$についての形式級数$d_z$を次のように定義する。
	\begin{equation*}\begin{split}
		d_z := \sum_{n\in\sizen}|\Dyck_n|z^n
	\end{split}\end{equation*}
	すると、漸化式\ref{prop:Dyck言語の大きさ}より次の式が成り立つ。
	\begin{equation*}\begin{split}
		d_z^2 &= \sum_{p,q\in\sizen} |\Dyck_p||\Dyck_q|z^{p+q}
		= \sum_{n\in\sizen}\sum_{p=0}^n |\Dyck_p||\Dyck_{n-p}|z^n
		= \sum_{n\in\sizen} |\Dyck_{n+1}|z^n \\
		&= \frac{d_z - |\Dyck_0|}{z} = \frac{d_z - 1}{z}
	\end{split}\end{equation*}
	したがって、変数$z$についての形式級数$D_z$を次のように定義すると、
	\begin{equation*}\begin{split}
		D_z := \sum_{n\in\sizen}|\Dyck_n|z^{n+1}
	\end{split}\end{equation*}
	$D_z^2 = D_z - z$が成り立ち、この$D_z$に関する二次式を解くと、
	次の二つの解が得られる。
	\begin{equation*}\begin{split}
		D_z = \frac{1\pm\sqrt{1 - 4z}}{2}
	\end{split}\end{equation*}
	この解に$D_0=0$という条件を課すと、次の解が得られ、
	\begin{equation*}\begin{split}
		D_z = \frac{1-\sqrt{1 - 4z}}{2}
	\end{split}\end{equation*}
	Dyck経路の数を次のように解析的に表すことができる。
	\begin{equation*}\begin{split}
		|\Dyck_n| = \frac{1}{2\pi i}\oint_{0}\frac{dz}{z^{n+2}} D_z
	\end{split}\end{equation*}
	根号$\sqrt{1-4z}$を$z=0$の周りで展開してみる。
	一般に、任意の$\nu\in\fukuso,\;k\in\sizen$に対して、$\cbinom{\nu}{k}$を
	次の式で定義すると、
	\begin{equation*}\begin{split}
		(1 + x)^\nu = \sum_{k\in\sizen}\cbinom{\nu}{k} x^k
	\end{split}\end{equation*}
	$\cbinom{\nu}{k}$は次のようになる。
	\begin{equation*}\begin{split}
		\cbinom{\nu}{0} = 1,\quad
		\cbinom{\nu}{k} = \frac{\nu}{k}\frac{\nu-1}{k-1}
			\cdots\frac{\nu-(k-1)}{1}
		= \frac{\Gamma_{\nu+1}}{\Gamma_{k+1}\Gamma_{\nu-k+1}}
		\quad\text{for all } k\in\sizen_+
	\end{split}\end{equation*}
	$\nu\in\sizen$の時$\cbinom{\nu}{k}$は通常の二項係数となる。
	$\cbinom{\nu}{k}$を使うと、$\sqrt{1-4z}$は次のように書ける。
	\begin{equation*}\begin{split}
		\sqrt{1-4z} = \sum_{k\in\sizen} \cbinom{\frac{1}{2}}{k} (-4z)^k
	\end{split}\end{equation*}
	ここで、任意の$k\in\sizen_+$に対して次の式が成り立つから、
	\begin{equation*}\begin{split}
		\cbinom{\frac{1}{2}}{k}
		&= \frac{\frac{1}{2}}{k}\frac{\frac{1}{2}-1}{k-1}
			\cdots\frac{\frac{1}{2}-(k-1)}{1}
		= -\left(-\frac{1}{2}\right)^k\frac{1\cdot3\cdots(2k-3)}{k!} \\
		&= -2\left(-\frac{1}{4}\right)^k \frac{(2k-2)!}{k!(k-1)!} \\
		\implies & \sqrt{1-4z} = 1 - 2\sum_{n\in\sizen_+}
			\frac{(2k-2)!}{k!(k-1)!} z^k \\
	\end{split}\end{equation*}
	$D_z$は次のようになることがわかる。
	\begin{equation*}\begin{split}
		D_z = \sum_{n\in\sizen_+} \frac{(2k-2)!}{k!(k-1)!} z^k
		= \sum_{n\in\sizen} \frac{1}{k+1} \binom{2k}{k} z^{k+1}
	\end{split}\end{equation*}
	この式より、$D_z=\sum_{k\in\sizen}|\Dyck_k|z^{k+1}$だから、
	$|\Dyck_k|=\frac{1}{k+1} \binom{2k}{k}$となることがわかる。

	二項係数$\binom{2n}{n}$は$(0,0)$から$(n,n)$への単調経路の数になっている。
	Dyck経路の数が単調経路の数を$n+1$で割ったものになるということは、
	単調経路に次の性質が成り立つ同値関係が定義できることを予想させる。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item すべての同値類がDyck経路を唯一つ必ず含む。
		\item すべての同値類の大きさが等しくなる。
	\end{itemize} %}
	因子$n+1$は同値類の大きさとなる。
	ここで、単調経路から生成される単語を定義しておく。

	\begin{definition}[単調な単語]\label{def:単調な単語} %{
		文字$a$を$m$個、文字$b$を$n$個含む単語を$\set{a,b}$から生成される
		単調な単語といい、単調な単語全体のつくる集合を$\Cyck_{m,n}$と書く。
	\end{definition} %def:単調な単語}

	$(0,0)$から$(m,n)$への単調な経路はすべて$m+n$個の辺を持つ。そして、
	$m+n$個の辺の中から水平な辺を$m$個選ぶと経路が唯一つ定まる。
	したがって、単調な経路の数は次の式で与えられる。
	\begin{equation*}\begin{split}
		|\Cyck_{m,n}| = \binom{m+n}{n} \quad\text{for all } m,n\in\sizen
	\end{split}\end{equation*}
	単調な経路全体の中でDyck経路を特徴付けるパラメータを定義する。

	\begin{definition}[超過数（exceedance）]\label{def:超過数} %{
		単調な経路$\gamma$で対角線より上にある上向きの辺の数を$\gamma$の
		超過数という。
	\end{definition} %def:超過数}

	次の図は、$(0,0)$から$(5,5)$への単調な経路で、超過数に勘定する辺を二重線
	で示している。
	\begin{equation}\label{eq:超過数の例}\xymatrix@R=1em@C=1em{
		& & & & (4,5) \ar[r] & (5,5) \\
		& & & & (4,4) \ar@{=>}[u] \\
		& (1,3) \ar[r] & (2,3) \ar[r] & (3,3) \ar[r] & (4,3) \ar[u] \\
		& (1,2) \ar@{=>}[u] \\
		& (1,1) \ar@{=>}[u] \\
		(0,0) \ar[r] \ar@{.}[rrrrruuuuu] & (1,0) \ar[u] \\
	}\end{equation}
	Dyck経路の超過数は$0$となる。
	超過数が$0$に向かって変化するような経路の変形を考える。
	単調な経路に対して次のような経路の変形をすると、超過数が一つ減る。
	\begin{equation}\label{eq:Dyck経路への変形}\begin{split}
		\xymatrix@R=1em@C=1em{
			& & \ar@{-}[r] & \\
			\ar@{-}[r] & \ar[r]^\delta & \ar@{-}[r] \ar@{-}[u]_{}^{}="l" 
				& \ar@{-}[u]_{}^{}="r" \ar@{}"l";"r"|{\gamma_2} \\
			\\
			\ar@{-}[r] \ar@{-}[uu]_{}^{}="L" \ar@{.}[rrruuu] 
				& \ar@{-}[uu]_{}^{}="R" \ar@{}"L";"R"|{\gamma_1} \\
		} \quad\mapsto\quad \xymatrix@R=1em@C=1em{
			& & \ar@{-}[r] & \\
			\\
			\ar@{-}[r] & \ar[r]^\delta & \ar@{-}[r]\ar@{-}[uu]^{}_{}="L" 
				& \ar@{-}[uu]^{}_{}="R" \ar@{}"L";"R"|{\gamma_1} \\
			\ar@{-}[r] \ar@{-}[u]_{}^{}="l" \ar@{.}[rrruuu] 
				& \ar@{-}[u]_{}^{}="r" \ar@{}"l";"r"|{\gamma_2} \\
		}
	\end{split}\end{equation}
	この変形を繰り返すと、最終的に超過数が$0$になってDyck経路となる。
	Dyck経路には辺$\delta$が存在しないので、それ以上の変形はできない。
	ここで、辺$\delta$は最も左にある辺をとることにする。
	経路\eqref{eq:超過数の例}の場合には、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $\gamma_1$は経路$(0,0)\twoheadrightarrow(2,3)$、
		\item $\gamma_2$は経路$(3,3)\twoheadrightarrow(5,5)$、
		\item $\delta$は経路$(2,3)\to(3,3)$
	\end{itemize} %}
	となっている。経路\eqref{eq:超過数の例}を変形すると次のようになる。
	\begin{equation*}\begin{split}
		& \xymatrix@R=1ex@C=1em{
			& & & & (4,5) \ar[r] & (5,5) \\
			\\
			& (1,3) \ar[r] & (2,3) \ar[r] & (3,3) \ar[r] & (4,3) \ar@{>>}[uu] \\
			\\
			\\
			(0,0) \ar[r] \ar@{.}[rrrrruuuuu] & (1,0) \ar@{>>}[uuu] \\
		} \\
		\mapsto & \xymatrix@R=1ex@C=1em{
			& & & & (1,3) \ar[r] \ar[r] & (2,3) \\
			\\
			\\
			& (4,5) \ar[r] & (5,5) \ar[r] & (0,0) \ar[r] & (1,0) \ar@{>>}[uuu] \\
			\\
			(3,3) \ar[r] \ar@{.}[rrrrruuuuu] & (4,3) \ar@{>>}[uu] \\
		} \\
		\mapsto & \xymatrix@R=1ex@C=1em{
			& & & & & (4,5) \\
			\\
			& & (1,3) \ar[r] & (2,3) \ar[r] & (3,3) \ar[r] & (4,3) \ar@{>>}[uu] \\
			\\
			\\
			(5,5) \ar[r] \ar@{.}[rrrrruuuuu] & (0,0) \ar[r] & (1,0) \ar@{>>}[uuu] \\
		} \\
		\mapsto & \xymatrix@R=1ex@C=1em{
			& & & & & (1,3) \\
			\\
			\\
			& & (4,5) \ar[r] & (5,5) \ar[r] & (0,0) \ar[r] & (1,0) \ar@{>>}[uuu] \\
			\\
			(2,3) \ar[r] \ar@{.}[rrrrruuuuu] & (3,3) \ar[r] & (4,3) \ar@{>>}[uu] \\
		}
	\end{split}\end{equation*}
	$\Cyck_{n,n,l}$を超過数$l$の単調な経路全体のつくる集合とすると、
	$\Cyck_{n,n}$は次のように分類され、
	\begin{equation*}\begin{split}
		\Cyck_{n,n} = \sum_{l\in0..n}\Cyck_{n,n,l}
	\end{split}\end{equation*}
	変形\eqref{eq:Dyck経路への変形}は、任意の$l=0..(n-1)$に対して、
	集合同型$\Cyck_{n,n,l+1}\simeq\Cyck_{n,n,l}$を与える。
	したがって、Dyck経路の数は$|\Dyck_n|=|\Cyck_{n,n}|/(n+1)$となることが
	わかる。
%s1:Dyck言語}
\section{シャッフル積}\label{s1:シャッフル積} %{
	この節を通して次の記号を用いる。
	\begin{description}\setlength{\itemsep}{-1mm} %{
		%
		\item[係数環] $R$を可換環とする。
		%
		\item[対称群] $S_n$を$n$次対称群とする。
		%
		\item[べき集合] 集合$A$に対して$\Pow_*A$を$A$のべき集合とし、
		$\Pow_nA\subset\Pow_*A$を$A$の大きさ$n$の部分集合全体のつくる集合、
		$\Pow_+A\subset\Pow_*A$を$A$の空でない部分集合全体のつくる集合とする。
		\begin{equation*}\begin{split}
			\Pow_*A = \sum_{n\in\sizen} \Pow_nA
			,\quad \Pow_+A = \sum_{n\in\sizen_+} \Pow_nA
		\end{split}\end{equation*}
		$A$が空集合の場合は、$\Pow_*A$は空集合だけからなるべき集合となる。
		%
		\item[文字列] 集合$A$に対して$\W_*A$を集合$A$から生成される
		自由モノイドとし、$\W_nA\subset\W_*A$を長さ$n$の文字列全体のつくる
		集合、$\W_+A\subset\Pow_*A$を空でない文字列全体のつくる集合とする。
		\begin{equation*}\begin{split}
			\W_*A = \sum_{n\in\sizen} \W_nA
			,\quad \W_+A = \sum_{n\in\sizen_+} \W_nA
		\end{split}\end{equation*}
		$A$が空集合の場合は、$\W_*A$は空の文字列だけからなる文字列の集合
		となる。
		$\W_*A$の文字列の連結による積は、前置記法で$m_\myspace$または$\myspace$
		と書き、中置記法では記号を省略する。
		%
		\item[文字列] $\W_*A$の元をカッコを用いて次のように書く。
		\begin{equation*}\begin{array}{rll}
			\text{空文字列}\quad & 1_\W \text{ または } []  \\
			\text{非空文字列}\quad & [a_1\cdots a_m] 
			& \quad\text{for all } a_1,\dots,a_m\in A
		\end{array}\end{equation*}
		%
		\item[文字列] 文字の文字列への作用を次のように定義する。
		\begin{equation*}\begin{split}
			a[a_1\cdots a_m] = [aa_1\cdots a_m]
		\end{split}\end{equation*}
		$a\in A$と$a\in \End(\W_*A)$を同一視して書く。
		%
		\item[自由代数] 集合$A$に対して$\W_*A$から生成される自由$R$-代数を
		$R\W_*A$と書く。$\W_*A$から$R\W_*A$への標準入射をケットを使って
		$\ket{-}:\W_*A\to R\W_*A$と書く。
		\begin{equation*}\begin{split}
				1_\W &\mapsto \ket{1} \\
				[a_1\cdots a_p] &\mapsto \ket{a_1\cdots a_p}
				\quad\text{for all } a_1,\dots,a_p\in A
		\end{split}\end{equation*}
		また、$R\W_*A$の双対空間を$R\W_*A^\tran:=\Mod{R}(R\W_*A,R)$と書き、
		$\ket{W_*A}$の双対元をブラを使って表す。
		\begin{equation*}\begin{split}
			\braket{w_1|w_2} = \jump{w_1 = w_2}
			\quad\text{for all } w_1,w_2\in \W_*A
		\end{split}\end{equation*}
		%
		\item[置換群] 空でない集合$A$に対して$A$の置換群を$\Perm A$と書く。
		$A$が有限集合でない場合は、$\Perm A$は$A$の自己同型写像全体のつくる
		集合とする。
		%
		\item[非交差和] 共通を持たない集合$A,B$に対して非交差和を$A+B$と書く。
		共通を持もつかもしれない集合$C,D$の和は$C\cup D$と書く。
	\end{description} %}

\subsection{シャッフル置換}\label{s2:シャッフル置換} %{
	$I$を全順序$\le$の定義された集合とする。

	\begin{definition}[順序で分離された部分集合]
	\label{def:順序で分離された部分集合} %{
		空でない部分集合$I_1,I_2\subseteq I$に対して、
		$I_1\oless I_2\subseteq I\times I$を次の直積集合とする。
		\begin{equation*}\begin{split}
			I_1\oless I_2 \xIff{\dfn} 
				i_1 < i_2 \quad\text{for all } i_1\in I_1,\; i_2\in I_2
		\end{split}\end{equation*}
		$I_1,I_2$を順序で分離された$I$の部分集合といい、$I_1\oless I_2$と書く。
	\end{definition} %def:順序で分離された部分集合}

	$I_1\oless I_2$ならば$I_1\cap I_2=\emptyset$となることに注意する。

	シャッフル置換と逆シャッフル置換を次のように定義する。

	\begin{definition}[シャッフル置換]\label{def:シャッフル置換} %{
		$I_1\oless I_2\subseteq I^2$に対して、
		置換群の部分集合$\Cap(I_1,I_2)\subseteq\Perm(I_1+I_2)$を
		次のように定義する。
		\begin{equation*}\begin{split}
			\sigma\in \Cap(I_1,I_2) \xIff{\dfn} \left\{\begin{split}{}
				\sigma i,\;\sigma j \in I_1 \And \sigma i < \sigma j
					&\implies i < j \\
				\sigma i,\;\sigma j \in I_2 \And \sigma i < \sigma j
					&\implies i < j \\
			\end{split}\right.
		\end{split}\end{equation*}
		$\Cap(I_1,I_2)$を$I_1\oless I_2$のシャッフル置換という。
	\end{definition} %def:シャッフル置換}
	\begin{definition}[逆シャッフル置換]\label{def:逆シャッフル置換} %{
		$I_1\oless I_2\subseteq I^2$に対して、
		$I_1+I_2$の置換群の部分集合
		$\Cap^\tran(I_1,I_2)\subseteq\Perm(I_1+I_2)$を次のように定義する。
		\begin{equation*}\begin{split}
			\sigma\in\Cap^\tran(I_1,I_2) \xIff{\dfn} \left\{\begin{array}{ll}
				\sigma i < \sigma j
				& \quad\text{for all } i,\;j \in I_1 \And i < j \\
				\sigma i < \sigma j
				& \quad\text{for all } i,\;j \in I_2 \And i < j \\
			\end{array}\right. \\ %\}
		\end{split}\end{equation*}
		$\Cap^\tran(I_1,I_2)$を$I_1\oless I_2$の逆シャッフル置換という。
	\end{definition} %def:逆シャッフル置換}

	シャッフル置換と逆シャッフル置換は集合同型で互いに逆の関係にある。
	\begin{equation*}\begin{split}
		\Cap(I_1,I_2) &\simeq \Cap^\tran(I_1,I_2) \\
		\sigma &\mapsto \sigma^{-1}
	\end{split}\end{equation*}
	したがって、シャッフル置換だけをを定義すればよいが、定義が簡単な
	逆シャッフル置換が用いられることもあるので、逆シャッフル置換も定義
	しておいた。

	シャッフル置換は通常の積で群にはならないことに注意する。
	例えば$I_1,I_2\in\sizen_+$で$I_1=\set{1,2},\;I_2=\set{3}$とすると、
	$\Cap(I_1,I_2)=\set{1,\sigma_1,\sigma_2}$の群表は次のようになる。
	\begin{equation*}\begin{split}
		\left\{\begin{array}{rcl}
			\sigma_1 &=& \begin{pmatrix}
				1 & 2 & 3 \\ 1 & 3 & 2
			\end{pmatrix} \\
			\sigma_2 &=& \begin{pmatrix}
				1 & 2 & 3 \\ 3 & 1 & 2
			\end{pmatrix} \\
		\end{array}\right. \implies \begin{array}{c|cc}
			& \sigma_1 & \sigma_2 \\\hline
			\sigma_1 & 1 & \begin{pmatrix}
				1 & 2 & 3 \\ 3 & 2 & 1
			\end{pmatrix} \\
			\sigma_2 & \begin{pmatrix}
				1 & 2 & 3 \\ 2 & 1 & 3
			\end{pmatrix} & \begin{pmatrix}
				1 & 2 & 3 \\ 2 & 3 & 1
			\end{pmatrix} \\
		\end{array}
	\end{split}\end{equation*}
	$\sigma_1^2$以外は$\Cap(I_1,I_2)$の元ではない。

	次のように順序を保ったまま文字列の文字を入れ替えていく操作を繰り返すと、
	シャッフル置換の元が列挙できる。
	\begin{equation}\label{eq:シャッフル置換の列挙その一}
	\xymatrix@R=1em@C=1em{
		[1,2\bou3,4] \ar[r] & [1\bou3,2\bou4] \ar[r] \ar[rd] 
			& [3,1,2\bou4] \ar[r] & [3,1\bou4,2] \ar[r] & [3,4,1,2] \\
		& & [1\bou3,4,2] \ar[ru] & \\
	}\end{equation}
	この図では次のような規則で文字の並びを入れ替えている。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $\set{1,2}$と$\set{3,4}$の位置を一つづつ入れ替える。
		\item $\set{1,2}$の元は左から右へ、$\set{3,4}$の元は右から左へ
		移動する。
	\end{itemize} %}
	図\eqref{eq:シャッフル置換の列挙その一}では入れ替えを行うことができる
	位置を縦棒$\bou$で示している。

	図\eqref{eq:シャッフル置換の列挙その一}の列挙を見ると、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 左端の文字は$1$または$3$、
		\item 右端の文字は$2$または$4$
	\end{itemize} %}
	となっていることに気づく。これは偶然ではなく、次の事実に基づく。
	$I_1\oless I_2\subset I^2$を次のようにおくと、
	\begin{equation*}\begin{split}
		i_1<\cdots< i_{p+q} \in I
		,\quad I_1 = \set{i_1,\dots,i_p}
		,\quad I_2 = \set{i_{p+1},\dots,i_{p+q}}
	\end{split}\end{equation*}
	任意の$\sigma\in\Cap(I_1,I_2)$に対して次の式が成り立つ。
	\begin{equation*}\begin{array}{rcll}
		\sigma i_1 \neq i_1 &\implies& \sigma i_1\not\in I_1
		& \because\; \text{$\Cap(I_1,I_2)$の定義} \\
		&\iff& \sigma i_1\in I_2 \\
		&\implies& \sigma i_1 = i_{p+1}
		& \because\; \text{$\Cap(I_1,I_2)$の定義} \\
	\end{array}\end{equation*}
	つまり、$\sigma i_1$は必ず$i_1$または$i_{p+1}$になる。
	このことを使うと、上記の方法とは別のシャッフル置換の元を列挙する方法
	が得られる。
	\begin{equation*}\begin{split}
		[1,2\bou 3,4] &= [1]\times[2\bou 3,4] + [3]\times[1,2\bou 4] \\
		&= [1,2]\times[\bou 3,4] + [1,3]\times[2\bou 4] \\
		&\,+ [3,1]\times[2\bou 4] + [3,4]\times[1,2\bou] \\
		&= [1,2,3,4] + [1,3,2]\times[\bou 4] + [1,3,4]\times[2\bou] \\
		&\,+ [3,1,2]\times[\bou 4] + [3,1,4]\times[2\bou] + [3,4,1,2] \\
		&= [1,2,3,4] + [1,3,2,4] + [1,3,4,2] \\
		&\,+ [3,1,2,4] + [3,1,4,2] + [3,4,1,2] \\
	\end{split}\end{equation*}
	したがって、シャッフル置換を次のように拡張すると、
	\begin{equation}\label{eq:シャッフル置換の拡張}\begin{split}
		\Cap(\emptyset,J) = \set{\id_J} = \Cap(J,\emptyset) 
		\quad\text{for all } J\ne\emptyset\subseteq I
	\end{split}\end{equation}
	シャッフル置換の次の分解が得られる。
	\begin{equation}\label{eq:シャッフル置換の分解}\begin{split}
		\Cap(I_1,I_2) = \Cap(I_1',I_2) + \Cap(I_1,I_2') \quad\text{where} \\
		I_1' := I_1 - \set{\min I_1},\quad I_2' := I_2 - \set{\min I_2}
	\end{split}\end{equation}
	この分解から、シャッフル置換の大きさ$\Cap_{|I_1|,|I_2|}:=\Cap(I_1,I_2)$
	についての次の漸化式が得られる。
	\begin{equation}\label{eq:シャッフル置換の大きさの漸化式}
	\begin{array}{rcll}
		\Cap_{m+1,n+1} &=& \Cap_{m,n+1} + \Cap_{m+1,n}
			& \quad\text{for all } m,n\in\sizen \\
		\Cap_{m,0} &=& 1 = \Cap_{0,m} & \quad\text{for all } m\in\sizen \\
	\end{array}\end{equation}
	この漸化式は次のように考えて解くことができる。
	$\Cap_{I_1,I_2}$は$|I_1|+|I_2|$個の箱を一直線に並べて、箱の中に$I_1$と
	$I_2$の元をそれぞれの順序を保ちながら入れていく方法と考えることができる。
	その時、$|I_1|+|I_2|$個の箱の中から$I_1$個の箱を選び出すと、$I_1$と$I_2$
	の順序を保つことから、一意に元の分配方法が定まってしまう。したがって、
	次の式が成り立つことになる。
	\begin{equation}\label{eq:シャッフル置換の大きさ}\begin{split}
		\Cap_{m,n} &= \binom{m+n}{n} \quad\text{for all } m,n\in\sizen_+
	\end{split}\end{equation}
	実際、二項係数は次の式を満たす。
	\begin{equation*}\begin{split}
		\binom{m+n+2}{m+1} = \binom{m+n+1}{m} + \binom{m+n+1}{m+1}
		\quad\text{for all } m,n\in\sizen
	\end{split}\end{equation*}
%s2:シャッフル置換}
\subsection{シャッフル積}\label{s2:シャッフル積} %{
	シャッフル置換を用いてシャッフル積を定義する。

	\begin{definition}[シャッフル積]\label{def:シャッフル積} %{
		$A$を集合とする。
		$R$-双線形写像$\shuffle:R\W_*A\otimes R\W_*A\to R\W_*A$
		を次のように定義する。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item 任意の$w\in \W_*A$に対して
			\begin{equation*}\begin{split}
				\ket{w}\shuffle\ket{1} = \ket{w} = \ket{1}\shuffle\ket{w}
			\end{split}\end{equation*}
			\item 任意の$a_1,\dots,a_{p+q}\in A$に対して
			\begin{equation*}\begin{split}
				\ket{a_1\cdots a_p}\shuffle\ket{a_{p+1}\cdots a_{p+q}}
				= \sum_{\sigma\in\Cap(I_1,I_2)} 
				\ket{a_{\sigma1}\cdots a_{\sigma(p+q)}} \text{ where} \\
				I_1=1..p,\quad I_2=(p+1)..(p+q)
			\end{split}\end{equation*}
		\end{itemize} %}
		$\shuffle$を$R\W_*A$のシャッフル積という。
	\end{definition} %def:シャッフル積}

	$R\W_+\sizen_+$に対するシャッフル積は次のようになる。
	\begin{equation*}\begin{split}
		[1]\shuffle[2] &= [1,2] + [2,1] \\
		[1,2]\shuffle[3] &= [1,2,3] + [1,3,2] + [3,1,2] \\
		[1,2]\shuffle[3,4] &= [1,2,3,4] + [1,3,2,4] + [1,3,4,2] \\
			&\, + [3,1,2,4] + [3,1,4,2] + [3,4,1,2] \\
	\end{split}\end{equation*}

	シャッフル積は対称な積となるが、それを証明する前に、
	シャッフル置換の分解\eqref{eq:シャッフル置換の分解}を用いて、
	シャッフル積を漸化式によって計算する方法を導いておく。

	\begin{proposition}[シャッフル積の摂動]\label{prop:シャッフル積の摂動} %{
		$A$を集合とする。任意の$v_1,v_2\in RA$と$x_1,x_2\in R\W_*A$に対して
		次の式が成り立つ。
		\begin{equation*}\begin{split}
			(v_1x_1)\shuffle(v_2x_2) = v_1\bigl(x_1\shuffle(v_2x_2)\bigr) 
				+ v_2\bigl((v_1x_1)\shuffle x_2\bigr)
		\end{split}\end{equation*}
	\end{proposition} %prop:シャッフル積の摂動}
	\begin{proof} $p,q\in\sizen_+$として、
	シャッフル置換の分解\eqref{eq:シャッフル置換の分解}を
	シャッフル積に適用すると次のようになる。
	\begin{equation*}\begin{split}
		& \ket{a_1\cdots a_p}\shuffle\ket{a_{p+1}\cdots a_{p+q}} \\
		&= \sum_{\sigma\in\Cap(1..p,(p+1)..(p+q))}
			\ket{a_{\sigma 1}\cdots a_{\sigma p}
			a_{\sigma(p+1)}\cdots a_{\sigma(p+q)}} \\
		&= \sum_{\sigma\in\Cap(2..p,(p+1)..(p+q))}
			a_1\ket{a_{\sigma }\cdots a_{\sigma p}
			a_{\sigma(p+1)}\cdots a_{\sigma(p+q)}} \\
		&\,+ \sum_{\sigma\in\Cap(1..p,(p+2)..(p+q))}
			a_{p+1}\ket{a_{\sigma }\cdots a_{\sigma p}
			a_{\sigma(p+2)}\cdots a_{\sigma(p+q)}} \\
		&= a_{1}\bigl(\ket{a_2\cdots a_p}
			\shuffle\ket{a_{p+1}\cdots a_{p+q}}\bigr)
			+ a_{p+1}\bigl(\ket{a_1\cdots a_p}
			\shuffle\ket{a_{p+2}\cdots a_{p+q}}\bigr)
	\end{split}\end{equation*}
	したがって、命題の式が成り立つことがわかる。
	\end{proof}

	この命題を用いて、シャッフル積が対称な積となることを証明する。

	\begin{proposition}[シャッフル積は対称な積]
	\label{prop:シャッフル積は対称な積} %{
		次の命題が成り立つ。
		\begin{enumerate}\setlength{\itemsep}{-1mm} %{
			\item\label{eum:シャッフル積は対称} シャッフル積は対称である。
			\item\label{eum:シャッフル積は結合的} シャッフル積は結合的である。
		\end{enumerate} %}
	\end{proposition} %prop:シャッフル積は対称な積}
	\begin{proof} $A$を集合とする。
	$A$が$\W_*A$の生成元になっていることと、
	\begin{equation*}\begin{split}
		v\in\W_{n+1} \implies \exists\; x\in A,\; w\in\W_nA \text{ s.t. }
		v = xw
	\end{split}\end{equation*}
	シャッフル積が文字列の長さを保つこと
	\begin{equation*}\begin{split}
		w_1\in \W_mA \And w_2\in \W_nA
		\implies w_1\shuffle w_2\in R\W_{m+n}A
	\end{split}\end{equation*}
	を使って、連結した文字列の長さの帰納法によって証明する。
	対称性と結合性の証明は同じようにして証明される。

	\ref{eum:シャッフル積は対称}\quad
	シャッフル積の定義より、任意の$w\in\W_*A$に対して次の式が成り立つ。
	\begin{equation}\label{eq:単位元とのシャッフル積}\begin{split}
		w\shuffle1_\W=w=1_\W\shuffle w
	\end{split}\end{equation}
	特に、連結した文字列の長さが$1$以下のときに命題が成り立つことがわかる。
	連結した文字列の長さが$n$以下のときに命題が成り立つと仮定する。
	\begin{equation*}\begin{split}
		w_1\shuffle w_2 = w_2\shuffle w_1
		\quad\text{for all } |w_1| + |w_2| \le n
	\end{split}\end{equation*}

	$x_1,x_2\in\W_*A$を$|x_1|+|x_2|=n+1$となる文字列とする。
	$x_1=1_\W$または$x_2=1_\W$のときは、$1_\W$がシャッフル積の単位元
	だから、$x_1\shuffle x_2=x_2\shuffle x_1$が成り立つ。
	したがって、$x_1,x_2\in\W_+A$とする。この時、
	$x_1=a_1w_1$かつ$x_2=a_2w_2$となる$a_1,a_2\in A$と$w_1,w_2\in\W_*A$
	が存在する。そして、次の式が成り立つ。
	\begin{equation}\label{eq:非単位同士のシャッフル積}\begin{split}
		(a_1w_1)\shuffle(a_2w_2) &= a_1\bigl(w_1\shuffle(a_2w_2)\bigr) 
			+ a_2\bigl((a_1w_1)\shuffle w_2\bigr) \\
		(a_2w_2)\shuffle(a_1w_1) &= a_2\bigl(w_2\shuffle(a_1w_1)\bigr) 
			+ a_1\bigl((a_2w_2)\shuffle w_1\bigr) \\
	\end{split}\end{equation}
	$|w_1|+|w_2|=n-1$だから、帰納法の仮定より、
	$w_1\shuffle(a_2w_2)=(a_2w_2)\shuffle w_1$と
	$(a_1w_1)\shuffle w_2=w_2\shuffle(a_1w_1)$が成り立つから、
	\begin{equation*}\begin{split}
		(a_1w_1)\shuffle(a_2w_2) = (a_2w_2)\shuffle(a_1w_1)
	\end{split}\end{equation*}
	となることがわかる。よって、任意の$|x_1|+|x_2|=n+1$となる
	$x_1,x_2\in\W_*A$に対して$x_1\shuffle x_2=x_2\shuffle x_1$となることが
	わかり、連結した文字列の長さが$n+1$のときも命題が成り立つことがわかる。
	
	\ref{eum:シャッフル積は結合的}\quad
	シャッフル積の定義より、任意の$w_1,w_2\in\W_*A$に対して次の式が成り立つ。
	\begin{equation}\label{eq:単位元とのシャッフル積その二}\begin{split}
		(w_1\shuffle1_\W)\shuffle w_2 = w_1\shuffle w_2 
		= w_1\shuffle (1_\W\shuffle w_2)
	\end{split}\end{equation}
	特に、連結した文字列の長さが$2$以下のときに命題が成り立つことがわかる。
	連結した文字列の長さが$n$以下のときに命題が成り立つと仮定する。
	\begin{equation*}\begin{split}
		w_1\shuffle(w_2\shuffle w_3) = (w_1\shuffle w_2)\shuffle w_3
		\quad\text{for all } |w_1| + |w_2| + |w_3| \le n
	\end{split}\end{equation*}
	$x_1,x_2,x_3\in\W_*A$を$|x_1|+|x_2|+|x_3|=n+1$となる文字列とする。
	$x_1,x_2,x_3$のうちどれかが$1_\W$ときは、
	式\eqref{eq:単位元とのシャッフル積その二}から、
	$(x_1\shuffle x_2)\shuffle x_3=x_1\shuffle(x_2\shuffle x_3)$が成り立つ。
	したがって、$x_1,x_2,x_3\in\W_+A$とする。この時、各$i=1,2,3$に対して、
	$x_i=a_iw_i$となる$a_i\in A$と$w_i\in\W_*A$が存在する。
	そして、次の式が成り立つ。
	\begin{equation}\label{eq:非単位同士のシャッフル積その二}\begin{split}
		\bigl((a_1w_1)\shuffle(a_2w_2)\bigr)\shuffle(a_3w_3)
		&= a_1\biggl(\bigl(w_1\shuffle(a_2w_2)\bigr)\shuffle(a_3w_3)\biggr) \\
		&\,+ a_2\biggl(\bigl((a_1w_1)\shuffle w_2\bigr)\shuffle(a_3w_3)\biggr) \\
		&\,+ a_3\biggl(\bigl((a_1w_1)\shuffle(a_2w_2)\bigr)\shuffle w_3\biggr) \\
		(a_1w_1)\shuffle\bigl((a_2w_2)\shuffle(a_3w_3)\bigr)
		&= a_1\biggl(w_1\shuffle\bigl((a_2w_2)\shuffle(a_3w_3)\bigr)\biggr) \\
		&\,+ a_2\biggl((a_1w_1)\shuffle\bigl(w_2\shuffle(a_3w_3)\bigr)\biggr) \\
		&\,+ a_3\biggl((a_1w_1)\shuffle\bigl((a_2w_2)\shuffle w_3\bigr)\biggr) \\
	\end{split}\end{equation}
	$|w_1|+|w_2|+|w_3|=n-2$だから、帰納法の仮定より、次の式が成り立つから、
	\begin{equation*}\begin{split}
		\bigl(w_1\shuffle(a_2w_2)\bigr)\shuffle(a_3w_3)
		&= w_1\shuffle\bigl((a_2w_2)\shuffle(a_3w_3) \\
		\bigl((a_1w_1)\shuffle w_2\bigr)\shuffle(a_3w_3)
		&= (a_1w_1)\shuffle\bigl(w_2\shuffle(a_3w_3) \\
		\bigl((a_1w_1)\shuffle(a_2w_2)\bigr)\shuffle w_3
		&= (a_1w_1)\shuffle\bigl((a_2w_2)\shuffle w_3 \\
	\end{split}\end{equation*}
	次の式が成り立つことがわかる。
	\begin{equation*}\begin{split}
		\bigl((a_1w_1)\shuffle(a_2w_2)\bigr)\shuffle(a_3w_3)
		= (a_1w_1)\shuffle\bigl((a_2w_2)\shuffle(a_3w_3)\bigr)
	\end{split}\end{equation*}
	よって、任意の$|x_1|+|x_2|+|x_3|=n+1$となる$x_1,x_2,x_3\in\W_*A$に対して
	$(x_1\shuffle x_2)\shuffle x_3=x_1\shuffle(x_2\shuffle x_3)$となることが
	わかり、連結した文字列の長さが$n+1$のときも命題が成り立つことがわかる。
	\end{proof}

	シャッフル積を拡張してq-シャッフル積を定義する\cite{Duchamp1997Non}。
	q-シャッフル積は文字列の連結と外積代数を含むシャッフル積の
	拡張になっている。シャッフル積の拡張には擬シャッフル積
	（quasi-shuffle product）もあるが、ここではそれは扱わない。

	\begin{definition}[q-シャッフル積（q-shuffle product）]
	\label{def:q-シャッフル積} %{
		$A$を集合とする。$q\in R$に対して
		$R$-双線形写像$\shuffle_q:R\W_*A\otimes R\W_*A\to R\W_*A$
		を次のように再帰的に定義する。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item 任意の$w\in \W_*A$に対して
			\begin{equation*}\begin{split}
				w\shuffle_q1_\W = w = 1_\W\shuffle_qw
			\end{split}\end{equation*}
			\item 任意の$a_1,a_2\in A$と$w_1,w_2\in\W_*A$に対して
			\begin{equation*}\begin{split}
				(a_1w_1)\shuffle (a_2w_2)
				= a_1\bigl(w_1\shuffle_q(a_2w_2)\bigr)
				+ q^{|w_1|+1} a_2\bigl((a_1w_1)\shuffle_2w_2\bigr)
			\end{split}\end{equation*}
		\end{itemize} %}
		$\shuffle_q$を$R\W_*A$のq-シャッフル積という。
	\end{definition} %def:q-シャッフル積}

	q-シャッフル積の$q=0$が文字列の連結、$q=1$がシャッフル積、
	$q=-1$が外積に対応する。

	\begin{proposition}[q-シャッフル積は積]\label{prop:q-シャッフル積は積} %{
		q-シャッフル積は結合的である。
	\end{proposition} %prop:q-シャッフル積は積}
	\begin{proof} まず、任意の$a_1,a_2,a_3\in A$に対して次の結合性が
	成り立つ。
	\begin{equation*}\begin{split}
		\bigl([a_1]\shuffle_q[a_2]\bigr)\shuffle_q[a_3]
		= [a_1]\shuffle_q\bigl([a_2]\shuffle_q[a_3]\bigr) \\
		= [a_1a_2a_3] + q\bigl([a_1a_3a_2] + [a_2a_1a_3]\bigr)
		+ q^2\bigl([a_3a_1a_2] + [a_2a_3a_1]\bigr) + q^3[a_3a_2a_1]
	\end{split}\end{equation*}
	任意の$a_1,a_2,a_3\in A$と$w_1,w_2,w_3\in \W_*A$に対して、
	次の式が成り立つことを帰納法に帰着させる。
	\begin{equation}\label{eq:q-シャッフル積の結合性}\begin{split}
		\bigl(a_1w_1\shuffle_qa_2w_2\bigr)\shuffle_qa_3w_3
		= a_1w_1\shuffle_q\bigl(a_2w_2\shuffle_qa_3w_3\bigr)
	\end{split}\end{equation}
	ここで、カッコを減らすために$aw\shuffle\cdots:=(aw)\shuffle\cdots$という
	演算の順序で書くことにする。
	左辺は次のようになり、
	\begin{equation*}\begin{split}
		\text{lhs} &= \bigl(a_1(w_1\shuffle_qa_2w_2)
			+ q^{|w_1|+1}a_2(a_1w_1\shuffle_qw_2)\bigr)\shuffle a_3w_3 \\
		&= a_1 \bigl((w_1\shuffle_qa_2w_2)\shuffle a_3w_3\bigr)
			+ q^{|w_1|+|w_2|+2}
			a_3 \bigl(a_1(w_1\shuffle_qa_2w_2)\shuffle w_3\bigr) \\
		&\,+ q^{|w_1|+1}a_2\bigl((a_1w_1\shuffle_qw_2)\shuffle a_3w_3\bigr)
			+ q^{2|w_1|+|w_2|+3}
			a_3\bigl(a_2(a_1w_1\shuffle_qw_2)\shuffle w_3\bigr) \\
		&= a_1 \bigl((w_1\shuffle_qa_2w_2)\shuffle a_3w_3\bigr)
			+ q^{|w_1|+1}a_2\bigl((a_1w_1\shuffle_qw_2)\shuffle a_3w_3\bigr) \\
		&\,+ q^{|w_1|+|w_2|+2}
			a_3 \bigl(a_1(w_1\shuffle_qa_2w_2)\shuffle w_3
			+ q^{|w_1|+1} a_2(a_1w_1\shuffle_qw_2)\shuffle w_3\bigr) \\
		&= a_1 \bigl((w_1\shuffle_qa_2w_2)\shuffle a_3w_3\bigr)
			+ q^{|w_1|+1}a_2\bigl((a_1w_1\shuffle_qw_2)\shuffle a_3w_3\bigr) \\
		&\,+ q^{|w_1|+|w_2|+2}
			a_3 \bigl((a_1w_1\shuffle_qa_2w_2)\shuffle w_3\bigr) \\
	\end{split}\end{equation*}
	右辺は次のようになる。
	\begin{equation*}\begin{split}
		\text{rhs} &= a_1w_1\shuffle_q\bigl(a_2(w_2\shuffle_qa_3w_3) 
			+ q^{|w_2|+1} a_3(a_2w_2\shuffle_qw_3)\bigr) \\
		&= a_1\bigl(w_1\shuffle_qa_2(w_2\shuffle_qa_3w_3)\bigr)
			+ q^{|w_1|+1} a_2\bigl(a_1w_1\shuffle_q(w_2\shuffle_qa_3w_3)\bigr) \\
		&\,+ q^{|w_2|+1}
			a_1 \bigl(w_1\shuffle_qa_3(a_2w_2\shuffle_qw_3)\bigr)
			+ q^{|w_1|+|w_2|+2}
			a_3 \bigl(a_1w_1\shuffle_q(a_2w_2\shuffle_qw_3)\bigr) \\
		&= a_1\bigl(w_1\shuffle_qa_2(w_2\shuffle_qa_3w_3)
			+ q^{|w_2|+1} w_1\shuffle_qa_3(a_2w_2\shuffle_qw_3)\bigr) \\
		&\,+ q^{|w_1|+1} a_2\bigl(a_1w_1\shuffle_q(w_2\shuffle_qa_3w_3)\bigr)
			+ q^{|w_1|+|w_2|+2}
			a_3 \bigl(a_1w_1\shuffle_q(a_2w_2\shuffle_qw_3)\bigr) \\
		&= a_1\bigl(w_1\shuffle_q(a_2w_2\shuffle_qa_3w_3)\bigr)
			+ q^{|w_1|+1} a_2\bigl(a_1w_1\shuffle_q(w_2\shuffle_qa_3w_3)\bigr) \\
		&\,+ q^{|w_1|+|w_2|+2}
			a_3 \bigl(a_1w_1\shuffle_q(a_2w_2\shuffle_qw_3)\bigr) \\
	\end{split}\end{equation*}
	したがって、次の式が成り立てば、式\eqref{eq:q-シャッフル積の結合性}が
	成り立つことになる。
	\begin{equation*}\begin{split}
		(w_1\shuffle_qa_2w_2)\shuffle a_3w_3
			&= w_1\shuffle_q(a_2w_2\shuffle_qa_3w_3) \\
		(a_1w_1\shuffle_qw_2)\shuffle a_3w_3
			&= a_1w_1\shuffle_q(w_2\shuffle_qa_3w_3) \\
		(a_1w_1\shuffle_qa_2w_2)\shuffle w_3
			&= a_1w_1\shuffle_q(a_2w_2\shuffle_qw_3) \\
	\end{split}\end{equation*}
	よって、命題の証明は文字列の長さ$|w_1w_2w_3|$に関する帰納法に帰着する。
	\end{proof}

	q-シャッフル積をシャッフル置換を用いて表すことを考える。
	まず、置換に対してその重さを定義する。

	\begin{definition}[置換の重さ]\label{def:置換の重さ} %{
		$S_n$を$n$次対称群とする。
		任意の$\sigma\in S_n$に対して、$\sigma$をあみだくじとして書いた時に
		必要となる\underline{最小の}横線の数を$|\sigma|$と書く。
	\end{definition} %def:置換の重さ}

	$3$次対称群の場合、巡回置換を用いるとその重さは次のようになる。
	\begin{equation*}\begin{split}
		|()| = 0,\quad |(1,2)| = |(2,3)| = |(3,1)| = 1
		,\quad |(1,2,3)| = |(1,3,2)| = 2
	\end{split}\end{equation*}
	一般に置換の重さは次の三角不等式を満たす。
	\begin{equation*}\begin{split}
		|\sigma_1\sigma_2|\le |\sigma_1| + |\sigma_2| \\
		|\sigma_1\sigma_2| = 0 \iff \sigma_1\sigma_2 = \id
	\end{split}
		\quad\text{for all } \sigma_1,\sigma_2\in S_n
	\end{equation*}

	置換の重さを用いると、q-シャッフル積は次のように書くことができる。
	\begin{equation*}\begin{split}
		\ket{a_1\cdots a_p}\shuffle_q\ket{a_{p+1}\cdots a_{p+q}}
		= \sum_{\sigma\in\Cap(I_1,I_2)} q^{|\sigma|}
		\ket{a_{\sigma 1}\cdots a_{\sigma(p+q)}} \quad\text{where} \\
		I_1 = 1..p,\; I_2 = (p+1)..(p+q)
		\quad\text{for all } a_1,\dots,a_{p+q}\in A
	\end{split}\end{equation*}
	シャッフル置換の分解\eqref{eq:シャッフル置換の分解}から、
	このようにq-シャッフル積を定義しても、シャッフル積の定義
	\ref{def:q-シャッフル積}の漸化式を満たすことがわかる。

	\begin{proposition}[q-シャッフル写像その一]
	\label{prop:q-シャッフル写像その一} %{
		$S_n$を$n$次対称群とすると、任意の$a_1,\dots,a_n\in A$に対して
		次の式が成り立つ。
		\begin{equation*}\begin{split}
			\ket{a_1}\shuffle_q\cdots\shuffle_q\ket{a_n}
			= \sum_{\sigma\in S_n} q^{|\sigma|}
			\ket{a_{\sigma1}\cdots a_{\sigma n}}
		\end{split}\end{equation*}
	\end{proposition} %prop:q-シャッフル写像その一}
	\begin{proof} 文字数$n$に関する帰納法で証明する。まず、$n=2$の時は
	q-シャッフル積の定義より命題が成り立つことがわかる。
	\begin{equation*}\begin{split}
		\ket{a_1}\shuffle_q\ket{a_2}
		&= \sum_{\sigma\in S_2} q^{|\sigma|} \ket{a_{\sigma1}a_{\sigma2}}
		\quad\text{for all } a_1,a_2\in A
	\end{split}\end{equation*}
	ある$2\le n\in\sizen$に対して命題が成り立つとすると、
	任意の$a_1,\dots,a_{n+1}$に対して次の式が成り立つ。
	\begin{equation*}\begin{split}
		\ket{a_1}\shuffle_q\cdots\shuffle_q\ket{a_{n+1}}
		&= \sum_{\sigma\in S_n} q^{|\sigma|} \ket{a_{\sigma1}\cdots a_{\sigma n}}
			\shuffle_q\ket{a_{n+1}} \\
		&= \sum_{\sigma\in S_n} q^{|\sigma|} \left(\begin{array}{rrl}
			&& \ket{a_{\sigma1}\cdots a_{\sigma n}a_{n+1}} \\
			+& q & \ket{a_{\sigma1}\cdots a_{\sigma(n-1)}a_{n+1}a_{\sigma n}} \\
			+& & \cdots \\
			+& q^n & \ket{a_{n+1}a_{\sigma1}\cdots a_{\sigma n}} \\
		\end{array}\right) \\
		&= \sum_{\sigma\in S_{n+1}} q^{|\sigma|} \ket{a_{\sigma1}
			\cdots a_{\sigma(n+1)}} \\
	\end{split}\end{equation*}
	したがって、文字数が$n+1$の時も命題が成り立つことがわかる。
	\end{proof}

	\begin{definition}[q-シャッフル写像]\label{def:q-シャッフル写像} %{
		$A$を集合とする。$R$-線形写像$\Cap_q:R\W_*A\to R\W_*A$を次のように
		定義する。
		\begin{equation*}\begin{array}{rcll}
			\Cap_q\ket{1} &:=& \ket{1} \\
			\Cap_q\ket{a_1\cdots a_m} 
			&:=& \sum_{\sigma\in S_n} q^{|\sigma|} \ket{a_{\sigma1}\cdots a_{\sigma n}}
			%&=& \ket{a_1}\shuffle_q\cdots\shuffle_q\ket{a_m}
			& \quad\text{for all } a_1,\dots,a_m\in A
		\end{array}\end{equation*}
		$\Cap_q$をq-シャッフル写像ということにする。
	\end{definition} %def:q-シャッフル写像}

	\begin{proposition}[q-シャッフル写像その二]
	\label{prop:q-シャッフル写像その二} %{
		文字列の連結$\myspace$とq-シャッフル積の間に次の関係が成り立つ。
		\begin{equation*}\begin{split}
			(-\shuffle_q-)(\Cap_q\otimes\Cap_q)
			= \Cap_q(-\myspace-)
		\end{split}\end{equation*}
	\end{proposition} %prop:q-シャッフル写像その二}
	\begin{proof} 一項目の文字数に関する帰納法によって証明する。
	まず、任意の$w\in\W_*A$に対して次の式が成り立つことがわかる。
	\begin{equation*}\begin{split}
		\bigl(\Cap_q\ket{1}\bigr)\shuffle_q\bigl(\Cap_q\ket{w}\bigr)
		= \Cap_q\ket{w}
	\end{split}\end{equation*}
	任意の$w_1,w_2\in\W_*A$と$a\in A$に対して次の式が成り立つから、
	\begin{equation*}\begin{split}
		\bigl(\Cap_q\ket{w_1}\bigr)\shuffle_q\bigl(\Cap_q\ket{w_2}\bigr)
		= \Cap_q\ket{w_1w_2} \\
		\implies \begin{split}
			\bigl(\Cap_qa\ket{w_1}\bigr)\shuffle_q\bigl(\Cap_q\ket{w_2}\bigr)
			& = \ket{a}\shuffle_q\bigl(\Cap_q\ket{w_1}\bigr)
				\shuffle_q\bigl(\Cap_q\ket{w_2}\bigr) \\
			& = \ket{a}\shuffle_q\bigl(\Cap_q\ket{w_1w_2}\bigr) \\
			& = \Cap_qa\ket{w_1w_2}
		\end{split}
	\end{split}\end{equation*}
	$w_1$の長さについて帰納法を使うと命題が証明される。
	\end{proof}

	この命題より、$\Cap_p$は$R$-代数準同型
	$\Cap_p:(R\T_*A,-\myspace-)\to(\Cap_pR\T_*A,-\shuffle_q-)$
	となることがわかる。

	\begin{todo}[余積の性質]\label{todo:余積の性質} %{
		積の代数的な双対として余積$\Delta_q$を定義すると次のようになる。
		\begin{equation*}\begin{split}
			\Delta_q(a\shuffle_qb) = (\Delta_qa)\shuffle(\Delta_qb),\quad
			\Delta_q(b\shuffle_qa) = (\Delta_qb)\shuffle(\Delta_qa)
		\end{split}\end{equation*}
		これを行列で書くと次のようになる。
		\begin{equation*}\begin{split}
			\Delta_q \begin{pmatrix}
				1 & q \\ q & 1
			\end{pmatrix} \begin{pmatrix}
				ab \\ ba
			\end{pmatrix} = \begin{pmatrix}
				1 & q \\ q & 1
			\end{pmatrix} \begin{pmatrix}
				ab\otimes 1 + 1\otimes ab \\ ba\otimes 1 + 1\otimes ba
			\end{pmatrix} + \begin{pmatrix}
				1 & 1 \\ 1 & 1
			\end{pmatrix} \begin{pmatrix}
				a\otimes b \\ b\otimes a
			\end{pmatrix} \\
			\udset{q\neq-1}{}{\implies} \Delta_q \begin{pmatrix}
				ab \\ ba
			\end{pmatrix} = \begin{pmatrix}
				ab\otimes 1 + 1\otimes ab \\ ba\otimes 1 + 1\otimes ba
			\end{pmatrix} + \frac{1}{1+q}\begin{pmatrix}
				1 & 1 \\ 1 & 1
			\end{pmatrix}\begin{pmatrix}
				a\otimes b \\ b\otimes a
			\end{pmatrix} + \ker \begin{pmatrix}
				1 & q \\ q & 1
			\end{pmatrix}
		\end{split}\end{equation*}
		$q=-1$のときは外積代数に対応するが、$\Delta_{-1}$は$R\W_*A$全域で
		定義することができないことを示している。ただし、$q=-1$の時も、
		部分代数$\Wedge_*A\subset R\W_*A$には$\Delta_{-1}$は定義できる。
		$\ker$の部分は不定性を表している。$1-q^2=0$の時のみ$\ker$は存在するが、
		$q=-1$の時は$1/(1+q)$が定義できなのので、$q=1$の時のみ$\ker$が存在
		する。したがって、$q$の値に応じて$\Delta_q$は次のようになる。
		\begin{equation*}\begin{array}{rcrcll}
			q = 1 &:& \Delta_{1} \begin{pmatrix}
				ab \\ ba
			\end{pmatrix} &=& \begin{pmatrix}
				ab\otimes 1 + 1\otimes ab \\ ba\otimes 1 + 1\otimes ba
			\end{pmatrix} + \cfrac{1}{2}\begin{pmatrix}
				1 & 1 \\ 1 & 1
			\end{pmatrix}\begin{pmatrix}
				a\otimes b \\ b\otimes a
			\end{pmatrix} + \ker \begin{pmatrix}
				1 & 1 \\ 1 & 1
			\end{pmatrix} \\
			|q| \neq 1 &:& \Delta_q \begin{pmatrix}
				ab \\ ba
			\end{pmatrix} &=& \begin{pmatrix}
				ab\otimes 1 + 1\otimes ab \\ ba\otimes 1 + 1\otimes ba
			\end{pmatrix} + \cfrac{1}{1+q}\begin{pmatrix}
				1 & 1 \\ 1 & 1
			\end{pmatrix}\begin{pmatrix}
				a\otimes b \\ b\otimes a
			\end{pmatrix}
		\end{array}\end{equation*}

		一方、積の内積的な双対として余積$m_q^\tran$を定義すると次のようになる。
		\begin{equation*}\begin{split}
			m_q^\tran\ket{ab}
			&= \sum_{x,y\in \W_*A}(\ket{x}\otimes\ket{y})(\bra{x}\otimes\bra{y})
				m_q^\tran\ket{ab} \\
			&= \sum_{x,y\in \W_*A}(\ket{x}\otimes\ket{y})
				\bigl(m_q(\ket{x}\otimes\ket{y})\bigr)^\tran\ket{ab} \\
			&= \ket{ab}\otimes\ket{1} + \ket{a}\otimes\ket{b} 
				+ \ket{1}\otimes \ket{ab} + q\ket{b}\otimes\ket{a} \\
		\end{split}\end{equation*}
		これを行列で書くと次のようになる。
		\begin{equation*}\begin{split}
			m_q^\tran\begin{pmatrix}
				ab \\ ba
			\end{pmatrix} = \begin{pmatrix}
				ab\otimes 1 + 1\otimes ab \\
				ba\otimes 1 + 1\otimes ba \\
			\end{pmatrix} + \begin{pmatrix}
				1 & q \\ q & 1
			\end{pmatrix} \begin{pmatrix}
				a\otimes b \\ b\otimes a
			\end{pmatrix}
		\end{split}\end{equation*}
		$\Delta_1$の$\ker$の部分を次のようにとると、
		\begin{equation*}\begin{split}
			\frac{1}{2} \begin{pmatrix}
				1 & -1 \\ -1 & 1
			\end{pmatrix} \begin{pmatrix}
				a\otimes b \\ b\otimes a
			\end{pmatrix}\in \ker \begin{pmatrix}
				1 & 1 \\ 1 & 1
			\end{pmatrix}
		\end{split}\end{equation*}
		$m_0^\tran=\Delta_1$となる。このことは、
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item 文字列の連結について内積的な余積がシャッフル積の代数的な余積
			になっている
		\end{itemize} %}
		ことは特殊な例であることを示している。
	\end{todo} %todo:余積の性質}

	\begin{todo}[余積の一意性]\label{todo:余積の一意性} %{
		テンソル代数の普遍性から代数的双対な余積が一意に定まることがわかる。
		部分$R$-代数$V\subseteq R\W_*A$として次の可換図が成り立つ。
		\begin{equation*}\begin{array}{rcll}
			\xymatrix{
				A \ar[r]^{-\ket{1}} \ar[rd]_{f} & R\W_*A \ar@{.>}[d]^{f_*} \\
				& V
			} \quad \xymatrix{
				A \ar[r]^{-\ket{1}} \ar[rd]_{g} & R\W_*A \ar@{.>}[d]^{g_*} \\
				& V\otimes V
			}
		\end{array}\end{equation*}
	\end{todo} %todo:余積の一意性}
%s2:シャッフル積}
\subsection{シャッフル積の列挙}\label{s2:シャッフル積の列挙} %{
	q-シャッフル積をプログラムを使って列挙する方法を考える。
	q-シャッフル積に現れる単語の数は、文字数に対して指数的に増加する。
	例えば、$16$文字の単語同士のq-シャッフル積に現れる単語の数は、
	$\binom{16+16}{16}=601080390$（約$6$億）となる。したがって、単語を
	列挙するにはなるべく効率的に計算する必要がある。

	次の式を例にして説明する。
	\begin{equation*}\begin{split}
		\ket{1,2,3}\shuffle_q\ket{4,5}
	\end{split}\end{equation*}
	このq-シャッフル積に現れる重み付き単語は次の格子の$(0,0)$から
	$(3,2)$に至る経路として表すことができる（集合同型）。
	\begin{equation}\label{eq:3-2の経路}\xymatrix{
		(0,2) \ar[r]^{(q^0,1)} & (1,2) \ar[r]^{(q^0,2)} 
			& (2,2) \ar[r]^{(q^0,3)} & (3,2) \\
		(0,1) \ar[r]^{(q^0,1)} \ar[u]_{(q^3,5)} 
			& (1,1) \ar[r]^{(q^0,2)} \ar[u]_{(q^2,5)} 
			& (2,1) \ar[r]^{(q^0,3)} \ar[u]_{(q^1,5)} 
			& (3,1) \ar[u]_{(q^0,5)} \\
		(0,0) \ar[r]^{(q^0,1)} \ar[u]_{(q^3,4)} 
			& (1,0) \ar[r]^{(q^0,2)} \ar[u]_{(q^2,4)} 
			& (2,0) \ar[r]^{(q^0,3)} \ar[u]_{(q^1,4)} 
			& (3,0) \ar[u]_{(q^0,4)} \\
	}\end{equation}
	例えば、経路$(0,0)(1,0)(1,1)(2,1)(3,1)(3,2)$は
	$q^{0+2+0+0+0}\ket{1,4,2,3,5}$という重み付きの単語に対応する。

	経路\eqref{eq:3-2の経路}をパラメトライズすることを考える。
	$\ket{1,2,3}\shuffle_q\ket{4,5}$の中に現れる単語は、
	文字$\set{1,2,3}$が単語の中の何文字目に現れるかを決めれば一意的に
	決まる。したがって、図\eqref{eq:3-2の経路}の経路の集合を$I_{3,2}$
	とすると、$I_{3,2}$は次の単語の集合として表すことができる。
	\begin{equation*}\begin{split}
		I_{3,2} := \set{\ket{k_1,k_2,k_3}\bou k_1,k_2,k_3\in 1..5
			\And k_0< k_1< k_2}
	\end{split}\end{equation*}
	$\ket{k_1,k_2,k_3}\in I_{3,2}$は、生成する単語の中に単語$1,2,3$が現れる
	位置を示している。$k_1$は文字$4$、$k_2$は$5$が現れる位置を示している。
	$I_{3,2}$からq-シャッフル積に現れる単語は次の写像
	$\phi:I_{3,2}\to\W_5(1..5)[q]$によって得られる。
	\begin{equation*}\begin{split}
		\phi\ket{k_1,k_2,k_3} = q^{(k_1-1)+(k_2-2)+(k_3-3)} \ket{i_1,\dots,i_5}
		\text{ with} \\
		i_{k_1} = 1,\; i_{k_2} = 2,\; i_{k_3} = 3
		\text{ and } (i_p = 4 \And i_q = 5 \implies p < q)
	\end{split}\end{equation*}
	$I_{3,2}$の単語の変化に対して$\phi$の像は次のように変化する。
	\begin{equation*}\begin{split}
		\phi\ket{k_1\pm1,k_2,k_3}
			&= q^{\pm1}(k_1,k_1\pm1)\phi\ket{k_1,k_2,k_3} \\
		\phi\ket{k_1,k_2\pm1,k_3}
			&= q^{\pm1}(k_2,k_2\pm1)\phi\ket{k_1,k_2,k_3} \\
		\phi\ket{k_1,k_2,k_3\pm1}
			&= q^{\pm1}(k_3,k_3\pm1)\phi\ket{k_1,k_2,k_3} \\
	\end{split}\end{equation*}
	ここで、$(k,k+1)$を次のような互換の操作とする。
	\begin{equation*}\begin{array}{rl}
		(k,k+1) & \ket{\dots, i_k,\quad i_{k+1},\dots} \\
		=	& \ket{\dots, i_{k+1}, i_k,\quad\dots}
	\end{array}\end{equation*}
	計算機で処理する場合、なるべく少ない互換で列挙することが望ましい。

	次の順序で$I_{3,2}$の単語を列挙することを考えてみる。
	\begin{equation}\label{eq:シャッフル積の往復列挙}\xymatrix@R=1ex@C=2ex{
		\ket{1,2,3} \ar[r] & \ket{1,2,4} \ar[r] & \ket{1,2,5} \ar[ld] \\
		\ket{1,3,4} \ar[d] & \ket{1,3,5} \ar[l] \\
		\ket{1,4,5} \ar[d] \\
		\ket{2,3,4} \ar[r] & \ket{2,3,5} \ar[ld] \\
		\ket{2,4,5} \ar[d] \\
		\ket{3,4,5}
	}\end{equation}

\begin{todo}[修正その二]\label{todo:修正その二} %{
\end{todo} %todo:修正その二}
	$\ket{3,4}\to\ket{2,3}$の遷移以外は$\phi$の像は一つの互換で遷移する。
	$I_{n_1,2}$の場合はプログラム\ref{code:In2}のようになる。

	\begin{lstlisting}[caption=$I_{n_1,2}$, label=code:In2]
	 next: (w:word(natural), q:natural, n1:natural) -> (w:word(natural), q:natural) or None = {
		 ks = w.which (n1 < $1);
		 if odd (w.length () - ks[2]) {
			 if ks[1] + 1 < ks[2] {
				 return (w.swap (ks[1], ks[1] + 1), q - 1);
			 } else 1 < ks[1] {
				 return (w.swap(ks[1] - 1, ks[1]).swap (ks[2] - 1, ks[2]), q + 2);
			 }
		 } else 1 < ks[1] {
			 return (w.swap (ks[1] - 1, ks[1]), q + 1);
		 } else ks[1] + 1 < ks[2] {
			 return (w.swap (ks[2] - 1, ks[2]), q + 1);
		 }
		 return none;
	 }
	\end{lstlisting}

	$I_{3,2}$を列挙する順序\eqref{eq:シャッフル積の往復列挙}を一般の
	$I_{n_1,n_2}$に拡張することを考える。
	例えば$I_{3,3}$の場合は、文字の偶奇性を次のようにおいて、
	\begin{equation*}\begin{split}
		\ket{*,k_2,k_3} \mapsto \ket{(-)^{5-k_2},(-)^{6-k_3}}
	\end{split}\end{equation*}
	次のような順序で列挙してみる。
	\begin{equation*}\xymatrix@R=1em@C=1em{
		\ket{+,+} & \ket{1,5,6} \ar[d] & \ket{2,5,6} \ar[l]
			& \ket{3,5,6} \ar[l] & \ket{4,5,6} \ar[l] \\
		\ket{-,+} & \ket{1,4,6} \ar[r] & \ket{2,4,6} \ar[r]
			& \ket{3,4,6} \ar[dl] \\
		\ket{+,+} & \ket{1,3,6} \ar[d] & \ket{2,3,6} \ar[l] \\
		\ket{-,+} & \ket{1,2,6} \ar[d] \\
		\ket{-,-} & \ket{1,2,5} \ar[dr] \\
		%
		\ket{+,-} & \ket{1,3,5} \ar[d] & \ket{2,3,5} \ar[l] \\
		\ket{-,-} & \ket{1,4,5} \ar[r] & \ket{2,4,5} \ar[r]
			& \ket{3,4,5} \ar[dl] \\
		\ket{+,+} & \ket{1,3,4} \ar[d] & \ket{2,3,4} \ar[l] \\
		\ket{-,+} & \ket{1,2,4} \ar[d] \\
		\ket{-,-} & \ket{1,2,3} \\
	}\end{equation*}
	$\ket{k_1,k_2,k_3}\in I_{3,3}$での基本的な操作は次のようになる。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item $k_1$は、$(-)^{5-k_2}$が正なら値を下げて、負なら値を上げる。
		\item $k_2$は、$(-)^{6-k_3}$が正なら値を下げて、負なら値を上げる。
		\item $k_3$は、値を下げる。
	\end{itemize} %}
	この列挙の順序は次の直和分解に対応する。
	\begin{equation*}\begin{split}
		RI_{3,3}
		\simeq RI_{3,2} \oplus RI_{2,2} \oplus RI_{1,2} \oplus RI_{0,2} \\
		\begin{split}
			p_{n,2}: RI_{3,3} &\to RI_{n,2} \\
			\ket{k_1,k_2,k_3} &\mapsto \jump{k_3=3+n}\ket{k_1,k_2}
		\end{split}
		\quad\text{for all } n = 0..3
	\end{split}\end{equation*}
	ここで、$I_{0,2}\simeq\set{\ket{1,2}}\simeq\set{\ket{1,2,3}}$とした。

	\begin{lstlisting}[caption=$I_{n_1,n_2}$, label=code:In1n2]
	 next: (w:word(natural), q:natural, n1:natural) -> (w:word(natural), q:natural) or None = {
		 ks = w.which (n1 < $1);
		 ps = sequence (1, ks.length()) - ks;
		 ps = ps mod 2;
		 i = 0
		 while i < ks.length () {
			 if odd ps[i] {
				 if ks[i] + 1 < ks[i + 1] {
					 return (w.swap (ks[i], ks[i] + 1), q - 1);
				 } else 1 < ks[i] {
					 return (w.swap(ks[i] - 1, ks[i]).swap (ks[2] - 1, ks[2]), q + 2);
				 }
			 }
			 i += 1;
		 }

		 if odd (w.length () - ks[2]) {
			 if ks[1] + 1 < ks[2] {
				 return (w.swap (ks[1], ks[1] + 1), q - 1);
			 } else 1 < ks[1] {
				 return (w.swap(ks[1] - 1, ks[1]).swap (ks[2] - 1, ks[2]), q + 2);
			 }
		 } else 1 < ks[1] {
			 return (w.swap (ks[1] - 1, ks[1]), q + 1);
		 } else ks[1] + 1 < ks[2] {
			 return (w.swap (ks[2] - 1, ks[2]), q + 1);
		 }
		 return none;
	 }
	\end{lstlisting}


	\begin{todo}[修正]\label{todo:修正} %{
	\end{todo} %todo:修正}
	q-シャッフル積の漸化式
	\begin{equation}\label{eq:3-2の分解}\begin{split}
		\ket{1,2,3}\shuffle_q\ket{4,5}
		= \bigl(\ket{1,2,3}\shuffle_q\ket{4}\bigr)\ket{5}
		+ q^2 \bigl(\ket{1,2}\shuffle_q\ket{4,5}\bigr)\ket{3}
	\end{split}\end{equation}
	は、経路の分解
	\begin{equation*}\begin{split}
		& \xymatrix@R=1em@C=1em{
			(0,2) \ar[r] & (1,2) \ar[r] & (2,2) \ar[r] & (3,2) \\
			(0,1) \ar[r] \ar[u] & (1,1) \ar[r] \ar[u] 
				& (2,1) \ar[r] \ar[u] & (3,1) \ar[u] \\
			(0,0) \ar[r] \ar[u] & (1,0) \ar[r] \ar[u] 
				& (2,0) \ar[r] \ar[u] & (3,0) \ar[u] \\
		} \\
		= & \xymatrix@R=1em@C=1em{
			& & & (3,2) \\
			(0,1) \ar[r] & (1,1) \ar[r] & (2,1) \ar[r] & (3,1) \ar[u] \\
			(0,0) \ar[r] \ar[u] & (1,0) \ar[r] \ar[u] 
				& (2,0) \ar[r] \ar[u] & (3,0) \ar[u] \\
		} \;+\; \xymatrix@R=1em@C=1em{
			(0,2) \ar[r] & (1,2) \ar[r] & (2,2) \ar[r] & (3,2) \\
			(0,1) \ar[r] \ar[u] & (1,1) \ar[r] \ar[u] & (2,1) \ar[u] \\
			(0,0) \ar[r] \ar[u] & (1,0) \ar[r] \ar[u] & (2,0) \ar[u] \\
		} \\
	\end{split}\end{equation*}
	に対応する。

	q-シャッフル積の漸化式\eqref{eq:3-2の分解}に対応する$RI_{3,2}$の直和分解
	は次のようになる。
	\begin{equation*}\begin{split}
		& RI_{3,1} \udset{p_1}{i_1}{\fromto} RI_{3,2}
			\udset{p_2}{i_2}{\tofrom} RI_{2,2} \\
		& \begin{array}{rclrcl}
			p_1\ket{k_1,k_2} &=& \jump{k_2=5}\ket{k_1}
				,\quad & i_1\ket{k} &=& \ket{k,5} \\
			p_2\ket{k_1,k_2} &=& \jump{k_2\neq5}\ket{k_1,k_2}
				,\quad & i_2\ket{k_1,k_2} &=& \ket{k_1,k_2} \\
		\end{array}
	\end{split}\end{equation*}

	写像$\phi:I_{3,2}\to\W_{3+2}\braket{3+2}[q]$を次のように定義する。
	\begin{equation*}\begin{split}
		\phi\ket{k_0,k_1} = q^{(3-k_0)+(3-k_1)}
			\ket{0,\dots,k_0 - 1, 3, k_0,\dots,k_1 - 1, 4, k_1,\dots,3-1}
	\end{split}\end{equation*}
	$0$始まりの添字として、
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 添字$k_0$の値が$3$、
		\item 添字$k_1+1$の値が$4$
	\end{itemize} %}
	となっている。
	$\phi$は次の式を満たす。
	\begin{equation*}\begin{split}
		\ket{0,1,2}\shuffle_q\ket{3,4} = \sum_{w\in I_{3,2}}\phi\ket{w}
	\end{split}\end{equation*}
	$I_{3,2}$を列挙しならがら$\phi$を作用していくと、次のような巡回置換の
	操作が必要になる。
	\begin{equation*}\begin{split}
		\phi\ket{(k_0+d)k_1} &= q^{-d} 
			(k_0, k_0 + 1, \dots, k_0 + d) \phi\ket{k_0k_1} \\
		& \quad\text{for all } d\in0..(k_1-k_0) \\
		\phi\ket{k_0(k_1+d)} &= q^{-d}
			(k_1 + 1, k_1 + 2, \dots, k_1 + d + 1) \phi\ket{k_0k_1} \\
		& \quad\text{for all } d\in0..(3-k_1) \\
	\end{split}\end{equation*}

	桁上げの方法で$I_{3,2}$を列挙すると次のようになる。
	\begin{equation*}\begin{array}{rcrl}
		\ket{3,3} &\mapsto& q^0 & \ket{0,1,2,3,4} \\
		\ket{2,3} &\mapsto& q^1 & \ket{0,1,3,2,4} \\
		\ket{2,2} &\mapsto& q^2 & \ket{0,1,3,4,2} \\
		\ket{1,3} &\mapsto& q^2 & \ket{0,3,1,2,4} \\
		\ket{1,2} &\mapsto& q^3 & \ket{0,3,1,4,2} \\
		\ket{1,1} &\mapsto& q^4 & \ket{0,3,4,1,2} \\
		\ket{0,3} &\mapsto& q^3 & \ket{3,0,1,2,4} \\
		\ket{0,2} &\mapsto& q^4 & \ket{3,0,1,4,2} \\
		\ket{0,1} &\mapsto& q^5 & \ket{3,0,4,1,2} \\
		\ket{0,0} &\mapsto& q^6 & \ket{3,4,0,1,2} \\
	\end{array}\end{equation*}
	この場合は、次の二つの操作に集約される。
	\begin{equation*}\begin{array}{rlcl}
		\phi & \ket{k_0,k_1-1} &=& q(k_1,k_1+1)\phi\ket{k_0,k_1} \\
		\phi & \ket{k_0-1,3} &=& q^{1-(3-k_0)}(k_0-1,k_0)(k_0+1,\dots,4)
		\phi\ket{k_0,k_0} \\
	\end{array}\end{equation*}


	したがって、効率的に$I_{3,2}$を列挙する問題に帰着する。
	\begin{equation*}\begin{array}{rcrl}
		\ket{3,3} &\mapsto& q^0 & \ket{0,1,2,3,4} \\
		\to \ket{2,3} \to \ket{2,2} &\mapsto&
			q^{1+\cdots} & \ket{0,1,3,\dots} \\
		\to \ket{1,3} \to \ket{1,2} \to \ket{1,1} &\mapsto&
			q^{2+\cdots} & \ket{0,3,\dots} \\
		\to \ket{0,3} \to \ket{0,2} \to \ket{0,1} \to \ket{0,0} \\
	\end{array}\end{equation*}
%s2:シャッフル積の列挙}
\subsection{ここまで}\label{s2:ここまで} %{
%s2:ここまで}
	シャッフル積の代数的双対な余積$\Delta_\shuffle$を求める。
	$A$を集合とする。$\W_*A$の生成元$A$に対する$\Delta_\shuffle$の作用を
	次のように定義する。
	\begin{equation*}\begin{split}
		\Delta_\shuffle1_\W &= 1_\W\otimes 1_\W \\
		\Delta_\shuffle[a] &= [a]\otimes1_\W + 1_\W\otimes[a]
		\quad\text{for all } a\in A
	\end{split}\end{equation*}
	すると、次の式が成り立ち、
	\begin{equation*}\begin{split}
		&(\Delta_\shuffle[a_1])\shuffle(\Delta_\shuffle[a_2]) \\
		&= ([a_1]\shuffle[a_2])\otimes1_\W + [a_1]\otimes[a_2] 
		+ 1_\W\otimes[a_1a_2] + 1_\W\otimes([a_1]\shuffle[a_2]) \\
		&= [a_1a_2]\otimes1_\W + [a_1]\otimes[a_2] + 1_\W\otimes[a_1a_2]
		+ (1\swap2) \quad\text{for all } a_1,a_2\in A
	\end{split}\end{equation*}
	$\Delta_\shuffle$を$\W_2A$に対して次のように定義すれば、
	$\Delta_\shuffle$が$\shuffle$の代数的双対になることがわかる（十分条件）。
	\begin{equation*}\begin{split}
		& \Delta_\shuffle[a_1a_2]
		= [a_1a_2]\otimes1_\W + [a_1]\otimes[a_2] + 1_\W\otimes[a_1a_2] \\
		& \implies \left\{\begin{split}
			\Delta_\shuffle([a_1a_2]\shuffle 1_\W)
			&= (\Delta_\shuffle[a_1a_2])\shuffle(\Delta_\shuffle 1_\W) \\
			\Delta_\shuffle([a_1]\shuffle[a_2])
			&= (\Delta_\shuffle[a_1])\shuffle(\Delta_\shuffle[a_2]) \\
		\end{split}\right. \quad\text{for all } a_1,a_2\in A
	\end{split}\end{equation*}
	これを一般化して$\Delta_\shuffle$を次のように定義する。
	\begin{equation*}\begin{split}
		\Delta_\shuffle1_\W &= 1_\W\otimes 1_\W \\
		\Delta_\shuffle[a_1\cdots a_p]
		&= 1_\W\otimes[a_1\cdots a_p] \\
		&\,+ [a_1]\otimes[a_2\cdots a_p] \\
		&\,+ [a_1a_2]\otimes[a_3\cdots a_p] \\
		&\,+ \cdots \\
		&\,+ [a_1\cdots a_p]\otimes1_\W 
		\quad\text{for all } a_1,\dots,a_p\in A
	\end{split}\end{equation*}
	この式から、$\Delta_\shuffle$が余対称になることはわかる。
	また、任意の$w\in\W_*A$に対して次の式が成り立ち、
	\begin{equation*}\begin{split}
		(\Delta_\shuffle\otimes\id)\Delta_\shuffle1_\W
		= 1_\W\otimes1_\W\otimes1_\W
		= (\id\otimes\Delta_\shuffle)\Delta_\shuffle1_\W
	\end{split}\end{equation*}
	任意の$a_1,\dots,a_p\in A$に対して次の式が成り立つことから、
	$\Delta_\shuffle$が余結合的になることがわかる。
	\begin{equation*}\begin{array}{lcrcrcr}
		&& (\Delta_\shuffle\otimes\id)\Delta_\shuffle[a_1\cdots a_p] \\
		&=& 1_\W\otimes1_\W\otimes[a_1\cdots a_p] \\
		&+& 1_\W\otimes[a_1]\otimes[a_2\cdots a_p]
		&+& [a_1]\otimes1_\W\otimes[a_2\cdots a_p] \\
		&+& 1_\W\otimes[a_1a_2]\otimes[a_3\cdots a_p]
		&+& [a_1]\otimes[a_2]\otimes[a_3\cdots a_p]
		&+& [a_1a_2]\otimes1_\W\otimes[a_3\cdots a_p] \\
		&+& \cdots \\
		&=& 1_\W\otimes(\Delta_\shuffle[a_1\cdots a_p])
		&+& [a_1]\otimes(\Delta_\shuffle[a_2\cdots a_p])
		&+& [a_1a_2]\otimes(\Delta_\shuffle[a_3\cdots a_p]) \\
		&+& \cdots \\
		&=& (\id\otimes\Delta_\shuffle)\Delta_\shuffle[a_1\cdots a_p]
	\end{array}\end{equation*}

	シャッフル積に比べて$\Delta_\shuffle$は定義が簡単なので、
	シャッフル積の場合の命題\ref{prop:シャッフル積の摂動}に相当する式が
	任意の$\W_*A$の元に対して求まる。
	\begin{equation*}\begin{split}
		\Delta_\shuffle(w_1w_2) = (\Delta_\shuffle w_1)(1_\W\otimes w_2)
		+ (w_1\otimes1_\W)(\Delta_\shuffle w_2) - w_1\otimes w_2 \\
		\quad\text{for all } w_1,w_2\in \W_*A
	\end{split}\end{equation*}
	特に、次の式が成り立つ。
	\begin{equation*}\begin{split}
		\Delta_\shuffle(aw) = 1_\W\otimes(aw) + (a\otimes\id)\Delta_\shuffle w
		\quad\text{for all } a\in A,\; w\in \W_*A
	\end{split}\end{equation*}

	次の式が成り立つことが証明されれば、$\Delta_\shuffle$がシャッフル積に
	代数的双対になることがわかる。
	\begin{equation*}\begin{split}
		(\Delta_\shuffle w_1)\shuffle(\Delta_\shuffle w_2)
		= \Delta_\shuffle(w_1\shuffle w_2)
		\quad\text{for all } w_1,w_2\in \W_*A
	\end{split}\end{equation*}
	この式を帰納法によって証明する。紙面の節約のために、
	任意の$a\in A,\;t\in \W_2A$に対して$a\rhd t:=(a\otimes\id)t$と書く。
	\begin{equation*}\begin{split}
		&\Delta_\shuffle(a_1w_1)\shuffle\Delta_\shuffle(a_2w_2) \\
		&= \bigl(1_\W\otimes(a_1w_1) + a_1\rhd\Delta_\shuffle w_1\bigr)
		\shuffle\bigl(1_\W\otimes(a_2w_2) + a_2\rhd\Delta_\shuffle w_2\bigr) \\
		&= 1_\W\otimes\bigl((a_1w_1)\shuffle(a_2w_2)\bigr)
		+ \bigl(a_1\rhd\Delta_\shuffle w_1\bigr)
			\shuffle\bigl(a_2\rhd\Delta_\shuffle w_2\bigr) + r \\
		%
		&\Delta_\shuffle\bigl((a_1w_1)\shuffle(a_2w_2)\bigr)
		= \Delta_\shuffle\biggl(a_1\bigl(w_1\shuffle(a_2w_2)\bigr)
			+ (1\swap2))\biggr) \\
		&= 1_\W\otimes\biggl(a_1\bigl(w_1\shuffle(a_2w_2)\bigr)\biggr) 
		+ a_1\rhd\Delta_\shuffle\bigl(w_1\shuffle(a_2w_2)\bigr) + (1\swap2) \\
		&= 1_\W\otimes\bigl((a_1w_1)\shuffle(a_2w_2)\bigr) + s \\
	\end{split}\end{equation*}
	ここで、$r,s$を次のようにおいた。
	\begin{equation*}\begin{split}
		r &:= \bigl(a_1\rhd\Delta_\shuffle w_1\bigr)
			\shuffle\bigl(1_\W\otimes(a_2w_2)\bigr) + (1\swap2) \\
		s &:= a_1\rhd\biggl((\Delta_\shuffle w_1)
			\shuffle\bigl(\Delta_\shuffle(a_2w_2)\bigr)\biggr) + (1\swap2) \\
	\end{split}\end{equation*}
	ここで、次の式より、
	\begin{equation*}\begin{split}
		s &= a_1\rhd\biggl((\Delta_\shuffle w_1)
			\shuffle\bigl(\Delta_\shuffle(a_2w_2)\bigr)\biggr) + (1\swap2) \\
		&= a_1\rhd\biggl((\Delta_\shuffle w_1)
			\shuffle(a_2\rhd\Delta_\shuffle w_2)\biggr) \\
		&\,+ a_1\rhd\biggl((\Delta_\shuffle w_1)
			\shuffle\bigl(1_\W\otimes(a_2w_2)\bigr)\biggr) + (1\swap2) \\
		&= \bigl(a_1\rhd\Delta_\shuffle w_1\bigr)
			\shuffle\bigl(a_2\rhd\Delta_\shuffle w_2\bigr) + r
	\end{split}\end{equation*}
	次の式が成り立つことがわかり、
	\begin{equation*}\begin{split}
		s = \bigl(a_1\rhd\Delta_\shuffle w_1\bigr)
		\shuffle\bigl(a_2\rhd\Delta_\shuffle w_2\bigr) + r
	\end{split}\end{equation*}
	次の式が成り立つことがわかる。
	\begin{equation*}\begin{split}
		\Delta_\shuffle(a_1w_1)\shuffle\Delta_\shuffle(a_2w_2)
		= \Delta_\shuffle\bigl((a_1w_1)\shuffle(a_2w_2)\bigr)
	\end{split}\end{equation*}

	\begin{todo}[知りたいこと]\label{todo:知りたいこと} %{
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item シャッフル積の変形
			\begin{equation*}\begin{split}
				[a_1\cdots a_p]\shuffle_q[a_{p+1}\cdots a_{p+q}]
				= q^{\sigma} [a_{\sigma1}\cdots a_{\sigma(p+q)}]
			\end{split}\end{equation*}
			$q=1$で通常のシャッフル積、$q=-1$で外積となる。
			通常のシャッフル積をBosonic統計、外積をFermionic統計と思うと、
			$q=e^{ih}$はAnyonic統計に対応しそうだ。
		\end{itemize} %}
	\end{todo} %todo:知りたいこと}
%s1:シャッフル積}

\section{可換環}\label{s1:可換環} %{
	この節を通して、$R=(R,+,0,\myspace,1)$を可換環とする。

	\begin{definition}[可換環のイデアル]\label{def:可換環のイデアル} %{
		部分環$A\subseteq R$が次の性質を満たすとき、$A$を$R$のイデアルという。
		\begin{equation*}\begin{split}
			ra\in A \quad\text{for all } a\in A,\; r\in R
			\quad\bigl(\iff RA\subseteq A \bigr)
		\end{split}\end{equation*}
	\end{definition} %def:可換環のイデアル}

	\begin{definition}[単項イデアル]\label{def:単項イデアル} %{
		任意の$r\in R$に対して$R$の部分集合$rR:=\set{rs\in R\bou s\in R}$は
		はイデアルとなる。
		このイデアル$rR$を$r$から生成された単項イデアルという。
	\end{definition} %def:単項イデアル}

	\begin{definition}[部分集合から生成されたイデアル]
	\label{def:部分集合から生成されたイデアル} %{
		任意の空でない部分集合$S\subseteq R$に対して$R$の部分集合
		$SR:=\set{sr\in R\bou s\in S,\; r\in R}$はイデアルとなる。
		このイデアル$SR$を$S$から生成されたイデアルという。
	\end{definition} %def:部分集合から生成されたイデアル}

	自明なイデアルといった場合は、自明な環や自明な群などとは'自明'の意味する
	ものが異なることに注意する。

	\begin{definition}[自明なイデアル]\label{def:自明なイデアル} %{
		加法の単位元のみからなるイデアル$\set{0}$と$R$自身を自明なイデアル
		という。
	\end{definition} %def:自明なイデアル}

	\begin{proposition}[体とイデアル]\label{prop:体とイデアル} %{
		$R$が体になる必要十分条件は、$R$のイデアルが自明なイデアルのみになること
		である。
	\end{proposition} %prop:体とイデアル}
	\begin{proof} 
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[必要] 体$F$のイデアルが自明なイデアルに限ることを示せばよい。
		$A$を$F=(F,+,0,\myspace,1)$のイデアルとする。
		$S$が$0$以外の元を含むとすると、イデアルの定義より、
		任意の$a\neq 0\in A$に対して$a^{-1}a=1\in A$となり、$1\in A$となる。
		したがって、イデアルの定義より、任意の$f\in F$に対して$f=f1\in A$
		となり、$A=F$となることが示される。
		%
		\item[十分] 環$R$のイデアルが$\set{0}$と$R$のみだとする。
		仮定から、任意の$r\neq0\in R$に対して単項イデアル$rR$は$rR=R$となる。
		したがって、$rR=R$から$1\in R$となり、$rs=1$となる$s\in R$が存在する
		ことがわかる。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $r\neq 1$の場合は、$rR=R$だから$rs=1$となる$s\in R$が存在する
			ことがわかる。
			\item $r=1$の場合は、$rr=1$となる。
		\end{itemize} %}
		よって、任意の$r\neq0\in R$に対して乗法の逆元が存在することがわかる。
	\end{description} %}
	\end{proof}
%s1:可換環}
\section{加群}\label{s1:加群} %{
	この節では、任意の圏$\mycal{C}$に対して、$\mycal{C}$の対象全体を
	$\mycal{C}_O$、$\mycal{C}$の射全体を$\mycal{C}_A$と書く。

	この節を通して、$R=(R,+,0,\myspace,1)$を可換環、$\Mod{R}$を小さな
	$R$-加群の圏とする。任意の$A,B\in\Mod{R}_O$に対して、$A$から$B$への
	$R$-準同型全体を$\Hom_R(A,B)$と書き、混乱の恐ればないときは、
	$A$から$B$への$R$-準同型$f$を単に射$f:A\to B$とか$A\xto{f}B\in\Mod{R}$
	と書く。

	任意の$A,B\in\Mod{A}_R$に対して$\Hom_R(A,B)$は次の畳み込みにより
	$R$-加群となる。
	\begin{equation*}\begin{array}{rcll}
		(f + g)a &:=&  (fa) + (ga)
			& \quad\text{for all } f,g\in\Hom_R(A,B),\; a\in A \\
		(rf)a &:=& rfa
			& \quad\text{for all } f\in\Hom_R(A,B),\; r\in R,\; a\in A \\
	\end{array}\end{equation*}
	また、$0$への恒等射を$0:a\mapsto 0\text{ for all }a\in A$と書くと、
	$0$は加法$+$の単位元となる。この畳み込みによる$\Hom_R(A,B)$の$R$-加群
	は、断りなしに使うことにする。

	\begin{note}[加群と表現]\label{note:加群と表現} %{
		$\Mod{R}$での射は$R$-線形写像となる。
		\begin{equation*}\begin{split}
			fr = rf \quad\text{for all } f\in\Mod{R}_A,\; r\in R
		\end{split}\end{equation*}
		係数環$R$を複素数上の代数$V$とすると、$\Mod{V}$の対象は$V$の表現空間、
		射はintertwinerとなる。Schurの補題から、既約表現の間のintertwinerは、
		互いに$\fukuso$-同型となる既約表現の間に限られる。
		圏$\Mod{V}$の様子を絵にすると次のようになる。
		\begin{equation*}\xymatrix{
			\text{可約表現} \ar[d] \ar[dr] \ar@<1ex>[rr] 
			&& \text{可約表現} \ar[d] \ar[dl] \ar[ll] \\
			\text{既約表現} \ar@<1ex>[u]
			& \text{既約表現} \ar@<1ex>[ul] \ar@<1ex>[ur]
			& \text{既約表現} \ar@<1ex>[u]
		}\end{equation*}
	\end{note} %note:加群と表現}

\subsection{加群の生成系}\label{s2:加群の生成系} %{
	まず、加群の自由直積を定義してから、加群の生成系と基底系を順に定義する。

	\begin{definition}[自由加群その一]\label{def:自由加群その一} %{
		$X$を空でない集合、$X$から$R$への写像全体の集合$\mybf{Set}(X,R)$の
		部分集合$\coprod_XR$を次のように定義する。
		\begin{equation*}\begin{split}
			\coprod_XR := \set{f:X\to R
			\bou fx\neq 0 \text{ only finitely many }x\in X}
		\end{split}\end{equation*}
		$\coprod_XR$に加法$+$と係数の作用$\myspace$を次のように定義する。
		\begin{equation*}\begin{array}{lrcll}
			\text{加法} & (f + g)x &:=& (fx) + (gx)
			& \quad\text{for all }f,g\in\coprod_XR,\; x\in X \\
			\text{係数} & (rf)x &:=& r(fx)
			& \quad\text{for all }f\in\coprod_XR,\; r\in R,\; x\in X \\
		\end{array}\end{equation*}
		すると、次の事が成り立つことがわかる。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $0\in R$への恒等写像$0\in\coprod_XR$が加法の単位元となる。
			\begin{equation*}\begin{split}
				f + 0 = f = 0 + f & \quad\text{for all } f\in\coprod_XR \\
				rf = 0 & \quad\text{for all } f\in\coprod_XR,\; r\in R
			\end{split}\end{equation*}
			\item 分配則が成り立つ
			\begin{equation*}\begin{split}
				r(f + g) = rf + rg \quad\text{for all } f,g\in \coprod_XR,\; r\in R
			\end{split}\end{equation*}
		\end{itemize} %}
		したがって、$(\prod_XR,\myspace,+,0)$は$R$-加群となる。
		$(\prod_XR,\myspace,+,0)$を$X$から生成された自由$R$-加群といい、
		$RX^\tran$と書く。
	\end{definition} %def:自由加群その一}

	\begin{definition}[自由加群その二]\label{def:自由加群その二} %{
		$A$を$R$-加群とする。$A$がある空でない集合$X$から生成された自由$R$-加群
		と$R$-加群同型になることき、$A$を自由$R$-加群という。
	\end{definition} %def:自由加群その二}

	$X$を集合とし、$x\in X$の双対元$x^\tran\in RX^\tran$を次のように
	定義すると、
	\begin{equation*}\begin{split}
		x^\tran y = \jump{x=y} \quad\text{for all } y\in X
	\end{split}\end{equation*}
	任意の写像$f:X\to R$は双対元の線形結合で書くことができる。
	\begin{equation*}\begin{split}
		f = \sum_{x\in X}(fx)x^\tran
	\end{split}\end{equation*}
	また、写像$-^\tran\in\mybf{Set}(X,RX^\tran)$を次のように定義すると、
	\begin{equation}\label{eq:転置の定義その一}\begin{split}
		(-^\tran)x = x^\tran \quad\text{for all } x\in X
	\end{split}\end{equation}
	$-^\tran$は$1:1$になる。また、$\vec{-}:\mybf{Set}(X,\Hom_R(RX^\tran,R))$
	を次のように定義すると、
	\begin{equation}\label{eq:転置の定義その二}\begin{split}
		\vec{x}f := fx \quad\text{for all } f\in RX^\tran,\; x\in X 
	\end{split}\end{equation}
	次の式が成り立つ。
	\begin{equation}\label{eq:自由加群の恒等射}\begin{split}
		\sum_{x\in X} (\vec{x}-)x^\tran = \id_{RX^\tran}
	\end{split}\end{equation}

	\begin{definition}[転置]\label{def:転置} %{
		$X$を集合とする。式\eqref{eq:転置の定義その一}で定義された写像
		$-^\tran:X\to RX^\tran$を転置ということにする。
		また、誤解の恐れがないときは、式\eqref{eq:転置の定義その二}で
		定義された写像$\vec{-}:X\to\Hom_R(RX^\tran,R)$を用いて、
		次の$R$-加群準同型$-^\tran:RX^\tran\tofrom\Hom_R(RX^\tran,R)$
		にも同じ記号を用いる。
		\begin{equation*}\begin{split}
			x \xto{-^\tran} x^\tran \udset{-^\tran}{-^\tran}{\tofrom} \vec{x}
			\quad\text{for all } x\in X
		\end{split}\end{equation*}
	\end{definition} %def:転置}

	\begin{proposition}[自由加群の普遍性]\label{prop:自由加群の普遍性} %{
		$X$を空でない集合、$A$を加群とすると、任意の写像$f:X\to A$に対して
		次の図を可換にする$R$-加群準同型$f_*:RX^\tran\to A$が唯一つ定まる。
		\begin{equation*}\xymatrix{
			X \ar[r]^{-^\tran} \ar[rd]_f & RX^\tran \ar@{.>}[d]^{f_*} \\
			& A
		}\end{equation*}
	\end{proposition} %prop:自由加群の普遍性}
	\begin{proof} 
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[存在] 写像$f_*\in\mybf{Set}(X^\tran,A)$を次のように定義する。
		\begin{equation*}\begin{split}
			f_*x^\tran := fx \quad\text{for all } x\in X
		\end{split}\end{equation*}
		$f_*$を$R$-線形に拡張して、$f_*\in\Hom_R(RX^\tran,A)$とすると、
		次のようになる。
		\begin{equation*}\begin{split}
			f_*g = \sum_{x\in X}(fx)(\vec{x}g) \quad\text{for all } g\in RX^\tran
		\end{split}\end{equation*}
		$f_*(-^\tran)=f$となるから、命題の$f_*$が存在することがわかる。
		\item[唯一] 写像$-^\tran:X\to RX^\tran$が$1:1$だから、
		任意の$f_*,g_*\in\Hom_R(RX^\tran,A)$に対して次の式が成り立つ。
		\begin{equation*}\begin{split}
			g_*(-^\tran) = f = f_*(-^\tran)
			\implies (f_* - g_*)(-^\tran) = 0
			\implies f_* = g_*
		\end{split}\end{equation*}
		したがって、命題の$f_*$が存在するならば唯一つであることがわかる。
	\end{description} %}
	\end{proof}

	\begin{definition}[加群の生成系]\label{def:加群の生成系} %{
		$A$を$R$-加群、$E$を$A$の空でない部分集合とする。
		$E$の有限の$R$-線形結合で張られる$A$の部分集合を$RE$と書く。
		\begin{equation*}\begin{split}
			RE := \set{\sum_{e\in E}r_ee\in A\bou r_e\in R \text{ and }
			r_e\neq 0 \text{ for only finitely many } e\in E}
		\end{split}\end{equation*}
		$RE=E$となるとき、$E$を$A$の生成系という。
	\end{definition} %def:加群の生成系}

	生成系に一意性の条件を課したものが基底系となる。

	\begin{definition}[加群での線形独立]\label{def:加群での線形独立} %{
		$A$を$R$-加群とする。$A$の空でない部分集合$E$が次の条件を満たすとき、
		$E$を$R$-線形独立な部分集合という。
		\begin{equation*}\begin{split}
			\sum_{e\in E}(fe)e = 0 \implies f = 0
			\quad\text{for all } f\in RE^\tran
		\end{split}\end{equation*}
	\end{definition} %def:加群での線形独立}

	\begin{definition}[加群の基底系]\label{def:加群の基底系} %{
		$A$を$R$-加群、$E$を$A$の生成系とする。$E$が$R$-線形独立なとき、
		$E$を$A$の基底系という。
	\end{definition} %def:加群の基底系}

	\begin{proposition}[基底系による一意的な表現]
	\label{prop:基底系による一意的な表現} %{
		$A$を$R$-加群、$E$を$A$の基底系とする。
		任意の$A$の元は$E$の元の線形結合で一意に書くことができる。
	\end{proposition} %prop:基底系による一意的な表現}
	\begin{proof} 次の式が成り立つ。
		\begin{equation*}\begin{split}
			\sum_{e\in E}(fe)e = \sum_{e\in E}(ge)e
			\implies \bigl((fe) - (ge)\bigr)e = 0 \implies f = g \\
			\quad\text{for all } f,g\in RE^\tran
		\end{split}\end{equation*}
	\end{proof}

	自由加群と基底系を持つことは同じことになる。

	\begin{proposition}[自由加群と基底系]\label{prop:自由加群と基底系} %{
		$A$を$R$-加群とする。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $A$が自由加群であることと、
			\item $A$が基底系を持つこと
		\end{itemize} %}
		は同値である。
	\end{proposition} %prop:自由加群と基底系}
	\begin{proof} 
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[自由$\implies$基底] $F$を集合$X$から生成された自由$R$-加群とし、
		同型射$\phi:F\to A$が成り立つとする。
		次の写像で$\phi X^\tran$が$A$の基底系となることを示す。
		\begin{equation*}\begin{split}
			X\xto{-^\tran} F\xto{\;\phi\;} A
		\end{split}\end{equation*}
		\begin{description}\setlength{\itemsep}{-1mm} %{
			\item[生成系] $\phi X^\tran$が$A$の生成系となることを示す。
			$\phi$が全射だから、任意の$a\in A$に対してある$f\in F$が存在して、
			$a=\phi f$とすることができる。すると、式\eqref{eq:自由加群の恒等射}
			より、次の式が成り立つことがわかる。
			\begin{equation*}\begin{split}
				a = \phi f = \phi \sum_{x\in X} (fx)x^\tran
				= \sum_{x\in X} (fx)(\phi x^\tran)
			\end{split}\end{equation*}
			したがって、$\phi X^\tran$が$A$の生成系となることがわかる。
			%
			\item[基底系] $\phi X^\tran$が$R$-線形独立となることを示す。
			$\phi$と$-^\tran$が単射だから、任意の$f\in RX^\tran$に対して
			次の式が成り立つ。
			\begin{equation*}\begin{array}{rcll}
				\sum_{x\in X} (fx)(\phi x^\tran) = 0
				&\implies& \phi\sum_{x\in X} (fx)x^\tran = 0
					& \quad\because\;\text{$\phi$ is morphism} \\
				&\implies& \sum_{x\in X} (fx)x^\tran = 0
					& \quad\because\;\text{$\phi$ is $1:1$} \\
				&\implies& f = 0
					& \quad\because\;\text{$-^\tran$ is $1:1$} \\
			\end{array}\end{equation*}
			したがって、$\phi X^\tran$が$R$-線形独立になることがわかる。
		\end{description} %}
		%
		\item[基底$\implies$自由] $X$を$A$の基底系とする。
		$R$-加群準同型$\phi:RX^\tran\to A$を次のように定義する。
		\begin{equation*}\begin{split}
			\phi f = \sum_{x\in X} (fx)x
		\end{split}\end{equation*}
		$X$が$A$の生成系であることから$\phi$が$\onto$になることが示され、
		$X$が$R$-線形独立であることから$\phi$が$1:1$になることが示される。
	\end{description} %}
	\end{proof}


	\begin{example}[生成系だが基底系でない例]
	\label{eg:生成系だが基底系でない例} %{
		加群の基底系でない生成系の例を挙げる。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $\sei$-加群$\sei_2$は、生成系$E:=\set{1_2\in\sei_2}$を持つが、
			$21_2=0$だから、$E$は基底系ではない。任意の$2\le n\in\sei$に対して、
			$\sei$-加群$\sei_n$も同様である。
			%
			\item $\sei$-加群$\bun$は、生成系
			$E:=\set{1/p^n\bou p\in\text{primes},\; n\in\sizen_+}$
			を持つが、$1\cdot1/1=2\cdot1/2$だから、$E$は基底系ではない。
			%
			\item $\sei_6$-加群$\sei_6$は、生成系$E:=\set{4_6,3_6}$を持つが、
			\begin{equation*}\begin{split}
				1_6 = 4_6 + 3_6 \implies n_6 = n_6\cdot4_6 + n_6\cdot3_6
				\quad\text{for all } n_6\in \sei_6
			\end{split}\end{equation*}
			$3_6\cdot4_6=2_6\cdot3_6=0_6$だから、$E$は生成系ではない。
		\end{itemize} %}
	\end{example} %eg:生成系だが基底系でない例}
%s2:加群の生成系}

\subsection{加群の直和}\label{s2:加群の直和} %{
	\begin{definition}[加群の直和]\label{def:加群の直和} %{
		$A,B$を$R$-加群とする。直積$A\times B$に次のように加法$+$と係数の作用
		$\myspace$を定義したものを$A$と$B$の直和といい、$A\oplus B$と書く。
		\begin{equation*}\begin{array}{rcll}
			(a_1,b_1) + (a_2,b_2) &=& (a_1+a_2,b_1+b_2)
				& \quad\text{for all }a_1,a_2\in A,\; b_1,b_2\in B \\
			r(a,b) &=& (ra,rb)
				& \quad\text{for all }a\in A,\; b\in B,\; r\in R \\
		\end{array}\end{equation*}
	\end{definition} %def:加群の直和}
%s2:加群の直和}

\subsection{加群のテンソル積}\label{s2:加群のテンソル積} %{
	加群のテンソル積を定義して、テンソル積を使ってテンソル代数を定義する。

	\begin{definition}[双線形写像]\label{def:双線形写像} %{
		$A,B$を$R$-加群とする。次の性質を満たす写像$f:A\times B\to R$を
		$A$から$B$への$R$-双線形写像という。
		\begin{equation*}\begin{array}{rcll}
			f(a_1+a_2,b) &=& f(a_1,b) + f(a_2,b)
				& \quad\text{for all }a_1,a_2\in A,\; b\in B \\
			f(a,b_1+b_2) &=& f(a,b_1) + f(a,b_2)
				& \quad\text{for all }a\in A,\; b_1,b_2\in B \\
			f(ra,b) &=& f(a,rb)
				& \quad\text{for all }a\in A,\; b\in B,\; r\in R \\
		\end{array}\end{equation*}
	\end{definition} %def:双線形写像}

	一般の加群に対するテンソル積の定義は面倒なことになる。

	\begin{definition}[テンソル積]\label{def:テンソル積} %{
		$A,B$を$R$-加群とする。
		\begin{enumerate}\setlength{\itemsep}{-1mm} %{
			\item\label{item:テンソル積その一} 
			$\sei(A\times B)$を直積$A\times B$から生成される自由アーベル群
			（形式和）とする。
			%
			\item\label{item:テンソル積その二} 
			$\sei(A\times B)$に次の同値関係$\sim$を定義する。
			\begin{equation*}\begin{array}{rcll}
				(a_1 + a_2, b) &\sim& (a_1, b) + (a_2, b)
					& \quad\text{for all }a_1,a_2\in A,\; b\in B \\
				(a, b_1 + b_2) &\sim& (a, b_1) + (a, b_2)
					& \quad\text{for all }a\in A,\; b_1,b_2\in B \\
				(ra, b) &\sim& (a,rb)
					& \quad\text{for all }a\in A,\; b\in B,\; r\in R \\
			\end{array}\end{equation*}
			%
			\item\label{item:テンソル積その三} 
			$\sei(A\times B)$を$\sim$で割ったアーベル群を
			$A\otimes B:=\sei(A\times B)/\sim$と書く。
			%
			\item\label{item:テンソル積その四} 
			$A\otimes B$に係数の作用を次のように定義すると、$A\otimes B$は
			$R$-加群となる。
			\begin{equation*}\begin{split}
				(ra,b) = r(a,b) = (a,rb)
				\quad\text{for all }a\in A,\; b\in B,\; r\in R \\
			\end{split}\end{equation*}
		\end{enumerate} %}
		$R$-加群$A\otimes B$を$A$と$B$のテンソル積という。また、慣習で
		\ref{item:テンソル積その三}のアーベル群準同型とその像も同一の記号
		$\otimes$を用いる。
		\begin{equation*}\begin{split}
			\otimes: A\times B &\to A\otimes B \\
			(a,b) &\mapsto  a\otimes b = \bigl[i_\sei(a,b)\bigr]
		\end{split}\end{equation*}
		ここで、$i_\sei: A\times B\to\sei(A\times B)$を標準入射、$[(a,b)]$を
		$(a,b)\in A\times B$を代表元とする$A\times B/\sim$の同値類とする。
	\end{definition} %def:テンソル積}

	\begin{proposition}[テンソル積の普遍性]\label{prop:テンソル積の普遍性} %{
		$A,B,C$を$R$-加群とする。任意の$R$-双線形写像$f:A\times B\to C$に
		対して次の図を可換にする$R$-加群準同型$f_*:A\otimes B\to C$が一意に
		定まる。
		\begin{equation*}\xymatrix{
			A\times B \ar[r]^{\otimes} \ar[dr]_f & A\otimes B \ar@{.>}[d]^{f_*} \\
			& C
		}\end{equation*}
	\end{proposition} %prop:テンソル積の普遍性}
	\begin{proof} テンソル積の定義より、写像$f_*:A\otimes B\to C$を、
		任意の$\in A,\;b\in B$に対して$f_*(a\otimes b):=f(a,b)$と定義することが
		できる。すると、$f$が$R$-双線形写像だから、は$R$加群準同型となる。
		\begin{equation*}\begin{split}
			f(a_1+a_2,b) = f(a_1,b) + f(a_2,b) \\
			\implies f_*\bigl((a_1 + a_2)\otimes b\bigr)
			=  f_*(a_1\otimes b + a_2\otimes b)
			= f_*(a_1\otimes b) + f_*(a_2\otimes b) \\
			\quad\text{for all } a_1,a_2\in A,\; b\in B \\
			f(ra,b) = rf(a,b) 
			\implies f_*\bigl((ra)\otimes b\bigr) 
			= f_*\bigl(r(a\otimes b)\bigr) = rf_*(a\otimes b) \\
			\quad\text{for all } a\in A,\; b\in B,\; r\in R \\
			\text{same as for $B$}
		\end{split}\end{equation*}
		また、
		$\phi:A\otimes B\to C$を$R$-加群準同型とすると、次の式が成り立つ。
		\begin{equation*}\begin{split}
			\biggl(\phi(a\otimes b) = f(a,b)
				\quad\text{for all }a\in A,\; b\in B \biggr) \\
			\implies \biggl( f_*(a\otimes b) = f(a,b) = \phi(a\otimes b)
				\quad\text{for all }a\in A,\; b\in B \biggr) \implies f_* = \phi
		\end{split}\end{equation*}
	\end{proof}

	次の命題はテンソル積の普遍性によってテンソル積の基底系を保証する。

	\begin{proposition}[テンソル積の基底系]\label{prop:テンソル積の基底系} %{
		$A,B$を$R$-加群とする。$E_A$を$A$の生成系、$E_B$を$B$の生成系
		とすると、次の部分集合$E_{AB}\subseteq A\otimes B$は$A\otimes B$の
		生成系となる。
		\begin{equation*}\begin{split}
			E_{AB} := \set{a\otimes b\in A\otimes B \bou a\in E_A,\; b\in E_B}
		\end{split}\end{equation*}
		特に、$E_A$と$E_B$がそれぞれ$A$と$B$の基底系となるとき、
		$E_{AB}$は$A\otimes B$の基底系となる。
	\end{proposition} %prop:テンソル積の基底系}
	\begin{proof} 
	\begin{description}\setlength{\itemsep}{-1mm} %{
		\item[生成系] $A\otimes B\subseteq RE_{AB}$を示す。
		$E_A$と$E_B$がの生成系だから、任意の$f\in A$と$g\in B$に対して、
		\begin{equation*}\begin{split}
			f = \sum_{a\in E_A} (f_*a)a,\quad g = \sum_{b\in E_B} (g_*b)b
		\end{split}\end{equation*}
		となる$f_*\in RE_A^\tran$と$g_*:RE_B^\tran$が存在する。したがって、
		次の式から$f\otimes g\in RE_{AB}$となることがわかる。
		\begin{equation*}\begin{split}
			f\otimes g = \biggl(\sum_{a\in E_A} (f_*a)a\biggr)
				\otimes \biggl(\sum_{b\in E_B} (g_*b)b\biggr)
			= \sum_{a\in E_A,\;b\in E_B}(f_*a)(g_*b)(a\otimes b)
		\end{split}\end{equation*}
		%
		\item[基底系] $E_A$と$E_B$が基底系であるとき、
		$E_{AB}$が$R$-線形独立であることが示せれば命題が証明される。
		つまり、任意の$\phi\in\myop{Set}(A\times B,R)$に対して
		次の式が成り立つことが示せればよい。
		\begin{equation*}\begin{split}
			\sum_{a\in E_A,\;b\in E_B}\bigl(\phi(a,b)\bigr)(a\otimes b) = 0 
			\implies \phi = 0
		\end{split}\end{equation*}
		$E_A$と$E_B$が共に基底系だから、任意の$a\in E_A$と$b\in E_B$に対して
		$R$-双線形写像$\psi_{ab}:A\times B\to R$を次のように定義する\footnote{
			$E_A,\;E_B$が共に基底系であるから、$R$-双線形写像$\psi_{ab}$
			\eqref{eq:双線形写像の基底系}を定義できる。
			例えば、$E_A$が基底系でなければ、ある$r\neq0\in R,\;a\neq0\in E_A$で
			$ra=0$となることがあり得る。このとき、次のようになり、
			$\psi_{ab}$は$R$-双線形写像とはならない。
			\begin{equation*}\begin{split}
				\psi_{ab}(ra,b) = 0 \neq r = r\psi_{ab}(a,b)
			\end{split}\end{equation*}
		}。
		\begin{equation}\label{eq:双線形写像の基底系}\begin{split}
			\psi_{ab}(a_1,b_1) = \jump{a=a_1}\jump{b=b_1}
			\quad\text{for all } a_1\in E_A,\; b_1\in E_B
		\end{split}\end{equation}
		すると、テンソル積の普遍性\ref{prop:テンソル積の普遍性}により、
		次の式を満たす$R$-加群準同型$(a\otimes b)^\tran:A\otimes B\to R$
		が唯一つ定まり、
		\begin{equation*}\begin{split}
			(a\otimes b)^\tran(-\otimes-) = \psi_{ab}
			\quad\text{for all } a\in E_A,\; b\in E_B
		\end{split}\end{equation*}
		任意の$\phi\in\myop{Set}(A\times B, R)$と$a_0\in E_A,\; b_0\in E_B$
		に対して次の式が成り立つ。
		\begin{equation*}\begin{split}
			& \sum_{a\in E_A,\;b\in E_B}\bigl(\phi(a,b)\bigr)(a\otimes b) = 0 \\
			& \implies (a_0\otimes b_0)^\tran
			\sum_{a\in E_A,\;b\in E_B}\bigl(\phi(a,b)\bigr)(a\otimes b) = 0 \\
			& \implies \bigl(\phi(a,b)\bigr)
			\sum_{a\in E_A,\;b\in E_B}\phi_{a_0b_0}(a,b) = 0 \\
			& \implies \phi(a_0,b_0) = 0 \\
		\end{split}\end{equation*}
		したがって、命題が成り立つことがわかる。
	\end{description} %}
	\end{proof}

	この命題と命題\ref{prop:自由加群と基底系}を使うと、
	任意の集合$X,Y$に対して次の可換図が成り立つことがわかる。
	\begin{equation*}\xymatrix{
		& X\times Y \ar[d]^{-^\tran} \ar[dl] \ar[dr] \\
		X \ar[d]_{-^\tran} & R(X\times Y)^\tran \ar@{<->}[d]^{\simeq}
			& Y \ar[d]^{-^\tran} \\
		RX^\tran & RX^\tran\otimes RY^\tran & RY^\tran \\
		& RX^\tran\times RY^\tran \ar[u]_\otimes \ar[ul] \ar[ur] \\
	}\end{equation*}

	直和とテンソル積は分配則を満たす。

	\begin{proposition}[直和とテンソル積の分配則]
	\label{prop:直和とテンソル積の分配則} %{
		任意の$R$-加群$A,B,C$に対して次の分配則が成り立つ。
		\begin{equation*}\begin{split}
			A\otimes(B\oplus C)\simeq(A\otimes B)\oplus(A\otimes B)
		\end{split}\end{equation*}
	\end{proposition} %prop:直和とテンソル積の分配則}
	\begin{proof} 次の射$p_A,p_B,i_A,i_B$を、
		\begin{equation}\label{eq:分配則の双積}\begin{split}
			A\otimes C \udset{p_A}{i_A}{\fromto} (A\oplus B)\otimes C
			\udset{p_B}{i_B}{\tofrom} B\otimes C \\
		\end{split}\end{equation}
		任意の$a\in A,\;b\in B,\;c\in C$に対して次のように定義する。
		\begin{equation*}\begin{array}{rclrcl}
			p_A(a\oplus b\otimes c) &=& a\otimes c
			,& p_B(a\oplus b\otimes c) &=& b\otimes c \\
			i_A(a\otimes c) &=& (a\oplus 0)\otimes c
			,& i_B(b\otimes c) &=& (0\oplus b)\otimes c \\\
		\end{array}\end{equation*}
		すると、$p_Ai_A=\id_{A\otimes C}$と$p_Bi_B=\id_{B\otimes C}$が成り立ち、
		任意の$a\in A,b\in B,c\in C$に対して次の式が成り立つから、
		\begin{equation*}\begin{split}
			(i_Ap_A + i_Bp_B)\bigl((a\oplus b)\otimes c\bigr)
			&= i_A\bigl(a\otimes c\bigr) + i_B\bigl(b\otimes c\bigr) \\
			&= \bigl((a\oplus 0)\otimes c\bigr)
				+ \bigl((0\oplus b)\otimes c\bigr) \\
			&= (a\oplus b)\otimes c \\
		\end{split}\end{equation*}
		$i_Ap_A+i_Bp_B=\id_{(A\oplus B)\otimes C}$が成り立つ。
		したがって、式\eqref{eq:分配則の双積}が双積となり、命題が成り立つこと
		がわかる。
	\end{proof}

	加群の直和とテンソル積は分配則を満たすから代数を定義することができる。

	\begin{definition}[テンソル代数]\label{def:テンソル代数} %{
		$A$を$R$-加群とする。$n\in\sizen$に対して$\T_nA$を次のように定義し、
		\begin{equation*}\begin{array}{rcll}
			\T_0A &:=& R \\
			\T_1A &:=& A \\
			\T_nA &:=& \underbrace{A\otimes A\otimes\cdots\otimes A}_{n\text{ times}}
				& \quad\text{for all } 2\le n\in\sizen \\
		\end{array}\end{equation*}
		$\T_*A\subset\oplus_{n\in\sizen} \T_nA$を次のように有限和で定義する。
		\begin{equation*}\begin{split}
			\T_*A := \Set{\sum_{n\in\sizen}t_n\in\oplus_{n\in\sizen} \T_nA
			\;\left|\; \begin{array}{l}
				t_n\in \T_n A \text{ for all } n\in \sizen \text{ and} \\
				t_n\neq 0\text{ for only finitely many } n\in \sizen
			\end{array}\right.}
		\end{split}\end{equation*}
		$\T_*A$は直和$\oplus$によって$R$-加群となり、テンソル積$\otimes$に
		よって$R$-代数となる。
		\begin{equation*}\begin{array}{lrcl}
			\text{加法} & t_1 + t_2 &:=& t_1\oplus t_2 \\
			\text{乗法} & t_1t_2 &:=& t_1\otimes t_2 \\
		\end{array}
		\quad\text{for all } t_1,t_2\in T_*A
		\end{equation*}
		この$R$-代数$\T_*A=(\T_*A,+,0,\myspace,R)$を$A$のテンソル代数という
		\footnote{
			通常は$A$のテンソル代数を$\T A$と書くが、ここでは$\T_1A$との混同を
			避けるために$\T_*A$と書く事にする。
		}。
	\end{definition} %def:テンソル代数}

	自由加群のテンソル代数はベクトル空間のテンソル代数とほぼ同じものになる。

	\begin{proposition}[自由加群のテンソル代数]
	\label{prop:自由加群のテンソル代数} %{
		$F$を自由$R$-加群とする、
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item $\T_*F$をのテンソル代数、
			\item $E$を$F$の基底系、
			\item $\W_*E$を$E$から生成された自由モノイド、
			\item $R\W_*E$を$\W_*E$から生成された自由加群
		\end{itemize} %}
		とすると、$R$-代数同型$\T_*F\simeq R\W_*F$が成り立ち、
		$\W_*F$の元が$\T_*F$の基底系となる。
	\end{proposition} %prop:自由加群のテンソル代数}
	\begin{proof} と$R\W_*F$が$R$-代数同型になることが示されれば、
		$R\W_*F$が$\W_*A$から生成された自由加群だから、命題が成り立つことが
		示される。写像$\ket{-}:\W E\to\T_*F$を次のように定義する。
		\begin{equation*}\begin{split}
			\ket{1} &= 1 \\
			\ket{e_1\cdots e_p} &= e_1\otimes\cdots\otimes e_p
			\quad\text{for all } e_1,\dots,e_p\in E
		\end{split}\end{equation*}
		すると、$\ket{-}$はモノイド準同型となることがわかる。
		\begin{equation*}\begin{split}
			\ket{w_1w_2} = \ket{w_1}\otimes\ket{w_2}
			\quad\text{for all } w_1,w_2\in\W_*E
		\end{split}\end{equation*}
		したがって、$\ket{-}$を$R$-線形に拡張すると$R$-代数準同型
		$\ket{-}:R\W_*E\to\T_*F$となる。
		\begin{equation*}\begin{array}{rcll}
			\ket{f_1 + f_2} &=& \ket{f_1} + \ket{f_2}
			&\quad\text{for all } f_1,f_2\in R\W_*E \\
			\ket{rf} &=& r\ket{f} &\quad\text{for all } f\in R\W_*E,\; r\in R
		\end{array}\end{equation*}
	\end{proof}
%s2:加群のテンソル積}

\subsection{加群の外積}\label{s2:加群の外積} %{
	加群のテンソル代数の剰余代数として外積代数を定義する。

	\begin{definition}[加群の外積代数]\label{def:加群の外積代数} %{
		$A$を$R$-加群とする。 部分集合$\dup A\subseteq A\otimes A$を
		次のように定義する。
		\begin{equation*}\begin{split}
			\dup A:=\set{a\otimes a\in A\otimes A\bou a\in A}
		\end{split}\end{equation*}
		$\dup A$から生成されたイデアル$\dup_*A:=(\dup A)\T_*A\subseteq\T_*A$
		による剰余代数を$A$の外積代数といい、$\Wedge_*A$と書く。
		\begin{equation*}\begin{split}
			\Wedge_*A := \T_*A/\dup_*A
		\end{split}\end{equation*}
	\end{definition} %def:加群の外積代数}

	自由加群の外積代数はほとんどベクトル空間の外積代数と同じものになる。

	\begin{proposition}[自由加群の外積代数]\label{prop:自由加群の外積代数} %{
		$F$を自由$R$-加群、$E=\set{e_1,\dots,e_n}$を$F$の基底系とする。
		$\Wedge F$を$F$の外積代数とすると、次の代数同型が成り立つ。
		\begin{equation*}\begin{split}
			\Wedge F\simeq R[x_1,\dots,x_n]/I
		\end{split}\end{equation*}
		ここで、$I$は部分集合
		$\set{x_ix_j\bou i,j\in1..n}\subset R[x_1,\dots,x_n]$から生成された
		イデアルとする。
	\end{proposition} %prop:自由加群の外積代数}
	\begin{proof} 
	\end{proof}

	\begin{proposition}[自由加群の外積]\label{prop:自由加群の外積} %{
		自由$R$-加群の外積空間は次のようになる。
		\begin{equation*}\begin{split}
			\Lambda_pR^m &\simeq \left\{\begin{split}
				p\le m &\implies R^{\binom{m}{p}} \\
				\text{else} &\implies 0 \\
			\end{split}\right. \quad\text{for all } p,m\in\sizen
		\end{split}\end{equation*}
	\end{proposition} %prop:自由加群の外積}
	\begin{proof} 帰納法で証明する。$m=0,1$のときは次の式より、命題が成り立つ
	ことがわかる。
	\begin{equation*}\begin{split}
		\Lambda_pR \simeq \left\{\begin{split}
			p=0,1 &\implies R \\
			\text{else} &\implies 0 \\
		\end{split}\right. \\ %\}
	\end{split}\end{equation*}
	ある$2\le m\in\sizen$かで命題が成り立つと仮定する。すると、
	$\Lambda_0R^{m+1}=R$が成り立ち、任意の$p\in0..m$に対して次の式が成り立つ。
	\begin{equation*}\begin{split}
		\Lambda_{p+1}R^{m+1} \simeq (\Lambda_{p+1}\oplus\Lambda_p)R^m
		\simeq R^{\binom{m}{p+1}}\oplus R^{\binom{m}{p}}
		\simeq R^{\binom{m}{p+1}+\binom{m}{p}}
	\end{split}\end{equation*}
	ここで、$\binom{m}{p+1}+\binom{m}{p}=\binom{m+1}{p+1}$となるから、
	$\Lambda_{p+1}R^{m+1}\simeq R^{\binom{m+1}{p+1}}$が成り立つことがわかり、
	$m+1$でも命題が成り立つことがわかる。
	\end{proof}

	この命題から、論文\cite{Grayson1978Gro}の次の式が導かれる。
	\begin{equation*}\begin{split}
		\lambda_t[R^m] := \sum_{p\in\sizen}t^p[\Lambda_pR^m] = (1 + t)^m[R] \\
		\because\; \sum_{p\in\sizen}t^p[\Lambda_pR^m]
		= \sum_{p=0}^mt^p[\Lambda_pR^m]
		= \sum_{p=0}^mt^p[R^{\binom{m}{p}}]
		= \sum_{p=0}^mt^p\binom{m}{p}[R]
	\end{split}\end{equation*}
%s2:加群の外積}
%s1:加群}
\section{自由加群の線形代数}\label{s1:自由加群の線形代数} %{
	この節を通して、$R=(R,+,0,\myspace,1)$を可換環とする。
	さらに次のような記号を使う。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 自由$R$-加群の間の射の集合を次のように書く。
		\begin{equation*}\begin{split}
			\Mat_{m,n}R := \Hom_R(R^m,R^n) ,\quad \Mat_{m}R := \Hom_R(R^m,R^m)
		\end{split}\end{equation*}
		%
		\item $\bld_k$を$k$番目の成分がでそれ以外はすべてのベクトルとする。
		\begin{equation*}\begin{split}
			\bld_k^\tran = (0,\dots,0,\underbrace{1}_{\text{$k$-th}},0,\dots)
		\end{split}\end{equation*}
		$\bld_k$は入れ物の自由$R$-加群の次元については考えないものとする。
		例えば、$\bld_2$という記号は$2$次元以上の自由$R$-加群について全て共通に
		使う。
		%
		\item 紙面の省略のために、基底系$\bld_i$のテンソル積をブラケット記法
		で書くことにする。
		\begin{equation*}\begin{array}{rcll}
			\ket{1} &=& 1 \\
			\ket{i_1\cdots i_p} &=& \bld_{i_1}\otimes\cdots\otimes \bld_{i_p} 
				& \quad\text{for all } i_1,\dots,i_p\in 1..m \\
		\end{array}\end{equation*}
		ケット同士のテンソル積は文字列の連結となる。
		\begin{equation*}\begin{split}
			\ket{i_1\cdots i_p}\otimes\ket{j_1\cdots j_q}
				= \ket{i_1\cdots i_pj_1\cdots j_q} \\
			\quad\text{for all } i_1,\dots,i_p,j_1,\dots,j_q\in 1..m \\
		\end{split}\end{equation*}
	\end{itemize} %}
\subsection{外積}\label{s2:外積} %{
	任意の$m\in\sizen$に対して$R$-加群準同型$\alpha:\T_*R^m\to\T_*R^m$
	を次のように定義する。
	\begin{equation*}\begin{array}{rcll}
		\alpha \ket{i_1\cdots i_k}
			&=& \frac{1}{k!}\sum_{\sigma\in S_k} (-)^\sigma 
			\ket{i_{\sigma1}\cdots i_{\sigma k}}
			& \quad\text{for all } i_1,\dots,i_k\in 1..m
	\end{array}\end{equation*}
	ここで、$S_k$は$k$次対称群、$(-)^\sigma$は$\sigma\in S_k$が偶置換か奇置換
	かの符号とする。$A_*R^m:=\alpha\T_*R^m$とおく。
	$R$-双線形写像$\owedge:A_*R^m\times A_*R^m\to A_*R^m$を次のように
	定義する。
	\begin{equation*}\begin{split}
		(\alpha t_1)\owedge(\alpha t_2) := \alpha(t_1\otimes t_2)
		\quad\text{for all } t_1,t_2\in \T_*R^m
	\end{split}\end{equation*}
	次の式が成り立てば、$\owedge$は結合的になり、$R$-代数準同型
	$\alpha:(\T_*R^m,\otimes,1)\to (A_*R^m,\owedge,1)$となる。
	\begin{equation}\label{eq:交代化が積になるための条件}\begin{split}
		\alpha\bigl(\alpha(t_1\otimes t_2)\otimes t_3\bigr)
		= \alpha\bigl(t_3\otimes \alpha(t_2\otimes t_3)\bigr)
		\quad\text{for all } t_1,t_2,t_3\in\T_*R^m
	\end{split}\end{equation}
	$R^m\otimes R^m\otimes T_*R^m$の場合では次のようになる。
	\begin{equation*}\begin{split}
		& \alpha\bigl((\alpha\ket{i_1i_2})\otimes\ket{i_3\cdots i_p}\bigr) \\
		& = \frac{1}{2}\alpha\bigl((\ket{i_1i_2}-\ket{i_2i_1})
			\otimes\ket{i_3\cdots i_p}\bigr) \\
		& = \frac{1}{2p!} \sum_{\sigma\in S_p} (-)^\sigma
			(\ket{i_{\sigma1}i_{\sigma2}} - \ket{i_{\sigma2}i_{\sigma1}})
			\otimes\ket{i_{\sigma3}\cdots i_{\sigma p}} \\
		& = \frac{1}{p!} \sum_{\sigma\in S_p} (-)^\sigma
			\ket{i_{\sigma1}i_{\sigma2}}
			\otimes\ket{i_{\sigma3}\cdots i_{\sigma p}} \\
		& = \alpha\ket{i_1i_2i_3\cdots i_p} \\
	\end{split}\end{equation*}
	これを一般化すると次のようになる。
	\begin{equation*}\begin{split}
		& \ket{i_1\cdots i_p}\times\ket{i_{p+1}\cdots i_{p+q}}
			\times\ket{i_{p+q+1}\cdots i_{p+q+r}} \\
		& \xmapsto{\alpha(\myhere\otimes\myhere)\times\id}
			\frac{1}{(p+q)!}\sum_{\sigma\in S_{p+q}} (-)^\sigma
			\ket{i_{\sigma1}\cdots i_{\sigma(p+q)}}
			\times\ket{i_{p+q+1}\cdots i_{p+q+r}} \\
		& \xmapsto{\alpha(\myhere\otimes\myhere)} \frac{1}{(p+q)!(p+q+r)!}
			\sum_{\substack{\sigma\in S_{p+q}\\\tau\in S_{p+q+r}}}
			(-)^{\sigma+\tau} \ket{i_{\tau\sigma1}\cdots i_{\tau\sigma(p+q)}
			i_{\tau(p+q+1)}\cdots i_{\tau(p+q+r)}} \\
		& = \frac{1}{(p+q+r)!} \sum_{\tau\in S_{p+q+r}} (-)^{\tau}
			\ket{i_{\tau1}\cdots i_{\tau(p+q)}
			i_{\tau(p+q+1)}\cdots i_{\tau(p+q+r)}} \\
		& = \alpha\ket{i_1\cdots i_{p+q+r}}
	\end{split}\end{equation*}
	$\alpha(\myhere\otimes\myhere)(\id\otimes\alpha(\myhere\otimes\myhere))$
	についても同様に計算すると、$\owedge$が結合的になるための式
	\eqref{eq:交代化が積になるための条件}が成り立つことがわかる。
	したがって、$\alpha$が$R$-代数準同型となることもわかる。
	\begin{equation*}\xymatrix{
		\T_*R^m\otimes \T_*R^m \ar[r]^{\alpha\otimes\alpha} \ar[d]^{\simeq}
			& A_*R^m\otimes A_*R^m \ar[d]^{\myhere\owedge\myhere} \\
		\T_*R^m \ar[r]^{\alpha} & A_*R^m \\
	}\end{equation*}

	任意の$1\le p\le m$に対して次の集合$E_p^m$は$A_pR^m$の基底系となる。
	\begin{equation*}\begin{split}
		E_p^m := \Set{\alpha\ket{i_1\cdots i_p}\bou i_1<\cdots<i_p\in 1..m}
	\end{split}\end{equation*}
	$R$-加群準同型$\phi:A_pR^m\to\Wedge_pR^m$を次のように定義すると、
	\begin{equation*}\begin{split}
		\phi\alpha\ket{1_1\cdots i_p} := \bld_{i_1}\wedge\cdots\wedge \bld_{i_p}
	\end{split}\end{equation*}
	$\phi$は$R$-加群同型となる。また、次の式より、$\phi$は$R$-代数同型
	$\phi:A_*R^m\simeq\Wedge_*R^m$となることもわかる。
	\begin{equation*}\begin{split}
		\phi\biggl(\bigl(\alpha\ket{i_1\cdots i_p}\bigr)
			\owedge\bigl(\alpha\ket{j_1\cdots j_q}\bigr)\biggr)
		&= \phi\alpha\ket{i_1\cdots i_pj_1\cdots j_q} \\
		&= \bigl(\phi\alpha\ket{i_1\cdots i_p}\bigr)
			\wedge\bigl(\phi\alpha\ket{j_1\cdots j_q}\bigr)
	\end{split}\end{equation*}
	よって、$(A_*R^m,\owedge,1)$と$(\Wedge_*R^m,\wedge,1)$を同一視しても
	構わない。以降、$(A_*R^m,\owedge,1)$と$(\Wedge_*R^m,\wedge,1)$を同一視して
	$R$-代数準同型$\alpha:(T_*R^m,\otimes,1)\to(\Wedge_*R^m,\wedge,1)$
	として扱い、$\Wedge_*R^m\subseteq \T_*R^m$とする。
	\begin{equation*}\begin{split}
		(\alpha t_1)\wedge (\alpha t_2) = \alpha(t_1\otimes t_2)
		\quad\text{for all } t_1,t_2\in T_*R^m
	\end{split}\end{equation*}

	$\wedge$を$\Wedge_*R^m$から$\T_*R^m$へ拡張することを考える。次の式から、
	\begin{equation*}\begin{split}
		(\alpha t)\wedge(\alpha v) = (\alpha t)\wedge v = \alpha(t\otimes v)
		\quad\text{for all } t\in T_*R^m,\; v\in R^m
		\implies \\
		\sum_{\sigma\in S_p} (-)^{\sigma}
			\ket{i_{\sigma1}\cdots i_{\sigma p}}\wedge\ket{i_{p+1}}
		= \frac{1}{p+1}\sum_{\sigma\in S_{p+1}} (-)^{\sigma}
			\ket{i_{\sigma1}\cdots i_{\sigma p}i_{\sigma(p+1)}} \\
	\end{split}\end{equation*}
	$\wedge$を次のように定義すればよいことがわかる（十分条件）。
	\begin{equation*}\begin{split}
		(p + 1) \ket{i_1\cdots i_p}\wedge\ket{i_{p+1}}
		& = \ket{i_1\cdots i_pi_{p+1}} \\
		& - \ket{i_1\cdots i_{p-1}i_{p+1}i_p} \\
		& +\cdots \\
		& + (-)^p \ket{i_{p+1}i_1\cdots i_p} \\
		& = \ket{i_1}\otimes
			\bigl(\ket{i_2\cdots i_p}\wedge\ket{i_{p+1}}\bigr)
			+ (-)^p \ket{i_{p+1}}\otimes\ket{i_1\cdots i_p} \\
	\end{split}\end{equation*}
	この式はシャッフル積を交代化したものになっている。
	$\T_*R^m$の二項演算$\Cap$を次の漸化式で定義する。
	\begin{itemize}\setlength{\itemsep}{-1mm} %{
		\item 任意の$t\in\T_*R^m$に対して
		\begin{equation*}\begin{split}
			t\Cap 1 = t = 1\Cap t
		\end{split}\end{equation*}
		\item 任意の$w_1,w_2\in\W_*\sizen_+$と$i_1,i_2\in\sizen_+$に対して
		\begin{equation*}\begin{split}
			\ket{i_1w_1}\Cap\ket{i_2w_2} 
			&= \frac{1}{|w_1| + |w_2| + 2} \bigl(x_1 - (-)^{|w_1|} x_2\bigr) \\
			x_1 &= \ket{i_1}\otimes\bigl(\ket{w_1}\Cap \ket{i_2w_2}\bigr) \\
			x_2 &= \ket{i_2}\otimes\bigl(\ket{i_1w_1}\Cap \ket{w_2}\bigr) \\
		\end{split}\end{equation*}
	\end{itemize} %}

\subsubsection{シャッフル置換（shuffle permutation）}
\label{s3:シャッフル置換} %{
	\begin{todo}[ここまで切り取り]\label{todo:ここまで切り取り} %{
	\end{todo} %todo:ここまで切り取り}
	さらに、$S^{p+q}_p(1)$

	したがって、$\shuffle$の可換性はシャッフル置換の可換性に帰着され、
	\begin{equation*}\begin{split}
		(\myhere\shuffle\myhere)
			\biggl([x_1\cdots x_p]\otimes[x_{p+1}\cdots x_{p+q}]\biggr)
		= \sum_{\sigma^{-1}\in S^{p+q}_p}
			[x_{\tau\sigma1}\cdots x_{\tau\sigma(p+q)}] \\
	\end{split}\end{equation*}
	$\shuffle$の結合性はシャッフル置換の結合性に帰着される。
	\begin{equation*}\begin{split}
		(\myhere\shuffle\myhere)(\myhere\shuffle\myhere\otimes\id)
		\biggl([x_1\cdots x_p]\otimes[x_{p+1}\cdots x_{p+q}]
			\otimes[x_{p+q+1}\cdots x_{p+q+r}]\biggr) \\
		= \sum_{\tau^{-1}\in S^{p+q+r}_{p+q},\;\sigma^{-1}\in S^{p+q}_p}
		[x_{\tau\sigma1}\cdots x_{\tau\sigma(p+q)}
			x_{\tau(p+q+1)}\cdots x_{\tau(p+q+r)}]
	\end{split}\end{equation*}
%s3:シャッフル置換}

	\begin{todo}[確かめること]\label{todo:確かめること} %{
		交代シャッフル積について確かめることを書いておく。
		\begin{itemize}\setlength{\itemsep}{-1mm} %{
			\item 自由Lie代数の双対がShuffle代数となる。
			\item 集合から生成される自由$R$-代数を定義すること。
			\begin{equation*}\xymatrix@R=1em{
				\text{自由モノイド} \W_*X \ar[r] 
					& \text{$R$-モノイド代数} R\W_*X \ar@{<->}[dd]^{\simeq} \\
				\text{集合} X \ar[u] \ar[d] \\
				\text{自由$R$-加群} RX^\tran \ar[r] 
					& \text{テンソル代数} \T_*X^\tran \\
			}\end{equation*}
			\item $\Cap$が結合的になること。
			\begin{itemize}\setlength{\itemsep}{-1mm} %{
				\item	シャッフル置換を用いて、交代シャッフル積を定義する。
				\begin{equation*}\begin{split}
					\ket{i_1\cdots i_p}\Cap\ket{i_{p+1}\cdots i_n}
					= \frac{1}{n!}\sum_{\sigma^{-1}\in S_{n:p}} (-)^{\sigma}
					\ket{i_{\sigma1}\cdots i_{\sigma n}}
				\end{split}\end{equation*}
			\end{itemize} %}
			%
			\item 交代シャッフル積を用いて外積が定義できること。
			\begin{equation*}\begin{split}
				(\alpha\ket{w_1})\Cap(\alpha\ket{w_2}) = \alpha\ket{w_1w_2}
			\end{split}\end{equation*}
		\end{itemize} %}
	\end{todo} %todo:確かめること}

////////////////////
	\begin{equation*}\begin{split}
		v_1\owedge v_2 = \alpha(v_1\otimes v_2)
			\implies v_1\owedge v_2
			= \frac{1}{2}(v_1\otimes v_2 - v_2\otimes v_1) \\
		v_1\owedge v_2\owedge v_3 = \alpha(v_1\otimes v_2\otimes v_3) \\
		\implies \sum_{\sigma\in S_2} (-)^\sigma
			(v_{\sigma1}\otimes v_{\sigma2})\owedge v_3
			= \frac{1}{3}\sum_{\sigma\in S_3} (-)^\sigma 
			v_{\sigma1}\otimes v_{\sigma2}\otimes v_{\sigma3} \\
	\end{split}\end{equation*}

	\begin{todo}[ここまで]\label{todo:ここまで} %{
	\end{todo} %todo:ここまで}

	$\owedge$は積となり、$\phi$は$R$-代数準同型
	$\T_*R^m\to A_*R^m$となる。

	$R$-双線形写像$\owedge:\T_*R^m\times \T_*R^m\to \T_*R^m$を次のように
	定義する。
	\begin{equation*}\begin{split}
		v\owedge w = \phi(v\otimes w) \quad\text{for all } v,w\in \T_*R^m
	\end{split}\end{equation*}
	\begin{equation*}\begin{split}
		\bigl(\phi (v_1\otimes\cdots\otimes v_p)\bigr)
			\owedge \bigl(\phi (w_1\otimes\cdots\otimes w_q)\bigr) \\
		= \frac{1}{p!q!} \sum_{\sigma\in S_p,\tau\in S_q} (-)^{\sigma+\tau}
			(v_{\sigma1}\otimes\cdots\otimes v_{\sigma p})
			\owedge (w_{\tau1}\otimes\cdots\otimes w_{\tau p}) \\
		= \frac{1}{p!q!(p+q)!} \sum_{\sigma\in S_p,\tau\in S_q,\mu\in S_{p+q}}
			(-)^{\sigma+\tau+\mu}
			v_{\mu\sigma1}\otimes\cdots\otimes v_{\mu\sigma p}\otimes
			w_{\mu\tau1}\otimes\cdots\otimes w_{\mu\tau p} \\
	\end{split}\end{equation*}
\subsubsection{行列式}\label{s3:行列式} %{
	行列$A\in\Mat_2R$を縦ベクトルで$A=[A_1,A_2]$と表すと、次のように
	行列式を反対称化したテンソル積によって表すことができる。
	\begin{equation*}\begin{split}
		A_1\otimes A_2 - A_2\otimes A_1
		& = \begin{pmatrix}
		A_{11} \\ A_{21}
		\end{pmatrix} \begin{pmatrix}
		A_{12} & A_{22}
		\end{pmatrix} - \begin{pmatrix}
		A_{12} \\ A_{22}
		\end{pmatrix} \begin{pmatrix}
		A_{11} & A_{21}
		\end{pmatrix} \\
		& = (\det A) (\bld_1\otimes\bld_2 - \bld_2\otimes\bld_1)
	\end{split}\end{equation*}
	この式を$2$次元から一般の次元に一般化する。
	行列$A\in\Mat_nR$を縦ベクトルで$A=[A_1,\dots,A_n]$と表して、
	反対称化したテンソル積を計算すると次のようになる。
	\begin{equation}\label{eq:反対称テンソルによる行列式}\begin{split}
		& \sum_{\sigma\in S_n} (-)^\sigma A_{\sigma1}
			\otimes\cdots\otimes A_{\sigma n} \\
		& = \sum_{\sigma\in S_n}\sum_{i_1,\dots,i_n\in1..n} 
			(-)^\sigma A_{(\sigma1)i_1}\cdots A_{(\sigma n)i_n}
			(\bld_{i_1}\otimes\cdots\otimes\bld_{i_n}) \\
		& = \sum_{\sigma,\tau\in S_n}
			(-)^\sigma A_{(\sigma1)(\tau1)}\cdots A_{(\sigma n)(\tau n)}
			(\bld_{\tau1}\otimes\cdots\otimes\bld_{\tau n}) \\
		& = (\det A) \sum_{\tau\in S_n} (-)^\tau
			(\bld_{\tau1}\otimes\cdots\otimes\bld_{\tau n}) \\
	\end{split}\end{equation}
	ここで、テンソル積の中に同じ添字が二つ以上現れると、
	置換の和をとると、置換の偶奇性よりその項は$0$になることを使った。
	例えば、
	$\cdots\otimes\bld_k\otimes\cdots\otimes\bld_k\otimes\cdots$
	のようなテンソル積を含む項は、次のように置換の和をとると$0$になる。
	\begin{equation*}\begin{split}
		A_{1k}A_{2k}(\bld_k\otimes\bld_k) - A_{2k}A_{1k}(\bld_k\otimes\bld_k)
		= 0
	\end{split}\end{equation*}
	外積を使うと、式\eqref{eq:反対称テンソルによる行列式}は、任意の
	$A=[A_1,\dots,A_n]\in \Mat_nR$に対して次のように簡潔に書くことができる。
	\begin{equation}\label{eq:外積による行列式}\begin{split}
		A_1\wedge\cdots\wedge A_n = (\det A)\;\bld_1\wedge\cdots\wedge \bld_n
	\end{split}\end{equation}
%s3:行列式}
%s2:外積}
%s1:自由加群の線形代数}
	%
	} %\setlength\arraycolsep{2pt}
	%
\endgroup %}
