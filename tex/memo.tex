\section{余結合性と二進数}\label{s1:結合性と二進数} %{
	$A=(A,\Delta)$を余半群とする。余結合性$
	(\Delta\times \myid)\Delta=(\myid\times \Delta)\Delta$をSweedler記法
	で書くと、任意の$a\in A$に対して$a_{(11)}\otimes a_{(21)}\otimes a_{(2)}
	=a_{(1)}\otimes a_{(12)}\otimes a_{(22)}$と書ける。
	余積の成分だけを$0$始まりで単語のように書くと、
	$[00]\otimes[10]\otimes[1]=[0]\otimes[01]\otimes[11]$と書ける。
	つまり、$\mybf{2}=\set{0,1}$を文字とする単語$W\mybf{2}$に対する
	二項演算としてみることができる。
%s1:結合性と二進数}

\section{計算と分解の関係}\label{s1:計算と分解の関係} %{
	多くの場合、分解できることが計算できることの基礎になっている。
	例えば、ある集合から生成された自由モノイド$W$は文字数で直和分解
	$W=\oplus_{n\in\mybf{N}}W_n$される。文字数$m$の単語は、
	任意の$p=0,1,2\dots,m$に対して、次の可換図を満たすように、
	文字数の単語$p$と文字数$m-p$の単語に分解できる。
	\begin{equation*}\xymatrix{
		W_m \ar[r]^(.3){\delta} \ar[d]_{\myid} 
		& \oplus_{p=0}^m W_p\times W_{m-p} \ar[ld]^{m_*} \\
		W_m
	}\end{equation*}
%s1:計算と分解の関係}

\section{シャッフル積に関する論文}\label{s1:シャッフル積に関する論文} %{
	講演録\cite{url:dotsenko:anick}にシャッフル積に関する興味深い考察が
	あるのでまとめておく。

	\begin{todo}[問題設定がわからない]\label{todo:問題設定がわからない} %{
	\end{todo} %todo:問題設定がわからない}

	英語のアルファベットの文字列で'sex'という文字列を含まない文字数$n$の
	単語の数を求める問題を考える。
	\begin{equation*}\begin{split} %{
		\text{'sex'を含まない単語の数} &= \text{すべての単語の数} \\
		& - \text{'sex'を一つ以上含む単語の数} \\
		& + \text{'sex'を二つ以上含む単語の数} \\
		& - \text{'sex'を三つ以上含む単語の数} \\
		& + \cdots \\
	\end{split}\end{equation*} %}
	大文字と小文字の区別はしないものとすると次のような表になる。
	\begin{equation*}\begin{array}{rrrrrrr} %{
		\text{文字数} & 1 & 2 & 3 & 4 & 5 & 6 \\
		\text{すべての単語数} & 26 & 26^2 & 26^3 & 26^4 & 26^5 & 26^6 \\
		\text{'sex'を一つ以上含む単語数} & 0 & 0 & 1 & 2\cdot26 & 3\cdot26^2 & 4\cdot26^3 \\
		\text{'sex'を二つ以上含む単語数} & 0 & 0 & 0 & 0 & 0 & 1 \\
	\end{array}\end{equation*} %}
%s1:シャッフル積に関する論文}

\section{分類属性}\label{s1:分類属性} %{
	THTMLのclassやTwitterのタグ等、一つの対象に不定個の属性を付けることで
	その属性を使った応用が拡がることがある。
	最もよく使われる応用は対象のグループ分けだろう。HTMLでは、ある特定の
	class属性を持ったタグに対して一括してある処理を施すことがよく使われるし、
	Twitterでは同一タグをもつTweetの列挙がよく使われる。
	これらの対象を分類することを目的とした属性を分類属性ということにする。
%s1:分類属性}

\section{木}\label{s1:木} %{
	$S$を集合、$TS$を$S$を頂点に持つ木の集合とする。
	$TS$の同値関係は、子供の頂点の並びまで含めるものする。
	例えば、次のような同値関係とする。
	\begin{equation*}\begin{split} %{
		\mytree{
			& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			s_1 && s_2 \\
		} = \mytree{
			& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			s_2 && s_1 \\
		} \iff s_1 = s_2
	\end{split}\end{equation*} %}
	$TS$には空の木を含めないものとする。
	木を次の図のように子供の頂点を括弧でくくって表すことにする。
	\begin{equation*}\begin{split} %{
		s_0[s_1[s_3]s_2[]] := \mytree{
			& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			s_1 \ar@{-}[d] && s_2 \\
			s_3 \\
		}
	\end{split}\end{equation*} %}
	木$t\in TS$の頂点の集合を$\set{t}\subseteq S$と書く。
	$WTS=(TS,m_*,1_*)$を$TS$から生成された自由モノイドとする。
	$WTS$の元を$TS$の元を並べて括弧でくくって表すことにする。
	例えば、$t_1,t_2,\dots,t_m\in TS$に対して$[t_1t_2\cdots t_m]$と書く。
	$m_*$は文字列の連結で、$1_*$は空文字である。
	$WTS$の元を枝と言うことにする。
	枝$w\in WTS$の頂点の集合を$\set{w}\subseteq S$と書く。
	木から頂点を取り除いてできる枝を木の枝ということにする。
	例えば、$t_1,t_2,\dots,t_m\in TS$に対して、枝$[t_1t_2\cdots t_m]$は、
	任意の$s\in S$を頂点とする木$s[t_1t_2\cdots t_m]$の枝となる。

	写像$\myop{tree}$を次のように定義する。
	\begin{equation}\begin{split} %{
		\myop{tree}: S\times WTS &\to TS \\
		s\times w &\mapsto sw \\
	\end{split}\end{equation} %}
	写像$\myop{tree}$は集合同型となる。$\myop{tree}$の逆写像を
	$\myop{tree}^{^1}$書く。
	\begin{equation}\begin{split} %{
		\myop{tree}^{-1}: TS &\to S\times WTS \\
		sw &\mapsto s\times w \\
	\end{split}\end{equation} %}
	木から根を取り出す操作を$\myop{root}=\pi_1\myop{tree}^{-1}$、
	木から根の子供達を$\myop{branch}=\pi_2\myop{tree}^{-1}$と書く。

	$R=(R,+,0,\myspace,1)$を半環とする。
	$RS$を$S$を基底とする$R$係数半モジュール、
	$RTS$を$TS$を基底とする$R$係数半モジュール、
	$RWTS$を$WTS$を基底とする$R$係数半モジュールとする。
	文字列の連結$m_*:WTS\times WTS\to WTS$を$R$線形に$RWTS$に拡張したものを
	同一の記号$m_*$で書くことにする。積$m_*$に双対になる余積$\Delta_*$を次の
	ように定義する。
	\begin{equation}\begin{split} %{
		\Delta_*: RWTS\otimes RWTS &\to RWTS \\
			[t_1t_2\cdots t_m] &\mapsto [t_1t_2\cdots t_m]\otimes 1_* \\
				&\quad + \sum_{1\le i\le m}[t_1t_2\cdots t_m]\neg\set{i}\otimes [t_i] \\
				&\quad + \sum_{1\le i<j\le m}[t_1t_2\cdots t_m]\neg\set{i,j}\otimes [t_it_j] \\
				&\quad + \cdots \\
				&\quad + \sum_{1\le i<j\le m}[t_i]\otimes [t_1t_2\cdots t_m]\neg\set{i} \\
				&\quad + \sum_{1\le i<j\le m}1_*\otimes [t_1t_2\cdots t_m] \\
	\end{split}\end{equation} %}
	ここで、$[t_1t_2\cdots t_m]\neg{i_1,i_2,\dots,i_p}$は$[t_1t_2\cdots t_m]$
	から$i_1,i_2,\dots,i_p$番目の文字を除いた単語とする。
	例えば、次のようになる。
	\begin{equation*}\begin{split} %{
		[t_1t_2t_3]\neg\set{1} &= [t_2t_3] \\
		[t_1t_2t_3]\neg\set{1,3} &= [t_2] \\
		[t_1t_2t_3]\neg\set{1,2,3} &= [] \\
	\end{split}\end{equation*} %}
	余積$\Delta_*$に対する余単位射$\epsilon_*$は次のようになる。
	\begin{equation}\begin{split} %{
		\epsilon_*: RTW &\to R \\
		w &\mapsto \begin{cases} %{
			1, &\text{ iff }w=1_* \\
			0, &\text{ otherwise } \\
		\end{cases} %}
	\end{split}\end{equation} %}

	$RTS$に積を定義するための準備をする。

	\begin{definition}[頂点を指定した接木]\label{def:頂点を指定した接木} %{
		$S$を集合、$TS$を$S$を頂点にもつ木の集合とする。
		$t\in TS$の頂点$i\in \set{t}$の最後の子供に木$t_1\in TS$を付け加える
		操作を$t_1$の頂点$i$への接木ということにする。
	\end{definition} %def:頂点を指定した接木}

	ラベルによらずに頂点の位置を表すために頂点を'頂点の位置:ラベル'
	という形で書いて、接木を図示すると次のようになる。
	\begin{equation*}\begin{split} %{
		\mytree{
			& 0:s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			1:s_1 \ar@{-}[d] && 3:s_3 \\
			2:s_2 \\
		} \lhd_{1} \mytree{
			& r_0 \ar@{-}[dl] \ar@{-}[dr] \\
			r_1 && r_2 \\
		} &= \mytree{
			&& 0:s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			& 1:s_1 \ar@{-}[dl] \ar@{-}[dr] && 3:s_3 \\
			2:s_2 && r_0 \ar@{-}[dl] \ar@{-}[dr] \\
			& r_1 && r_2 \\
		}
	\end{split}\end{equation*} %}

	すべての頂点にわたって接木をする操作を定義する。

	\begin{definition}[木への接木]\label{def:木への接木} %{
		$S$を集合、$R$を半環とする。$TS$を$S$頂点木の集合、$RTS$を$TS$を
		基底とする$R$係数自由半モジュールとする。
		$t\in TS$に対して、頂点$i\in \set{t}$への接木を$\lhd_i$と書く。
		次の$R$双線形写像$\lhd$を木への接木ということにする。
		\begin{equation}\begin{split} %{
			\lhd: RTS\otimes RTS &\to RTS \\
				t\otimes u &\mapsto \sum_{i\in \set{t}}t\lhd_{i}u
				\quad\text{for all }t,u\in TS
		\end{split}\end{equation} %}
	\end{definition} %def:木への接木}

	木への接木を図示すると次のようになる。
	\begin{equation*}\begin{split} %{
		\mytree{
			& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			s_1 \ar@{-}[d] && s_3 \\
			s_2 \\
		} \lhd \mytree{
			& r_0 \ar@{-}[dl] \ar@{-}[dr] \\
			r_1 && r_2 \\
		} &= \mytree{
			& s_0 \ar@{-}[dl] \ar@{-}[d] \ar@{-}[dr] \\
			s_1 \ar@{-}[d] & s_3 & r_0 \ar@{-}[dl] \ar@{-}[dr] \\
			s_2 & r_1 && r_2 \\
		} + \mytree{
			&& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			& s_1 \ar@{-}[dl] \ar@{-}[dr] && s_3 \\
			s_2 && r_0 \ar@{-}[dl] \ar@{-}[dr] \\
			& r_1 && r_2 \\
		} \\
		&+ \mytree{
			&& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			& s_1 \ar@{-}[d] && s_3 \\
			& s_2 \ar@{-}[d] \\
			& r_0 \ar@{-}[dl] \ar@{-}[dr] \\
			r_1 && r_2 \\
		} + \mytree{
			& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			s_1 \ar@{-}[d] && s_3 \ar@{-}[d] \\
			s_2 && r_0 \ar@{-}[dl] \ar@{-}[dr] \\
			& r_1 && r_2 \\
		}
	\end{split}\end{equation*} %}

	木への接木を枝による接木に拡張する。

	\begin{definition}[枝による木への接木]\label{def:枝による木への接木} %{
		$S$を集合、$R$を半環とする。$TS$を$S$頂点木の集合、
		$WTS$を$TS$から生成された自由モノイド、
		$RTS$を$TS$を基底とする$R$係数自由半モジュール、
		$RWTS$を$WTS$を基底とする$R$係数自由半モジュールとする。
		$t\in TS$の頂点$i\in \set{t}$への接木を$\lhd_i$と書く。
		次の$R$双線形写像$\lhd$を枝による木への接木または単に木への接木
		ということにする。
		\begin{equation}\begin{split} %{
			\lhd: RTS\otimes RWTS &\to RTS \\
				t\otimes 1_* &\mapsto t \quad\text{for all }t\in TS \\
				t\otimes [t_1t_2\cdots t_m] 
				&\mapsto \sum_{i_1,i_2,\dots,i_m\in\set{t}}t\lhd_{i_1}t_1\lhd_{i_2}t_2\cdots\lhd_{i_m}t_m \\
				&\quad\text{for all }t,t_1,t_2,\dots,t_m\in TS \\
		\end{split}\end{equation} %}
	\end{definition} %def:枝による木への接木}

	木への接木は根を不変に保つので、次の式により$R$双線形二項演算
	$\sqcup$を定義することができる。
	\begin{equation}\begin{split} %{
		(sw_1)\lhd w_2 = s(w_1\sqcup w_2)\quad\text{for all }s\in S,\;w_1,w_2\in WTS
	\end{split}\end{equation} %}
	前置記号を用いて書くと次のようになる。
	\begin{equation}\begin{split} %{
		\mybiop{\lhd}
		= \myop{tree}(\myid\otimes\mybiop{\sqcup})(\myop{tree}^{-1}\otimes\myid)
	\end{split}\end{equation} %}

	$\sqcup$を計算してみる。
	任意の$s\in S$、$w\in WTS$に対して次のようになる。
	\begin{equation}\begin{split} %{
		(s[])\lhd w=sw &\implies 1_*\sqcup w=w \\
		(sw)\lhd 1_*=sw &\implies w\sqcup 1_*=w \\
	\end{split}\end{equation} %}
	任意の$s\in S$、$t,t_1,t_2,\dots,t_m\in TS$と任意の$1_*$でない$w\in WTS$
	に対しては次の式が成り立つ。
	\begin{equation}\begin{split} %{
		(sw)\lhd[t_1t_2\cdots t_m]
			&= \sum_{i_1,i_2,\dots,i_m\in\set{s}\cup\set{w}}(sw)\lhd_{i_1}t_1\lhd_{i_2}t_2\cdots\lhd_{i_m}t_m \\
			&= (sw)\lhd_{s}[t_1t_2\cdots t_m] \\
			&\;+ \sum_{1\le i\le m}(sw)\lhd_{s}[t_1t_2\cdots t_m]_{\neg\set{i}}\lhd_{\set{w}}[t_i] \\
			&\;+ \sum_{1\le i<j\le m}(sw)\lhd_{s}[t_1t_2\cdots t_m]_{\neg\set{i,j}}\lhd_{\set{w}}[t_it_j] \\
			&\;+ \cdots \\
			&\;+ (sw)\lhd_{\set{w}}[t_1t_2\cdots t_m] \\
	\end{split}\end{equation} %}
	ここで、木$t\in TS$の頂点の部分集合$v\in\set{t}$に対して
	$t\lhd_v[t_1t_2\cdots t_m]$を次のようにおいた。
	\begin{equation}\begin{split} %{
		t\lhd_v[t_1t_2\cdots t_m] 
		&= \sum_{i_1,i_2,\dots,i_m\in v}t\lhd_{i_1}t_1\lhd_{i_2}t_2\cdots\lhd_{i_m}t_m
	\end{split}\end{equation} %}
	したがって、$\sqcup$は任意の$t,t_1,t_2,\dots,t_m\in TS$と任意の$1_*$で
	ない$w\in WTS$に対して次のようになることがわかる。
	\begin{equation}\label{eq:接木による積}\begin{split} %{
		w\sqcup[t_1t_2\cdots t_m]
		&= w\lhd[t_1t_2\cdots t_m] \\
		&\;+ \sum_{1\le i\le m}(w\lhd[t_1t_2\cdots t_m]_{\neg\set{i}})*[t_i] \\
		&\;+ \sum_{1\le i<j\le m}(w\lhd[t_1t_2\cdots t_m]_{\neg\set{i,j}})*[t_it_j] \\
		&\;+ \cdots \\
		&\;+ w*[t_1t_2\cdots t_m] \\
	\end{split}\end{equation} %}
	ここで、$w_1,w_2\in WTS$に対して$w_1\lhd w_2$を$w_1$のすべての頂点に
	接木をした和とした。任意の$t\in TS$、$w\in WTS$に対して
	$[t]\lhd w=[t\lhd w]$となり、
	任意の$t,u_1,u_2,\dots,u_m\in TS$、任意の$1_*$でない$w\in WTS$に対して
	次の再帰式を満たす。
	\begin{equation*}\begin{split} %{
		&([t]*w)\lhd [u_1u_2\cdots u_m] \\
		&= ([t]\lhd 1_*)*(w\lhd [u_1u_2\cdots u_m]) \\
		&\;+ \sum_{1\le i\le m}([t]\lhd[u_i])*(w\lhd [u_1u_2\cdots u_m]_{\neg\set{i}}) \\
		&\; + \sum_{1\le i<j\le m}([t]\lhd[u_iu_j])*(w\lhd [u_1u_2\cdots u_m]_{\neg\set{i,j}}) \\
		&\; + \cdots \\
		&\; + ([t]\lhd [u_1u_2\cdots u_m])*(w\lhd 1_*) \\
	\end{split}\end{equation*} %}
	この式は、任意の$1_*$でない$w_1,w_2\in WTS$と任意の$w_3\in WTS$に対する
	次の再帰式にまとまる。
	\begin{equation}\label{eq:枝同士の接木}\begin{split} %{
		(w_1*w_2)\lhd w_3 = \left(w_1\lhd (\Delta_*^{(1)}w_3)\right)*\left(w_1\lhd (\Delta_*^{(2)}w_3)\right) \\
	\end{split}\end{equation} %}
	さらに、任意の$w\in WTS$に対して$1_*\lhd w=\jump{w=1_*}1_*$と定義すると、
	式\eqref{eq:枝同士の接木}は、任意の$t\in TS,\;w\in WTS$に対して
	$[t]\lhd w=[t\lhd w]$を満たす。改めて、枝同士の接木$\lhd$を定義しておく。

	\begin{definition}[枝への接木]\label{def:枝への接木} %{
		$S$を集合、$R$を半環とする。$TS$を$S$頂点木の集合、
		$WTS$を$TS$から生成された自由モノイド、
		$RTS$を$TS$を基底とする$R$係数自由半モジュール、
		$RWTS$を$WTS$を基底とする$R$係数自由半モジュールとする。
		$t\in TS$の頂点$i\in \set{t}$への接木を$\lhd_i$と書く。
		次の$R$双線形写像$\lhd$を枝による枝への接木または単に枝への接木
		ということにする。
		\begin{equation}\begin{split} %{
			\lhd: RWTS\otimes RWTS &\to RWTS \\
			1_*\otimes w &\mapsto \begin{cases} %{
				1_*, &\text{ iff }w=1_* \\
				0, &\text{ otherwise } \\
			\end{cases} %}
			\quad\text{for all }w\in WTS \\
			[t]\otimes w &\mapsto [t\lhd w] \quad\text{for all }t\in TS,\;w\in WTS \\
			(w_1*w_2)\otimes w &\mapsto \left(w_1\lhd(\Delta_*^{(1)}w)\right) * \left(w_2\lhd(\Delta_*^{(2)}w)\right) \\
			& \quad\text{for all }w_1,w_2,w\in WTS \\
		\end{split}\end{equation} %}
	\end{definition} %def:枝への接木}

	枝への接木を用いると、式\eqref{eq:接木による積}により、
	任意の枝$w_1,w_2\in WTS$に対して次の式が成り立つことがわかる。
	\begin{equation}\begin{split} %{
		w_1\sqcup w_2 &= \left(w_1\lhd(\Delta_*^{(2)}w_2)\right)*(\Delta_*^{(1)}w_2)
	\end{split}\end{equation} %}
	前置記号で書くと次のようになる。
	\begin{equation}\begin{split} %{
		\mybiop{\sqcup} = m_*(\mybiop{\lhd}\otimes\myid)\sigma_{23}(\myid\otimes\Delta_*)
	\end{split}\end{equation} %}

	$\sqcup$の結合性を調べる。まず、任意の$w_1,w_2,w_3\in WTS$に対して
	次の式が成り立つ。
	\begin{equation}\begin{split} %{
		(w_1\sqcup w_2)\sqcup w_3 
		&= \left((w_1\sqcup w_2)\lhd (\Delta_*^{(2)}w_3)\right)*(\Delta_*^{(1)}w_3) \\ 
		&= x_1*x_2*x_3 \\
		x_1 &= \left(w_1\lhd(\Delta_*^{(2)}w_2)\right)\lhd(\Delta_*^{(1)}\Delta_*^{(2)}w_3) \\
		x_2 &= (\Delta_*^{(1)}w_2)\lhd(\Delta_*^{(2)}\Delta_*^{(2)}w_3) \\
		x_3 &= \Delta_*^{(1)}w_3 \\
	\end{split}\end{equation} %}
	一方、$w_1\sqcup(w_2\sqcup w_3)$は次のようになるが、
	\begin{equation}\label{eq:接木の積の結合性その一}\begin{split} %{
		w_1\sqcup(w_2\sqcup w_3) 
		&= \left(w_1\lhd\left(\Delta_*^{(2)}(w_2\sqcup w_3)\right)\right)*\left(\Delta_*^{(1)}(w_2\sqcup w_3)\right) \\ 
	\end{split}\end{equation} %}
	次の式が成り立つから、
	\begin{equation}\begin{split} %{
		&\Delta_*(w_2\sqcup w_3) \\
		&= \left((\Delta_*^{(1)}w_2)\sqcup(\Delta_*^{(1)}w_3)\right)
		\otimes \left((\Delta_*^{(2)}w_2)\sqcup(\Delta_*^{(2)}w_3)\right) \\
		&= \left(\left((\Delta_*^{(1)}w_2)\lhd(\Delta_*^{(2)}\Delta_*^{(1)}w_3)\right)*(\Delta_*^{(1)}\Delta_*^{(1)}w_3)\right)\otimes \left((\Delta_*^{(2)}w_2)\sqcup(\Delta_*^{(2)}w_3)\right) \\
		&= \left(\left((\Delta_*^{(1)}w_2)\lhd(\Delta_*^{(1)}\Delta_*^{(2)}w_3)\right)*(\Delta_*^{(1)}w_3)\right)\otimes \left((\Delta_*^{(2)}w_2)\sqcup(\Delta_*^{(2)}\Delta_*^{(2)}w_3)\right) \\
	\end{split}\end{equation} %}
	式\eqref{eq:接木の積の結合性その一}は次のようになる。
	\begin{equation}\begin{split} %{
		w_1\sqcup(w_2\sqcup w_3) &= y_1*y_2*x_3 \\
		y_1 &= w_1\lhd\left((\Delta_*^{(2)}w_2)\sqcup(\Delta_*^{(2)}\Delta_*^{(2)}w_3)\right) \\
		y_2 &= (\Delta_*^{(1)}w_2)\lhd(\Delta_*^{(1)}\Delta_*^{(2)}w_3) \\
	\end{split}\end{equation} %}
	さらに、が余対称であることを使うと式\eqref{eq:接木の積の結合性その一}は
	次のようになる。
	\begin{equation}\begin{split} %{
		w_1\sqcup(w_2\sqcup w_3) &= z_1*x_2*x_3 \\
		z_1 &= w_1\lhd\left((\Delta_*^{(2)}w_2)\sqcup(\Delta_*^{(1)}\Delta_*^{(2)}w_3)\right) \\
	\end{split}\end{equation} %}

	until

	枝$w\in WTS$の木$t\in TS$の頂点$s\in \set{t}$への接木を中置記法で
	$t\lhd_{s}w$と書く。$s_0,s_1,s_2,s_3\in S$、$t\in TS$として、
	接木$\lhd_{s_1}$を図示すると次のようになる。
	\begin{equation*}\begin{split} %{
		\mytree{
			& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			s_1 \ar@{-}[d] && _2 \\
			s_3 \\
		}\lhd_{s_1} [t_1t_2] &= \mytree{
			&& s_0 \ar@{-}[dl] \ar@{-}[dr] \\
			& s_1 \ar@{-}[dl] \ar@{-}[d] \ar@{-}[dr] && s_2 \\
			s_3 & *+[F]{t_1} & *+[F]{t_2} \\
		}
	\end{split}\end{equation*} %}

	\begin{definition}[自然な成長]\label{def:自然な成長} %{
		を
		$R$双線形写像$\lhd_T$を次のように定義する。
		\begin{equation}\begin{split} %{
			\mathchar`-\lhd_T\mathchar`- : RTS\otimes RWTS &\to RTS \\
				t\otimes 1_* &\mapsto t \quad\text{for all }t\in TS \\
				t\otimes [t_1t_2\cdots t_m] &\mapsto \sum_{s_1,s_2,\dots,s_m\in \set{t}}t \lhd_{s_1} t_1 \lhd_{s_2} t_2 \cdots \lhd_{s_m} t_m \\
				&\quad\text{for all }t,t_1,t_2,\dots,t_m\in TS \\
		\end{split}\end{equation} %}
		$t\lhd_T w$を枝$w$による自然な成長ということにする。
	\end{definition} %def:自然な成長}

	until

	木$t\in TS$の頂点の部分集合$v\subseteq \set{t}$に対して$\lhd_v$を
	次のように定義する。
	\begin{equation}\begin{split} %{
		t\lhd_v w = \sum_{s\in v} t\lhd_s w 
		\quad\text{for all }w\in WTS,\; v\in \set{t}
	\end{split}\end{equation} %}
	自然な成長は木の頂点を変えず頂点を保存する。任意の$t\in TS$、
	$w\in WTS$、$v\subseteq \set{t}$に対して次のようになる。
	\begin{equation*}\begin{split} %{
		\myop{root}(t\lhd_{v} w) &= \myop{root}t \\
		\set{t\lhd_{v} w} &= \set{t}\cup \set{w} \\
	\end{split}\end{equation*} %}
	自然な成長を用いて、$R$双線形な二項演算
	$\mathchar`-\sqcup\mathchar`-:RWT\otimes RWT\to RWT$を次のように定義する。
	\begin{equation}\begin{split} %{
		(sw_1)\lhd_{\set{t}} w_2 = s(w_1\sqcup w_2) \quad\text{for all }s\in S,\;w_1,w_2\in WTS \\
	\end{split}\end{equation} %}
	木$t\in TS$のすべての頂点に対する接木の和$\lhd_{\set{t}}$は、
	任意の$t_1,t_2,\dots,t_m\in TS$に対して次のようになる。
	\begin{equation*}\begin{split} %{
		&t\lhd_{\set{t}}[t_1t_2\cdots t_m] \\
		&= \sum_{s\in \set{t}}t\lhd_s[t_1t_2\cdots t_m] \\
		&= t\lhd_{\myop{root}t}[t_1t_2\cdots t_m] \\
		&+ \sum_{1\le i\le m}t\lhd_{\myop{root}t}[t_1t_2\cdots t_m]_{\neg\set{i}}\lhd_{\set{\myop{branch}t}}[t_i] \\
		&+ \sum_{1\le i<j\le m}t\lhd_{\myop{root}t}[t_1t_2\cdots t_m]_{\neg\set{i,j}}\lhd_{\set{\myop{branch}t}}[t_it_j] \\
		&+ \cdots \\
		&+ t\lhd_{\set{\myop{branch}t}}[t_1t_2\cdots t_m] \\
	\end{split}\end{equation*} %}
	したがって、余積$\Delta_*$を用いると次のようになる。
	\begin{equation*}\begin{split} %{
		t\lhd_{\set{t}} w &= t\lhd_{\myop{root}t}\Delta_*^{(1)}w\lhd_{\set{\myop{branch}t}}\Delta_*^{(2)}w
	\end{split}\end{equation*} %}

until

	特定の頂点に対する接木を、木のすべての頂点に対する接木に拡張する。

	\begin{definition}[自然な成長]\label{def:自然な成長} %{
		$R$双線形写像$\lhd_T$を次のように定義する。
		\begin{equation}\begin{split} %{
			\mathchar`-\lhd_T\mathchar`- : RTS\otimes RWTS &\to RTS \\
				t\otimes 1_* &\mapsto t \quad\text{for all }t\in TS \\
				t\otimes [t_1t_2\cdots t_m] &\mapsto \sum_{s_1,s_2,\dots,s_m\in \set{t}}t \lhd_{s_1} t_1 \lhd_{s_2} t_2 \cdots \lhd_{s_m} t_m \\
				&\quad\text{for all }t,t_1,t_2,\dots,t_m\in TS \\
		\end{split}\end{equation} %}
		$t\lhd_T w$を枝$w$による自然な成長ということにする。
	\end{definition} %def:自然な成長}

	次のように自然な成長を枝に対する操作$\lhd_W$に拡張する。
	\begin{equation}\begin{split} %{
		sw_1\lhd_T w_2 &= s(w_1\lhd_W w_2) 
		\quad\text{for all }s\in S,\;w_1,w_2\in WTS
	\end{split}\end{equation} %}
	$\lhd_W$は次のようになる。
	\begin{equation*}\begin{split} %{
		t\lhd_T [t_1t_2\cdots t_m]
		&= t\lhd_{\set{\myop{branch}t}}[t_1t_2\cdots t_m] \\
		&+ \sum_{1\le i\le m}t\lhd_{\myop{root}t}[t_i]\lhd_{\set{\myop{branch}t}}[t_1t_2\cdots t_m]\neg\set{i} \\
		&+ \sum_{1\le i<j\le m}t\lhd_{\myop{root}t}[t_it_j]\lhd_{\set{\myop{branch}t}}[t_1t_2\cdots t_m]\neg\set{i,j} \\
		&+\cdots \\
		&+ t\lhd_{\myop{root}t}[t_1t_2\cdots t_m]
	\end{split}\end{equation*} %}

	\begin{definition}[枝の自然な成長]\label{def:枝の自然な成長} %{
		$R$線形写像$\lhd_W$を次のように定義する。
		\begin{equation}\begin{split} %{
			\mathchar`-\lhd_W\mathchar`-: RWTS\otimes RWTS &\to RWTS \\
				w_1\otimes w_2 &\mapsto \left(w_1\lhd_W' (\Delta_*^{(2)}w_2)\right)*(\Delta_*^{(1)}w_2) \\
				&\quad\text{for all }w_1,w_2\in WTS \\
			\mathchar`-\lhd_W'\mathchar`-: RWTS\otimes RWTS &\to RWTS \\
				(w_1*w_2)\otimes w_3 &\mapsto \left(w_1\lhd_W' (\Delta_*^{(1)}w_3)\right)*\left(w_2\lhd_W' (\Delta_*^{(2)}w_3)\right) \\
				&\quad\text{for all }w_1,w_2,w_3\in WTS \\
		\end{split}\end{equation} %}
	\end{definition} %def:枝の自然な成長}

	枝の自然な成長を前置記号で書くと次のようになる。
	\begin{equation*}\begin{split} %{
		\mathchar`-\lhd_W\mathchar`-(w_1\otimes w_2)
		&= m_*(\mathchar`-\lhd_W'\mathchar`-\otimes \myid)\sigma_{23}(\myid\otimes \Delta_*)(w_1\otimes w_2) \\
	\end{split}\end{equation*} %}

	木を頂点と頂点の子供の木に分割する$R$線形写像を$\tau$と書くことにする。
	\begin{equation}\begin{split} %{
		\tau: RTS &\to RS\otimes RWTS \\
		s[t_1t_2\cdots t_m] &\mapsto s\times [t_1t_2\cdots t_m] \quad\text{for all }s\in S,\;t_1,t_2,\dots,t_m\in TS
	\end{split}\end{equation} %}
	$\tau$は$R$係数半モジュールとして同型となる。
	さらに、$R$線形写像$\tau_1$を次のように定義し、
	\begin{equation}\begin{split} %{
		\tau_1: RTS &\to RS \\
		s[t_1t_2\cdots t_m] &\mapsto s \quad\text{for all }s\in S,\;t_1,t_2,\dots,t_m\in TS
	\end{split}\end{equation} %}
	$R$線形写像$\tau_2$を次のように定義する。
	\begin{equation}\begin{split} %{
		\tau_2: RTS &\to RWTS \\
		s[t_1t_2\cdots t_m] &\mapsto [t_1t_2\cdots t_m] \quad\text{for all }s\in S,\;t_1,t_2,\dots,t_m\in TS
	\end{split}\end{equation} %}
	$R$線形写像$\phi_\perp$を次のように定義する。
	\begin{equation}\begin{split} %{
		\phi_\perp: RTS\otimes RTS &\to RTS \\
			s_1w_1\otimes s_2w_2 &\mapsto s_1\phi_\sqcup(w_1\otimes w_2) \\
			& \quad\text{for all }s_1,s_2\in S\,\;w_1,w_2\in WTS \\
	\end{split}\end{equation} %}
	ここで、$R$線形写像$\xi_\perp:RWTS\otimes RWTS\to RWTS$を次のように
	定義する。
	\begin{itemize} %{
		\item 任意の$w\in WTS$に対して
		\begin{equation}\begin{split} %{
			\phi_\sqcup(1_*\otimes w) = w = \phi_\sqcup(w\otimes 1_*) 
		\end{split}\end{equation} %}
		\item 任意の$w\in WTS$に対して
		\begin{equation}\begin{split} %{
			\phi_\sqcup(w_1\otimes w_2) &= []　\\
			\phi_\sqcup([t_1t_2\cdots t_m]\otimes w)
			&= m_*([t_1't_2'\cdots t_m']\otimes \Delta_*^{(2)}w) \quad\text{where} \\
		\end{split}\end{equation} %}
	\end{itemize} %}
	\begin{equation}\begin{split} %{
	\end{split}\end{equation} %}
	\begin{equation}\begin{split} %{
			w &= m_*(\phi_\vee\otimes \myid)(\myid\otimes \Delta_*)(w_1\otimes w_2 ) \\
			t_1\otimes t_2 &= \tau^{-1}(\myid\otimes m_*(\phi_\vee\otimes \myid))(\tau\otimes \Delta_*\tau_2)(t_1\otimes t_2) \\
			&\quad\text{for all }t_1,t_2\in TS \\
		\phi_\vee: RWTS\otimes RWTS &\to RWTS \\
	\end{split}\end{equation} %}

	$R$を半環とする。$RTS$を$TS$を基底とする$R$係数半モジュール、
	$RWTS$を$WTS$を基底とする$R$係数半モジュールとする。
	二項演算$\sqcup$を次のように定義する。
	\begin{equation}\begin{split} %{
		\sqcup: RTS\otimes RTS &\to RTS \\
			t_1\otimes 
	\end{split}\end{equation} %}
%s1:木}

\section{モノイド半環の自己線形写像}\label{s1:モノイド半環の自己線形写像} %{
	$R=(R,+,0,m_R,1)$を可換半環、$R_x=R[[x]]$を$\set{x^n}_{n=0}^\infty$を基底
	とする$R$係数半モジュールとする。
	$R_x$の基底を任意の$n\in \mybf{N}$に対して括弧つきで$[n]=x^n$のように書く。

	$R_x$に次の積$m_x$と余積$\Delta_x$を定義する。
	\begin{equation}\label{eq:多項式の積と余積}\begin{split} %{
		m_x([m]\otimes[n]) &= [m+n] \\
		\Delta_x[m] &= \sum_{k=0}^m\binom{m}{k}[k]\otimes[m-k] \\
	\end{split}\end{equation} %}
	$m_x$と$\Delta_x$は双対となる。$m_x$に関する単位射は$u_x1=[0]$、
	$\Delta_x$に関する余単位射は$\epsilon_x[m]=\jump{m=0}$となる。

	$R_x$から$R$への線形写像全体を$R_x^t$とおく。任意の$p,m\in\mybf{N}$に
	対して$[p]^t_*\in R_x^t$を$[p]^t_*[m]=\jump{p=m}$で定義する。すると、
	$R_x^t$は$\set{[n]^t_*}_{n\in\mybf{N}}$を基底とする$R$係数半モジュールとなる。
	$R_x^t$には畳み込みにより次の積$m_x^t$と余積$\Delta_x^t$が定義される。
	\begin{equation}\begin{split} %{
		m_x^t([p]^t_*\otimes [q]^t_*) &= \binom{p+q}{p}[p+q]^t_* \\
		\Delta_x^t[p]^t_* &= \sum_{k=0}^p[k]^t_*\otimes[p-k]^t_* \\
	\end{split}\end{equation} %}
	この積$m_x^t$と余積$\Delta_x^t$の定義は、積$m_x$と余積$\Delta_x$の定義
	\eqref{eq:多項式の積と余積}をスケール変換したものと同じ形になっている。
	$[p]^t=p![p]^t_*$とすると、畳み込みによる積$m_x^t$と余積$\Delta_x^t$は
	次のようになる。
	\begin{equation}\begin{split} %{
		m_x^t([p]^t\otimes [q]^t) &= [p+q]^t \\
		\Delta_x^t[p]^t &= \sum_{k=0}^p\binom{p}{k}[k]^t\otimes[p-k]^t \\
	\end{split}\end{equation} %}
	$m_x^t$に関する単位射は$u_x^t1=[0]^t$、$\Delta_x^t$に関する余単位射は
	$\epsilon_x^t[p]^t=\jump{p=0}$となる。$m_x^t$と$\Delta_x^t$は双対となる。

	$MR_x=\homset(R_x,R_x)$を自己線形写像全体のつくる空間とする。
	\begin{equation}\begin{split} %{
		f(y_1+y_2) &= (fy_1) + (fy_2)\quad\text{for all }f\in MR_x,\;y_1,y_2\in R_x \\
		f(ry) &= r(fy)\quad\text{for all }f\in MR_x,\;y\in R_x,\;r\in R \\
	\end{split}\end{equation} %}
	$MR_x$には次のように加法とスカラー積を定義することができる。
	\begin{equation}\begin{split} %{
		+: MR_x\times MR_x &\to MR_x \\
			f\times g&\mapsto (f+g) \quad\text{such that }\\
			&\quad (f+g)y=(fy)+(gy)\quad\text{for all }y\in R_x \\
		\rhd_R: R\times MR_x &\to MR_x \\
			r\times f &\mapsto (r\rhd_Rf) \quad\text{such that } \\
			&\quad(r\rhd_Rf)y=r(fy)\quad\text{for all }y\in R_x \\
		\lhd_R: MR_x\times R &\to MR_x \\
			f\times r &\mapsto (f\rhd_Rr) \quad\text{such that } \\
			&\quad(f\rhd_Rr)y=(fy)r\quad\text{for all }y\in R_x \\
	\end{split}\end{equation} %}
	したがって、$MR_x$は$R$を係数とする半モジュールとなる。
	以下では、スカラー積$\rhd_R$と$\lhd_R$の記号は省略して書く。
	テンソル積$R_x\otimes R_x^t$から$MR_x$への線形写像を$\mu$を次のように
	定義する。
	\begin{equation}\begin{split} %{
		\mu: R_x\otimes R_x^t &\to MR_x \\
			y_1\otimes y_2^t &\mapsto \mu(y_1\otimes y_2^t)\quad\text{such that } \\
			&\quad \mu(y_1\otimes y_2^t)z = y_1(y_2^t z)\quad\text{for all }z\in R_x \\
	\end{split}\end{equation} %}
	以下では、任意の$f,g\in A$に対して、$fg^t=\mu(f\otimes g^t)$と書く。
	任意の$f\in MR_x$は次のように書くことができる。
	\begin{equation*}\begin{split} %{
		f = \sum_{p=0}^\infty\frac{1}{p!}(f[p])[p]^t
	\end{split}\end{equation*} %}
	したがって、$\mu$は$R$半モジュール同型となる。
	$MR_x$の基底として$\set{[p][q]^t}_{p,q\in\mybf{N}}$をとることができる。
	見やすいように$\mybinom{p}{q}=[p][q]^t$と書くことにする。
	任意の$p,q,m\in \mybf{N}$に対して次のようになる。
	\begin{equation}\begin{split} %{
		\mybinom{p}{q}[m] &= \jump{m=q}q![p] \\
		\mybinom{p}{q} &= q![p][q]^t_* \\
	\end{split}\end{equation} %}

	$MR_x$の合成$\circ$もまた$MR_x$の元になる。
	\begin{equation}\begin{split} %{
		f\circ g\in MR_x \quad\text{for all }f,g\in MR_x \\
	\end{split}\end{equation} %}
	したがって、写像の合成$\circ$は恒等写像$1_\circ=\sum_{p\in \mybf{N}}\mybinom{p}{p}$を
	単位元とする積となる。写像の合成を前置記号で$m_\circ$と書くことにする。
	積$m_\circ$は、任意の$p_1,p_2,q_1,q_2\in \mybf{N}$に対して次のようになる。
	\begin{equation}\begin{split} %{
		m_\circ(\mybinom{p_1}{q_1}\otimes \mybinom{p_2}{q_2}) 
		&= ([q_1]^t[p_2])\mybinom{p_1}{q_2} \\
		&= \jump{q_1=p_2}q_2!\mybinom{p_1}{q_2} 
	\end{split}\end{equation} %}
	積$m_\circ$に関する生成系は次のものをとることができる。
	\begin{equation}\begin{split} %{
		\set{\mybinom{0}{1},\mybinom{0}{2},\dots,\mybinom{1}{0},\mybinom{2}{0},\dots}
	\end{split}\end{equation} %}

	写像の合成以外による積の他に、次の可換図で積$m_\mu:MR_x\otimes MR_x\to MR_x$
	を定義することができる。
	\begin{equation}\xymatrix{
		R_x\otimes R_x^t\otimes R_x\otimes R_x^t \ar[r]^{\mu\times \mu} \ar[d]^{(m_x\otimes m_x^t)\sigma_{23}}
		& MR_x\otimes MR_x \ar@{.>}[d]^{m_\mu} \\
		R_x\otimes R_x^t \ar[r]^{\mu} & MR_x \\
	}\end{equation}
	積$m_\mu$は、任意の$p_1,p_2,q_1,q_2\in\mybf{N}$に対して次のようになる。
	\begin{equation}\begin{split} %{
		m_\mu(\mybinom{p_1}{q_1}\otimes\mybinom{p_2}{q_2}) = \mybinom{p_1+p_2}{q_1+q_2}
	\end{split}\end{equation} %}
	任意の$p_1,p_2,p_3,q_1,q_2,q_3\in\mybf{N}$に対して次のようになるから、
	積$m_x$と積$m_x^t$の結合性から、写像$m_\mu$が結合的になることは確かめられる。
	\begin{equation}\begin{split} %{
		&(\myid\otimes m_\mu)m_\mu(\mybinom{p_1}{q_1}\otimes\mybinom{p_2}{q_2}\otimes\mybinom{p_3}{q_3}) \\
		&\quad= ((\myid\otimes m_x)m_x[p_1p_2p_3]_\otimes)((\myid\otimes m_x^t)m_x^t[q_1q_2q_3]^t_\otimes) \\
		&(m_\mu\otimes \myid)m_\mu(\mybinom{p_1}{q_1}\otimes\mybinom{p_2}{q_2}\otimes\mybinom{p_3}{q_3}) \\
		&\quad= ((m_x\otimes \myid)m_x[p_1p_2p_3]_\otimes)((m_x^t\otimes \myid)m_x^t[q_1q_2q_3]^t_\otimes) \\
	\end{split}\end{equation} %}
	ここで、表記を簡略化するために、任意の$n\in\mybf{N}$および
	$p_1,p_2,\dots,p_n\in\mybf{N}$次のようにおいた。
	\begin{equation}\begin{split} %{
		[p_1p_2\cdots p_n]_\otimes &= [p_1]\otimes[p_2]\otimes\cdots\otimes[p_n] \\
		[p_1p_2\cdots p_n]^t_\otimes &= [p_1]^t\otimes[p_2]^t\otimes\cdots\otimes[p_n]^t \\
	\end{split}\end{equation} %}
	積$m_\mu$に関する単位射は$u_\mu1=\mybinom{0}{0}$となる。
	積$m_\mu$に関する単位元を$1_\mu=\mybinom{0}{0}$ とおく。
	積$m_\mu$に関する生成系は次のものをとることができる。
	\begin{equation}\begin{split} %{
		\set{\mybinom{0}{1},\mybinom{1}{0}}
	\end{split}\end{equation} %}
	余積$\Delta_\mu$を次の可換図で定義する。
	\begin{equation}\xymatrix{
		R_x\otimes R_x^t\otimes R_x\otimes R_x^t \ar[r]^{\mu\times \mu}
		& MR_x\otimes MR_x \\
		R_x\otimes R_x^t \ar[r]^{\mu} \ar[u]_{\sigma_{23}(\Delta_x\otimes \Delta_x^t)} & MR_x \ar@{.>}[u]_{\Delta_\mu} \\
	}\end{equation}
	余積$\Delta_\mu$は、任意の$p,q\in\mybf{N}$に対して次のようになる。
	\begin{equation}\begin{split} %{
		\Delta_\mu\mybinom{p}{q} = \sum_{k=0}^p\sum_{l=0}^q\binom{p}{k}\binom{q}{l}\mybinom{k}{l}\otimes \mybinom{p-k}{q-l} \\
	\end{split}\end{equation} %}
	任意の$p,q\in\mybf{N}$に対して次のようになるから、余積$\Delta_x$と
	余積$\Delta_x^t$の余結合性から、写像$\Delta_\mu$が余結合的になることは
	確かめられる。
	\begin{equation}\begin{split} %{
		(\myid\otimes \Delta_\mu)\Delta_\mu\mybinom{p}{q}
		&= ((\myid\otimes \Delta_x)\Delta_x[p])((\myid\otimes \Delta_x^t)\Delta_x^t[q]^t_*) \\
		(\Delta_\mu\otimes \myid)\Delta_\mu\mybinom{p}{q}
		&= ((\Delta_x\otimes \myid)\Delta_x[p])((\Delta_x^t\otimes \myid)\Delta_x^t[q]^t_*) \\
	\end{split}\end{equation} %}
	余積$\Delta_\mu$に関する余単位射$\epsilon_\mu$は次のようになる。
	\begin{equation}\begin{split} %{
		\epsilon_\mu\mybinom{p}{q} = \jump{p=q=0} \quad\text{for all }p,q\in\mybf{N}
	\end{split}\end{equation} %}
	任意の$p_1,p_2,q_1,q_2\in\mybf{N}$に対して次の式が成り立つから、
	積$m_x$と余積$\Delta_x$の双対性、積$m_x^t$と余積$\Delta_x^t$の双対性から、
	積$m_\mu$と余積$\Delta_\mu$は互いに双対になる。
	\begin{equation}\begin{split} %{
		&\Delta_\mu m_\mu\kakko{\mybinom{p_1}{q_1}\otimes\mybinom{p_2}{q_2}} \\
		&\quad = (\Delta_x m_x[p_1p_2])(\Delta_x^t m_x^t[q_1q_2]^t_*) \\
		&(m_\mu\otimes m_\mu)\sigma_{23}(\Delta_\mu\otimes \Delta_\mu)\kakko{\mybinom{p_1}{q_1}\otimes\mybinom{p_2}{q_2}} \\
		&\quad = ((m_x\otimes m_x)\sigma_{23}(\Delta_x\otimes \Delta_x)[p_1p_2])
		((m_x^t\otimes m_x^t)\sigma_{23}(\Delta_x^t\otimes \Delta_x^t)[q_1q_2]^t_*)
	\end{split}\end{equation} %}
	任意の$p_1,p_2,q_1,q_2,m\in\mybf{N}$に対して次の可換図が成り立つ。
	\begin{equation}\xymatrix{
		\displaystyle\sum_{k=0}^m\binom{m}{k}[k]\otimes[m-k] 
		\ar[d]^{\mybinom{p_1}{q_1}\otimes \mybinom{p_2}{q_2}}
		& [m] \ar[l]_{\Delta_x} 
		\ar[d]^{m_\mu(\mybinom{p_1}{q_1}\otimes \mybinom{p_2}{q_2})}
		\\
		\jump{m=q_1+q_2}m![p_1]\otimes[p_2] \ar[r]^{m_x}
		& \jump{m=q_1+q_2}m![p_1+p_2]
		\\
	}\end{equation}
	また、任意の$p,q,m,n\in\mybf{N}$に対して次の可換図が成り立つ。
	\begin{equation}\xymatrix@C+3pc{
		[m]\otimes[n] \ar[r]^{m_x} \ar[d]^{\Delta_\mu\mybinom{p}{q}}
		& [m+n] \ar[d]^{\mybinom{p}{q}}
		\\
		\jump{q=m+n}q!\sum_{k=0}^p\binom{p}{k}[k]\otimes[p-k] 
		& \jump{q=m+n}q![p] \ar[l]_{\Delta_x}
		\\
	}\end{equation}
	したがって、双半代数$(MR_x,m_\mu,u_\mu,\Delta_\mu,\epsilon_\mu)$は
	双半代数$(R_x,m_x,u_x,\Delta_x,\epsilon_x)$の畳み込みからも得ることが
	できる。

	ここで、半代数準同型写像$(R_x,m_x,u_x)\to (R_x,m_x,u_x)$を考える。
	半代数準同型写像$(R_x,m_x,u_x)\to (R_x,m_x,u_x)$全体を
	$\myop{end}R_x=(R_x,m_x,u_x)\to (R_x,m_x,u_x)$と書く。
	任意の$y\in R_x$に対して$x\mapsto y$となる$y_*\in\myop{end}R_x$
	は次のように書ける。
	\begin{equation}\begin{split} %{
		y_* &= 1_\mu + y[1] + \frac{1}{2!}m_x(y\otimes y)[2]^t + \cdots \\
		&= 1_\mu + y[1]^t + \frac{1}{2!}m_\mu(y[1]^t\otimes y[1]^t) + \cdots \\
		&= \exp_\mu(y[1]^t) \\
	\end{split}\end{equation} %}
	ここで、$\exp_\mu:MR_x\to MR_x$を、任意の$f\in MR_x$に対して次のように
	おいた。
	\begin{equation}\begin{split} %{
		\exp_\mu f &= 1_\mu + f + \frac{1}{2!}m_\mu(f\otimes f) + \cdots \\
	\end{split}\end{equation} %}
	特に、合成の単位元$1_\circ$は$\exp_\mu$を用いて次のように書ける。
	\begin{equation}\begin{split} %{
		\exp_\mu \mybinom{1}{1} &= 1_\mu + \mybinom{1}{1} + \frac{1}{2!}m_\mu(\mybinom{1}{1}\otimes \mybinom{1}{1}) + \cdots \\
	\end{split}\end{equation} %}
	写像$\exp_\mu$は線形写像ではないことに注意する。

\begin{todo}[until]\label{todo:until} %{
	自己半代数準同型の合成は自己半代数準同型になるから、
	$(\myop{end}R_x,m_\circ,u_\circ)$は$(MR_x,m_\circ,u_\circ)$の部分半代数
	となる。次の写像$\phi$は集合同型となる。
	\begin{equation}\begin{split} %{
		\phi: R_x &\to \myop{end}R_x \\ 
			y &\mapsto \exp_\mu(y[1]^t) \\
	\end{split}\end{equation} %}

	任意の$f,g\in MR_x$に対して$m_\mu(f\otimes g)=fg$とし、
	$y=y_0+y_1[1]+y_2[2]+\cdots\in R_x$を
	$y=y_0\mybinom{0}{0}+y_1\mybinom{1}{0}+y_2\mybinom{2}{0}+\cdots\in MR_x$
	と同一視する。$y\in R_x$として微分作用素$y\partial$は次の式で得られる。
	\begin{equation}\label{eq:微分変換群の一次近似}\begin{split} %{
		\phi([1]+y) &= \exp_\mu(\mybinom{1}{1}+y\mybinom{0}{1}) \\
			&= (\exp_\mu\mybinom{1}{1})(\exp_\mu y\mybinom{0}{1}) \\
			&= 1_\circ(\exp_\mu y\mybinom{0}{1}) \\
			&= 1_\circ + 1_\circ(y\mybinom{0}{1}) + \frac{1}{2!}1_\circ(y\mybinom{0}{1})^2 + \cdots \\
			&= 1_\circ + y(1_\circ\mybinom{0}{1}) + \frac{1}{2!}y^2(1_\circ\mybinom{0}{2}) + \cdots \\
			&= 1_\circ + y\partial + \frac{1}{2!}y^2(\partial\circ\partial) + \cdots \\
	\end{split}\end{equation} %}
	ここで、$\partial$を次のようにおき、
	\begin{equation}\begin{split} %{
		\partial = 1_\circ*\mybinom{0}{1} = \sum_{k=0}^\infty \frac{1}{k!}\mybinom{k}{k+1} \\
	\end{split}\end{equation} %}
	次の式が成り立つことを使った。
	\begin{equation}\begin{split} %{
		1_\circ\mybinom{0}{2} &= \partial\circ\partial \\
		1_\circ\mybinom{0}{3} &= \partial\circ\partial\circ\partial \\
		\cdots &= \cdots \\
	\end{split}\end{equation} %}
	式\eqref{eq:微分変換群の一次近似}は、微分変換$\exp_\circ(y\partial)$の
	一次近似となっている。
\end{todo} %todo:until}
%s1:モノイド半環の自己線形写像}

\section{The Explicit Computation of Integration Algorithms and First Integrals for Ordinary Differential Equations With Polynomial Coefficients Using Trees}\label{s1:The Explicit Computation of Integration Algorithms and First Integrals for Ordinary Differential Equations With Polynomial Coefficients Using Trees} %{
	論文\cite{url:grossman:explicit}に関するメモを書いておく。

	簡単のために一次元で考える。体$k$を実数または複素数とする。
	$k$上の常微分方程式を考える。与えられた$v\in(k[x]\to k[x])$に対して、
	次の式を満たす写像$x:k\to k$を求めることを考える。
	\begin{equation}\label{eq:お題の常微分方程式}\begin{split} %{
		\partial_tx = v(x),\quad x0=x_0 \\
	\end{split}\end{equation} %}
	この式の形式解$x$は次のように書ける。
	\begin{equation}\begin{split} %{
		x = e^{tv(x)\partial_x}x\bou_{x=x_0}
	\end{split}\end{equation} %}
	したがって、次の式を処理することで\eqref{eq:お題の常微分方程式}の解
	の持つ性質が導かれる。
	\begin{equation}\label{eq:常微分方程式の形式解}\begin{split} %{
		e^{tv(x)\partial_x}x
	\end{split}\end{equation} %}
	この形式解の中で写像$e^{tv(x)\partial_x}$は$k[x]\to k[x]$の線形写像
	\begin{equation}\begin{split} %{
		e^{tv(x)\partial_x}(f+g) 
		&= (e^{tv(x)\partial_x}f) + (e^{tv(x)\partial_x}g) \quad\text{for all }f,g\in k[x] \\
		e^{tv(x)\partial_x}(af) &= a(e^{tv(x)\partial_x}f) \quad\text{for all }f\in k[x],\;a\in k \\
	\end{split}\end{equation} %}
	かつ準同型写像
	\begin{equation}\begin{split} %{
		e^{tv(x)\partial_x}x^{m+n} 
		&= (e^{tv(x)\partial_x}x^m)(e^{tv(x)\partial_x}x^n) \quad\text{for all }m,n\in \mybf{N}
	\end{split}\end{equation} %}
	となっている。
	$k[x]\to k[x]$の線形写像全体を$\myop{end}k[x]$と書く。
	写像$e^{tv(x)\partial_x}$を$t$についてべき展開すると次のようになる。
	\begin{equation}\begin{split} %{
		e^{tv(x)\partial_x} &= \sum_{k\in\mybf{N}}\frac{t^k}{k!}(v\partial_x)^n \\
	\end{split}\end{equation} %}
	$(v\partial_x)^n$は$n=0,1,2,3$に対して次のようになる。
	\begin{equation}\begin{split} %{
		(v\partial_x)^0 &= 1 \\
		(v\partial_x)^1 &= v\partial_x \\
		(v\partial_x)^2 &= v^2\partial_x^2 + v(\partial_xv)\partial_x \\
		(v\partial_x)^3 &= v^3\partial_x^3 + 3v^2(\partial_xv)\partial_x^2 
			+ v^2(\partial_x^2v)\partial_x + v(\partial_xv)^2\partial_x \\
	\end{split}\end{equation} %}
	この$t$に関するべき展開は、根を黒丸、根以外の頂点を$v$とする木で
	書くことができる。
	\begin{equation}\begin{split} %{
		(v\partial_x)^0 &\sim \mytree {
			\bullet
		} \\
		(v\partial_x)^1 &\sim \mytree {
			\bullet \ar@{-}[d] \\
			v
		} \\
		(v\partial_x)^2 &\sim \mytree {
			& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
			v && v \\
		} + \mytree {
			\bullet \ar@{-}[d] \\
			v \ar@{-}[d] \\
			v \\
		} \\
		(v\partial_x)^3 &\sim \mytree {
			& \bullet \ar@{-}[dl] \ar@{-}[d] \ar@{-}[dr] \\
			v & v & v \\
		} + 3 \mytree {
			& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
			v \ar@{-}[d] && v \\
			v \\
		} + \mytree {
			& \bullet \ar@{-}[d] \\
			& v \ar@{-}[dl] \ar@{-}[dr] \\
			v && v \\
		} + \mytree {
			\bullet \ar@{-}[d] \\
			v \ar@{-}[d] \\
			v \ar@{-}[d] \\
			v \\
		}  \\
	\end{split}\end{equation} %}
	$(v\partial_x)^{n+1}$を表す木は、$(v\partial_x)^{n}$を表す木の根を含む
	各頂点の最後の子供に頂点$v$を付け足すと得られれる。
	わかりやすくするために頂点の種類を$\set{v_1,v_2,\dots}$と複数に増やして、
	頂点$v_i$を付け足す操作を$\lhd$で表すと次のような図になる。
	\begin{equation}\begin{split} %{
		\mytree{
			\bullet
		} \lhd v_1 &= \mytree{
			\bullet \ar@{-}[d] \\
			v_1
		} \\
		\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		} \lhd v_2 &= \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 && v_2
		} + \mytree{
			\bullet \ar@{-}[d] \\
			v_1 \ar@{-}[d] \\
			v_2
		} \\
		\mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 && v_2
		} \lhd v_3 &= \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[d] \ar@{-}[rd] \\
			v_1 & v_2 & v_3
		} + \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 \ar@{-}[d] && v_2 \\
			v_3
		} + \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 && v_2 \ar@{-}[d] \\
			&& v_3
		} \\
		\mytree{
			\bullet \ar@{-}[d] \\
			v_1 \ar@{-}[d] \\
			v_2
		} \lhd v_3 &= \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 \ar@{-}[d] && v_3 \\
			v_2
		} + \mytree{
			& \bullet \ar@{-}[d] \\
			& v_1 \ar@{-}[ld] \ar@{-}[rd] \\
			v_2 && v_3
		} + \mytree{
			\bullet \ar@{-}[d] \\
			v_1 \ar@{-}[d] \\
			v_2 \ar@{-}[d] \\
			v_3
		}
	\end{split}\end{equation} %}
	木の子供の並びの順序の違いを無視すると次のようになる。
	\begin{equation}\begin{split} %{
		(v\partial_x)^0 &\sim \bullet \\
		(v\partial_x)^1 &\sim \bullet\lhd v \\
		(v\partial_x)^2 &\sim (\bullet\lhd v)\lhd v \\
		(v\partial_x)^3 &\sim ((\bullet\lhd v)\lhd v)\lhd v \\
	\end{split}\end{equation} %}
	木に頂点を付け足していく操作$\lhd$を木の二項演算$*$で書き直すことを考える。
	括弧を省略して、$(\bullet\lhd v_1)\lhd v_2$を$\bullet\lhd v_1\lhd v_2$
	と書き、木の二項演算$\amalg$を、二項目が二つの頂点だけからなる木に対して
	次のように定義する。
	\begin{equation}\begin{split} %{
		\bullet\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_1
		} &= \bullet\lhd v_1 \\
		\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_2
		} &= \bullet\lhd v_1\lhd v_2 \\
		\kakko{\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_2
		}}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_3
		} &= \bullet\lhd v_1\lhd v_2\lhd v_3 \\
	\end{split}\end{equation} %}
	$\amalg$が結合律を満たすためには、次の式が成り立つ必要がある。
	\begin{equation}\begin{split} %{
		\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \kakko{\mytree{
			\bullet \ar@{-}[d] \\
			v_2
		}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_3
		}} &= \kakko{\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_2
		}}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_3
		}
	\end{split}\end{equation} %}
	つまり、次の式が成り立つ必要がある。
	\begin{equation}\begin{split} %{
		\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \kakko{\mytree{
			\bullet \ar@{-}[d] \\
			v_2
		}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_3
		}} &= \mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \kakko{\mytree {
			& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
			v_2 && v_3
		} + \mytree {
			\bullet \ar@{-}[d] \\
			v_2 \ar@{-}[d] \\
			 v_3
		}} \\
		&= \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[d] \ar@{-}[rd] \\
			v_1 & v_2 & v_3
		} + \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 \ar@{-}[d] && v_2 \\
			v_3
		} + \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 && v_2 \ar@{-}[d] \\
			&& v_3
		} \\
		&+ \mytree{
			& \bullet \ar@{-}[ld] \ar@{-}[rd] \\
			v_1 \ar@{-}[d] && v_3 \\
			v_2
		} + \mytree{
			& \bullet \ar@{-}[d] \\
			& v_1 \ar@{-}[ld] \ar@{-}[rd] \\
			v_2 && v_3
		} + \mytree{
			\bullet \ar@{-}[d] \\
			v_1 \ar@{-}[d] \\
			v_2 \ar@{-}[d] \\
			v_3
		}
	\end{split}\end{equation} %}
	この式は$\amalg$を次のように定義すれば成り立つ。
	\begin{equation}\begin{split} %{
		\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \mytree{
			& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
			v_2 && v_3
		} &= \mytree{
			& \bullet \ar@{-}[dl] \ar@{-}[d] \ar@{-}[dr] \\
			v_1 & v_2 & v_3
		} + \mytree{
			& \bullet \ar@{-}[dl]  \ar@{-}[dr] \\
			v_1 \ar@{-}[d] && v_2 \\
			v_3 
		} + \mytree{
			& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
			v_1 \ar@{-}[d] && v_3 \\
			v_2
		} + \mytree{
			& \bullet \ar@{-}[d] \\
			& v_1 \ar@{-}[dl] \ar@{-}[dr] \\
			v_2 && v_3
		} \\
		\mytree{
			\bullet \ar@{-}[d] \\
			v_1
		}\amalg \mytree{
			\bullet \ar@{-}[d] \\
			v_2 \ar@{-}[d] \\
			v_3
		} &= \mytree{
			& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
			v_1 && v_2 \ar@{-}[d] \\
			&& v_3
		} + \mytree{
			\bullet \ar@{-}[d] \\
			v_1 \ar@{-}[d] \\
			v_2 \ar@{-}[d] \\
			v_3
		}
	\end{split}\end{equation} %}

	二項演算$\amalg$の演算規則は次のようになる。
	\begin{itemize} %{
		\item $V$を集合とする。$V$を頂点とする空でない木の集合を$TV$とする。
		$\bullet$を根、$V$を根以外の頂点とする空でない木の集合を
		$T_\bullet V$とする。$T_\bullet V$の任意の元は、$\bullet$または、
		$\mytree{
				& \bullet \ar@{-}[dl] \ar@{-}[d] \ar@{-}[drr] \\
				*+[F]{t_1} & *+[F]{t_2} & \cdots & *+[F]{t_m}
		}$という形に一意的に書ける。
		$T_*V=T_\bullet V\cup TV$とする。
		\item $R$を半環とする。$TV$を基底とする$R$自由半モジュールを$RVT$、
		$T_\bullet V$を基底とする$R$自由半モジュールを$RV_\bullet T$、
		$T_*V$を基底とする$R$自由半モジュールを$RV_*T$とする。
		\item 木$t\in T_*V$の根を含むすべての頂点を$\set{t}$と書く。
		\item 木$t\in T_*V$の頂点$v$の最後の子供に木$t_1\in TV$を付け加える
		操作を中置記法で$t\lhd_v t_1$と書く。例えば、$s\in V\cup\set{\bullet}$
		、$v_1,v_2\in V$、$t_0,t_1\in VT$に対して次のように定義する。
		\begin{equation}\begin{split} %{
			\mytree{
			& s \ar@{-}[dl] \ar@{-}[dr] \\
			v_1 \ar@{-}[d] && v_2 \\
			*+[F]{t_0}
		} \lhd_{v_1} t_1 &= \mytree{
			&& s \ar@{-}[dl] \ar@{-}[dr] \\
			&v_1 \ar@{-}[dl] \ar@{-}[dr] && v_2 \\
			*+[F]{t_0} && *+[F]{t_1}
		}
		\end{split}\end{equation} %}
		さらに、$t_1$を木$t_0$の部分木とするとき、任意の木$t$に対して
		$t_0\lhd_{t_1}t=\sum_{v\in \set{t_1}}t_0\lhd_v t$と書く。
		例えば次のように定義する。
		\begin{equation}\begin{split} %{
			\mytree{
			& v_0 \ar@{-}[dl] \ar@{-}[dr] \\
			v_1 \ar@{-}[d] && v_2 \\
			*+[F]{t_0}
		} \lhd_{\set{v_0,v_1}} t_1 &= \mytree{
			& v_0 \ar@{-}[dl] \ar@{-}[d] \ar@{-}[dr] \\
			v_1 \ar@{-}[d] & *+[F]{t_1} & v_2 \\
			*+[F]{t_0}
		} + \mytree{
			&& v_0 \ar@{-}[dl] \ar@{-}[dr] \\
			&v_1 \ar@{-}[dl] \ar@{-}[dr] && v_2 \\
			*+[F]{t_0} && *+[F]{t_1}
		}
		\end{split}\end{equation} %}
		\item 任意の木$t\in T_\bullet V$と$t_1,t_2,\dots,t_m\in TV$、
		$s\in V\cup\set{\bullet}$対して$R$双線形写像
		$\amalg:RT_*V\otimes RT_*V\to RT_*V$を次のように定義する。
		\begin{equation}\begin{split} %{
			t\amalg s &= t \\
			t\amalg \mytree{
				& s \ar@{-}[dl] \ar@{-}[d] \ar@{-}[drr] \\
				*+[F]{t_1} & *+[F]{t_2} & \cdots & *+[F]{t_m}
			} &= t\lhd_t t_1\lhd_t t_2\cdots \lhd_t t_m \\
		\end{split}\end{equation} %}
	\end{itemize} %}
	木$t\in T_*V$の根を$s$としたとき、任意の木$t_1\in T_*V$に対して$t*t_1$
	の根は$s$となる。したがって、任意の$f\in RT_\bullet V,\;g\in RT_*V$に
	対して$f*g\in RT_\bullet V$となることに注意する。

	二項演算$\amalg$の結合性を証明するために、木を簡潔に書くための記号を
	導入する。任意の$s\in V\cup\set{\bullet}$、$t_1,t_2,\dots,t_m\in TV$
	に対して次のようにして木を表すことにする。
	\begin{equation}\begin{split} %{
		s[t_1t_2\cdots t_m] &= \mytree {
			& s \ar@{-}[dl] \ar@{-}[d] \ar@{-}[drr] \\
			*+[F]{t_1} & *+[F]{t_2} & \cdots & *+[F]{t_m}
		}
	\end{split}\end{equation} %}
	例えば次のようになる。
	\begin{equation}\begin{split} %{
		s[v_1[v_3]v_2[]] &= \mytree {
			& s \ar@{-}[dl] \ar@{-}[dr] \\
			v_1 \ar@{-}[d] && v_2 \\
			v_3
		}
	\end{split}\end{equation} %}
	誤解の恐れがないときは、葉の頂点は後ろの$[]$を省略する。例えば、
	$s[v_1[v_3]v_2]=s[v_1[v_3]v_2[]]$と書く。

	$RT_*V$の積$m_*$を次のように定義する。
	\begin{equation}\begin{split} %{
		m_*: RT_*V\otimes RT_*V &\to RT_*V \\
		s\otimes t &\mapsto t \quad\text{for all }s\in V\cup\set{\bullet},\;t\in T_*V \\
		t\otimes s &\mapsto t \quad\text{for all }s\in V\cup\set{\bullet},\;t\in T_*V \\
		s_1[t_{11}t_{12}\cdots t_{1m}]\otimes s_2[t_{21}t_{22}\cdots t_{2n}] 
		&\mapsto s_1[t_{11}t_{12}\cdots t_{1m}t_{21}t_{22}\cdots t_{2n}] \\
		&\quad\text{for all }s_1,s_2\in V\cup\set{\bullet}\\
		&\quad, t_{11},t_{12},\dots,t_{1m},t_{21},t_{22},\dots,t_{2n}\in TV \\
	\end{split}\end{equation} %}
	$m_*$は$T_*V$を$TV$から生成された自由モノイドとしてみたときの文字列の
	連結による積に他ならない。余積$\Delta_*$を次のように定義する。
	\begin{equation}\begin{split} %{
		\Delta_*: RT_*V &\to RT_*V\otimes RT_*V \\
		s[] &\mapsto s[]\otimes s[] \quad\text{for all }s\in V\cup\set{\bullet} \\
		s[t_1t_2\cdots t_m] &\mapsto s[]\otimes s[t_1t_2\cdots t_m] \\
			&\quad + \sum_{1\le i\le m} s[t_i]\otimes s[t_1t_2\cdots t_m]\neg\set{i} \\
			&\quad + \sum_{1\le i<j\le m} s[t_it_j]\otimes s[t_1t_2\cdots t_m]\neg\set{i,j} \\
			&\quad + \cdots \\
			&\quad + s[t_1t_2\cdots t_m]\otimes s[]
	\end{split}\end{equation} %}
	積$m_*$と余積$\Delta_*$は双対となる。$*$を中置記法で$*$と書き、
	\begin{equation}\begin{split} %{
		&(t_{11}\otimes t_{12}\otimes t_{1m})*(t_{21}\otimes t_{22}\otimes t_{2m}) \\
		&=(t_{11}*t_{21})\otimes(t_{11}*t_{21})\otimes\cdots\otimes(t_{1m}*t_{2m})
	\end{split}\end{equation} %}
	とすると、積$m_*$と余積$\Delta_*$の双対性は次のように書ける。
	\begin{equation}\begin{split} %{
		\Delta_*(t_1*t_2) = (\Delta_*t_1)*(\Delta_*t_2) \\
	\end{split}\end{equation} %}
	積$m_*$と余積$\Delta_*$を用いると、二項演算は任意の木$t_1,t_2\in T_*V$
	に対して次のように書くことができる。
	\begin{equation}\begin{split} %{
		t_1\amalg t_2 &= (t_1\amalg' (\Delta_*^{(1)}t_2)) * (\Delta_*^{(2)}t_2) \\
			&= m_*(-\amalg'-\otimes \myid)(\myid\otimes \Delta_*)(t_1\otimes t_2) \\
	\end{split}\end{equation} %}
	ここで、$\amalg':T_*V\otimes T_*V\to T_*V$は$\amalg$の部分木に対する
	再帰部分で、任意の$s\in V\cup\set{\bullet},\;t\in V_*T$に対して
	$s[]\amalg't=0$、任意の
	$s\in V\cup\set{\bullet},\;t\in V_*T,\;t_1,t_2,\dots,t_m\in VT$
	に対して次のように定義される。
	\begin{equation}\begin{split} %{
		s[t_1t_2\cdots t_m]\amalg't &= s[t_1't_2'\cdots t_m']\quad\text{where} \\
		t_1' &= t_1\amalg(\Delta_*^{(1)}t) \\
		t_2' &= t_1\amalg(\Delta_*^{(1)}\Delta_*^{(2)}t) \\
		\vdots \\
		t_{m-1}' &= t_1\amalg(\Delta_*^{(1)}\Delta_*^{(2)m-2}t) \\
		t_m' &= t_1\amalg(\Delta_*^{(2)m-1}t) \\
	\end{split}\end{equation} %}
	$*$と$\amalg'$は任意の$t_1,t_2,t_3\in T_*V$に対して次の分配則が成り立つ。
	\begin{equation}\label{eq:木の分配則その一}\begin{split} %{
		(t_1*t_2)\amalg't_3 = \left(t_1\amalg'(\Delta_*^{(1)}t_3)\right)
			*\left(t_2\amalg'(\Delta_*^{(2)}t_3)\right)
	\end{split}\end{equation} %}

	\begin{proof} %{
		二項演算$\amalg$の結合性を証明する。
		任意の$t_1,t_2,t_3\in T_*V$に対して次のように書ける。
		\begin{equation}\begin{split} %{
			&(t_1\amalg t_2)\amalg t_3 \\
			& = \left((t_1\amalg t_2)\amalg'(\Delta_*^{(1)}t_3)\right)*(\Delta_*^{(2)}t_3) \\
			& = \left(\left((t_1\amalg' (\Delta_*^{(1)}t_2))*(\Delta_*^{(2)}t_2)\right)\amalg'(\Delta_*^{(1)}t_3)\right)*(\Delta_*^{(2)}t_3) \\
		\end{split}\end{equation} %}
		分配則\eqref{eq:木の分配則その一}を使うと次のようになる。
		\begin{equation}\begin{split} %{
			(t_1\amalg t_2)\amalg t_3 &= t_1'*t_2'*t_3' \\
			t_1' &= \left(t_1\amalg'(\Delta_*^{(1)}t_2)\right)\amalg'(\Delta_*^{(1)}\Delta_*^{(1)}t_3) \\
			t_2' &= (\Delta_*^{(2)}t_2)\amalg'(\Delta_*^{(2)}\Delta_*^{(1)}t_3) \\
			t_3' &= \Delta_*^{(2)}t_3 \\
		\end{split}\end{equation} %}

until


		積$m_*$と余積$\Delta_*$を用いると、二項演算$\amalg$は、
		任意の$s\in V\cup\set{\bullet}$、$u_1,u_2,\dots,u_m\in TV$、
		$t\in T_*V$に対して次のように書ける。
		\begin{equation}\begin{split} %{
			s[u_1u_2\cdots u_m]\amalg t
			&= s[u_1'u_2'\cdots u_m']*(\Delta_{*(1)}t) \\
			u_1' &= u_1\amalg (\Delta_{*(1)}\Delta_{*(2)}t) \\
			u_2' &= u_2\amalg (\Delta_{*(1)}\Delta_{*(2)}^2t) \\
			\cdots \\
			u_{m-1}' &= u_{m-1}\amalg (\Delta_{*(1)}\Delta_{*(2)}^{m-1}t) \\
			u_m' &= u_m\amalg (\Delta_{*(2)}^mt) \\
		\end{split}\end{equation} %}
		したがって、任意の$s\in V\cup\set{\bullet}$、
		$u_1,u_2,\dots,u_m\in TV$、$t_1,t_2\in T_*V$に対して次のように書ける。
		\begin{equation}\label{eq:再帰その一}\begin{split} %{
			(s[u_1u_2\cdots u_m]\amalg t_1)\amalg t_2
			&= s[u_1'u_2'\cdots u_m']*(\Delta_{*(1)}t_1)*(\Delta_{*(1)}t_2) \\
			u_1' &= \left(u_1\amalg (\Delta_{*(1)}\Delta_{*(2)}t_1)\right)\amalg (\Delta_{*(1)}\Delta_{*(2)}t_2) \\
			u_2' &= \left(u_2\amalg (\Delta_{*(1)}\Delta_{*(2)}^2t_1)\right)\amalg (\Delta_{*(1)}\Delta_{*(2)}^2t_2) \\
			\cdots \\
			u_{m-1}' &= \left(u_{m-1}\amalg (\Delta_{*(1)}\Delta_{*(2)}^{m-1}t_1)\right)\amalg (\Delta_{*(1)}\Delta_{*(2)}^{m-1}t_2) \\
			u_m' &= \left(u_m\amalg (\Delta_{*(2)}^mt_1)\right)\amalg (\Delta_{*(2)}^mt_2) \\
		\end{split}\end{equation} %}
		$m_*$は結合的だから、次の式
		\begin{equation}\label{eq:再帰その二}\begin{split} %{
			\left(u_m\amalg (\Delta_{*(2)}^mt_1)\right)\amalg (\Delta_{*(2)}^mt_2)
			= u_m\amalg \left((\Delta_{*(2)}^mt_1)\amalg (\Delta_{*(2)}^mt_2)\right)
		\end{split}\end{equation} %}
		と、$i=1,2,\dots,m-1$に対して次の式
		\begin{equation}\label{eq:再帰その三}\begin{split} %{
			&\left(u_i\amalg (\Delta_{*(1)}\Delta_{*(2)}^it_1)\right)\amalg (\Delta_{*(1)}\Delta_{*(2)}^it_2) \\
			&\quad = u_i\amalg \left((\Delta_{*(1)}\Delta_{*(2)}^it_1)\amalg (\Delta_{*(1)}\Delta_{*(2)}^it_2)\right)
		\end{split}\end{equation} %}
		が成り立つことが示せれば、二項演算$\amalg$が結合的になることがわかる。
		式\eqref{eq:再帰その一}と\eqref{eq:再帰その二}と\eqref{eq:再帰その三}
		は木$s[u_1u_2\cdots u_m]$の深さ方向への再帰の形になっている。
		したがって、木$s[u_1u_2\cdots u_m]$の任意の葉$r\in V\cup\set{\bullet}$
		と、任意の木$w_{11},w_{12},\dots,w_{1p},w_{21},w_{22},\dots,w_{2q}\in TV$
		に対して次の式が成り立てば、二項演算$\amalg$が結合的になることが示せる。
		\begin{equation}\label{eq:再帰の葉}\begin{split} %{
			&\left(r\amalg \bullet[w_{11}w_{12}\cdots w_{1p}]\right)\amalg \bullet[w_{21}w_{22}\cdots w_{2q}] \\
			&\quad = r\amalg \left(\bullet[w_{11}w_{12}\cdots w_{1p}]\amalg \bullet[w_{21}w_{22}\cdots w_{2q}]\right)
		\end{split}\end{equation} %}
		より一般に、任意の$r_0,r_1,r_2\in V\cup\set{\bullet}$に対して
		次の式が成り立つので、式$\eqref{eq:再帰の葉}$は成り立つ。
		\begin{equation}\begin{split} %{
			&\left(r_0\amalg r_1[w_{11}w_{12}\cdots w_{1p}]\right)\amalg r_2[w_{21}w_{22}\cdots w_{2q}] \\
			&\quad = r_0[w_{11}w_{12}\cdots w_{1p}]\amalg r_2[w_{21}w_{22}\cdots w_{2q}] \\
			&\quad = r_0\amalg \left(r_1[w_{11}w_{12}\cdots w_{1p}]\amalg r_2[w_{21}w_{22}\cdots w_{2q}]\right)
		\end{split}\end{equation} %}
	\end{proof} %}

	積$m_\amalg$は定義域が$RT_*V$のままでは左単位元を持たないが\footnote{
		任意の根だけからなる木が右単位元となる。
	}、定義域を$RT_\bullet V$に制限すると、根だけからなる木$\bullet[]$が
	単位元となる。

	\begin{todo}[この先]\label{todo:この先} %{
		$\mybf{1}=\set{\circ}$として、写像$\xi$を次のようにおく。
		\begin{equation}\begin{split} %{
			\xi: k[x]\times kT_\bullet\mybf{1} &\to \myop{end}k[x] \\
			v\times t &\mapsto \xi_vt \\
		\end{split}\end{equation} %}
		ここで、$k$線形写像$\xi_v:kT_\bullet\mybf{1}\to\myop{end}k[x]$を任意の
		$t_1,t_2,\dots,t_m\in T\mybf{1}$に対して次のようにおいた。
		\begin{equation}\begin{split} %{
			\xi_v\bullet[] &= \myid \\
			\xi_v\circ[] &= v \\
			\xi_v\bullet[t_1t_2\cdots t_m] &= (\xi_vt_1)(\xi_vt_2)\cdots(\xi_vt_m)\partial_x^m \\
			\xi_v\circ[t_1t_2\cdots t_m] &= (\xi_vt_1)(\xi_vt_2)\cdots(\xi_vt_m)(\partial_x^mv) \\
		\end{split}\end{equation} %}
		$\xi_v$は子供の部分木の順序を置換しても不変となることに注意する。
		この不変性がCM(Connes-Mxxx)係数に反映される。
		\begin{equation}\begin{split} %{
			\xi_v\mytree{
				&& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
				&\circ \ar@{-}[dl] \ar@{-}[dr] && \circ \\
				\circ \ar@{-}[d] && \circ \\
				\circ
			} = \xi_v\mytree{
				&& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
				&\circ \ar@{-}[dl] \ar@{-}[dr] && \circ \\
				\circ && \circ \ar@{-}[d] \\
				&& \circ
			} = \xi_v\mytree{
				& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
				\circ && \circ \ar@{-}[dl] \ar@{-}[dr] \\
				& \circ \ar@{-}[d] && \circ \\
				& \circ
			} = \xi_v\mytree{
				& \bullet \ar@{-}[dl] \ar@{-}[dr] \\
				\circ && \circ \ar@{-}[dl] \ar@{-}[dr] \\
				& \circ && \circ \ar@{-}[d] \\
				&&& \circ
			}
		\end{split}\end{equation} %}
		$\xi_v$は準同型$(T_\bullet\mybf{1},\amalg,\bullet[])\to (\myop{end}k[x],\myspace,\myid)$
		になる。(要証明$\to$べき乗の次数に関する帰納法)
		\begin{equation}\begin{split} %{
			\xi_v(f_1\amalg f_2) = (\xi_vf_1)(\xi_vf_2) \quad\text{for all }f_1,f_2\in kT_\bullet\mybf{1}
		\end{split}\end{equation} %}
		べき乗を任意の$f\in kT_\bullet\mybf{1},\;n\in\mybf{N}$に対して
		次のように定義し、
		\begin{equation}\begin{split} %{
			f^{\amalg n} &= \begin{cases} %{
				\bullet[], &\text{ iff }n=0 \\
				\underbrace{f\amalg\cdots\amalg f}_{n\text{個}}, &\text{ otherwise } \\
			\end{cases} %}
		\end{split}\end{equation} %}
		エクスポーネントを任意の$f\in kT_\bullet\mybf{1}$に対して
		次のように定義する。
		\begin{equation}\begin{split} %{
			\exp_\amalg f = \sum_{n\in\mybf{N}}\frac{1}{n!}f^{\amalg n}
		\end{split}\end{equation} %}
		すると、任意の$t\in k$に対して次の式が成り立つ。
		\begin{equation}\begin{split} %{
			\xi_v\exp_\amalg(t\bullet[\circ]) = \exp(tv\partial_x)
		\end{split}\end{equation} %}

		$m_\amalg$に双対な余積を求めて、その役割を調べる。
	\end{todo} %todo:この先}

	\begin{formula}[Picardの再帰法]\label{formula:Picardの再帰法} %{
		式変形
		\begin{equation}\begin{split} %{
			\exp tx &= 1 + tx + \frac{t^2}{2!}x^2 + \cdots \\
				&= 1 + x(t + \frac{t^2}{2!}x + \cdots) \\
				&= 1 + x\int_0^t ds (\exp sx) \\
		\end{split}\end{equation} %}
		を用いて\eqref{eq:常微分方程式の形式解}を変形すると次のようになる。
		\begin{equation}\begin{split} %{
			e^{tv(x)\partial_x}x
			&= x + (vx)\partial_x\int_{0}^t dse^{sv(x)\partial_x}x \\
			&= x + \int_{0}^t dse^{sv(x)\partial_x}v(x) \\
			&= x + \int_{0}^t dsv(e^{sv(x)\partial_x}x) \\
		\end{split}\end{equation} %}
		$x_t=e^{tv(x)\partial_x}x$とおくと、更に次のように変形される。
		\begin{equation}\begin{split} %{
			x_t &= x + \int_0^t dsv(x_s) \\
		\end{split}\end{equation} %}
	\end{formula} %formula:Picardの再帰法}
	%s2:保留}
%s1:The Explicit Computation of Integration Algorithms and First Integrals for Ordinary Differential Equations With Polynomial Coefficients Using Trees}

\section{Bialgebra Deformations of Certain Universal Enveloping Algebras}\label{s1:Bialgebra Deformations of Certain Universal Enveloping Algebras} %{
	論文\cite{url:grossman:deform}に関するメモを書いておく。
	すべてを理解していないので、断片的なメモになっている。

	論文\cite{url:grossman:deform}の動機は常微分方程式の摂動による解法である。
	$x:\mybf{C}\to \mybf{C}^n,\;F_x:\mybf{C}^n\to \mybf{C}^n$として、常微分方程式
	\begin{equation}\begin{split} %{
		\partial_tx = F_xx,\quad x0 = x_0 \\
	\end{split}\end{equation} %}
	の形式解は$\exp(tF_x)x|_{x=x_0}$と書ける。次の級数を計算できれば、任意の初期条件
	に対して解を時刻の摂動として求めることができる。
	\begin{equation}\begin{split} %{
		\exp(tF_x)x &= x + tF_xx + \frac{t^2}{2}F_xF_xx + \cdots \\
	\end{split}\end{equation} %}

	\begin{itemize} %{
		\item 数値計算の方法を見つける事は、代数の変形を見つけることである。
		\item 時刻の導入 \\
		体$k$係数モジュール$A$が与えられたとき、$A$を係数とする文字$t$の多項式
		$A_t=A[t]$は$k$係数モジュールとなる。$A$が半環であれば、$A_t$は$A$係数
		半モジュールとしてみることができるが、ここではそうみない。
		\item テンソル積の完備化 \\
		テンソル積$A_t\otimes_kA_t$に次の同値関係を入れたものを完備化された
		テンソル積$A_t\widehat{\otimes}_kA_t$と定義している。
		\begin{equation}\begin{split} %{
			a_1t^{m+1}\otimes_ka_2^n &\sim a_1t^m\otimes_ka_2^{n+1} \\
			a_1t^m\otimes_ka_2^{n+1} &\sim a_1t^(m+1)\otimes_ka_2^n \\
			&\quad\text{for all }m,n\in\mybf{N},\;a_1,a_2\in A \\
		\end{split}\end{equation} %}
		\item べき乗系列 \\
		$C_0=\set{c_0,c_1,c_2,\dots}$を余代数$C=(C,\Delta,\epsilon)$の部分集合
		とする。$\Delta c_m=\sum_{p=0}^mc_p\otimes c_{m-p}$となるとき、$C_0$を
		べき乗系列ということにする。
		\item 素な元 \\
		$A=(A,m,u,\Delta,\epsilon)$を双代数とする。元$a\in A$が
		\begin{itemize} %{
			\item $a=m(a_1\otimes  a_2)$となる二つの元は
			$a_1\otimes a_2=a\otimes 1_A$ または$a_1\otimes a_2=1_A\otimes a$
			に限られ、
			\item $\Delta a=a\otimes 1_A+1\otimes a$となる
		\end{itemize} %}
		とき、$a$を素な元ということにする。
		\item 群的な元 \\
		$A=(A,m,u,\Delta,\epsilon)$を双代数とする。元$a\in A$が
		$\Delta a=a\otimes a$かつ$\epsilon a=1$となるとき、$a$を群的な元と
		言うことにする。
		\item ほぼ素な元 \\
		$A=(A,m,u,\Delta,\epsilon)$を双代数とする。$K,H\in A$を群的な元とする。
		元$a\in A$が
		\begin{itemize} %{
			\item $a=m(a_1\otimes  a_2)$となる二つの元は
			$a_1\otimes a_2=a\otimes 1_A$ または$a_1\otimes a_2=1_A\otimes a$
			に限られ、
			\item $\Delta a=a\otimes K+H\otimes a$となる
		\end{itemize} %}
		とき、$a$をほぼ素な元ということにする。素な元$\implies$ほぼ素な元になる。
		\item 体の標数が$0$であれば、任意の$a\in A$に対して$\exp(a)$が定義できて、
		$\exp(at)$は群的な元になる。
	\end{itemize} %}

	双代数における素な元は、Lie環論で使われる概念らしい。

	\begin{definition}[双半代数における素な元]\label{def:双半代数における素な元} %{
		$R$を半環、$A=(A,m,1_A,\Delta,\epsilon)$を$R$係数の双半代数とする。
		元$a\in A$が$\Delta a=a\otimes 1_A+1_A\otimes a$となるとき、元$a$を
		素な元という。
	\end{definition} %def:双半代数における素な元}

	$R$を半環、$A=(A,m,1_A,\Delta,\epsilon)$を$R$係数の双半代数とする。
	積$m(a_1\otimes a_2)$を単に$a_1a_2$と書く。
	$a\in A$を素な元とすると、$m$と$\Delta$は双対だから次のようになる。
	\begin{equation}\begin{split} %{
		\Delta a^m &= (a\otimes 1_A+1_A\otimes a)^m \\
			&= \sum_{p=0}^m\binom{n}{p}a^p\otimes a^{m-p} \\
	\end{split}\end{equation} %}
	したがって、$\set{\frac{a^m}{m!}}_{m=0}^\infty$は$A$のべき乗系列となる。

	素な元がLie環論で使われる理由は、素な元$a_1,a_2\in A$のLie括弧
	$[a_1,a_2]\in A$もまた素な元になるためである。
	\begin{equation}\begin{split} %{
		\Delta[a_1,a_2] &= \Delta(a_1a_2-a_2a_1) \\
			&= (\Delta a_1)(\Delta a_2) - (\Delta a_2)(\Delta a_1) \\
			&= (a_1a_2\otimes 1_A + a_1\otimes a_2 + a_2\otimes a_1 + 1_A\otimes a_1a_2 ) \\
			&\quad - (a_2a_1\otimes 1_A + a_1\otimes a_2 + a_2\otimes a_1 + 1_A\otimes a_2a_1 ) \\
			&= [a_1,a_2]\otimes 1_A + 1_A\otimes [a_1,a_2] \\
	\end{split}\end{equation} %}
%s1:Bialgebra Deformations of Certain Universal Enveloping Algebras}

\section{立体視}\label{s1:立体視} %{
	立体視を実現させるための仕組みを列挙する。ここで、立体視とは、人間の左目と右目
	に異なる絵を受像させることである。一番簡単な方法は、ヘッドマウントディスプレイ
	を使って、右目用と左目用の絵を映し出すことである。シャッターグラスを用いた
	方法は、ヘッドマウントディスプレイに近い方法である。
	\begin{equation}\xymatrix{
		\txt{左目用の絵} \ar[rrr] &&& \txt{左目用の絵} \\
		\txt{右目用の絵} \ar[rrr] &&& \txt{右目用の絵} \\
	}\end{equation}
	その他の方法として、左目用と右目用の絵を合成して送信し、それを受信する側で
	分離する方法がある。
	\begin{equation}\xymatrix{
		\txt{左目用の絵} \ar[rd] &&& \txt{左目用の絵} \\
		& \txt{合成} \ar[r] & \txt{分離} \ar[ru] \ar[rd] \\
		\txt{右目用の絵} \ar[ru] &&& \txt{右目用の絵} \\
	}\end{equation}
	絵を合成/分離する方法としては、光の偏向を利用した方法と光の波長を利用した方法
	がある。どちらの方法も、絵を分離するために特殊なメガネを利用する。
	光の偏向を利用する方法では、鉛直方向の偏向のみを通す物質を左目のレンズに、
	水平方向の偏向のみを通す物質を右目のレンズに使うメガネを用いる。
	光の波長を利用する方法では、赤色の光のみを通す物質を左目のレンズに、
	青色の光のみを通す物質を右目のレンズに使うメガネを用いる。
%s1:立体視}

\section{DFAとキャンセル可能性}\label{s1:DFAとキャンセル可能性} %{
	次のDFAを考える。
	\begin{equation}\xymatrix{
		& c \ar[rd]^c \\
		ac+bc \ar[ru]^a \ar[rd]_b & & 1 \\
		& c \ar[ru]_c \\
	}\end{equation}
	これを半群の言葉でみると、左キャンセル可能な表現と思える。
	このDFAを最小化すると次のようになる。
	\begin{equation}\xymatrix{
		ac+bc \ar[r]^{a+b} & c \ar[r]^c & 1 \\
	}\end{equation}
	これを半群の言葉でみると、左右キャンセル可能な表現と思える。
	最小化したDFAを次のように書き直してみる。
	\begin{equation}\xymatrix{
		(a+b)c \ar[r]^{a+b} & c \ar[r]^c & 1 \ar@(u,u)[ll]_{(a+b)c} \\
	}\end{equation}
	これは、有限なキャンセル可能な半群は群になることを示していると思える。
	オートマトンの言葉と半群の言葉を表の形で対応させると次のようになりそうだ。
	\begin{tabular}{cc}
		オートマトン & 半群 \\ \hline
		有限オートマトン & 半群の有限次元表現 \\
		左DFA & 左キャンセル可能 $\implies$ 右単位元が存在 \\
		左右DFA & 左右キャンセル可能 $\implies$ 左右単位元が存在 \\ \hline
	\end{tabular}

	この対応表が正しいならば、正規表現は有限オートマトンによる表現を持つから、
	正規表現は群となる表現をもつことになる。
	ただし、半群ではなく加法をもったモノイド半環の線形結合で表される。
	図でいうと、$\set{1,a+b),c}$である。
%s1:DFAとキャンセル可能性}

\section{自然数から01へ}\label{s1:自然数から01へ} %{
	自然数から$\mybf{2}$への加法を保つ射影を考える。
	次の二つの射影が簡単に思いつく。
	\begin{itemize}
		\item OR-射影 \\
		$0$を、$1$以上の自然数を$1$に射影する。
		射影から誘導される加法はブーリアンのORとなる。
		\item XOR-射影 \\
		偶数を$0$、奇数を$1$に射影する。
		射影から誘導される加法はブーリアンのXORとなる。
	\end{itemize}
%s1:自然数から01へ}

\section{ゲーデル関数の例}\label{s1:ゲーデル関数の例} %{
	例として、自然数$\mybf{N}$とその直積$\mybf{N}^2$との次の対応を考える。
	\begin{equation*}\begin{split} %{
		f:\mybf{N}^2 &\to \mybf{N} \\
			m\times n &\mapsto \binom{m+n+1}{2}+n = \frac{(m+n+1)(m+n)}{2}+n \\
	\end{split}\end{equation*} %}
	\begin{equation*}\begin{split} %{
		\bordermatrix {
			  & 0 & 1 & 2 & 3 & \cdots \\
			0 & 0 & 2 & 5 & 9 & \\
			1 & 1 & 4 & 8 & 13 & \\
			2 & 3 & 7 & 12 & 18 & \\
			3 & 6 & 11 & 17 & 24 & \\
			\vdots & & & & & \\
		}
	\end{split}\end{equation*} %}
	\begin{cprog}
		f<-function(m,n) (m+n)*(m+n+1)/2+n
		x<-sapply(0:3,f,n=0:3);
		t(x);
	\end{cprog}
	$f$は集合同型となる。
%s1:ゲーデル関数の例}

\section{双半群の使い方}\label{s1:双半群の使い方} %{
	数学の重要な道具として準同型がある。準同型は、
	\begin{itemize}
		\item 準同型によって演算結果の対応関係がつけられて、
		\item 準同型の合成は準同型になる
	\end{itemize}
	というものである。
	\begin{equation*}\xymatrix{
		A\times A \ar[d]^{m_A} \ar[r]^{f\times f} & B\times B \ar[d]^{m_B} \ar[r]^{g\times g} & C\times C \ar[d]^{m_C} \\
		A \ar[r]^{f} & B \ar[r]^{g} & C \\
	}\end{equation*}
	この性質を満たすように準同型を拡張してみる。対角的な直積$f\times f$の
	代わりに余積を用いて次のような可換図を考える。
	\begin{equation*}\xymatrix{
		A\times A \ar[d]^{m_A} \ar[r]^{\Delta f} & B\times B \ar[d]^{m_B} \ar[r]^{\Delta g} & C\times C \ar[d]^{m_C} \\
		A \ar[r]^{f} & B \ar[r]^{g} & C \\
	}\end{equation*}
	写像の合成を$\circ$と書くと、合成が成り立つための条件は次のようになる。
	\begin{equation*}\begin{split} %{
		\Delta(g\circ f) &= (\Delta g)\circ(\Delta f) \\
	\end{split}\end{equation*} %}
	この式は、$\circ$を積、$\Delta$を余積とする双対の関係に他ならない。
	$\Delta$を群的な余積とした場合が準同型となる。
%s1:双半群の使い方}

\section{パーサーの方針}\label{s1:パーサーの方針} %{ 
	最初の問題設定として、文字列が与えられたパターンに合致するかどうかを
	判定する問題を考える。文字列の集合として、有限集合$A$から生成された
	自由モノイド$A^*$を考える。$A^*$からブーリアン、自然数、複素数などの
	可換半環$B$への写像全体$B^A$を考える。$B^A$には$B$の代数構造を反映した
	代数構造を定めることができて、$B^A$は半環となる。
	パターンを与えるということは$B^A$の元を一つ定めることになるだろう。
	そして、任意の単語$w_1,w_2$に対して、$f(w_1*w_2)=(\Delta f)(w_1\times w_2)$
	で$B^A$に余積$\Delta$を定めることができれば、最終的には一文字のマッチング
	にまで帰着させることができる。
	そして、$a\rhd f=(\Delta f)(a\times-)$で$A^*$の$B^A$への作用を定義すると、
	モノイド$A$の$A\rhd f\subseteq A^B$への表現を得ることができる。
	この表現が言語理論でのオートマトンと呼ばれているものになると思われる。
	また、正規表現に対するBrzozowski微分$D$は、$\Delta f=1\otimes f + Df$
	になるのではないかと思っている。

	半単純リー環の場合、表現を用いた分類(A,B,...)がされている。
	オートマトンでも半単純に相当する性質が定義できて、その分類ができればうれしい。
%s1:パーサーの方針}

\section{分配性}\label{s2:分配性} %{
	分配性が成り立つような乗法の定義の仕方を考える。$A=(A,+,0)$を可換モノイドとする。
	$A$から$A$への写像全体を$MA$と書く。$MA$は、写像の合成を積、恒等写像$1_{MA}$
	を単位元とするモノイドになる。写像の合成の記号は省略する。さらに、次のようにして
	$MA$に積$+$を定義することができる。
	\begin{equation*}\begin{split} %{
		(f+g)a &= fa + ga \\
	\end{split}\end{equation*} %}
	$a\in A$への恒等写像を$a^*$とする。特に、$0^*$は積$+$の単位元となる。
	$MA$の中で半群準同型を満たす元の集まりを$HA$と書く。
	\begin{equation*}\begin{split} %{
		HA &= \set{f\in MA\bou f \text{ satisfies the below condition}} \\
			& f(a_1+a_2) = fa_1 + fa_2 \text{ for all }a_1,a_2\in A \\
	\end{split}\end{equation*} %}
	$HA$は写像の合成と$+$で閉じている。
	\begin{equation*}\begin{split} %{
		fg(a_1+a_2) &= f(ga_1+ga_2) \\
			&= fga_1 + fga_2 \\
		(f+g)(a_1+a_2) &= f(a_1+a_2) + g(a_1+a_2)  = fa_1 + fa_2 + ga_1 + ga_2 \\
			& = (f+g)a_1 + (f+g)a_2 \\
	\end{split}\end{equation*} %}
	さらに、$HA$は写像の合成と$+$で分配性を持つ。
	\begin{equation*}\begin{split} %{
		f(g+h)a &= fga + fha = (fg+fh)a \\
		(f+g)ha &= fha + gha = (fh+gh)a \\
	\end{split}\end{equation*} %}

	以上の事柄をブーリアン$\mybf{B}=(\set{0,1},+,0)$で確かめてみる。
	可換な積$+$は論理和で定義する。
	\begin{equation*}\begin{split} %{
		+: \mybf{B}\times \mybf{B} &\to \mybf{B} \\
			b_1\times b_2 &\mapsto \begin{cases}
				0, &\text{ iff } b_1 = b_2 = 0 \\
				1, &\text{ otherwise } \\
			\end{cases}
	\end{split}\end{equation*} %}
	からへの写像全体$M\mybf{B}$は$M\mybf{B}=\set{0^*,1^*,\myid,\neg}$となる。$0^*,1^*$
	はそれぞれ$0,1$への定数写像、$\myid$は恒等写像、$\neg$は次のように定義する。
	\begin{equation*}\begin{split} %{
		\neg \begin{pmatrix}
			0 \\
			1 \\
		\end{pmatrix} &= \begin{pmatrix}
			1 \\
			0 \\
		\end{pmatrix} \\
	\end{split}\end{equation*} %}
	群表は次のようになる。
	\begin{equation*}\begin{split} %{
		\bordermatrix {
			+ & 0^* & 1^* & \neg & \myid \\
			0^* & 0^* & 1^* & \neg & \myid \\
			1^* & 1^* & 1^* & 1^* & 1^* \\
			\neg & \neg & 1^* & \neg & 1^* \\
			\myid & \myid & 1^* & 1^* & \myid \\
		} & \quad \bordermatrix {
			\text{合成} & 0^* & 1^* & \neg & \myid \\
			0^* & 0^* & 0^* & 0^* & 0^* \\
			1^* & 1^* & 1^* & 1^* & 1^* \\
			\neg & 1^* & 0^* & \myid & \neg \\
			\myid & 0^* & 1^* & \neg & \myid \\
		} \\
	\end{split}\end{equation*} %}
	$\neg$は次のとおり準同型とならない。
	\begin{equation*}\begin{split} %{
		\neg(0+1) = 0 \neq 1 = \neg0 + \neg1 \\
	\end{split}\end{equation*} %}
	$\neg$以外は準同型となるから、$M\mybf{B}$の中で準同型となるものの部分集合
	$H\mybf{B}$は$H\mybf{B}=\set{0^*,1^*,\myid}$となる。$H\mybf{B}$の群表は次の
	ようになる。
	\begin{equation}\label{eq:論理和の分配的な双対空間}\begin{split} %{
		\bordermatrix {
			+ & 0^* & 1^* & \myid \\
			0^* & 0^* & 1^* & \myid \\
			1^* & 1^* & 1^* & 1^* \\
			\myid & \myid & 1^* & \myid \\
		} & \quad \bordermatrix {
			\text{合成} & 0^* & 1^* & \myid \\
			0^* & 0^* & 0^* & 0^* \\
			1^* & 1^* & 1^* & 1^* \\
			\myid & 0^* & 1^* & \myid \\
		} \\
	\end{split}\end{equation} %}
	計算してみると、$H\mybf{B}$は分配性を持つことがわかる。以上より、上で述べた
	ことが確かめられる。

	式を見ると、部分集合$H_0\mybf{B}=\set{0^*,\myid}$は写像の合成と$+$について
	閉じているのがわかる。さらに、$H_0\mybf{B}$では次の事柄が成り立っている。
	\begin{itemize}
		\item 写像の合成が可換になる。
		\item 任意の$f\in H_0\mybf{B}$に対して、$0^*f=0^*=f0^*$が成り立つ。
		\item $+$に関して、$\mybf{B}$と同型$\varphi$になる。
		\begin{equation*}\begin{split} %{
			\varphi: \mybf{B} &\to H_0\mybf{B} \\
			\begin{pmatrix} 
				0 \\
				1 \\
			\end{pmatrix}
			&\mapsto \begin{pmatrix}
				0^* \\
				\myid \\
			\end{pmatrix}
		\end{split}\end{equation*} %}
	\end{itemize}
	$H\mybf{B}$は、$1^*0^*\neq0^*$なので、半環ではないが、$H_0\mybf{B}$は半環となる。
	したがって、$+$に関する$\mybf{B}$と$H_0\mybf{B}$のモノイド同型によって、
	$\mybf{B}$に乗法が定義される。

	\begin{problem}[分配的になる積に対する条件]\label{prob:分配的になる積に対する条件} %{ 
	$H\mybf{B}$にどのような条件を課すと$H_0\mybf{B}$が得られるのだろうか。
	また、ここで観察した$\mybf{2}$の論理和の場合は、任意の可換半群から半環を
	得ることに一般化できるだろうか。
	\end{problem} %prob:分配的になる積に対する条件}

	一般の場合に戻って問題を考えてみる。次の方法が考えられる。
	\begin{itemize}
		\item 逐次的な方法 \\
		$\set{0^*,1_M}\subseteq HA$の群表は次のようになる。
		\begin{equation}\begin{split} %{
			\bordermatrix {
				+ & 0^* & 1_M \\
				0^* & 0^* & 1_M \\
				1_M & 1_M & ? \\
			} & \quad \bordermatrix {
				\text{合成} & 0^* & 1_M \\
				0^* & 0^* & 0^* \\
				1_M & 0^* & 1_M \\
			} \\
		\end{split}\end{equation} %}
		$1_M+1_M$のところが未定である。任意の$a\in A$に対して、$(1_M+1_M)a=a+a$である。
		したがって、次の場合があり得る。
		\begin{itemize}
			\item $1_M+1_M=0^*$の場合は、任意の$a\in A$に対して、$0=a+a$となる。
			ブール代数でのXORなどが相当する。
			\item $1_M+1_M=1_M$の場合は、任意の$a\in A$に対して、$a=a+a$となる。
			ブール代数でのORなどが相当する。
			\item それ以外の場合は、$f_2=1_M+1_M\in HA$とおく。$f_2$は準同型となり、
			$0$を固定点に持つ。$\set{0^*,1_M,f_2}\subseteq HA$の群表は次のようになる。
			\begin{equation}\begin{split} %{
				\bordermatrix {
					+ & 0^* & 1_M & f_2 \\
					0^* & 0^* & 1_M & 0^* \\
					1_M & 1_M & f_2 & ? \\
					f_2 & 0^* & ? & 1_M + ? \\
				} & \quad \bordermatrix {
					\text{合成} & 0^* & 1_M & f_2 \\
					0^* & 0^* & 0^* & 0^* \\
					1_M & 0^* & 1_M & f_2 \\
					f_2 & 0^* & f_2 & 1_M + ? \\
				} \\
			\end{split}\end{equation} %}
			$f_2+1_M$と$f_2f_2=f_2+f_2$のところが未定である。
			こうやって、群表を埋めていった結果と$A$がモノイド同型になることを示せればよい。
			この方法で、$A$が可算集合の場合には構成的に乗法が定義できるように思える。
			\item 天下り的な方法 \\
			$HA$のなかで$0$を固定点に持つ元全体$H_0A$は$+$と写像の合成に関して閉じているので、
			半環となる。$A$と$H_0A$の$+$に関するモノイド同型が得られれば話が早い。
		\end{itemize}
	\end{itemize}
%s2:分配性}
