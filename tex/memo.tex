\section{DFAとキャンセル可能性}\label{s1:DFAとキャンセル可能性} %{
	次のDFAを考える。
	\begin{equation}\xymatrix{
		& c \ar[rd]^c \\
		ac+bc \ar[ru]^a \ar[rd]_b & & 1 \\
		& c \ar[ru]_c \\
	}\end{equation}
	これを半群の言葉でみると、左キャンセル可能な表現と思える。
	このDFAを最小化すると次のようになる。
	\begin{equation}\xymatrix{
		ac+bc \ar[r]^{a+b} & c \ar[r]^c & 1 \\
	}\end{equation}
	これを半群の言葉でみると、左右キャンセル可能な表現と思える。
	最小化したDFAを次のように書き直してみる。
	\begin{equation}\xymatrix{
		(a+b)c \ar[r]^{a+b} & c \ar[r]^c & 1 \ar@(u,u)[ll]_{(a+b)c} \\
	}\end{equation}
	これは、有限なキャンセル可能な半群は群になることを示していると思える。
	オートマトンの言葉と半群の言葉を表の形で対応させると次のようになりそうだ。
	\begin{tabular}{cc}
		オートマトン & 半群 \\ \hline
		有限オートマトン & 半群の有限次元表現 \\
		左DFA & 左キャンセル可能 $\implies$ 右単位元が存在 \\
		左右DFA & 左右キャンセル可能 $\implies$ 左右単位元が存在 \\ \hline
	\end{tabular}

	この対応表が正しいならば、正規表現は有限オートマトンによる表現を持つから、
	正規表現は群となる表現をもつことになる。
	ただし、半群ではなく加法をもったモノイド半環の線形結合で表される。
	図でいうと、$\set{1,a+b),c}$である。
%s1:DFAとキャンセル可能性}

\section{自然数から01へ}\label{s1:自然数から01へ} %{
	自然数から$\mybf{2}$への加法を保つ射影を考える。
	次の二つの射影が簡単に思いつく。
	\begin{itemize}
		\item OR-射影 \\
		$0$を、$1$以上の自然数を$1$に射影する。
		射影から誘導される加法はブーリアンのORとなる。
		\item XOR-射影 \\
		偶数を$0$、奇数を$1$に射影する。
		射影から誘導される加法はブーリアンのXORとなる。
	\end{itemize}
%s1:自然数から01へ}

\section{ゲーデル関数の例}\label{s1:ゲーデル関数の例} %{
	例として、自然数$\mybf{N}$とその直積$\mybf{N}^2$との次の対応を考える。
	\begin{equation*}\begin{split} %{
		f:\mybf{N}^2 &\to \mybf{N} \\
			m\times n &\mapsto \binom{m+n+1}{2}+n = \frac{(m+n+1)(m+n)}{2}+n \\
	\end{split}\end{equation*} %}
	\begin{equation*}\begin{split} %{
		\bordermatrix {
			  & 0 & 1 & 2 & 3 & \cdots \\
			0 & 0 & 2 & 5 & 9 & \\
			1 & 1 & 4 & 8 & 13 & \\
			2 & 3 & 7 & 12 & 18 & \\
			3 & 6 & 11 & 17 & 24 & \\
			\vdots & & & & & \\
		}
	\end{split}\end{equation*} %}
	\begin{cprog}
		f<-function(m,n) (m+n)*(m+n+1)/2+n
		x<-sapply(0:3,f,n=0:3);
		t(x);
	\end{cprog}
	$f$は集合同型となる。
%s1:ゲーデル関数の例}

\section{双半群の使い方}\label{s1:双半群の使い方} %{
	数学の重要な道具として準同型がある。準同型は、
	\begin{itemize}
		\item 準同型によって演算結果の対応関係がつけられて、
		\item 準同型の合成は準同型になる
	\end{itemize}
	というものである。
	\begin{equation*}\xymatrix{
		A\times A \ar[d]^{m_A} \ar[r]^{f\times f} & B\times B \ar[d]^{m_B} \ar[r]^{g\times g} & C\times C \ar[d]^{m_C} \\
		A \ar[r]^{f} & B \ar[r]^{g} & C \\
	}\end{equation*}
	この性質を満たすように準同型を拡張してみる。対角的な直積$f\times f$の
	代わりに余積を用いて次のような可換図を考える。
	\begin{equation*}\xymatrix{
		A\times A \ar[d]^{m_A} \ar[r]^{\Delta f} & B\times B \ar[d]^{m_B} \ar[r]^{\Delta g} & C\times C \ar[d]^{m_C} \\
		A \ar[r]^{f} & B \ar[r]^{g} & C \\
	}\end{equation*}
	写像の合成を$\circ$と書くと、合成が成り立つための条件は次のようになる。
	\begin{equation*}\begin{split} %{
		\Delta(g\circ f) &= (\Delta g)\circ(\Delta f) \\
	\end{split}\end{equation*} %}
	この式は、$\circ$を積、$\Delta$を余積とする双対の関係に他ならない。
	$\Delta$を群的な余積とした場合が準同型となる。
%s1:双半群の使い方}

\section{パーサーの方針}\label{s1:パーサーの方針} %{ 
	最初の問題設定として、文字列が与えられたパターンに合致するかどうかを
	判定する問題を考える。文字列の集合として、有限集合$A$から生成された
	自由モノイド$A^*$を考える。$A^*$からブーリアン、自然数、複素数などの
	可換半環$B$への写像全体$B^A$を考える。$B^A$には$B$の代数構造を反映した
	代数構造を定めることができて、$B^A$は半環となる。
	パターンを与えるということは$B^A$の元を一つ定めることになるだろう。
	そして、任意の単語$w_1,w_2$に対して、$f(w_1*w_2)=(\Delta f)(w_1\times w_2)$
	で$B^A$に余積$\Delta$を定めることができれば、最終的には一文字のマッチング
	にまで帰着させることができる。
	そして、$a\rhd f=(\Delta f)(a\times-)$で$A^*$の$B^A$への作用を定義すると、
	モノイド$A$の$A\rhd f\subseteq A^B$への表現を得ることができる。
	この表現が言語理論でのオートマトンと呼ばれているものになると思われる。
	また、正規表現に対するBrzozowski微分$D$は、$\Delta f=1\otimes f + Df$
	になるのではないかと思っている。

	半単純リー環の場合、表現を用いた分類(A,B,...)がされている。
	オートマトンでも半単純に相当する性質が定義できて、その分類ができればうれしい。
%s1:パーサーの方針}

\section{分配性}\label{s2:分配性} %{
	分配性が成り立つような乗法の定義の仕方を考える。$A=(A,+,0)$を可換モノイドとする。
	$A$から$A$への写像全体を$MA$と書く。$MA$は、写像の合成を積、恒等写像$1_{MA}$
	を単位元とするモノイドになる。写像の合成の記号は省略する。さらに、次のようにして
	$MA$に積$+$を定義することができる。
	\begin{equation*}\begin{split} %{
		(f+g)a &= fa + ga \\
	\end{split}\end{equation*} %}
	$a\in A$への恒等写像を$a^*$とする。特に、$0^*$は積$+$の単位元となる。
	$MA$の中で半群準同型を満たす元の集まりを$HA$と書く。
	\begin{equation*}\begin{split} %{
		HA &= \set{f\in MA\bou f \text{ satisfies the below condition}} \\
			& f(a_1+a_2) = fa_1 + fa_2 \text{ for all }a_1,a_2\in A \\
	\end{split}\end{equation*} %}
	$HA$は写像の合成と$+$で閉じている。
	\begin{equation*}\begin{split} %{
		fg(a_1+a_2) &= f(ga_1+ga_2) \\
			&= fga_1 + fga_2 \\
		(f+g)(a_1+a_2) &= f(a_1+a_2) + g(a_1+a_2)  = fa_1 + fa_2 + ga_1 + ga_2 \\
			& = (f+g)a_1 + (f+g)a_2 \\
	\end{split}\end{equation*} %}
	さらに、$HA$は写像の合成と$+$で分配性を持つ。
	\begin{equation*}\begin{split} %{
		f(g+h)a &= fga + fha = (fg+fh)a \\
		(f+g)ha &= fha + gha = (fh+gh)a \\
	\end{split}\end{equation*} %}

	以上の事柄をブーリアン$\mybf{B}=(\set{0,1},+,0)$で確かめてみる。
	可換な積$+$は論理和で定義する。
	\begin{equation*}\begin{split} %{
		+: \mybf{B}\times \mybf{B} &\to \mybf{B} \\
			b_1\times b_2 &\mapsto \begin{cases}
				0, &\text{ iff } b_1 = b_2 = 0 \\
				1, &\text{ otherwise } \\
			\end{cases}
	\end{split}\end{equation*} %}
	からへの写像全体$M\mybf{B}$は$M\mybf{B}=\set{0^*,1^*,\myid,\neg}$となる。$0^*,1^*$
	はそれぞれ$0,1$への定数写像、$\myid$は恒等写像、$\neg$は次のように定義する。
	\begin{equation*}\begin{split} %{
		\neg \begin{pmatrix}
			0 \\
			1 \\
		\end{pmatrix} &= \begin{pmatrix}
			1 \\
			0 \\
		\end{pmatrix} \\
	\end{split}\end{equation*} %}
	群表は次のようになる。
	\begin{equation*}\begin{split} %{
		\bordermatrix {
			+ & 0^* & 1^* & \neg & \myid \\
			0^* & 0^* & 1^* & \neg & \myid \\
			1^* & 1^* & 1^* & 1^* & 1^* \\
			\neg & \neg & 1^* & \neg & 1^* \\
			\myid & \myid & 1^* & 1^* & \myid \\
		} & \quad \bordermatrix {
			\text{合成} & 0^* & 1^* & \neg & \myid \\
			0^* & 0^* & 0^* & 0^* & 0^* \\
			1^* & 1^* & 1^* & 1^* & 1^* \\
			\neg & 1^* & 0^* & \myid & \neg \\
			\myid & 0^* & 1^* & \neg & \myid \\
		} \\
	\end{split}\end{equation*} %}
	$\neg$は次のとおり準同型とならない。
	\begin{equation*}\begin{split} %{
		\neg(0+1) = 0 \neq 1 = \neg0 + \neg1 \\
	\end{split}\end{equation*} %}
	$\neg$以外は準同型となるから、$M\mybf{B}$の中で準同型となるものの部分集合
	$H\mybf{B}$は$H\mybf{B}=\set{0^*,1^*,\myid}$となる。$H\mybf{B}$の群表は次の
	ようになる。
	\begin{equation}\label{eq:論理和の分配的な双対空間}\begin{split} %{
		\bordermatrix {
			+ & 0^* & 1^* & \myid \\
			0^* & 0^* & 1^* & \myid \\
			1^* & 1^* & 1^* & 1^* \\
			\myid & \myid & 1^* & \myid \\
		} & \quad \bordermatrix {
			\text{合成} & 0^* & 1^* & \myid \\
			0^* & 0^* & 0^* & 0^* \\
			1^* & 1^* & 1^* & 1^* \\
			\myid & 0^* & 1^* & \myid \\
		} \\
	\end{split}\end{equation} %}
	計算してみると、$H\mybf{B}$は分配性を持つことがわかる。以上より、上で述べた
	ことが確かめられる。

	式を見ると、部分集合$H_0\mybf{B}=\set{0^*,\myid}$は写像の合成と$+$について
	閉じているのがわかる。さらに、$H_0\mybf{B}$では次の事柄が成り立っている。
	\begin{itemize}
		\item 写像の合成が可換になる。
		\item 任意の$f\in H_0\mybf{B}$に対して、$0^*f=0^*=f0^*$が成り立つ。
		\item $+$に関して、$\mybf{B}$と同型$\varphi$になる。
		\begin{equation*}\begin{split} %{
			\varphi: \mybf{B} &\to H_0\mybf{B} \\
			\begin{pmatrix} 
				0 \\
				1 \\
			\end{pmatrix}
			&\mapsto \begin{pmatrix}
				0^* \\
				\myid \\
			\end{pmatrix}
		\end{split}\end{equation*} %}
	\end{itemize}
	$H\mybf{B}$は、$1^*0^*\neq0^*$なので、半環ではないが、$H_0\mybf{B}$は半環となる。
	したがって、$+$に関する$\mybf{B}$と$H_0\mybf{B}$のモノイド同型によって、
	$\mybf{B}$に乗法が定義される。

	\begin{problem}[分配的になる積に対する条件]\label{prob:分配的になる積に対する条件} %{ 
	$H\mybf{B}$にどのような条件を課すと$H_0\mybf{B}$が得られるのだろうか。
	また、ここで観察した$\mybf{2}$の論理和の場合は、任意の可換半群から半環を
	得ることに一般化できるだろうか。
	\end{problem} %prob:分配的になる積に対する条件}

	一般の場合に戻って問題を考えてみる。次の方法が考えられる。
	\begin{itemize}
		\item 逐次的な方法 \\
		$\set{0^*,1_M}\subseteq HA$の群表は次のようになる。
		\begin{equation}\begin{split} %{
			\bordermatrix {
				+ & 0^* & 1_M \\
				0^* & 0^* & 1_M \\
				1_M & 1_M & ? \\
			} & \quad \bordermatrix {
				\text{合成} & 0^* & 1_M \\
				0^* & 0^* & 0^* \\
				1_M & 0^* & 1_M \\
			} \\
		\end{split}\end{equation} %}
		$1_M+1_M$のところが未定である。任意の$a\in A$に対して、$(1_M+1_M)a=a+a$である。
		したがって、次の場合があり得る。
		\begin{itemize}
			\item $1_M+1_M=0^*$の場合は、任意の$a\in A$に対して、$0=a+a$となる。
			ブール代数でのXORなどが相当する。
			\item $1_M+1_M=1_M$の場合は、任意の$a\in A$に対して、$a=a+a$となる。
			ブール代数でのORなどが相当する。
			\item それ以外の場合は、$f_2=1_M+1_M\in HA$とおく。$f_2$は準同型となり、
			$0$を固定点に持つ。$\set{0^*,1_M,f_2}\subseteq HA$の群表は次のようになる。
			\begin{equation}\begin{split} %{
				\bordermatrix {
					+ & 0^* & 1_M & f_2 \\
					0^* & 0^* & 1_M & 0^* \\
					1_M & 1_M & f_2 & ? \\
					f_2 & 0^* & ? & 1_M + ? \\
				} & \quad \bordermatrix {
					\text{合成} & 0^* & 1_M & f_2 \\
					0^* & 0^* & 0^* & 0^* \\
					1_M & 0^* & 1_M & f_2 \\
					f_2 & 0^* & f_2 & 1_M + ? \\
				} \\
			\end{split}\end{equation} %}
			$f_2+1_M$と$f_2f_2=f_2+f_2$のところが未定である。
			こうやって、群表を埋めていった結果と$A$がモノイド同型になることを示せればよい。
			この方法で、$A$が可算集合の場合には構成的に乗法が定義できるように思える。
			\item 天下り的な方法 \\
			$HA$のなかで$0$を固定点に持つ元全体$H_0A$は$+$と写像の合成に関して閉じているので、
			半環となる。$A$と$H_0A$の$+$に関するモノイド同型が得られれば話が早い。
		\end{itemize}
	\end{itemize}
%s2:分配性}
